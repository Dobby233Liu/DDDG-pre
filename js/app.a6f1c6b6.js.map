{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/components/toolbox/subtools/color/sliderGroup.vue?c241","webpack:///./src/environments/browser.ts","webpack:///./src/environments/edge.ts","webpack:///./src/environments/electron.ts","webpack:///./src/environments/environment.ts","webpack:///./src/eventbus/event-bus.ts","webpack:///./src/components/message-console.vue?2422","webpack:///./src/renderables/character.ts","webpack:///./src/components/toolbox/tools/character/parts.vue?ae7b","webpack:///./src/components/ui/d-fieldset.vue?5378","webpack:///./src/components/toolbox/tools/notification.vue?f255","webpack:///./src/constants/game_modes/ddlc_plus/base.ts","webpack:///./src/util/colors/rgb.ts","webpack:///./src/components/toolbox/toolbox.vue?3600","webpack:///./src/components/ui/link.vue","webpack:///./src/components/ui/link.vue?17aa","webpack:///./src/components/ui/link.vue?b75b","webpack:///./src/renderables/offscreenRenderable.ts","webpack:///./src/models/repo.ts","webpack:///./src/renderables/assetListRenderable.ts","webpack:///./src/components/ui/d-button.vue?18fe","webpack:///./src/components/toolbox/tools/settings.vue?71f4","webpack:///./src/components/toolbox/tools/panels.vue?3bf5","webpack:///./src/constants/game_modes/ddlc/textBoxCustom.ts","webpack:///./src/asset-manager.ts","webpack:///./src/components/toolbox/tools/background/settings.vue?4e30","webpack:///./src/components/toolbox/tools/choice.vue?2070","webpack:///./src/store/objectTypes/baseObjectProps.ts","webpack:///./src/components/toolbox/tools/textbox.vue?c624","webpack:///./src/components/toolbox/tools/credits.vue?600d","webpack:///./src/renderer/rendererContext.ts","webpack:///./src/components/toolbox/tools/background/button.vue?6543","webpack:///./src/constants/game_modes/ddlc_plus/textBoxCustom.ts","webpack:///./src/components/toolbox/commonsFieldsets/layers.vue?59e8","webpack:///./src/renderer/renderAbortedException.ts","webpack:///./src/components/toolbox/tools/poem.vue?5535","webpack:///./src/components/toolbox/subtools/image-options/image-options.vue?9b20","webpack:///./src/components/toolbox/commonsFieldsets/positionAndSize.vue?05a1","webpack:///./src/components/toggle.vue?38e4","webpack:///./src/util/rotation.ts","webpack:///./src/constants/game_modes/ddlc/choices.ts","webpack:///./src/constants/game_modes/ddlc/notification.ts","webpack:///./src/constants/game_modes/ddlc/index.ts","webpack:///./src/constants/game_modes/ddlc_plus/choices.ts","webpack:///./src/constants/game_modes/ddlc_plus/notification.ts","webpack:///./src/constants/game_modes/ddlc_plus/poem.ts","webpack:///./src/constants/game_modes/ddlc_plus/index.ts","webpack:///./src/constants/index.ts","webpack:///./src/models/error-asset.ts","webpack:///./src/App.vue?dad2","webpack:///./src/components/ui/d-flow.vue?c366","webpack:///./src/components/toolbox/tools/object-tool.vue?7b8b","webpack:///./src/components/vertical-scroll-redirect.ts","webpack:///./src/components/toolbox/subtools/color/slider.vue?0f21","webpack:///./src/components/toolbox/subtools/text/text.vue?8917","webpack:///./src/components/ui/d-fieldset.vue","webpack:///./src/components/ui/d-fieldset.vue?b40b","webpack:///./src/components/ui/d-fieldset.vue?68b3","webpack:///./src/components/toolbox/tools/backgrounds.vue?27ab","webpack:///./src/store/objectTypes/characters.ts","webpack:///./src/components/ModalDialog.vue?073b","webpack:///./src/components/toolbox/subtools/color/color.vue?eb32","webpack:///./src/components/toggle.vue","webpack:///./src/components/toggle.vue?bbb0","webpack:///./src/components/toggle.vue?563e","webpack:///./src/models/seekers.ts","webpack:///./src/constants/game_modes/ddlc_plus/textBox.ts","webpack:///./src/App.vue","webpack:///./src/components/toolbox/toolbox.vue","webpack:///./src/components/toolbox/tools/settings.vue","webpack:///./src/components/toolbox/tools/panelMixin.ts","webpack:///./src/components/ModalDialog.vue","webpack:///./src/components/ModalDialog.vue?1c09","webpack:///./src/components/ModalDialog.vue?d092","webpack:///./src/util/errors.ts","webpack:///./src/components/toolbox/tools/settings.vue?ffc4","webpack:///./src/components/toolbox/tools/settings.vue?175a","webpack:///./src/components/toolbox/tools/add.vue","webpack:///./src/components/ui/d-button.vue","webpack:///./src/components/ui/d-button.vue?c8db","webpack:///./src/components/ui/d-button.vue?96c1","webpack:///./src/components/toolbox/tools/add.vue?283d","webpack:///./src/components/toolbox/tools/add.vue?f544","webpack:///./src/components/toolbox/tools/character.vue","webpack:///./src/components/toolbox/tools/character/parts.vue","webpack:///./src/components/toolbox/tools/character/partButton.vue","webpack:///./src/components/toolbox/tools/character/partButton.vue?3b03","webpack:///./src/components/toolbox/tools/character/partButton.vue?542d","webpack:///./src/components/ui/d-flow.vue","webpack:///./src/components/ui/d-flow.vue?003a","webpack:///./src/components/toolbox/tools/character/parts.vue?7498","webpack:///./src/components/toolbox/tools/character/parts.vue?7e61","webpack:///./src/util/simpleSettable.ts","webpack:///./src/components/toolbox/tools/object-tool.vue","webpack:///./src/components/toolbox/commonsFieldsets/positionAndSize.vue","webpack:///./src/renderer/textRenderer/string-walker.ts","webpack:///./src/renderer/textRenderer/tokenizer.ts","webpack:///./src/renderer/textRenderer/textCommands.ts","webpack:///./src/util/exhaust.ts","webpack:///./src/renderer/textRenderer/textRenderer.ts","webpack:///./src/renderables/scalingRenderable.ts","webpack:///./src/renderables/textboxRenderers/ddlc_base.ts","webpack:///./src/renderables/textboxRenderers/default.ts","webpack:///./src/renderables/textboxRenderers/corrupt.ts","webpack:///./src/renderer/pathTools.ts","webpack:///./src/renderables/textboxRenderers/custom.ts","webpack:///./src/renderables/textboxRenderers/none.ts","webpack:///./src/renderables/textboxRenderers/ddlc_plus_base.ts","webpack:///./src/renderables/textboxRenderers/custom_plus.ts","webpack:///./src/renderables/textbox.ts","webpack:///./src/components/toolbox/commonsFieldsets/positionAndSize.vue?5867","webpack:///./src/components/toolbox/commonsFieldsets/positionAndSize.vue?28a6","webpack:///./src/components/toolbox/commonsFieldsets/layers.vue","webpack:///./src/components/toolbox/commonsFieldsets/layers.vue?ff96","webpack:///./src/components/toolbox/commonsFieldsets/layers.vue?32a0","webpack:///./src/components/toolbox/commonsFieldsets/delete.vue","webpack:///./src/components/toolbox/commonsFieldsets/delete.vue?8f34","webpack:///./src/components/toolbox/commonsFieldsets/delete.vue?3356","webpack:///./src/components/toolbox/subtools/image-options/image-options.vue","webpack:///./src/components/toolbox/subtools/color/slider.vue","webpack:///./src/components/toolbox/subtools/color/slider.vue?d57c","webpack:///./src/components/toolbox/subtools/color/slider.vue?1cb9","webpack:///./src/components/toolbox/subtools/color/color.vue","webpack:///./src/components/toolbox/subtools/color/sliderGroup.vue","webpack:///./src/components/toolbox/subtools/color/sliderGroup.vue?4e6a","webpack:///./src/components/toolbox/subtools/color/sliderGroup.vue?1ef8","webpack:///./src/components/toolbox/subtools/color/color.vue?5cc8","webpack:///./src/components/toolbox/subtools/color/color.vue?8003","webpack:///./src/store/sprite_options.ts","webpack:///./src/components/toolbox/subtools/image-options/image-options.vue?e076","webpack:///./src/components/toolbox/subtools/image-options/image-options.vue?11a3","webpack:///./src/components/toolbox/subtools/text/text.vue","webpack:///./src/components/toolbox/subtools/text/text.vue?8f59","webpack:///./src/components/toolbox/subtools/text/text.vue?e6bc","webpack:///./src/components/toolbox/tools/object-tool.vue?bb85","webpack:///./src/components/toolbox/tools/object-tool.vue?4815","webpack:///./src/components/toolbox/tools/character.vue?72b6","webpack:///./src/components/toolbox/tools/character.vue?e8cb","webpack:///./src/components/toolbox/tools/sprite.vue","webpack:///./src/components/toolbox/tools/sprite.vue?a683","webpack:///./src/components/toolbox/tools/sprite.vue?a58f","webpack:///./src/components/toolbox/tools/textbox.vue","webpack:///./src/components/toolbox/tools/textbox.vue?0f2e","webpack:///./src/components/toolbox/tools/textbox.vue?b36e","webpack:///./src/components/toolbox/tools/choice.vue","webpack:///./src/components/toolbox/tools/choice.vue?7308","webpack:///./src/components/toolbox/tools/choice.vue?ecd7","webpack:///./src/components/toolbox/tools/credits.vue","webpack:///./src/components/toolbox/tools/credits.vue?4104","webpack:///./src/components/toolbox/tools/credits.vue?4a91","webpack:///./src/components/toolbox/tools/backgrounds.vue","webpack:///./src/components/toolbox/tools/background/button.vue","webpack:///./src/components/toolbox/tools/background/button.vue?b7cb","webpack:///./src/components/toolbox/tools/background/button.vue?2499","webpack:///./src/components/toolbox/tools/background/settings.vue","webpack:///./src/components/toolbox/tools/background/settings.vue?6031","webpack:///./src/components/toolbox/tools/background/settings.vue?25f2","webpack:///./src/components/toolbox/tools/backgrounds.vue?b9bb","webpack:///./src/components/toolbox/tools/backgrounds.vue?9860","webpack:///./src/components/toolbox/tools/content-pack.vue","webpack:///./src/components/toolbox/tools/content-pack.vue?4942","webpack:///./src/components/toolbox/tools/content-pack.vue?a00e","webpack:///./src/components/toolbox/tools/panels.vue","webpack:///./src/store/panels.ts","webpack:///./src/renderables/background.ts","webpack:///./src/renderables/sprite.ts","webpack:///./src/renderables/choices.ts","webpack:///./src/renderables/notification.ts","webpack:///./src/renderables/poem.ts","webpack:///./src/renderables/scene-renderer.ts","webpack:///./src/components/toolbox/tools/panels.vue?19b3","webpack:///./src/components/toolbox/tools/panels.vue?3f6d","webpack:///./src/components/toolbox/tools/notification.vue","webpack:///./src/components/toolbox/tools/notification.vue?5765","webpack:///./src/components/toolbox/tools/notification.vue?3253","webpack:///./src/components/toolbox/tools/poem.vue","webpack:///./src/components/toolbox/tools/poem.vue?4966","webpack:///./src/components/toolbox/tools/poem.vue?76f8","webpack:///./src/components/toolbox/toolbox.vue?d281","webpack:///./src/components/toolbox/toolbox.vue?6f67","webpack:///./src/components/message-console.vue","webpack:///./src/components/message-console.vue?c981","webpack:///./src/components/message-console.vue?fe48","webpack:///./src/components/render.vue","webpack:///./src/components/render.vue?3c85","webpack:///./src/components/render.vue?c91e","webpack:///./src/App.vue?1d14","webpack:///./src/App.vue?97f5","webpack:///./src/store/objectTypes/sprite.ts","webpack:///./src/store/objectTypes/choices.ts","webpack:///./src/util/math.ts","webpack:///./src/store/objectTypes/textbox.ts","webpack:///./src/store/objectTypes/notification.ts","webpack:///./src/store/objectTypes/poem.ts","webpack:///./src/store/objects.ts","webpack:///./src/store/ui.ts","webpack:///./src/store/content/merge.ts","webpack:///./src/store/content/index.ts","webpack:///./src/store/index.ts","webpack:///./src/plugins/vuex-history.js","webpack:///./src/main.ts","webpack:///./src/components/toolbox/tools/object-tool.vue?f155","webpack:///./src/constants/game_modes/ddlc/textBox.ts","webpack:///./src/components/toolbox/drop-target.vue","webpack:///./src/components/toolbox/drop-target.vue?2f60","webpack:///./src/components/toolbox/drop-target.vue?d003","webpack:///./src/components/toolbox/tools/character.vue?3b75","webpack:///./src/components/toolbox/tools/character/partButton.vue?1308","webpack:///./src/constants/game_modes/ddlc/base.ts","webpack:///./src/util/colors/hsl.ts","webpack:///./src/components/toolbox/tools/content-pack.vue?2b70","webpack:///./src/components/toolbox/tools/add.vue?063b","webpack:///./src/constants/game_modes/ddlc/poem.ts","webpack:///./src/components/toolbox/drop-target.vue?a4ce","webpack:///./src/renderer/renderer.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","installedCssChunks","jsonpScriptSrc","p","exports","module","l","e","promises","cssChunks","Promise","resolve","reject","href","fullhref","existingLinkTags","document","getElementsByTagName","tag","dataHref","getAttribute","rel","existingStyleTags","linkTag","createElement","type","onload","onerror","event","request","target","src","err","Error","code","parentNode","removeChild","head","appendChild","then","installedChunkData","promise","onScriptComplete","script","charset","timeout","nc","setAttribute","error","clearTimeout","chunk","errorType","realSrc","message","name","undefined","setTimeout","all","m","c","d","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","oe","console","jsonpArray","window","oldJsonpFunction","slice","state","autoAdd","downloadLocation","_gameMode","vuexHistory","$store","isSavingEnabled","localRepositoryUrl","self","this","canSave","IndexedDBHandler","addEventListener","preventDefault","returnValue","supports","optionalSaving","backgroundInstall","localRepo","lq","setDownloadFolder","openableFolders","Set","loading","doesDbExists","exists","savingEnabled","creatingDB","loadAutoload","autoload","getInstance","repo","packUrls","map","id","pack","getPack","dddg2Path","dddg1Path","transaction","dispatch","searchParams","URLSearchParams","location","search","getMode","stored","loadGameMode","saveGameMode","folder","store","downloadCanvas","filename","format","quality","a","createObjectURL","url","body","click","background","authors","saveAutoload","filter","x","idx","indexOf","base","darkMode","nsfw","defaultCharacterTalkingZoom","loadSettings","settings","saveSettings","defaultValue","prompt","handler","canvas","canCreateObjectUrl","URL","toDataURL","toBlob","blob","dataURItoBlob","dataURI","binStr","atob","split","len","arr","Uint8Array","charCodeAt","Blob","localStorage","setItem","createDB","catch","clear","clearDB","indexedDB","mozIndexedDB","webkitIndexedDB","msIndexedDB","IDBTransaction","webkitIDBTransaction","msIDBTransaction","db","saving","getItem","req","open","onupgradeneeded","oldVer","oldVersion","version","createObjectStore","deleteObjectStore","onsuccess","deleteDatabase","objectStorePromise","reqPromise","autoloads","put","callback","transact","objectStore","navigator","msSaveBlob","installedBackgroundsPack","packId","dependencies","packCredits","characters","fonts","sprites","poemStyles","poemBackgrounds","backgrounds","colors","electron","bgInvalidation","pendingContentPacks","autoLoading","ipcRenderer","on","filePath","filepath","parts","variants","label","scaling","invalidateInstalledBGs","fire","onConversation","packIds","reloadLocalRepo","contentPack","processed","send","sendConvo","arrayBuffer","buffer","assets","sourcePack","hq","asset","HTMLImageElement","fetch","img","array","startsWith","newUrl","requestAnimationFrame","updateInstalledBGs","cancelAnimationFrame","chooseEnv","isElectron","msSaveOrOpenBlob","envX","toast","eventBus","emit","kind","subscribe","eventType","unsubscribe","off","AssetFailureEvent","path","FailureEvent","CustomAssetFailureEvent","InvalidateRenderEvent","ShowMessageEvent","ColorPickedEvent","color","VueErrorEvent","info","Character","obj","scaleable","panelId","pose","currentHeads","drawAssetsUnloaded","renderCommands","renderCommand","offset","composite","posePositions","images","posePosition","positions","part","partAssets","size","zoom","close","width","closeZoom","height","screenWidth","screenHeight","sdCharacterScaleFactor","hdCharacterScaleFactor","CloseUpYOffset","BaseCharacterYPos","characterPositions","RGBAColor","g","b","Math","round","toString","padStart","h","max","min","sqrt","pow","str","validCssRgb","validHex","fromCssRgb","fromHex","rgbEx","test","rgbaEx","rgbHead","parentesisPos","rbgTail","elements","parseFloat","trim","hexShortEx","hexLongEx","hexTail","parseInt","mixins","props","to","String","required","computed","replace","_","page","replaceAll","render","OffscreenRenderable","localRenderer","lastVersion","hitDetectionFallback","renderable","lastHq","ready","canvasWidth","canvasHeight","renderLocal","flip","rotation","y","selected","rx","needRedraw","needsRedraw","updateLocalCanvas","getRenderRotation","rotationAnchor","drawImage","image","canvasDrawPosX","canvasDrawPosY","w","canvasDrawWidth","canvasDrawHeight","shadow","preview","blur","filters","hx","hy","hitbox","getHitbox","centerX","x0","x1","centerY","y0","y1","rotatedHitX","rotatedHitY","hit","pixelPerfectHitTest","angle","anchor","innerX","innerY","flippedX","scaleX","scaleY","getDataAt","_current","PI","repoUrl","Repo","onlineRepo","packs","combinedList","onlinePacks","onlineRepoLookup","Map","localPacks","localRepoLookup","loadedPackOrder","content","contentPacks","loadedPacksSet","addedPacks","has","add","autoloading","installed","online","loaded","onlineAuthors","localAuthors","freeze","loadRepo","getPacks","find","instance","createInstance","onlineRepoLoading","localRepoLoading","onlineRepoLoaded","localRepoLoaded","fetchJSON","ok","json","setStore","AssetListRenderable","refTextbox","zoomWidthDelta","objZoom","zoomHeightDelta","panel","objects","panels","inPanel","order","onTopOrder","talkingObjId","getAssetList","drawAsset","loadAssets","loadedDraws","loadedDraw","textboxZoom","enlargeWhenTalking","unloaded","textboxDefaultColor","controlsDefaultColor","nameboxDefaultColor","nameboxStrokeDefaultColor","nameboxTextOutlineDelta","nameboxBackgroundDelta","nameboxGradientMiddleStopPosition","nameboxGradientEndDelta","nameboxRounding","nameboxRoundingBuffer","textboxRounding","textboxRoundingBuffer","nameColorThreshold","controlColorDelta","controlDisableColorDelta","dotColorDelta","dotRadius","dotPatternSize","textboxOutlineColorDelta","textboxOutlineWidth","webpSupportPromise","heifSupportPromise","isWebPSupported","_reject","losslessCode","isHeifSupported","log","assetCache","customAssets","getAAsset","getAssetByUrl","Image","crossOrigin","style","display","baseUrl","getAsset","registerAsset","file","registerAssetWithURL","baseProps","opacity","Base","textboxColor","nameboxWidth","RenderContext","fsCtx","aborted","params","save","font","align","text","lineJoin","textAlign","outline","strokeStyle","lineWidth","strokeText","fill","fillStyle","fillText","restore","ret","measureText","globalCompositeOperation","filterList","offsetX","offsetY","blurRadius","join","opacityCombined","globalAlpha","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","rotX","rotY","translate","fillRect","rotate","scale","paintOnto","composition","beginPath","rect","stroke","repetition","previewCanvas","createPattern","transform","createLinearGradient","getContext","context","RenderAbortedException","rotateAround","relX","relY","angleCos","cos","angleSin","sin","translatedX","translatedY","rotatedX","rotatedY","ChoiceButtonColor","ChoiceButtonBorderColor","ChoiceButtonWidth","ChoiceSpacing","ChoiceX","ChoiceYOffset","ChoicePadding","Outline","ChoiceY","ChoiceTextStyle","alpha","fontName","fontSize","isBold","isItalic","isStrikethrough","isUnderlined","letterSpacing","lineSpacing","strokeColor","strokeWidth","NotificationBackgroundColor","NotificationBorderColor","NotificationBackdropColor","NotificationPadding","NotificationSpacing","NotificationOkTextStyle","NotificationTextStyle","Choices","Notification","Poem","TextBox","TextBoxCustom","defaultPoemBackground","defaultPoemStyle","defaultX","defaultY","poemTopPadding","poemBottomPadding","poemPadding","defaultPoemWidth","defaultPoemHeight","consoleBackgroundColor","consoleWidth","consoleHeight","defaultConsoleBackground","defaultConsoleStyle","BasePoemStyle","poemTextStyles","getConstants","gameMode","ErrorAsset","firefoxDeltaFactor","VerticalScrollRedirect","methods","verticalScrollRedirect","currentTarget","getComputedStyle","ev","deltaY","overflowY","scrollHeight","scrollTop","clientHeight","stopPropagation","oldScrollLeft","scrollLeft","mozInputSource","class","title","__scopeId","characterMutations","setPose","command","poseId","setCharStyleGroup","styleGroupId","setCharStyle","styleId","setPosePosition","setClose","setFreeMove","freeMove","constants","closestCharacterSlot","getData","getters","characterType","getDataG","rootGetters","getPose","styleGroups","styles","poses","getParts","positionKeys","keys","positionKey","compatibleHeads","unshift","getHeads","headTypeId","headType","heads","pos","sorted","abs","sort","lastSpriteId","characterActions","createCharacters","rootState","commit","char","charScale","hd","currentPanel","onTop","preserveRatio","ratio","defaultScale","ui","seekPart","delta","seekPose","mutatePoseAndPositions","change","seekStyle","linearStyles","flatMap","styleGroup","styleGroupIdx","styleIdx","styleGroupJson","JSON","stringify","components","styleA","styleB","localeCompare","linearIdx","findIndex","nextIdx","seekHead","headKey","setPart","val","setCharacterPosition","shiftCharacterSlot","currentSlotNr","newSlotNr","fixContentPackRemovalFromCharacter","oldPack","oldCharData","poseAndPositionChange","buildPoseAndPositionData","oldStyleGroup","oldStyle","oldPose","newCharData","current","chr","newStyleGroupIdx","newStyleGroup","styleProperies","newStyleIdx","newStyle","newPoseIdx","newPose","newPosePositions","newPosition","oldPositionIdx","oldHeadGroup","newHeadGroupIdx","oldHead","newHeadIdx","variant","commitPoseAndPositionChanges","character","poseAndPosition","oldHeadCollection","newHeadCollectionNr","uid","ref","for","modelValue","Boolean","default","set","$emit","checkbox","$refs","arraySeeker","TextBoxWidth","TextBoxCorruptedWidth","TextBoxHeight","TextBoxKerning","TextBoxLineHeight","TextBoxCorruptedKerning","TextBoxTextXOffset","TextBoxTextYOffset","TextBoxBottomSpacing","TextBoxTextCorruptedXOffset","TextBoxTextCorruptedYOffset","NameboxHeight","NameboxWidth","NameboxXOffset","NameboxTextYOffset","ControlsYBottomOffset","ControlsXHistoryOffset","ControlsXSkipOffset","ControlsXStuffOffset","ArrowXRightOffset","ArrowYBottomOffset","GlowRX","GlowRY","BaseTextStyle","NameboxTextStyle","ControlsTextStyle","ControlsTextDisabledStyle","TextBoxStyle","TextBoxCorruptedStyle","TextBoxX","TextBoxCorruptedX","TextBoxTextX","NameboxX","NameboxTextX","ControlsXHistory","ControlsXSkip","ControlsXStuff","DefaultTextboxStyle","canvasTooSmall","isSafari","preLoading","drawLastDownload","download","showDialog","showExpressionDialog","dialogVisable","expressionBuilderVisible","expressionBuilderCharacter","initHeadGroup","expressionBuilderHeadGroup","aria-hidden","vertical","setPanel","aria-label","$event","disabled","hasPrevRender","allowSavesModal","options","allowSaves","no-base-size","denySavesModal","denySaves","showModeDialog","modeChange","waitOnSaveChange","savesAllowed","savesEnabledInEnv","inPlusMode","lqAllowed","lqRendering","theme","showDownloadFolder","downloadFolder","openDownloadFolder","PanelMixin","mounted","updateVertical","$el","passive","classList","remove","watch","noBaseSize","option","Array","safeAsync","normalizeError","stack","stackLines","includes","Toggle","ModalDialog","L","environment","allowed","useDarkTheme","choice","baseLoc","protocol","host","pathname","updateDownloadFolder","openFolder","showDropTarget","hideDropTarget","addCustomSpriteFile","group","icon-pos","icon","onChosen","toLowerCase","assetPath","alt","sprite","assetSpriteBackground","addSpriteToScene","spriteUpload","onSpriteFileUpload","uploadFromURL","showSpritesFolder","openSpritesFolder","addTextBox","addPoem","addDialog","addChoice","addConsole","paste","hasClipboardContent","iconPos","uploadedSpritesPack","DropTarget","DButton","customAssetCount","clipboard","chibi","dataTransfer","effectAllowed","from","items","item","match","spriteDt","show","hide","uploadInput","files","lastSegment","addNewCustomSprite","created","showAltPanel","panelForParts","alt-panel","hasMultiplePoses","hasMultipleStyles","captialize","closeUp","no-wraping","charData","index","styleComponents","styleComponent","noWraping","buttons","button","choose_component","spriteSize","Number","lookups","backgroundSize","floor","backgroundPosition","lookup","backgroundImage","direction","maxSize","gap","finalDirection","wrapingClass","attrs","flowContainer","$slots","scrollContainer","PartButton","DFieldset","DFlow","stylePriorities","component","collection","currentPose","headKeyIdx","headIdx","headImages","previewSize","previewOffset","currentStyle","poseIdx","generatePosePreview","partIdx","partImage","updateStyleData","baseStyle","concat","updatePose","selection","priority","subSelect","choose","headTypeIdx","prioIdx","stylePriority","genericSetable","action","hasLabel","enableNameEdit","heading","showRename","renameOption","modalNameInput","textHandler","leave","finalColorHandler","imageOptionsOpen","step","useCustomTextboxColor","selectTextboxColor","placeholder","defaultNameboxWidth","copy","colspan","allowSize","allowStepMove","isFirstPos","positionNames","isLastPos","aroundContextSize","tokenize","tokens","stringWalker","currentTokenState","tokenStateNormal","tokenStateEnd","contents","walker","tokenStateCommand","tokenStateNewLine","tokenText","nextState","textContent","escape","next","msg","around","closing","commandName","argument","argumentsState","paramlessOp","relativeNumberOp","relative","parameter","op","num","isNaN","exhaust","rebuildParts","renderParts","getRenderParts","neededToLoad","doc","fontString","check","load","ctx","applyTextStyleToCanvas","State","lastChar","None","ExplictQuote","Star","measureWidth","ImplictQuote","lastPart","alignment","xStart","xEnd","yStart","maxLineWidth","currentLine","fixLine","applyLineWrapping","lineHeights","lineHeight","line","lastItem","lastItemInLine","styleStack","tagStack","currentStyleHeight","measureHeight","currentTag","token","TextRenderer","textCommands","pop","lastBreakPoint","currentLineWidth","lastBreakLineWidth","newParts","tmpContext","lastStyle","textStyle","heightCache","innerHTML","fontFamily","div","position","top","left","offsetHeight","lastWidth","lastHeight","lastX","lastY","lastFlip","draw","customTransform","trx","flipNormalizedCenterX","vCentered","centeredVertically","w2","h2","baseX","controlsCenter","controlsStyle","getControlsStyle","drawText","skip","getControlsDisabledStyle","refObject","defaultHeight","xOffset","renderBackdrop","nameboxHeight","renderNamebox","nameboxOffsetX","bottom","controlsY","controls","renderControls","continue","Default","Corrupted","roundedRectangle","moveTo","arcTo","closePath","roundedTopRectangle","lineTo","clip","subRx","gradient","linearGradient","baseBG","fromCss","nameboxBackgroundColor","targetColor","toHSL","toRgb","addColorStop","toCss","drawRect","hslColor","customColor","dotPattern","dotRx","drawDot","dotX","dotY","drawPath","ellipse","_subSubRx","pattern","patternFrom","glowGradient","outlineColor","Custom","customNameboxWidth","nameboxOutlineColor","overrideColor","deriveCustomColors","customNameboxStroke","customNameboxColor","texts","textWidths","combinedLength","DdlcPlusBase","controlWidth","spacing","controlX","textWidth","widthCache","CustomPlus","styleRenderers","rendererLookup","renderer","_lastRenderer","talkingObj","styleRenderer","textboxRenderer","talkingOther","renderName","renderText","autoWrap","nameboxStyle","loadFonts","fixAlignment","nameboxOffsetY","baseY","textboxStyle","autoQuoting","quote","textOffsetX","textOffsetY","appliesTo","forcedStyle","newRenderer","resizable","shiftLayer","Infinity","onClick","showShadowColor","noComposition","compositionMode","addEffectSelection","filterTypes","filterType","getFilterLabel","addFilter","currentFilter","removeFilter","currentFilterIdx","moveFilter","filterIdx","selectFilter","getFilterText","shadowX","shadowY","isPercentFilter","toFixed","maxValue","minValue","gradientStops","no-input","setValue","hueStops","shift-gradient","noInput","xmlns","viewBox","enterSlide","moveSlide","exitSlide","gradientOffset","x2","y2","spreadMethod","stroke-width","paint-order","pointerPath","sliderLength","sliderOffset","shiftGradient","slideActive","svg","contains","MouseEvent","which","bounding","getBoundingClientRect","clientX","touches","scaledX","updateHex","addSwatch","pickColor","swatches","swatch","label1","v1","max-value","maxValue1","gradient-stops","stops1","label2","v2","maxValue2","stops2","label3","v3","maxValue3","stops3","stopsAlpha","Slider","validator","lastRGBEmit","stops","eightsStops","stop","initValues","valueChanged","updateValue","newColor","rgbColor","toHex","gen","generatedPackId","SliderGroup","inheritAttrs","emits","rgb","settingColor","unmounted","hex","existingPack","newPack","percentageValue","objLookup","setMutation","newFilter","moveBy","filterText","Color","_e","objectTypeScope","toUpperCase","colorSelector","selectedColor","applyColor","onValueChanged","insertText","insertCommand","selectedFont","selectColor","rememberedStart","rememberedEnd","textArea","el","selectionStart","selectionEnd","$nextTick","selStart","selEnd","focus","arg","selectedText","before","after","commandOpen","PositionAndSize","Layers","Delete","TextEditor","ImageOptions","colorHandler","canEdit","localColorHandler","Parts","ObjectTool","charAt","substring","textBoxStyle","nameList","jumpToCharacter","textEditor","dialog","customizable","showControls","allowSkipping","showContinueArrow","nameboxWidthDefault","colorSelect","customControlsColor","resetPosition","splitTextbox","textEditorName","colorName","btnIdx","currentIdx","select","buttonText","removeChoice","simpleButtonSettable","choices","choiceIdx","dragEnter","dt","addImageFile","bgColor","imageOptions","no-composition","upload","onFileUpload","addByUrl","showBackgroundsFolder","openBackgroundFolder","backgroundId","setBackground","isActive","bgData","urls","isColor","isVariant","flipped","hasVariants","seekVariant","currentBackgroundId","uploadedBackgroundsPack","BackgroundButton","BackgroundSettings","addNewCustomBackground","addNew","readonly","credits","activatable","activate","deactivatable","deactivate","installable","install","uninstallable","uninstall","needRestart","restart","selectedPack","active","queuedUninstall","freshInstall","reload","localRepoUninstall","autoLoadAdd","autoLoadRemove","ScalingModes","panelButtons","updateCurrentPanel","addNewPanel","deletePanel","canDeletePanel","moveAhead","canMoveAhead","moveBehind","canMoveBehind","webpSupport","heifSupport","isLossy","ppi","pages","estimateExportSize","transparentId","lastPanelNum","previewManager","panelToUrl","urlToPanel","register","unregister","delete","revokeObjectURL","namespaced","panelOrder","mutations","setCurrentPanel","setPanelPreview","lastRender","createPanel","setPanelOrder","setCurrentBackground","setBackgroundColor","setBackgroundFlipped","setBackgroundVariant","setBackgroundScaling","setComposition","setFilters","backgroundSetComposition","backgroundSetFilters","actions","Cover","duplicatePanel","parse","sourcePanelId","targetPanelId","root","oldIdx","seekBackgroundVariant","newOrderIdx","orderIdx","fixContentPackRemoval","oldContent","oldBackground","newBackground","oldVariantJSON","newVariantIdx","values","move","newIdx","mutation","setFilter","backgroundAddFilter","backgroundRemoveFilter","backgroundMoveFilter","backgroundSetFilter","compositeMode","Stretch","screenRatio","init","readyResolve","_height","choiceRenderers","updateChoiceBounds","choiceRenderer","getHeight","reduce","acc","choiceDistance","_width","backdrop","textRenderer","buttonRenderer","lineWrap","getWidth","textHeight","buttonWidth","buttonHeight","consolePadding","consoleTopPadding","consoleLineWrapPadding","poemTopMargin","paper","padding","topPadding","lineWrapPadding","renderObjectCache","lCurrentlyRendering","renderCallback","date","Date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","opts","getRenderObjects","renderObject","hitTest","imageSmoothingEnabled","imageSmoothingQuality","getBackgroundRenderer","updatedContent","applyFilters","objectsState","toUncache","estimateFactor","thumbnailFactor","thumbnailQuality","qualityFactor","defaultQuality","qualityWarningThreshold","objectOrders","txtBox","objId","extractObjectText","moveFocusToActivePanel","renderThumbnail","distribution","getPanelDistibution","prefix","extension","renderObjects","imageIdx","saveToFile","sizes","readableSizes","filePluralize","itPluralize","sizePluralize","mapper","baseConst","targetCanvas","panelIdx","sceneRenderer","getLimitedPanelList","listedPages","foundMatch","trimmedPart","ary","pageIdx","imageI","sliceStart","sliceEnd","querySelector","scrollIntoView","ele","parent","parentElement","children","scroll","clientWidth","oldQuality","subType","poemBackground","poemStyle","poem","SettingsPanel","AddPanel","BackgroundsPanel","CreditsPanel","CharacterPanel","TextBoxPanel","ChoicePanel","SpritePanel","ContentPacksPanel","PanelsPanel","NotificationPanel","PoemPanel","panelSelection","lastDownload","onPanelChange","newSelection","showLoading","messages","errors","dismissError","shortHidingTime","longHidingTime","hideShowTimeouts","showLoadingTimeout","hideLoadingTimeout","onLoadingChange","newValue","bitmapHeight","bitmapWidth","cursor","draggable","onUiClick","onTouchStart","onDragStart","onSpriteDragMove","onSpriteDrop","onDragOver","onDrop","onMouseEnter","sdCtx","currentlyRendering","queuedRender","showingLast","dropSpriteCount","dropPreventClick","draggedObject","dragXOffset","dragYOffset","dragXOriginal","dragYOriginal","sceneRender","pickerMode","oldUrl","invalidateRender","render_","unsafe","renderLoadingScreen","loadingScreen","rctx","make","toRendererCoordinate","sd","offsetLeft","ry","offsetTop","sx","offsetWidth","sy","clientY","getImageData","selectedObject","objectsAt","currentObjectIdx","dropEffect","deltaX","shiftKey","getAsFile","TouchEvent","mut","aspectRatio","arrowMoveStepSize","packDialogWaitMs","canvasTooSmallThreshold","nsfwPacks","names","ToolBox","MessageConsole","Render","SingleBox","ExpressionBuilder","blendOver","uiSize","systemPrefersDarkMode","userPrefersDarkMode","last","setBlendOver","optimum","sw","sh","rh","rw","optimizeWithMenu","opth","optv","updateArea","documentElement","cw","ch","v","wait","packDialog","setSearch","headGroup","onKeydown","HTMLInputElement","HTMLTextAreaElement","ctrlKey","destroyed","removeEventListener","applyTheme","toggle","matchMedia","matcher","matches","addListener","app","env","connectToStore","spriteMutations","spriteActions","createSprite","choiceMutations","setChoices","setChoiceColor","setChoiceDistance","setAutoWrapping","lastChoiceId","choiceActions","createChoice","setChoiceText","between","splitTextboxSpacing","textBoxMutations","setText","setTalkingObject","setTalkingOther","setStyle","setControlsVisible","setControlsColor","setDeriveCustomColors","setNameboxColor","setNameboxStroke","setNameboxWidth","setSkipable","setContinueArrow","setCustomColor","setAutoQuoting","setResetBounds","resetBounds","setColorOverride","lastTextBoxId","textBoxActions","createTextBox","defaultWidth","oldRenderer","safetyMargin","updatePos","posUpdate","updateSize","sizeUpdate","resetTextboxBounds","newWidth","centerDistance","baseCenter","boxOneCoords","boxTwoCoords","notificationMutations","setNotificationColor","setNotificationText","setNotificationBackdrop","lastNotificationId","notificationActions","createNotification","poemMutations","setPoemBackground","setPoemFont","setPoemText","lastPoemId","poemActions","createPoem","_command","createConsole","lastCopyId","removeFromList","addToList","setOnTop","setPosition","setFlip","setSize","setRatio","setRotation","removeObject","setLabel","setTextboxColor","setEnlargeWhenTalking","setObjectNameboxWidth","setObjectZoom","otherObject","setPreserveRatio","setWidth","setHeight","copyObjects","sourceOrders","allSourceIds","transationTable","sourceId","targetId","oldObject","newObject","newTextbox","copyObjectToClipboard","pasteObjectFromClipboard","deleteAllOfPanel","setVertical","setNsfw","setLqRendering","setSelection","setLastDownload","setClipboard","setDarkTheme","setDefaultCharacterTalkingZoom","setColorPicker","mergeContentPacks","mergeBackgrounds","mergeCharacters","mergeArrayUnique","mergeIdArrays","xObj","yObj","sdVersion","mergeBackground","mergeCharacter","mergeHeadCollections","xStyleGroup","yStyleGroup","xClasses","yClasses","mergeStyleClasses","xStyle","yStyle","mergePose","classKey","headGroupKey","getId","merge","definedIds","yId","existingIdx","existing","baseDir","baseTypes","setContentPacks","setCurrentContent","convertContentPack","convertedPack","existingPacks","dependency","removeContentPacks","newContentPacks","sortByDependencies","replaceContentPack","packIdx","loadContentPacks","response","statusText","paths","convertV1","getCharacters","getBackgrounds","types","replacementMap","payload","setUnsafe","removePacks","oldState","vueApp","config","globalProperties","resetStateMutation","replayMutation","vm","baseObj","assign","replayTransaction","forEach","replayAll","oldTransactions","done","mutationProperiesCache","getMutationProperties","mutationProperties","ignore","combinable","oldMutation","newMutation","combinator","currentWildcard","history","reactive","undone","ignoreMutations","currentTransaction","transactionQueue","initialized","initialize","exec","redo","undo","lastUndo","combination","App","use","mount","HdSpacing","HdSideMargin","visible","drop","HSLAColor","deltas","q","hue2rgb","Renderer","runningContext","abort","clearRect","makeWithContext"],"mappings":"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","file":"js/app.a6f1c6b6.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded CSS chunks\n \tvar installedCssChunks = {\n \t\t\"app\": 0\n \t}\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// script path function\n \tfunction jsonpScriptSrc(chunkId) {\n \t\treturn __webpack_require__.p + \"js/\" + ({}[chunkId]||chunkId) + \".\" + {\"chunk-57967dfc\":\"2f238bd3\",\"chunk-f6c4e426\":\"e497202e\"}[chunkId] + \".js\"\n \t}\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n \t// This file contains only the entry chunk.\n \t// The chunk loading function for additional chunks\n \t__webpack_require__.e = function requireEnsure(chunkId) {\n \t\tvar promises = [];\n\n\n \t\t// mini-css-extract-plugin CSS loading\n \t\tvar cssChunks = {\"chunk-57967dfc\":1,\"chunk-f6c4e426\":1};\n \t\tif(installedCssChunks[chunkId]) promises.push(installedCssChunks[chunkId]);\n \t\telse if(installedCssChunks[chunkId] !== 0 && cssChunks[chunkId]) {\n \t\t\tpromises.push(installedCssChunks[chunkId] = new Promise(function(resolve, reject) {\n \t\t\t\tvar href = \"css/\" + ({}[chunkId]||chunkId) + \".\" + {\"chunk-57967dfc\":\"54fae591\",\"chunk-f6c4e426\":\"308ae515\"}[chunkId] + \".css\";\n \t\t\t\tvar fullhref = __webpack_require__.p + href;\n \t\t\t\tvar existingLinkTags = document.getElementsByTagName(\"link\");\n \t\t\t\tfor(var i = 0; i < existingLinkTags.length; i++) {\n \t\t\t\t\tvar tag = existingLinkTags[i];\n \t\t\t\t\tvar dataHref = tag.getAttribute(\"data-href\") || tag.getAttribute(\"href\");\n \t\t\t\t\tif(tag.rel === \"stylesheet\" && (dataHref === href || dataHref === fullhref)) return resolve();\n \t\t\t\t}\n \t\t\t\tvar existingStyleTags = document.getElementsByTagName(\"style\");\n \t\t\t\tfor(var i = 0; i < existingStyleTags.length; i++) {\n \t\t\t\t\tvar tag = existingStyleTags[i];\n \t\t\t\t\tvar dataHref = tag.getAttribute(\"data-href\");\n \t\t\t\t\tif(dataHref === href || dataHref === fullhref) return resolve();\n \t\t\t\t}\n \t\t\t\tvar linkTag = document.createElement(\"link\");\n \t\t\t\tlinkTag.rel = \"stylesheet\";\n \t\t\t\tlinkTag.type = \"text/css\";\n \t\t\t\tlinkTag.onload = resolve;\n \t\t\t\tlinkTag.onerror = function(event) {\n \t\t\t\t\tvar request = event && event.target && event.target.src || fullhref;\n \t\t\t\t\tvar err = new Error(\"Loading CSS chunk \" + chunkId + \" failed.\\n(\" + request + \")\");\n \t\t\t\t\terr.code = \"CSS_CHUNK_LOAD_FAILED\";\n \t\t\t\t\terr.request = request;\n \t\t\t\t\tdelete installedCssChunks[chunkId]\n \t\t\t\t\tlinkTag.parentNode.removeChild(linkTag)\n \t\t\t\t\treject(err);\n \t\t\t\t};\n \t\t\t\tlinkTag.href = fullhref;\n\n \t\t\t\tvar head = document.getElementsByTagName(\"head\")[0];\n \t\t\t\thead.appendChild(linkTag);\n \t\t\t}).then(function() {\n \t\t\t\tinstalledCssChunks[chunkId] = 0;\n \t\t\t}));\n \t\t}\n\n \t\t// JSONP chunk loading for javascript\n\n \t\tvar installedChunkData = installedChunks[chunkId];\n \t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n \t\t\t// a Promise means \"currently loading\".\n \t\t\tif(installedChunkData) {\n \t\t\t\tpromises.push(installedChunkData[2]);\n \t\t\t} else {\n \t\t\t\t// setup Promise in chunk cache\n \t\t\t\tvar promise = new Promise(function(resolve, reject) {\n \t\t\t\t\tinstalledChunkData = installedChunks[chunkId] = [resolve, reject];\n \t\t\t\t});\n \t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n \t\t\t\t// start chunk loading\n \t\t\t\tvar script = document.createElement('script');\n \t\t\t\tvar onScriptComplete;\n\n \t\t\t\tscript.charset = 'utf-8';\n \t\t\t\tscript.timeout = 120;\n \t\t\t\tif (__webpack_require__.nc) {\n \t\t\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n \t\t\t\t}\n \t\t\t\tscript.src = jsonpScriptSrc(chunkId);\n\n \t\t\t\t// create error before stack unwound to get useful stacktrace later\n \t\t\t\tvar error = new Error();\n \t\t\t\tonScriptComplete = function (event) {\n \t\t\t\t\t// avoid mem leaks in IE.\n \t\t\t\t\tscript.onerror = script.onload = null;\n \t\t\t\t\tclearTimeout(timeout);\n \t\t\t\t\tvar chunk = installedChunks[chunkId];\n \t\t\t\t\tif(chunk !== 0) {\n \t\t\t\t\t\tif(chunk) {\n \t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n \t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n \t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n \t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n \t\t\t\t\t\t\terror.type = errorType;\n \t\t\t\t\t\t\terror.request = realSrc;\n \t\t\t\t\t\t\tchunk[1](error);\n \t\t\t\t\t\t}\n \t\t\t\t\t\tinstalledChunks[chunkId] = undefined;\n \t\t\t\t\t}\n \t\t\t\t};\n \t\t\t\tvar timeout = setTimeout(function(){\n \t\t\t\t\tonScriptComplete({ type: 'timeout', target: script });\n \t\t\t\t}, 120000);\n \t\t\t\tscript.onerror = script.onload = onScriptComplete;\n \t\t\t\tdocument.head.appendChild(script);\n \t\t\t}\n \t\t}\n \t\treturn Promise.all(promises);\n \t};\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// on error function for async loading\n \t__webpack_require__.oe = function(err) { console.error(err); throw err; };\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./sliderGroup.vue?vue&type=style&index=0&id=24b7dbc3&lang=scss&scoped=true\"","import { EnvCapabilities, Folder, IEnvironment, Settings } from './environment';\nimport { Background } from '@/renderables/background';\nimport { EnvState } from './envState';\nimport { DeepReadonly, reactive, ref } from 'vue';\nimport { Repo } from '@/models/repo';\nimport { IHistorySupport } from '@/plugins/vuex-history';\nimport { Store } from 'vuex';\nimport { IRootState } from '@/store';\nimport { IAuthors } from '@edave64/dddg-repo-filters/dist/authors';\nimport { IPack } from '@edave64/dddg-repo-filters/dist/pack';\n\nexport class Browser implements IEnvironment {\n\tpublic readonly state: EnvState = reactive({\n\t\tautoAdd: [],\n\t\tdownloadLocation: 'Default download folder',\n\t});\n\tpublic readonly supports: DeepReadonly<EnvCapabilities>;\n\n\tpublic get gameMode(): 'ddlc' | 'ddlc_plus' | null {\n\t\treturn this._gameMode;\n\t}\n\n\tprivate _gameMode: 'ddlc' | 'ddlc_plus' | null = null;\n\n\tprivate vuexHistory: IHistorySupport | null = null;\n\tprivate $store: Store<DeepReadonly<IRootState>> | null = null;\n\n\tprivate readonly isSavingEnabled = ref(false);\n\n\tpublic readonly localRepositoryUrl = '';\n\n\tprivate loading: Promise<void>;\n\tprivate creatingDB?: Promise<IDBDatabase | void>;\n\n\tpublic get savingEnabled() {\n\t\treturn this.isSavingEnabled.value;\n\t}\n\n\tpublic set savingEnabled(value: boolean) {\n\t\tif (value) {\n\t\t\tlocalStorage.setItem('saving', 'true');\n\t\t\tthis.creatingDB = IndexedDBHandler.createDB();\n\t\t\tthis.creatingDB!.then(() => {\n\t\t\t\tthis.creatingDB = undefined;\n\t\t\t\tthis.isSavingEnabled.value = true;\n\t\t\t}).catch(() => {});\n\t\t} else {\n\t\t\t// I'm not just setting 'saving' to false because I want there to\n\t\t\t// be absolutely no trace if you revoke saving.\n\t\t\tlocalStorage.clear();\n\t\t\tthis.isSavingEnabled.value = false;\n\t\t\tthis.creatingDB = IndexedDBHandler.clearDB()\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.creatingDB = undefined;\n\t\t\t\t})\n\t\t\t\t.catch(() => {});\n\t\t}\n\t}\n\n\tconstructor() {\n\t\t// eslint-disable-next-line @typescript-eslint/no-this-alias\n\t\tconst self = this;\n\t\tconst canSave = IndexedDBHandler.canSave();\n\n\t\twindow.addEventListener('beforeunload', function(e) {\n\t\t\t// Cancel the event\n\t\t\te.preventDefault(); // If you prevent default behavior in Mozilla Firefox prompt will always be shown\n\t\t\t// Chrome requires returnValue to be set\n\t\t\te.returnValue =\n\t\t\t\t'Are you sure you want to leave? All your progress will be lost!';\n\t\t});\n\n\t\tconst supports = reactive({\n\t\t\toptionalSaving: canSave,\n\t\t\tget autoLoading(): boolean {\n\t\t\t\treturn canSave && self.isSavingEnabled.value;\n\t\t\t},\n\t\t\tbackgroundInstall: false,\n\t\t\tlocalRepo: false,\n\t\t\tlq: true,\n\t\t\tsetDownloadFolder: false,\n\t\t\topenableFolders: new Set([]),\n\t\t});\n\n\t\tthis.supports = supports;\n\n\t\tif (canSave) {\n\t\t\tthis.loading = (async () => {\n\t\t\t\tconst exists = await IndexedDBHandler.doesDbExists();\n\t\t\t\tthis.savingEnabled = exists;\n\t\t\t})();\n\t\t} else {\n\t\t\tthis.loading = Promise.resolve();\n\t\t}\n\n\t\tthis.loading.then(async () => {\n\t\t\tif (this.creatingDB) await this.creatingDB;\n\t\t\tif (this.savingEnabled) {\n\t\t\t\tconst autoload = (await IndexedDBHandler.loadAutoload()) || [];\n\t\t\t\tthis.state.autoAdd = autoload;\n\t\t\t\tconst repo = await Repo.getInstance();\n\t\t\t\tconst packUrls = autoload.map(id => {\n\t\t\t\t\tconst pack = repo.getPack(id);\n\t\t\t\t\treturn pack.dddg2Path || pack.dddg1Path;\n\t\t\t\t});\n\t\t\t\tthis.vuexHistory!.transaction(async () => {\n\t\t\t\t\tawait this.$store!.dispatch('content/loadContentPacks', packUrls);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\tpublic async loadGameMode(): Promise<void> {\n\t\tconst searchParams = new URLSearchParams(location.search);\n\t\tconst getMode = searchParams.get('mode');\n\t\tif (getMode === 'ddlc' || getMode === 'ddlc_plus') {\n\t\t\tthis._gameMode = getMode;\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.loading;\n\t\tawait this.creatingDB;\n\t\tlet stored: string = '';\n\t\tif (this.isSavingEnabled.value) {\n\t\t\tstored = await IndexedDBHandler.loadGameMode();\n\t\t}\n\t\tlet value: this['gameMode'] = 'ddlc';\n\t\tif (stored === 'ddlc' || stored === 'ddlc_plus') {\n\t\t\tvalue = stored;\n\t\t}\n\t\tthis._gameMode = value;\n\t}\n\tpublic async saveGameMode(mode: Browser['gameMode']): Promise<void> {\n\t\tif (this.isSavingEnabled.value) {\n\t\t\tawait IndexedDBHandler.saveGameMode(mode);\n\t\t}\n\t}\n\tupdateDownloadFolder(): void {\n\t\tthrow new Error('Method not implemented.');\n\t}\n\topenFolder(folder: Folder): void {\n\t\tthrow new Error('Method not implemented.');\n\t}\n\n\tpublic connectToStore(\n\t\tvuexHistory: IHistorySupport,\n\t\tstore: Store<DeepReadonly<IRootState>>\n\t) {\n\t\tthis.vuexHistory = vuexHistory;\n\t\tthis.$store = store;\n\t}\n\n\tpublic async saveToFile(\n\t\tdownloadCanvas: HTMLCanvasElement,\n\t\tfilename: string,\n\t\tformat = 'image/png',\n\t\tquality = 1\n\t): Promise<string> {\n\t\tconst a = document.createElement('a');\n\t\ta.setAttribute('download', filename);\n\t\tconst url = await this.createObjectURL(downloadCanvas, format, quality);\n\t\ta.setAttribute('href', url);\n\t\tdocument.body.appendChild(a);\n\t\ta.click();\n\t\tdocument.body.removeChild(a);\n\t\treturn url;\n\t}\n\n\tpublic installBackground(background: Background): boolean {\n\t\tthrow new Error('This environment does not support installing backgrounds');\n\t}\n\n\tpublic uninstallBackground(background: Background): boolean {\n\t\tthrow new Error(\n\t\t\t'This environment does not support uninstalling backgrounds'\n\t\t);\n\t}\n\n\tpublic localRepoInstall(url: string, repo: IPack, authors: IAuthors): void {\n\t\tthrow new Error('This environment does not support a local repository');\n\t}\n\n\tpublic localRepoUninstall(id: string): void {\n\t\tthrow new Error('This environment does not support a local repository');\n\t}\n\n\tpublic autoLoadAdd(id: string): void {\n\t\t(async () => {\n\t\t\tawait this.loading;\n\t\t\tawait this.creatingDB;\n\t\t\tawait IndexedDBHandler.saveAutoload([...this.state.autoAdd, id]);\n\t\t\tthis.state.autoAdd.push(id);\n\t\t})();\n\t}\n\n\tpublic autoLoadRemove(id: string): void {\n\t\t(async () => {\n\t\t\tawait this.loading;\n\t\t\tawait this.creatingDB;\n\n\t\t\tawait IndexedDBHandler.saveAutoload(\n\t\t\t\tthis.state.autoAdd.filter(x => x != id)\n\t\t\t);\n\t\t\tconst idx = this.state.autoAdd.indexOf(id);\n\t\t\tthis.state.autoAdd.splice(idx, 1);\n\t\t})();\n\t}\n\n\tpublic async loadSettings(): Promise<Settings> {\n\t\tawait this.loading;\n\t\tawait this.creatingDB;\n\t\tconst base: Settings = {\n\t\t\tdarkMode: undefined,\n\t\t\tlq: true,\n\t\t\tnsfw: false,\n\t\t\tdefaultCharacterTalkingZoom: true,\n\t\t};\n\t\tif (!this.isSavingEnabled.value) return base;\n\t\treturn {\n\t\t\t...base,\n\t\t\t...(await IndexedDBHandler.loadSettings()),\n\t\t};\n\t}\n\n\tpublic async saveSettings(settings: Settings): Promise<void> {\n\t\tawait this.loading;\n\t\tawait this.creatingDB;\n\t\tif (!this.isSavingEnabled.value) return;\n\t\tawait IndexedDBHandler.saveSettings(settings);\n\t}\n\n\tpublic async isInitialized(): Promise<void> {\n\t\tawait this.loading;\n\t\tawait this.creatingDB;\n\t}\n\n\tpublic prompt(\n\t\tmessage: string,\n\t\tdefaultValue?: string\n\t): Promise<string | null> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tresolve(prompt(message, defaultValue));\n\t\t});\n\t}\n\n\tpublic onPanelChange(handler: (panel: string) => void): void {\n\t\treturn;\n\t}\n\n\tprotected createObjectURL(\n\t\tcanvas: HTMLCanvasElement,\n\t\tformat: string,\n\t\tquality: number\n\t): Promise<string> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst canCreateObjectUrl = !!(window.URL && window.URL.createObjectURL);\n\t\t\tif (!canCreateObjectUrl)\n\t\t\t\treturn resolve(canvas.toDataURL(format, quality));\n\n\t\t\tif (canvas.toBlob) {\n\t\t\t\tcanvas.toBlob(\n\t\t\t\t\tblob => {\n\t\t\t\t\t\tif (!blob) {\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve(URL.createObjectURL(blob));\n\t\t\t\t\t},\n\t\t\t\t\tformat,\n\t\t\t\t\tquality\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tconst url = canvas.toDataURL(format, quality);\n\t\t\t\tconst blob = this.dataURItoBlob(url, format);\n\t\t\t\tresolve(URL.createObjectURL(blob));\n\t\t\t}\n\t\t});\n\t}\n\n\tprotected dataURItoBlob(dataURI: string, type: string) {\n\t\tconst binStr = atob(dataURI.split(',')[1]);\n\t\tconst len = binStr.length;\n\t\tconst arr = new Uint8Array(len);\n\n\t\tfor (let i = 0; i < len; i++) {\n\t\t\tarr[i] = binStr.charCodeAt(i);\n\t\t}\n\n\t\treturn new Blob([arr], { type });\n\t}\n}\n\nconst IndexedDBHandler = {\n\tindexedDB: (() => {\n\t\ttry {\n\t\t\treturn (window.indexedDB ||\n\t\t\t\t(window as any).mozIndexedDB ||\n\t\t\t\t(window as any).webkitIndexedDB ||\n\t\t\t\t(window as any).msIndexedDB) as IDBFactory;\n\t\t} catch (e) {\n\t\t\treturn null;\n\t\t}\n\t})(),\n\ttransaction: (() => {\n\t\ttry {\n\t\t\treturn ((window.IDBTransaction as any) ||\n\t\t\t\t(window as any).webkitIDBTransaction ||\n\t\t\t\t(window as any).msIDBTransaction) as IDBTransaction;\n\t\t} catch (e) {\n\t\t\treturn null;\n\t\t}\n\t})(),\n\tdb: null as null | Promise<IDBDatabase>,\n\n\tcanSave(): boolean {\n\t\treturn !!(IndexedDBHandler.indexedDB && window.localStorage);\n\t},\n\n\t// Optimally, this could just check if the database exists. But sadly, that's not standard. So we need to bring\n\t// localstorage into this. :/\n\tdoesDbExists(): Promise<boolean> {\n\t\tconst saving = localStorage.getItem('saving');\n\t\tif (saving === 'true') {\n\t\t\treturn Promise.resolve(true);\n\t\t}\n\t\treturn Promise.resolve(false);\n\t},\n\n\tcreateDB(): Promise<IDBDatabase> {\n\t\tif (IndexedDBHandler.db) return IndexedDBHandler.db;\n\t\treturn (IndexedDBHandler.db = new Promise((resolve, reject) => {\n\t\t\tconst req = IndexedDBHandler.indexedDB!.open('dddg', 3);\n\t\t\treq.onerror = event => {\n\t\t\t\treject(event);\n\t\t\t};\n\t\t\treq.onupgradeneeded = event => {\n\t\t\t\tconst db = (event.target! as any).result as IDBDatabase;\n\t\t\t\tconst oldVer = event.oldVersion ?? ((event as any).version as number);\n\t\t\t\tif (oldVer < 1) {\n\t\t\t\t\tdb.createObjectStore('settings');\n\t\t\t\t}\n\t\t\t\tif (oldVer === 1) {\n\t\t\t\t\tdb.deleteObjectStore('settings');\n\t\t\t\t\tdb.createObjectStore('settings');\n\t\t\t\t}\n\t\t\t};\n\t\t\treq.onsuccess = event => {\n\t\t\t\tresolve(req.result);\n\t\t\t};\n\t\t}));\n\t},\n\n\tclearDB(): Promise<void> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (!IndexedDBHandler.db) {\n\t\t\t\tresolve();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst req = IndexedDBHandler.indexedDB!.deleteDatabase('dddg');\n\t\t\tIndexedDBHandler.db = null;\n\t\t\treq.onerror = event => {\n\t\t\t\treject(event);\n\t\t\t};\n\t\t\treq.onsuccess = event => {\n\t\t\t\tresolve();\n\t\t\t};\n\t\t});\n\t},\n\n\tloadAutoload(): Promise<string[]> {\n\t\treturn this.objectStorePromise('readonly', async store => {\n\t\t\treturn await this.reqPromise<string[]>(store.get('autoload'));\n\t\t});\n\t},\n\tsaveAutoload(autoloads: string[]): Promise<void> {\n\t\treturn this.objectStorePromise('readwrite', async store => {\n\t\t\tawait this.reqPromise(store.put([...autoloads], 'autoload'));\n\t\t});\n\t},\n\n\tloadGameMode(): Promise<string> {\n\t\treturn this.objectStorePromise('readonly', async store => {\n\t\t\treturn await this.reqPromise<string>(store.get('gameMode'));\n\t\t});\n\t},\n\tsaveGameMode(mode: IEnvironment['gameMode']): Promise<void> {\n\t\treturn this.objectStorePromise('readwrite', async store => {\n\t\t\tawait this.reqPromise(store.put(mode, 'gameMode'));\n\t\t});\n\t},\n\n\tsaveSettings<T>(settings: T): Promise<void> {\n\t\treturn this.objectStorePromise('readwrite', async store => {\n\t\t\tawait this.reqPromise(store.put({ ...settings }, 'settings'));\n\t\t});\n\t},\n\n\tloadSettings<T>(): Promise<T> {\n\t\treturn this.objectStorePromise('readonly', async store => {\n\t\t\treturn await this.reqPromise<T>(store.get('settings'));\n\t\t});\n\t},\n\n\tobjectStorePromise<T>(\n\t\tmode: 'readonly' | 'readwrite',\n\t\tcallback: (store: IDBObjectStore) => Promise<T>\n\t): Promise<T> {\n\t\tif (!this.db) return Promise.reject(new Error('No database'));\n\t\treturn new Promise(async (resolve, reject) => {\n\t\t\tconst transact = (await this.db!).transaction(['settings'], mode);\n\t\t\tconst store = transact.objectStore('settings');\n\n\t\t\ttry {\n\t\t\t\tresolve(await callback(store));\n\t\t\t} catch (e) {\n\t\t\t\treject(e);\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Turns a database request into a promise to more easily use it in asyncronous code\n\t */\n\treqPromise<T>(req: IDBRequest<T>): Promise<T> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\treq.onerror = error => {\n\t\t\t\treject(error);\n\t\t\t};\n\t\t\treq.onsuccess = event => {\n\t\t\t\tresolve(req.result);\n\t\t\t};\n\t\t});\n\t},\n};\n","import { Browser } from './browser';\n\nexport class OldEdge extends Browser {\n\tpublic async saveToFile(\n\t\tdownloadCanvas: HTMLCanvasElement,\n\t\tfilename: string,\n\t\tformat: string = 'image/png',\n\t\tquality: number = 1\n\t): Promise<string> {\n\t\tlet url = downloadCanvas.toDataURL(format, quality);\n\t\tconst blob = this.dataURItoBlob(url, format);\n\n\t\tif (window.URL && window.URL.createObjectURL) {\n\t\t\turl = URL.createObjectURL(blob);\n\t\t}\n\n\t\t// IE-specific code\n\t\twindow.navigator.msSaveBlob(blob, filename);\n\t\treturn url;\n\t}\n}\n","import { EnvCapabilities, Folder, IEnvironment, Settings } from './environment';\nimport { registerAssetWithURL, getAsset } from '@/asset-manager';\nimport { Background } from '@/renderables/background';\nimport eventBus, { ShowMessageEvent } from '@/eventbus/event-bus';\nimport { EnvState } from '@/environments/envState';\nimport { ContentPack } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IHistorySupport } from '@/plugins/vuex-history';\nimport { Store } from 'vuex';\nimport { IRootState } from '@/store';\nimport { ReplaceContentPackAction } from '@/store/content';\nimport { reactive } from 'vue';\nimport { Repo } from '@/models/repo';\nimport { DeepReadonly } from '@/util/readonly';\nimport { IAuthors } from '@edave64/dddg-repo-filters/dist/authors';\nimport { IPack } from '@edave64/dddg-repo-filters/dist/pack';\n\nconst packs: IPack[] = [];\n\nconst installedBackgroundsPack: ContentPack<string> = {\n\tpackId: 'dddg.buildin.installedBackgrounds',\n\tdependencies: [],\n\tpackCredits: [],\n\tcharacters: [],\n\tfonts: [],\n\tsprites: [],\n\tpoemStyles: [],\n\tpoemBackgrounds: [],\n\tbackgrounds: [],\n\tcolors: [],\n};\n\nexport class Electron implements IEnvironment {\n\tpublic readonly state: EnvState = reactive({\n\t\tautoAdd: [],\n\t\tdownloadLocation: '',\n\t});\n\tpublic readonly localRepositoryUrl = '/repo/';\n\tpublic get gameMode(): 'ddlc' | 'ddlc_plus' | null {\n\t\treturn this._gameMode;\n\t}\n\n\tprivate _gameMode: 'ddlc' | 'ddlc_plus' | null = null;\n\tprivate readonly electron = (window as any) as IElectronWindow;\n\n\tprivate vuexHistory: IHistorySupport | null = null;\n\tprivate $store: Store<DeepReadonly<IRootState>> | null = null;\n\tprivate bgInvalidation: number | null = null;\n\tprivate readonly pendingContentPacks: string[] = [];\n\n\tconstructor() {\n\t\tthis.electron.ipcRenderer.on(\n\t\t\t'add-persistent-content-pack',\n\t\t\tasync (filePath: string) => {\n\t\t\t\tif (!this.$store || !this.vuexHistory) {\n\t\t\t\t\tthis.pendingContentPacks.push(filePath);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store!.dispatch('content/loadContentPacks', filePath);\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t\tthis.electron.ipcRenderer.on(\n\t\t\t'add-persistent-background',\n\t\t\tasync (filepath: string) => {\n\t\t\t\tconst name = 'persistentBg-' + filepath;\n\t\t\t\tconst parts = filepath.split('/');\n\t\t\t\tregisterAssetWithURL(name, filepath);\n\t\t\t\tinstalledBackgroundsPack.backgrounds.push({\n\t\t\t\t\tid: name,\n\t\t\t\t\tvariants: [[name]],\n\t\t\t\t\tlabel: parts[parts.length - 1],\n\t\t\t\t\tscaling: 'none',\n\t\t\t\t});\n\t\t\t\tthis.invalidateInstalledBGs();\n\t\t\t}\n\t\t);\n\t\tthis.electron.ipcRenderer.on('push-message', async (message: string) => {\n\t\t\teventBus.fire(new ShowMessageEvent(message));\n\t\t});\n\t\tthis.electron.ipcRenderer.on(\n\t\t\t'config.downloadFolderUpdate',\n\t\t\tasync (location: string) => {\n\t\t\t\tthis.state.downloadLocation = location;\n\t\t\t}\n\t\t);\n\t\tthis.electron.ipcRenderer.onConversation(\n\t\t\t'load-packs',\n\t\t\tasync (packIds: string[]) => {\n\t\t\t\tconst repo = await Repo.getInstance();\n\t\t\t\tconst packUrls = packIds.map(id => {\n\t\t\t\t\tconst pack = repo.getPack(id);\n\t\t\t\t\treturn pack.dddg2Path || pack.dddg1Path;\n\t\t\t\t});\n\t\t\t\tthis.vuexHistory!.transaction(async () => {\n\t\t\t\t\tawait this.$store!.dispatch('content/loadContentPacks', packUrls);\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t\tthis.electron.ipcRenderer.onConversation(\n\t\t\t'auto-load.changed',\n\t\t\tasync (packIds: string[]) => {\n\t\t\t\tthis.state.autoAdd = packIds;\n\t\t\t}\n\t\t);\n\t\tthis.electron.ipcRenderer.onConversation('reload-repo', async () => {\n\t\t\tawait (await Repo.getInstance()).reloadLocalRepo();\n\t\t});\n\t\tthis.electron.ipcRenderer.onConversation(\n\t\t\t'replace-pack',\n\t\t\tasync (contentPack: ContentPack<string>) => {\n\t\t\t\tthis.vuexHistory!.transaction(async () => {\n\t\t\t\t\tawait this.$store!.dispatch('content/replaceContentPack', {\n\t\t\t\t\t\tprocessed: false,\n\t\t\t\t\t\tcontentPack,\n\t\t\t\t\t} as ReplaceContentPackAction);\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t\tthis.electron.ipcRenderer.send('init-dddg');\n\t}\n\tpublic updateDownloadFolder(): void {\n\t\tthis.electron.ipcRenderer.send('config.newDownloadFolder');\n\t}\n\tpublic openFolder(folder: Folder): void {\n\t\tthis.electron.ipcRenderer.send('open-folder', folder);\n\t}\n\tpublic onPanelChange(handler: (panel: string) => void): void {}\n\tpublic readonly supports: EnvCapabilities = {\n\t\tautoLoading: true,\n\t\tbackgroundInstall: true,\n\t\tlocalRepo: true,\n\t\tlq: false,\n\t\toptionalSaving: false,\n\t\tsetDownloadFolder: true,\n\t\topenableFolders: new Set(['downloads', 'backgrounds', 'sprites']),\n\t};\n\tpublic readonly savingEnabled: boolean = true;\n\tpublic async saveSettings(settings: Settings): Promise<void> {\n\t\tawait this.electron.ipcRenderer.sendConvo(\n\t\t\t'config.set',\n\t\t\t'nsfw',\n\t\t\tsettings.nsfw\n\t\t);\n\t\tawait this.electron.ipcRenderer.sendConvo(\n\t\t\t'config.set',\n\t\t\t'darkMode',\n\t\t\tsettings.darkMode ?? undefined\n\t\t);\n\t\tawait this.electron.ipcRenderer.sendConvo(\n\t\t\t'config.set',\n\t\t\t'defaultCharacterTalkingZoom',\n\t\t\tsettings.defaultCharacterTalkingZoom\n\t\t);\n\t}\n\tpublic async loadGameMode() {\n\t\tthis._gameMode =\n\t\t\t(await this.electron.ipcRenderer.sendConvo('config.get', 'gameMode')) ||\n\t\t\t'ddlc';\n\t}\n\tpublic async saveGameMode(mode: Electron['gameMode']): Promise<void> {\n\t\tawait this.electron.ipcRenderer.sendConvo('config.set', 'gameMode', mode);\n\t}\n\tpublic async loadSettings(): Promise<Settings> {\n\t\treturn {\n\t\t\tlq: false,\n\t\t\tnsfw:\n\t\t\t\t(await this.electron.ipcRenderer.sendConvo('config.get', 'nsfw')) ??\n\t\t\t\tfalse,\n\t\t\tdarkMode:\n\t\t\t\t(await this.electron.ipcRenderer.sendConvo('config.get', 'darkMode')) ??\n\t\t\t\tundefined,\n\t\t\tdefaultCharacterTalkingZoom:\n\t\t\t\t(await this.electron.ipcRenderer.sendConvo(\n\t\t\t\t\t'config.get',\n\t\t\t\t\t'defaultCharacterTalkingZoom'\n\t\t\t\t)) ?? undefined,\n\t\t};\n\t}\n\n\tpublic async localRepoInstall(\n\t\turl: string,\n\t\trepo: IPack,\n\t\tauthors: IAuthors\n\t): Promise<void> {\n\t\tawait this.electron.ipcRenderer.sendConvo(\n\t\t\t'repo.install',\n\t\t\turl,\n\t\t\trepo,\n\t\t\tauthors\n\t\t);\n\t}\n\tpublic async localRepoUninstall(id: string): Promise<void> {\n\t\tawait this.electron.ipcRenderer.sendConvo('repo.uninstall', id);\n\t}\n\tpublic async autoLoadAdd(id: string): Promise<void> {\n\t\tawait this.electron.ipcRenderer.sendConvo('auto-load.add', id);\n\t}\n\tpublic async autoLoadRemove(id: string): Promise<void> {\n\t\tawait this.electron.ipcRenderer.sendConvo('auto-load.remove', id);\n\t}\n\n\tpublic saveToFile(\n\t\tdownloadCanvas: HTMLCanvasElement,\n\t\tfilename: string,\n\t\tformat = 'image/png',\n\t\tquality = 1\n\t): Promise<string> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tdownloadCanvas.toBlob(\n\t\t\t\tasync blob => {\n\t\t\t\t\tif (!blob) {\n\t\t\t\t\t\treject();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst buffer = await (blob as any).arrayBuffer();\n\t\t\t\t\tawait this.electron.ipcRenderer.sendConvo(\n\t\t\t\t\t\t'save-file',\n\t\t\t\t\t\tfilename,\n\t\t\t\t\t\tnew Uint8Array(buffer)\n\t\t\t\t\t);\n\t\t\t\t\tresolve(URL.createObjectURL(blob));\n\t\t\t\t},\n\t\t\t\tformat,\n\t\t\t\tquality\n\t\t\t);\n\t\t});\n\t}\n\n\tpublic async installBackground(background: Background): Promise<void> {\n\t\tif (background.assets.length !== 1) return;\n\t\tif (\n\t\t\tbackground.assets[0].sourcePack !== 'dddg.buildin.uploadedBackgrounds'\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst asset = await getAsset(background.assets[0].hq, true);\n\t\tif (!(asset instanceof HTMLImageElement)) return;\n\t\tconst img = await fetch(asset.src);\n\t\tconst array = new Uint8Array(await img.arrayBuffer());\n\t\tthis.electron.ipcRenderer.send('install-background', array);\n\t}\n\n\tpublic async uninstallBackground(background: Background): Promise<void> {\n\t\tif (background.assets.length !== 1) return;\n\t\tif (\n\t\t\tbackground.assets[0].sourcePack !== 'dddg.buildin.installedBackgrounds'\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst asset = await getAsset(background.assets[0].hq, true);\n\t\tif (!(asset instanceof HTMLImageElement)) return;\n\t\tif (!asset.src.startsWith('blob:')) {\n\t\t\tconst img = await fetch(asset.src);\n\t\t\tconst blob = await img.blob();\n\t\t\tconst newUrl = URL.createObjectURL(blob);\n\t\t\tregisterAssetWithURL(background.assets[0].hq, newUrl);\n\t\t}\n\t\tthis.electron.ipcRenderer.send('uninstall-background', background.id);\n\t}\n\n\tpublic async prompt(\n\t\tmessage: string,\n\t\tdefaultValue?: string\n\t): Promise<string | null> {\n\t\treturn await this.electron.ipcRenderer.sendConvo(\n\t\t\t'show-prompt',\n\t\t\tmessage,\n\t\t\tdefaultValue\n\t\t);\n\t}\n\n\tpublic connectToStore(\n\t\tvuexHistory: IHistorySupport,\n\t\tstore: Store<DeepReadonly<IRootState>>\n\t) {\n\t\tthis.vuexHistory = vuexHistory;\n\t\tthis.$store = store;\n\t\tthis.invalidateInstalledBGs();\n\n\t\tif (this.pendingContentPacks.length > 0) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tawait this.$store!.dispatch(\n\t\t\t\t\t'content/loadContentPacks',\n\t\t\t\t\tthis.pendingContentPacks\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate invalidateInstalledBGs() {\n\t\tif (!this.vuexHistory || !this.$store) return;\n\t\tif (this.bgInvalidation !== null) return;\n\t\tthis.bgInvalidation = requestAnimationFrame(() => {\n\t\t\tthis.updateInstalledBGs();\n\t\t});\n\t}\n\n\tprivate updateInstalledBGs() {\n\t\tif (this.bgInvalidation) {\n\t\t\tcancelAnimationFrame(this.bgInvalidation);\n\t\t\tthis.bgInvalidation = null;\n\t\t}\n\t\tif (!this.vuexHistory || !this.$store) return;\n\n\t\tthis.vuexHistory.transaction(() => {\n\t\t\tthis.$store!.dispatch('content/replaceContentPack', {\n\t\t\t\tcontentPack: installedBackgroundsPack,\n\t\t\t} as ReplaceContentPackAction);\n\t\t});\n\t}\n}\n\ninterface IElectronWindow {\n\tisElectron: boolean;\n\tipcRenderer: IpcRenderer;\n}\n\ninterface IpcRenderer {\n\ton(channel: string, listener: (...args: any[]) => void): void;\n\tonConversation(channel: string, listener: (...args: any[]) => void): void;\n\tsend(channel: string, ...args: any[]): void;\n\tsendConvo<T>(channel: string, ...args: any[]): Promise<T>;\n}\n","import { OldEdge } from './edge';\nimport { Browser } from './browser';\nimport { Electron } from './electron';\nimport { Background } from '@/renderables/background';\nimport { EnvState } from './envState';\nimport { IHistorySupport } from '@/plugins/vuex-history';\nimport { Store } from 'vuex';\nimport { IRootState } from '@/store';\nimport { DeepReadonly } from '@/util/readonly';\nimport { IAuthors } from '@edave64/dddg-repo-filters/dist/authors';\nimport { IPack as ICPack } from '@edave64/dddg-repo-filters/dist/pack';\n\nexport interface IPack {\n\turl: string;\n\tid: string;\n\tcredits: string;\n}\n\nexport type Folder = 'downloads' | 'sprites' | 'backgrounds';\n\nexport interface EnvCapabilities {\n\tsetDownloadFolder: boolean;\n\toptionalSaving: boolean;\n\tautoLoading: boolean;\n\tlocalRepo: boolean;\n\tbackgroundInstall: boolean;\n\tlq: boolean;\n\topenableFolders: ReadonlySet<Folder>;\n}\n\nexport interface Settings {\n\tlq?: boolean;\n\tnsfw?: boolean;\n\tdarkMode?: boolean;\n\tdefaultCharacterTalkingZoom?: boolean;\n}\n\nexport interface IEnvironment {\n\treadonly localRepositoryUrl: string;\n\treadonly gameMode: 'ddlc' | 'ddlc_plus' | null;\n\treadonly state: EnvState;\n\treadonly supports: DeepReadonly<EnvCapabilities>;\n\tsavingEnabled: boolean;\n\n\tsaveToFile(\n\t\tcanvas: HTMLCanvasElement,\n\t\tfilename: string,\n\t\tformat?: string,\n\t\tquality?: number\n\t): Promise<string>;\n\tinstallBackground(background: Background): void;\n\tuninstallBackground(background: Background): void;\n\tupdateDownloadFolder(): void;\n\topenFolder(folder: Folder): void;\n\tprompt(message: string, defaultValue?: string): Promise<string | null>;\n\tonPanelChange(handler: (panel: string) => void): void;\n\n\tlocalRepoInstall(url: string, repo: ICPack, authors: IAuthors): void;\n\tlocalRepoUninstall(id: string): void;\n\tautoLoadAdd(id: string): void;\n\tautoLoadRemove(id: string): void;\n\n\tsaveSettings(settings: Settings): Promise<void>;\n\tloadSettings(): Promise<Settings>;\n\tloadGameMode(): Promise<void>;\n\tsaveGameMode(mode: IEnvironment['gameMode']): Promise<void>;\n\tconnectToStore(\n\t\tvuexHistory: IHistorySupport,\n\t\tstore: Store<DeepReadonly<IRootState>>\n\t): void;\n}\n\nfunction chooseEnv(): IEnvironment {\n\tif ((window as any).isElectron) {\n\t\treturn new Electron();\n\t}\n\tif (window.navigator.msSaveOrOpenBlob !== undefined) {\n\t\treturn new OldEdge();\n\t}\n\treturn new Browser();\n}\n\nconst envX = chooseEnv();\n\n(window as any).toast = envX;\nexport default envX;\n","import { DeepReadonly } from '@/util/readonly';\nimport mitt from 'mitt';\n\nconst eventBus = mitt();\n\nexport default {\n\tfire(event: IEvent) {\n\t\teventBus.emit(event.kind, event);\n\t},\n\n\tsubscribe<T extends IEvent>(\n\t\teventType: IEventClass<T>,\n\t\thandler: (ev: T) => void\n\t) {\n\t\teventBus.on(eventType.kind, handler as any);\n\t},\n\n\tunsubscribe<T extends IEvent>(\n\t\teventType: IEventClass<T>,\n\t\thandler: (ev: T) => void\n\t) {\n\t\teventBus.off(eventType.kind, handler as any);\n\t},\n};\n\ninterface IEvent {\n\tkind: string;\n}\n\ninterface IEventClass<T> {\n\tkind: string;\n\tnew (...args: any[]): T;\n}\n\n// tslint:disable: max-classes-per-file\n\nexport class AssetFailureEvent implements IEvent {\n\tpublic static readonly kind = 'AssetFailureEvent';\n\tpublic readonly kind = 'AssetFailureEvent';\n\tpublic constructor(public path: string) {}\n}\nexport class FailureEvent implements IEvent {\n\tpublic static readonly kind = 'FailureEvent';\n\tpublic readonly kind = 'FailureEvent';\n\tpublic constructor(public message: string) {}\n}\nexport class CustomAssetFailureEvent implements IEvent {\n\tpublic static readonly kind = 'CustomAssetFailureEvent';\n\tpublic readonly kind = 'CustomAssetFailureEvent';\n\tpublic constructor(public error: ErrorEvent) {}\n}\n\nexport class InvalidateRenderEvent implements IEvent {\n\tpublic static readonly kind = 'InvalidateRenderEvent';\n\tpublic readonly kind = 'InvalidateRenderEvent';\n}\n\nexport class ShowMessageEvent implements IEvent {\n\tpublic static readonly kind = 'ShowMessageEvent';\n\tpublic readonly kind = 'ShowMessageEvent';\n\tpublic constructor(public message: string) {}\n}\n\nexport class ColorPickedEvent implements IEvent {\n\tpublic static readonly kind = 'ColorPickedEvent';\n\tpublic readonly kind = 'ColorPickedEvent';\n\tpublic constructor(public color: string) {}\n}\nexport class VueErrorEvent implements IEvent {\n\tpublic static readonly kind = 'VueErrorEvent';\n\tpublic readonly kind = 'VueErrorEvent';\n\tpublic constructor(\n\t\tpublic readonly error: DeepReadonly<Error>,\n\t\tpublic readonly info: string\n\t) {}\n}\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./message-console.vue?vue&type=style&index=0&id=7f9dc964&lang=scss&scoped=true\"","import {\n\tICharacter,\n\tgetPose,\n\tgetHeads,\n\tgetData,\n} from '@/store/objectTypes/characters';\nimport {\n\tPose,\n\tCharacter as CharacterModel,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport { DeepReadonly } from '@/util/readonly';\nimport { Store } from 'vuex';\nimport { IRootState } from '@/store';\nimport {\n\tAssetListRenderable,\n\tIDrawAssetsUnloaded,\n} from './assetListRenderable';\n\nexport class Character extends AssetListRenderable<ICharacter> {\n\tpublic constructor(\n\t\tobj: DeepReadonly<ICharacter>,\n\t\tprivate data: DeepReadonly<CharacterModel<IAsset>>\n\t) {\n\t\tsuper(obj);\n\t}\n\n\tpublic updatedContent(\n\t\tstore: Store<DeepReadonly<IRootState>>,\n\t\tpanelId: string\n\t): void {\n\t\tsuper.updatedContent(store, panelId);\n\t\tthis.data = getData(store, this.obj);\n\t}\n\n\tprotected getAssetList(): IDrawAssetsUnloaded[] {\n\t\tconst pose = getPose(this.data, this.obj) as Pose<IAsset>;\n\t\tconst currentHeads = getHeads(this.data, this.obj);\n\t\tconst drawAssetsUnloaded: IDrawAssetsUnloaded[] = [];\n\n\t\tfor (const renderCommand of pose.renderCommands) {\n\t\t\tswitch (renderCommand.type) {\n\t\t\t\tcase 'head':\n\t\t\t\t\tdrawAssetsUnloaded.push({\n\t\t\t\t\t\toffset: renderCommand.offset,\n\t\t\t\t\t\tcomposite: renderCommand.composite,\n\t\t\t\t\t\tassets: currentHeads\n\t\t\t\t\t\t\t? currentHeads.variants[this.obj.posePositions.head || 0]\n\t\t\t\t\t\t\t: [],\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'image':\n\t\t\t\t\tdrawAssetsUnloaded.push({\n\t\t\t\t\t\toffset: renderCommand.offset,\n\t\t\t\t\t\tcomposite: renderCommand.composite,\n\t\t\t\t\t\tassets: renderCommand.images,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'pose-part':\n\t\t\t\t\tconst posePosition = pose.positions[renderCommand.part];\n\t\t\t\t\tif (!posePosition || posePosition.length === 0) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tconst partAssets =\n\t\t\t\t\t\tposePosition[this.obj.posePositions[renderCommand.part] || 0];\n\t\t\t\t\tif (!partAssets) break;\n\t\t\t\t\tdrawAssetsUnloaded.push({\n\t\t\t\t\t\toffset: renderCommand.offset,\n\t\t\t\t\t\tcomposite: renderCommand.composite,\n\t\t\t\t\t\tassets: partAssets,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn drawAssetsUnloaded;\n\t}\n\n\tprotected scaleable = true;\n\tprotected get canvasHeight(): number {\n\t\tconst pose = getPose(this.data, this.obj) as Pose<IAsset>;\n\t\treturn pose.size[1];\n\t}\n\tprotected get canvasWidth(): number {\n\t\tconst pose = getPose(this.data, this.obj) as Pose<IAsset>;\n\t\treturn pose.size[0];\n\t}\n\n\tpublic get closeZoom(): number {\n\t\tlet zoom = 1;\n\t\tif (this.obj.close) zoom *= 2;\n\t\treturn zoom;\n\t}\n\n\tpublic get width() {\n\t\treturn this.obj.width * this.closeZoom;\n\t}\n\n\tpublic get height() {\n\t\treturn this.obj.height * this.closeZoom;\n\t}\n}\n","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./parts.vue?vue&type=style&index=0&id=47f2e1e8&lang=scss&scoped=true\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./d-fieldset.vue?vue&type=style&index=0&id=36ffea9a&lang=scss&scoped=true\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./notification.vue?vue&type=style&index=0&id=618f75f2&lang=scss&scoped=true\"","// tslint:disable: no-magic-numbers\nexport const screenWidth = 1920;\nexport const screenHeight = 1080;\n\nexport const positions = [\n\t'4-1',\n\t'3-1',\n\t'2-1',\n\t'4-2',\n\t'center',\n\t'4-3',\n\t'2-2',\n\t'3-3',\n\t'4-4',\n];\n\nexport const sdCharacterScaleFactor = 1.5;\nexport const hdCharacterScaleFactor = 1;\n\nexport const CloseUpYOffset = -111;\nexport const BaseCharacterYPos = -39;\n\nexport const characterPositions = [\n\t300,\n\t360,\n\t600,\n\t740,\n\t960,\n\t1180,\n\t1320,\n\t1560,\n\t1620,\n];\n","import { HSLAColor } from './hsl';\n\n// tslint:disable: no-magic-numbers\nexport class RGBAColor {\n\tpublic static validCss(str: string): boolean {\n\t\treturn this.validCssRgb(str) || this.validHex(str);\n\t}\n\n\tpublic static fromCss(str: string): RGBAColor {\n\t\tif (this.validCssRgb(str)) {\n\t\t\treturn this.fromCssRgb(str);\n\t\t}\n\t\tif (this.validHex(str)) {\n\t\t\treturn this.fromHex(str);\n\t\t}\n\t\tthrow new Error('Invalid RGB color format');\n\t}\n\n\tpublic static validCssRgb(str: string): boolean {\n\t\treturn this.rgbEx.test(str) || this.rgbaEx.test(str);\n\t}\n\n\tpublic static fromCssRgb(str: string): RGBAColor {\n\t\tif (!this.validCssRgb(str)) throw new Error('Invalid RGB color format');\n\t\tconst rgbHead = str.slice(0, -1);\n\t\tconst parentesisPos = rgbHead.indexOf('(');\n\t\tconst rbgTail = rgbHead.slice(parentesisPos + 1);\n\t\tconst elements = rbgTail.split(',').map(x => parseFloat(x.trim()));\n\t\treturn new RGBAColor(\n\t\t\telements[0],\n\t\t\telements[1],\n\t\t\telements[2],\n\t\t\telements.length === 4 ? elements[3] : 1\n\t\t);\n\t}\n\n\tpublic static validHex(str: string): boolean {\n\t\treturn this.hexShortEx.test(str) || this.hexLongEx.test(str);\n\t}\n\n\tpublic static fromHex(str: string): RGBAColor {\n\t\tif (!this.validHex(str)) throw new Error('Invalid Hex color format');\n\t\tconst hexTail = str.slice(1);\n\t\tif (hexTail.length === 3) {\n\t\t\treturn new RGBAColor(\n\t\t\t\tparseInt(hexTail[0] + hexTail[0], 16),\n\t\t\t\tparseInt(hexTail[1] + hexTail[1], 16),\n\t\t\t\tparseInt(hexTail[2] + hexTail[2], 16),\n\t\t\t\t1\n\t\t\t);\n\t\t}\n\t\tif (hexTail.length === 4) {\n\t\t\treturn new RGBAColor(\n\t\t\t\tparseInt(hexTail[0] + hexTail[0], 16),\n\t\t\t\tparseInt(hexTail[1] + hexTail[1], 16),\n\t\t\t\tparseInt(hexTail[2] + hexTail[2], 16),\n\t\t\t\tparseInt(hexTail[3] + hexTail[3], 16) / 255\n\t\t\t);\n\t\t}\n\t\tif (hexTail.length === 6) {\n\t\t\treturn new RGBAColor(\n\t\t\t\tparseInt(hexTail[0] + hexTail[1], 16),\n\t\t\t\tparseInt(hexTail[2] + hexTail[3], 16),\n\t\t\t\tparseInt(hexTail[4] + hexTail[5], 16),\n\t\t\t\t1\n\t\t\t);\n\t\t}\n\t\tif (hexTail.length === 8) {\n\t\t\treturn new RGBAColor(\n\t\t\t\tparseInt(hexTail[0] + hexTail[1], 16),\n\t\t\t\tparseInt(hexTail[2] + hexTail[3], 16),\n\t\t\t\tparseInt(hexTail[4] + hexTail[5], 16),\n\t\t\t\tparseInt(hexTail[6] + hexTail[7], 16) / 255\n\t\t\t);\n\t\t}\n\t\tthrow new Error('Invalid Hex color format length');\n\t}\n\n\tprivate static rgbEx = /^rgb\\((\\d*?),(\\d*?),(\\d*?)\\)$/i;\n\tprivate static rgbaEx = /^rgba\\((\\d{1,3}),(\\d{1,3}),(\\d{1,3}),([\\d.]+)\\)$/i;\n\tprivate static hexShortEx = /^#[0-9A-Z]{3,4}$/i;\n\tprivate static hexLongEx = /^#[0-9A-Z]{6,8}$/i;\n\n\tpublic constructor(\n\t\tpublic readonly r: number,\n\t\tpublic readonly g: number,\n\t\tpublic readonly b: number,\n\t\tpublic readonly a: number\n\t) {}\n\n\tpublic toCss(): string {\n\t\tif (this.a > 1) {\n\t\t\treturn `rgb(${this.r},${this.g},${this.b})`;\n\t\t}\n\t\treturn `rgba(${this.r},${this.g},${this.b},${this.a})`;\n\t}\n\n\tpublic toHex(): string {\n\t\treturn `#${Math.round(this.r)\n\t\t\t.toString(16)\n\t\t\t.padStart(2, '0')}${Math.round(this.g)\n\t\t\t.toString(16)\n\t\t\t.padStart(2, '0')}${Math.round(this.b)\n\t\t\t.toString(16)\n\t\t\t.padStart(2, '0')}${Math.round(this.a * 255)\n\t\t\t.toString(16)\n\t\t\t.padStart(2, '0')}`;\n\t}\n\n\tpublic toRgb(): RGBAColor {\n\t\treturn this;\n\t}\n\n\tpublic toHSL(): HSLAColor {\n\t\tlet { r, g, b } = this;\n\t\tconst { a } = this;\n\t\t(r /= 255), (g /= 255), (b /= 255);\n\t\tconst max = Math.max(r, g, b);\n\t\tconst min = Math.min(r, g, b);\n\t\tlet h: number;\n\t\tlet s: number;\n\t\tconst l: number = (max + min) / 2;\n\n\t\tif (max === min) {\n\t\t\th = s = 0; // achromatic\n\t\t} else {\n\t\t\tconst d = max - min;\n\t\t\ts = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n\t\t\tswitch (max) {\n\t\t\t\tcase r:\n\t\t\t\t\th = (g - b) / d + (g < b ? 6 : 0);\n\t\t\t\t\tbreak;\n\t\t\t\tcase g:\n\t\t\t\t\th = (b - r) / d + 2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase b:\n\t\t\t\t\th = (r - g) / d + 4;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\th! /= 6;\n\t\t}\n\n\t\treturn new HSLAColor(h!, s, l, a);\n\t}\n\n\tpublic get luminance(): number {\n\t\treturn Math.sqrt(\n\t\t\tMath.pow(0.299 * (this.r / 255), 2) +\n\t\t\t\tMath.pow(0.587 * (this.g / 255), 2) +\n\t\t\t\tMath.pow(0.114 * (this.b / 255), 2)\n\t\t);\n\t}\n}\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./toolbox.vue?vue&type=style&index=0&id=111e9686&lang=scss\"","<template>\n\t<a target=\"_blank\" rel=\"noopener noreferrer\" :href=\"href\">\n\t\t<slot />\n\t</a>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\nimport { VerticalScrollRedirect } from '../vertical-scroll-redirect';\n/**\n * a-tag links by default kinda suck for web apps, since they leave the current\n * page and do funny stuff with shared javascript contexts.\n * This takes care of the boilerplate\n */\nexport default defineComponent({\n\tmixins: [VerticalScrollRedirect],\n\tprops: {\n\t\tto: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\thref(): string {\n\t\t\tlet to = this.to;\n\t\t\tto = to.replace(\n\t\t\t\t/^github:\\/\\//,\n\t\t\t\t'https://github.com/edave64/Doki-Doki-Dialog-Generator/'\n\t\t\t);\n\t\t\tto = to.replace(/^wiki:\\/\\/(.*)/, (_, page) => {\n\t\t\t\treturn (\n\t\t\t\t\t'https://github.com/edave64/Doki-Doki-Dialog-Generator/wiki/Version-2:-' +\n\t\t\t\t\tpage.replaceAll(' ', '-')\n\t\t\t\t);\n\t\t\t});\n\t\t\treturn to;\n\t\t},\n\t},\n});\n</script>\n","\nimport { defineComponent } from 'vue';\nimport { VerticalScrollRedirect } from '../vertical-scroll-redirect';\n/**\n * a-tag links by default kinda suck for web apps, since they leave the current\n * page and do funny stuff with shared javascript contexts.\n * This takes care of the boilerplate\n */\nexport default defineComponent({\n\tmixins: [VerticalScrollRedirect],\n\tprops: {\n\t\tto: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\thref(): string {\n\t\t\tlet to = this.to;\n\t\t\tto = to.replace(\n\t\t\t\t/^github:\\/\\//,\n\t\t\t\t'https://github.com/edave64/Doki-Doki-Dialog-Generator/'\n\t\t\t);\n\t\t\tto = to.replace(/^wiki:\\/\\/(.*)/, (_, page) => {\n\t\t\t\treturn (\n\t\t\t\t\t'https://github.com/edave64/Doki-Doki-Dialog-Generator/wiki/Version-2:-' +\n\t\t\t\t\tpage.replaceAll(' ', '-')\n\t\t\t\t);\n\t\t\t});\n\t\t\treturn to;\n\t\t},\n\t},\n});\n","import { render } from \"./link.vue?vue&type=template&id=e82bc934\"\nimport script from \"./link.vue?vue&type=script&lang=ts\"\nexport * from \"./link.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","import { RenderContext } from '@/renderer/rendererContext';\r\nimport { Renderer } from '@/renderer/renderer';\r\nimport { IHitbox } from './renderable';\r\nimport { DeepReadonly } from '@/util/readonly';\r\nimport { SpriteFilter } from '@/store/sprite_options';\r\nimport { CompositeModes } from '@/renderer/rendererContext';\r\nimport { IObject } from '@/store/objects';\r\nimport { Store } from 'vuex';\r\nimport { IRootState } from '@/store';\r\nimport { rotateAround } from '@/util/rotation';\r\n\r\nexport abstract class OffscreenRenderable<Obj extends IObject> {\r\n\tprivate localRenderer: Renderer | null = null;\r\n\tprivate lastVersion: any = null;\r\n\tprivate hitDetectionFallback = false;\r\n\tprotected renderable: boolean = false;\r\n\r\n\tpublic constructor(public obj: DeepReadonly<Obj>) {}\r\n\r\n\tprotected abstract readonly canvasHeight: number;\r\n\tprotected abstract readonly canvasWidth: number;\r\n\r\n\t// The dimentions used to draw the local canvas onto the target. Is different from `canvasHeight` and `canvasWidth` to allow scaling\r\n\tprotected abstract readonly canvasDrawHeight: number;\r\n\tprotected abstract readonly canvasDrawWidth: number;\r\n\tprotected abstract readonly canvasDrawPosX: number;\r\n\tprotected abstract readonly canvasDrawPosY: number;\r\n\tprotected abstract renderLocal(rx: RenderContext): Promise<void>;\r\n\r\n\tprotected lastHq: boolean = false;\r\n\r\n\tprotected readonly ready = Promise.resolve();\r\n\r\n\tpublic get id(): string {\r\n\t\treturn this.obj.id;\r\n\t}\r\n\r\n\tprotected get x(): number {\r\n\t\treturn this.obj.x;\r\n\t}\r\n\tprotected get y(): number {\r\n\t\treturn this.obj.y;\r\n\t}\r\n\tprotected get version(): number {\r\n\t\treturn this.obj.version;\r\n\t}\r\n\tprotected get flip(): boolean {\r\n\t\treturn this.obj.flip;\r\n\t}\r\n\tprotected get rotation(): number {\r\n\t\treturn (this.obj.rotation / 180) * Math.PI;\r\n\t}\r\n\tprotected get composite(): CompositeModes {\r\n\t\treturn this.obj.composite;\r\n\t}\r\n\tprotected get filters(): DeepReadonly<SpriteFilter[]> {\r\n\t\treturn this.obj.filters;\r\n\t}\r\n\tprotected get width(): number {\r\n\t\treturn this.obj.width;\r\n\t}\r\n\tprotected get height(): number {\r\n\t\treturn this.obj.height;\r\n\t}\r\n\r\n\tpublic async updateLocalCanvas(hq: boolean) {\r\n\t\tawait this.ready;\r\n\t\tconst width = this.canvasWidth;\r\n\t\tconst height = this.canvasHeight;\r\n\t\tif (height === 0 && width === 0) {\r\n\t\t\tthis.renderable = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.renderable = true;\r\n\t\tthis.localRenderer = new Renderer(width, height);\r\n\t\tthis.lastHq = hq;\r\n\t\tawait this.localRenderer.render(this.renderLocal.bind(this));\r\n\t}\r\n\r\n\tpublic needsRedraw(): boolean {\r\n\t\treturn this.localRenderer === null || this.lastVersion !== this.version;\r\n\t}\r\n\r\n\tpublic getRenderRotation(): [number, { x: number; y: number } | undefined] {\r\n\t\treturn [\r\n\t\t\tthis.flip ? -this.rotation : this.rotation,\r\n\t\t\t{\r\n\t\t\t\tx: this.x,\r\n\t\t\t\ty: this.y + this.height / 2,\r\n\t\t\t},\r\n\t\t];\r\n\t}\r\n\r\n\tpublic async render(selected: boolean, rx: RenderContext) {\r\n\t\tconst needRedraw = this.lastHq !== rx.hq || this.needsRedraw();\r\n\r\n\t\tif (needRedraw) await this.updateLocalCanvas(!rx.hq);\r\n\r\n\t\tthis.lastVersion = this.version;\r\n\r\n\t\tif (!this.renderable) return;\r\n\r\n\t\tconst [rotation, rotationAnchor] = this.getRenderRotation();\r\n\r\n\t\trx.drawImage({\r\n\t\t\timage: this.localRenderer!,\r\n\t\t\tx: this.canvasDrawPosX,\r\n\t\t\ty: this.canvasDrawPosY,\r\n\t\t\tw: this.canvasDrawWidth,\r\n\t\t\th: this.canvasDrawHeight,\r\n\t\t\trotation,\r\n\t\t\trotationAnchor,\r\n\t\t\tflip: this.flip,\r\n\t\t\tshadow: selected && rx.preview ? { blur: 20, color: 'red' } : undefined,\r\n\t\t\tcomposite: this.composite,\r\n\t\t\tfilters: this.filters,\r\n\t\t});\r\n\t}\r\n\r\n\tpublic hitTest(hx: number, hy: number): boolean {\r\n\t\tif (!this.localRenderer) return false;\r\n\r\n\t\tconst hitbox = this.getHitbox();\r\n\r\n\t\tconst centerX = hitbox.x0 + (hitbox.x1 - hitbox.x0) / 2;\r\n\t\tconst centerY = hitbox.y0 + (hitbox.y1 - hitbox.y0) / 2;\r\n\r\n\t\t// Rotate the hit backwards, to cancle the rotation of the object\r\n\t\tconst [rotatedHitX, rotatedHitY] = rotateAround(\r\n\t\t\thx,\r\n\t\t\thy,\r\n\t\t\tcenterX,\r\n\t\t\tcenterY,\r\n\t\t\tthis.flip ? this.rotation : -this.rotation\r\n\t\t);\r\n\r\n\t\tconst hit =\r\n\t\t\trotatedHitX >= hitbox.x0 &&\r\n\t\t\trotatedHitX <= hitbox.x1 &&\r\n\t\t\trotatedHitY >= hitbox.y0 &&\r\n\t\t\trotatedHitY <= hitbox.y1;\r\n\r\n\t\tif (!hit) return false;\r\n\t\t// We can't do pixel perfect detection and we have a hitbox hit -> true\r\n\t\tif (this.hitDetectionFallback) return true;\r\n\r\n\t\ttry {\r\n\t\t\treturn this.pixelPerfectHitTest(hx, hy);\r\n\t\t} catch (e) {\r\n\t\t\tthis.hitDetectionFallback = true;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\tpublic pixelPerfectHitTest(x: number, y: number): boolean {\r\n\t\tif (!this.localRenderer) return false;\r\n\t\tconst [angle, anchor] = this.getRenderRotation();\r\n\t\tconst [rotatedHitX, rotatedHitY] = anchor\r\n\t\t\t? rotateAround(x, y, anchor.x, anchor.y, -angle)\r\n\t\t\t: [x, y];\r\n\r\n\t\tconst innerX = Math.round(rotatedHitX - this.canvasDrawPosX);\r\n\t\tconst innerY = Math.round(rotatedHitY - this.canvasDrawPosY);\r\n\r\n\t\tconst canvasDrawWidth = this.canvasDrawWidth;\r\n\t\tconst canvasDrawHeight = this.canvasDrawHeight;\r\n\r\n\t\tif (\r\n\t\t\tinnerX >= 0 &&\r\n\t\t\tinnerX <= canvasDrawWidth &&\r\n\t\t\tinnerY >= 0 &&\r\n\t\t\tinnerY <= canvasDrawHeight\r\n\t\t) {\r\n\t\t\tconst flippedX = this.flip ? this.canvasDrawWidth - innerX : innerX;\r\n\t\t\tconst scaleX = this.canvasWidth / this.canvasDrawWidth;\r\n\t\t\tconst scaleY = this.canvasHeight / this.canvasDrawHeight;\r\n\t\t\tconst data = this.localRenderer.getDataAt(\r\n\t\t\t\tMath.round(flippedX * scaleX),\r\n\t\t\t\tMath.round(innerY * scaleY)\r\n\t\t\t);\r\n\t\t\treturn data[3] !== 0;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the hitbox of the object, *not* taking into account any rotation (as that would just inflate the hitbox and reduce accuracy)\r\n\t * To manually apply rotation to it, rotate your hit test by `this.rotation` around the center of the hitbox.\r\n\t */\r\n\tpublic getHitbox(): IHitbox {\r\n\t\treturn {\r\n\t\t\tx0: this.x - this.width / 2,\r\n\t\t\tx1: this.x + this.width / 2,\r\n\t\t\ty0: this.y,\r\n\t\t\ty1: this.y + this.height,\r\n\t\t};\r\n\t}\r\n\r\n\tpublic updatedContent(\r\n\t\t_current: Store<DeepReadonly<IRootState>>,\r\n\t\tpanelId: string\r\n\t): void {}\r\n}\r\n","import { IPack as IPrimitivePack } from '@edave64/dddg-repo-filters/dist/pack';\r\nimport { IAuthor, IAuthors } from '@edave64/dddg-repo-filters/dist/authors';\r\nimport environment from '@/environments/environment';\r\nimport eventBus, { ShowMessageEvent } from '@/eventbus/event-bus';\r\nimport { computed, ComputedRef, DeepReadonly, ref, Ref } from 'vue';\r\nimport { Store } from 'vuex';\r\nimport { IRootState } from '@/store';\r\n\r\nconst repoUrl = 'https://edave64.github.io/Doki-Doki-Dialog-Generator-Packs/';\r\n\r\nexport type LoadedRepo = {\r\n\tpacks: IPrimitivePack[];\r\n\tauthors: IAuthors;\r\n};\r\n\r\nexport class Repo {\r\n\tprivate static instance: null | Promise<Repo>;\r\n\tpublic static setStore: ($store: Store<DeepReadonly<IRootState>>) => void;\r\n\tprivate static $store: Promise<Store<DeepReadonly<IRootState>>> = new Promise(\r\n\t\t(resolve, reject) => {\r\n\t\t\tRepo.setStore = resolve;\r\n\t\t}\r\n\t);\r\n\r\n\tpublic static getInstance(): Promise<Repo> {\r\n\t\tif (!Repo.instance) Repo.instance = this.createInstance();\r\n\t\treturn Repo.instance;\r\n\t}\r\n\r\n\tprivate static async createInstance(): Promise<Repo> {\r\n\t\tconst onlineRepoLoading = Repo.loadRepo(repoUrl);\r\n\t\tconst localRepoLoading = environment.supports.localRepo\r\n\t\t\t? Repo.loadRepo(environment.localRepositoryUrl)\r\n\t\t\t: null;\r\n\r\n\t\tconst [onlineRepoLoaded, localRepoLoaded, $store] = await Promise.all([\r\n\t\t\tonlineRepoLoading,\r\n\t\t\tlocalRepoLoading,\r\n\t\t\tRepo.$store,\r\n\t\t]);\r\n\r\n\t\treturn new Repo(onlineRepoLoaded, localRepoLoaded, $store);\r\n\t}\r\n\r\n\tprivate static async loadRepo(repo: string): Promise<LoadedRepo | null> {\r\n\t\ttry {\r\n\t\t\tconst [packs, authors] = await Promise.all([\r\n\t\t\t\tRepo.fetchJSON<IPrimitivePack[]>(repo + 'repo.json'),\r\n\t\t\t\tRepo.fetchJSON<IAuthors>(repo + 'people.json'),\r\n\t\t\t]);\r\n\t\t\treturn { packs, authors };\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate static async fetchJSON<A>(path: string): Promise<A> {\r\n\t\tconst req = await fetch(path);\r\n\t\tif (!req.ok) throw new Error('Could not load json');\r\n\t\treturn await req!.json();\r\n\t}\r\n\r\n\tprivate readonly onlineRepo: Ref<LoadedRepo | null>;\r\n\tprivate readonly localRepo: Ref<LoadedRepo | null>;\r\n\r\n\tprivate readonly combinedList: ComputedRef<DeepReadonly<Pack[]>>;\r\n\tprivate readonly authors: ComputedRef<DeepReadonly<IAuthors>>;\r\n\r\n\tprivate constructor(\r\n\t\tonlineRepo: LoadedRepo | null,\r\n\t\tlocalRepo: LoadedRepo | null,\r\n\t\tprivate $store: Store<DeepReadonly<IRootState>>\r\n\t) {\r\n\t\t(window as any).repo = this;\r\n\t\tif (!onlineRepo) {\r\n\t\t\tonlineRepo = { authors: {}, packs: [] };\r\n\t\t\teventBus.fire(new ShowMessageEvent(\"Couldn't load remote repository.\"));\r\n\t\t}\r\n\t\tif (!localRepo) {\r\n\t\t\tlocalRepo = { authors: {}, packs: [] };\r\n\t\t\tif (environment.supports.localRepo) {\r\n\t\t\t\teventBus.fire(new ShowMessageEvent(\"Couldn't load local repository.\"));\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.onlineRepo = ref(onlineRepo);\r\n\t\tthis.localRepo = ref(localRepo);\r\n\r\n\t\tthis.combinedList = computed(() => {\r\n\t\t\tconst onlineRepo = this.onlineRepo.value;\r\n\t\t\tconst onlinePacks = onlineRepo?.packs ?? [];\r\n\t\t\tconst onlineAuthors = onlineRepo?.authors ?? {};\r\n\t\t\tconst onlineRepoLookup = new Map(\r\n\t\t\t\tonlinePacks.map(pack => [pack.id, pack])\r\n\t\t\t);\r\n\r\n\t\t\tconst localRepo = this.localRepo.value;\r\n\t\t\tconst localPacks = localRepo?.packs ?? [];\r\n\t\t\tconst localAuthors = localRepo?.authors ?? {};\r\n\t\t\tconst localRepoLookup = new Map(localPacks.map(pack => [pack.id, pack]));\r\n\r\n\t\t\tconst autoloads = new Set(environment.state.autoAdd);\r\n\t\t\tconst loadedPackOrder = this.$store.state.content.contentPacks\r\n\t\t\t\t.map(pack => pack.packId)\r\n\t\t\t\t.filter(packId => !!packId) as string[];\r\n\t\t\tconst loadedPacksSet = new Set(loadedPackOrder) as Set<string>;\r\n\r\n\t\t\tconst addedPacks = new Set();\r\n\t\t\treturn [\r\n\t\t\t\t...loadedPackOrder,\r\n\t\t\t\t...localPacks.map(pack => pack.id),\r\n\t\t\t\t...onlinePacks.map(pack => pack.id),\r\n\t\t\t]\r\n\t\t\t\t.filter(packId => {\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\tpackId.startsWith('dddg.buildin.') ||\r\n\t\t\t\t\t\tpackId.startsWith('dddg.desktop.')\r\n\t\t\t\t\t)\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\tif (addedPacks.has(packId)) return false;\r\n\t\t\t\t\taddedPacks.add(packId);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t})\r\n\t\t\t\t.map(packId => {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t...(onlineRepoLookup.get(packId) ?? {\r\n\t\t\t\t\t\t\tcharacters: [],\r\n\t\t\t\t\t\t\tkind: [],\r\n\t\t\t\t\t\t\tauthors: [],\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t...(localRepoLookup.get(packId) ?? {}),\r\n\t\t\t\t\t\tautoloading: autoloads.has(packId),\r\n\t\t\t\t\t\tinstalled: localRepoLookup.has(packId),\r\n\t\t\t\t\t\tonline: onlineRepoLookup.has(packId),\r\n\t\t\t\t\t\tloaded: loadedPacksSet.has(packId),\r\n\t\t\t\t\t} as Pack;\r\n\t\t\t\t});\r\n\t\t});\r\n\r\n\t\tthis.authors = computed(() => {\r\n\t\t\tconst onlineRepo = this.onlineRepo.value;\r\n\t\t\tconst onlineAuthors = onlineRepo?.authors ?? {};\r\n\r\n\t\t\tconst localRepo = this.localRepo.value;\r\n\t\t\tconst localAuthors = localRepo?.authors ?? {};\r\n\t\t\treturn {\r\n\t\t\t\t...onlineAuthors,\r\n\t\t\t\t...localAuthors,\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\t// Stop Vue from breaking this object.\r\n\t\tObject.freeze(this);\r\n\t}\r\n\r\n\tpublic async reloadLocalRepo() {\r\n\t\tthis.localRepo.value = environment.supports.localRepo\r\n\t\t\t? await Repo.loadRepo(environment.localRepositoryUrl)\r\n\t\t\t: null;\r\n\t}\r\n\r\n\tpublic getPacks(): DeepReadonly<Pack[]> {\r\n\t\treturn this.combinedList.value;\r\n\t}\r\n\r\n\tpublic getPack(id: string): DeepReadonly<Pack> {\r\n\t\treturn this.getPacks().find(pack => pack.id === id)!;\r\n\t}\r\n\r\n\tpublic getAuthor(id: string): DeepReadonly<IAuthor | null> {\r\n\t\treturn this.authors.value[id] || null;\r\n\t}\r\n\r\n\tpublic getAuthors(): DeepReadonly<IAuthors> {\r\n\t\treturn this.authors.value;\r\n\t}\r\n}\r\n\r\nexport interface Pack extends IPrimitivePack {\r\n\tautoloading: boolean;\r\n\tonline: boolean;\r\n\tinstalled: boolean;\r\n\tloaded: boolean;\r\n}\r\n","import { RenderContext } from '@/renderer/rendererContext';\nimport { getAAsset } from '@/asset-manager';\nimport { PoseRenderCommand } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport { ErrorAsset } from '../models/error-asset';\nimport { DeepReadonly } from '@/util/readonly';\nimport { IObject } from '@/store/objects';\nimport { OffscreenRenderable } from './offscreenRenderable';\nimport { Store } from 'vuex';\nimport { IRootState } from '@/store';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport { IHitbox } from './renderable';\n\nexport abstract class AssetListRenderable<\n\tObj extends IObject\n> extends OffscreenRenderable<Obj> {\n\tprotected refTextbox: ITextBox | null = null;\n\tprotected abstract getAssetList(): Array<IDrawAssetsUnloaded | IDrawAssets>;\n\tprotected get canvasDrawWidth(): number {\n\t\treturn this.width * this.objZoom;\n\t}\n\tprotected get canvasDrawHeight(): number {\n\t\treturn this.height * this.objZoom;\n\t}\n\tprotected get canvasDrawPosX(): number {\n\t\treturn this.x - this.width / 2 + (this.height - this.canvasDrawHeight) / 2;\n\t}\n\tprotected get canvasDrawPosY(): number {\n\t\treturn this.y + (this.height - this.canvasDrawHeight);\n\t}\n\n\tprotected get objZoom(): number {\n\t\tconst textboxZoom =\n\t\t\tthis.obj.enlargeWhenTalking && this.refTextbox ? 1.05 : 1;\n\t\treturn textboxZoom * this.obj.zoom;\n\t}\n\n\tpublic getHitbox(): IHitbox {\n\t\tconst base = super.getHitbox();\n\t\tconst zoomWidthDelta = this.width * (this.objZoom - 1);\n\t\tconst zoomHeightDelta = this.height * (this.objZoom - 1);\n\n\t\treturn {\n\t\t\tx0: base.x0 - zoomWidthDelta / 2,\n\t\t\tx1: base.x1 + zoomWidthDelta / 2,\n\t\t\ty0: base.y0 - zoomHeightDelta,\n\t\t\ty1: base.y1,\n\t\t};\n\t}\n\n\tpublic updatedContent(\n\t\t_current: Store<DeepReadonly<IRootState>>,\n\t\tpanelId: string\n\t): void {\n\t\tconst panel = _current.state.objects.panels[panelId];\n\t\tconst inPanel = [...panel.order, ...panel.onTopOrder];\n\t\tthis.refTextbox = null;\n\t\tfor (const key of inPanel) {\n\t\t\tconst obj = _current.state.objects.objects[key] as ITextBox;\n\t\t\tif (obj.type === 'textBox' && obj.talkingObjId === this.obj.id) {\n\t\t\t\tthis.refTextbox = obj;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected async renderLocal(rx: RenderContext): Promise<void> {\n\t\tconst drawAssetsUnloaded: Array<\n\t\t\tIDrawAssetsUnloaded | IDrawAssets\n\t\t> = this.getAssetList();\n\n\t\tconst loadedDraws = await Promise.all(\n\t\t\tdrawAssetsUnloaded\n\t\t\t\t.filter(drawAsset => drawAsset.assets)\n\t\t\t\t.map(drawAsset => loadAssets(drawAsset, rx.hq))\n\t\t);\n\t\tfor (const loadedDraw of loadedDraws) {\n\t\t\tfor (const asset of loadedDraw.assets) {\n\t\t\t\trx.drawImage({\n\t\t\t\t\timage: asset,\n\t\t\t\t\tcomposite: loadedDraw.composite,\n\t\t\t\t\tx: loadedDraw.offset[0],\n\t\t\t\t\ty: loadedDraw.offset[1],\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport interface IDrawAssetsUnloaded {\n\toffset: DeepReadonly<[number, number]>;\n\tassets: DeepReadonly<IAsset[]>;\n\tcomposite?: PoseRenderCommand<any>['composite'];\n}\n\nexport interface IDrawAssets {\n\tloaded: true;\n\toffset: DeepReadonly<[number, number]>;\n\tassets: DeepReadonly<Array<HTMLImageElement | ErrorAsset>>;\n\tcomposite?: PoseRenderCommand<any>['composite'];\n}\n\nexport async function loadAssets(\n\tunloaded: IDrawAssetsUnloaded | IDrawAssets,\n\thq: boolean\n): Promise<IDrawAssets> {\n\tif ('loaded' in unloaded) return unloaded;\n\treturn {\n\t\tloaded: true,\n\t\toffset: unloaded.offset,\n\t\tassets: await Promise.all(\n\t\t\tunloaded.assets.map(asset => getAAsset(asset, hq))\n\t\t),\n\t\tcomposite: unloaded.composite,\n\t};\n}\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./d-button.vue?vue&type=style&index=0&id=465f5994&lang=scss&scoped=true\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./settings.vue?vue&type=style&index=0&id=82bbca46&lang=scss&scoped=true\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./panels.vue?vue&type=style&index=0&id=0c58913e&lang=scss&scoped=true\"","import { HSLAColor } from '@/util/colors/hsl';\n\nexport const textboxDefaultColor = '#ffa8d2';\nexport const controlsDefaultColor = '#552222';\nexport const nameboxDefaultColor = '#ffeef6';\nexport const nameboxStrokeDefaultColor = '#bb5599';\n\n// tslint:disable: no-magic-numbers\nexport const nameboxTextOutlineDelta = new HSLAColor(\n\t-0.03065134099616873,\n\t-0.5714285714285714,\n\t-0.29607843137254896,\n\t0\n);\n\nexport const nameboxBackgroundDelta = new HSLAColor(\n\t0.002028397565922768,\n\t0,\n\t0.13725490196078438,\n\t0\n);\n\nexport const nameboxGradientMiddleStopPosition = 0.82;\n\nexport const nameboxGradientEndDelta = new HSLAColor(\n\t-0.004901960784313708,\n\t-0.8599999999999999,\n\t-0.16274509803921566,\n\t0\n);\n\nexport const nameboxRounding = 12;\nexport const nameboxRoundingBuffer = 1.5;\n\nexport const textboxRounding = 12;\nexport const textboxRoundingBuffer = 1.5;\n\nexport const nameColorThreshold = 0.6;\n\nexport const controlColorDelta = new HSLAColor(\n\t0.08045977011494243,\n\t-0.5714285714285714,\n\t-0.5960784313725489,\n\t0\n);\n\nexport const controlDisableColorDelta = new HSLAColor(\n\t0,\n\t-0.14285714285714296,\n\t0.3,\n\t0\n);\n\nexport const dotColorDelta = new HSLAColor(\n\t0.004269293924466178,\n\t-0.01869158878504662,\n\t-0.039215686274509665,\n\t0\n);\n\nexport const dotRadius = 9.5;\nexport const dotPatternSize = 47;\n\nexport const textboxOutlineColorDelta = new HSLAColor(\n\t0.0023347701149424305,\n\t0,\n\t0.10784313725490202,\n\t0\n);\nexport const textboxOutlineWidth = 3;\n","import EventBus, {\n\tAssetFailureEvent,\n\tCustomAssetFailureEvent,\n} from './eventbus/event-bus';\nimport { ErrorAsset } from './models/error-asset';\nimport { IAsset } from './store/content';\nimport environment from './environments/environment';\n\nlet webpSupportPromise: Promise<boolean>;\nlet heifSupportPromise: Promise<boolean>;\n\nexport function isWebPSupported(): Promise<boolean> {\n\tif (!webpSupportPromise) {\n\t\twebpSupportPromise = new Promise((resolve, _reject) => {\n\t\t\tconst losslessCode =\n\t\t\t\t'data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=';\n\t\t\tconst img = document.createElement('img');\n\t\t\timg.addEventListener('load', () => {\n\t\t\t\tresolve(img.width === 2 && img.height === 1);\n\t\t\t});\n\t\t\timg.addEventListener('error', () => {\n\t\t\t\tresolve(false);\n\t\t\t});\n\t\t\timg.src = losslessCode;\n\t\t});\n\t}\n\treturn webpSupportPromise;\n}\n\nexport function isHeifSupported(): Promise<boolean> {\n\tif (!heifSupportPromise) {\n\t\theifSupportPromise = new Promise((resolve, _reject) => {\n\t\t\tconst losslessCode =\n\t\t\t\t'data:image/heic;base64,AAAAGGZ0eXBoZWljAAAAAG1pZjFoZWljAAAAsW1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAHBpY3QAXABjAGMAcwBsAGEAAAAADnBpdG0AAAAAAAEAAAAQaWxvYwAAAABEQAAAAAAAI2lpbmYAAAAAAAEAAAAVaW5mZQIAAAAAAQAAaHZjMQAAAABDaXBycAAAACdpcGNvAAAAH2h2Y0NmzGx1ci0AAAAAAABv9HP+//v9bjr3AAAAABRpcG1hAAAAAAAAAAEAAQGBAAAACG1kYXQ=';\n\t\t\tconst img = document.createElement('img');\n\t\t\timg.addEventListener('load', () => {\n\t\t\t\tconsole.log('Heif no error. ' + (img.width === 2 && img.height === 1));\n\t\t\t\tresolve(img.width === 2 && img.height === 1);\n\t\t\t});\n\t\t\timg.addEventListener('error', () => {\n\t\t\t\tconsole.log('Heif not supported');\n\t\t\t\tresolve(false);\n\t\t\t});\n\t\t\timg.src = losslessCode;\n\t\t});\n\t}\n\treturn heifSupportPromise;\n}\n\nconst assetCache: {\n\t[url: string]: Promise<HTMLImageElement | ErrorAsset> | undefined;\n} = {};\nconst customAssets: { [id: string]: Promise<HTMLImageElement> } = {};\n\nexport async function getAAsset(\n\tasset: IAsset,\n\thq: boolean = true\n): Promise<HTMLImageElement | ErrorAsset> {\n\treturn getAssetByUrl(environment.supports.lq && !hq ? asset.lq : asset.hq);\n}\nexport async function getAssetByUrl(\n\turl: string\n): Promise<HTMLImageElement | ErrorAsset> {\n\tif (!assetCache[url]) {\n\t\tassetCache[url] = new Promise((resolve, _reject) => {\n\t\t\tconst img = new Image();\n\t\t\timg.addEventListener('load', () => {\n\t\t\t\tresolve(img);\n\t\t\t});\n\t\t\timg.addEventListener('error', () => {\n\t\t\t\tEventBus.fire(new AssetFailureEvent(url));\n\t\t\t\tassetCache[url] = undefined;\n\t\t\t\tresolve(new ErrorAsset());\n\t\t\t});\n\t\t\timg.crossOrigin = 'Anonymous';\n\t\t\timg.src = url;\n\t\t\timg.style.display = 'none';\n\t\t\tdocument.body.appendChild(img);\n\t\t});\n\t}\n\n\treturn assetCache[url]!;\n}\nexport const baseUrl = process.env.BASE_URL === '' ? '.' : process.env.BASE_URL;\n\nexport async function getAsset(\n\tasset: string,\n\thq: boolean = true\n): Promise<HTMLImageElement | ErrorAsset> {\n\tif (customAssets[asset]) {\n\t\treturn customAssets[asset];\n\t}\n\n\tconst url = `${baseUrl}/assets/${asset}${hq ? '' : '.lq'}${\n\t\t(await isWebPSupported()) ? '.webp' : '.png'\n\t}`.replace(/\\/+/, '/');\n\treturn getAssetByUrl(url);\n}\n\nexport function registerAsset(asset: string, file: File): string {\n\tconst url = URL.createObjectURL(file);\n\tcustomAssets[asset] = new Promise((resolve, reject) => {\n\t\tconst img = new Image();\n\t\timg.addEventListener('load', () => {\n\t\t\tresolve(img);\n\t\t});\n\t\timg.addEventListener('error', error => {\n\t\t\tEventBus.fire(new CustomAssetFailureEvent(error));\n\t\t\treject(`Failed to load \"${url}\"`);\n\t\t});\n\t\timg.crossOrigin = 'Anonymous';\n\t\timg.src = url;\n\t\timg.style.display = 'none';\n\t\tdocument.body.appendChild(img);\n\t});\n\treturn url;\n}\n\nexport function registerAssetWithURL(\n\tasset: string,\n\turl: string\n): Promise<HTMLImageElement> {\n\treturn (customAssets[asset] = new Promise((resolve, reject) => {\n\t\tconst img = new Image();\n\t\timg.addEventListener('load', () => {\n\t\t\tresolve(img);\n\t\t});\n\t\timg.addEventListener('error', error => {\n\t\t\tEventBus.fire(new CustomAssetFailureEvent(error));\n\t\t\treject(`Failed to load \"${url}\"`);\n\t\t});\n\t\timg.crossOrigin = 'Anonymous';\n\t\timg.src = url;\n\t\timg.style.display = 'none';\n\t\tdocument.body.appendChild(img);\n\t}));\n}\n","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./settings.vue?vue&type=style&index=0&id=99a6545a&lang=scss&scoped=true\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./choice.vue?vue&type=style&index=0&id=6218d3d4&lang=scss&scoped=true\"","import getConstants from '@/constants';\r\n\r\nexport function baseProps() {\r\n\treturn {\r\n\t\tflip: false,\r\n\t\trotation: 0,\r\n\t\tversion: 0,\r\n\t\topacity: 100,\r\n\t\tx: getConstants().Base.screenWidth / 2,\r\n\t\tcomposite: 'source-over',\r\n\t\tfilters: [],\r\n\t\tlabel: null,\r\n\t\ttextboxColor: null,\r\n\t\tenlargeWhenTalking: false,\r\n\t\tnameboxWidth: null,\r\n\t\tzoom: 1,\r\n\t};\r\n}\r\n","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./textbox.vue?vue&type=style&index=0&id=fb44b570&lang=scss&scoped=true\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./credits.vue?vue&type=style&index=0&id=753d2b9a&lang=scss&scoped=true\"","import { RenderAbortedException } from './renderAbortedException';\nimport { Renderer } from './renderer';\nimport { ErrorAsset } from '@/models/error-asset';\nimport { SpriteFilter } from '@/store/sprite_options';\nimport { DeepReadonly } from '@/util/readonly';\n\nexport type CompositeModes =\n\t| 'source-over'\n\t| 'source-in'\n\t| 'source-out'\n\t| 'source-atop'\n\t| 'destination-over'\n\t| 'destination-in'\n\t| 'destination-out'\n\t| 'destination-atop'\n\t| 'lighter'\n\t| 'copy'\n\t| 'xor'\n\t| 'multiply'\n\t| 'screen'\n\t| 'overlay'\n\t| 'darken'\n\t| 'lighten'\n\t| 'color-dodge'\n\t| 'color-burn'\n\t| 'hard-light'\n\t| 'soft-light'\n\t| 'difference'\n\t| 'exclusion'\n\t| 'hue'\n\t| 'saturation'\n\t| 'color'\n\t| 'luminosity';\n\nexport class RenderContext {\n\tprivate aborted: boolean = false;\n\n\tprivate constructor(\n\t\tprivate canvas: HTMLCanvasElement,\n\t\tpublic readonly fsCtx: CanvasRenderingContext2D,\n\t\tpublic readonly hq: boolean,\n\t\tpublic readonly preview: boolean\n\t) {}\n\n\tpublic static make(\n\t\tcanvas: HTMLCanvasElement,\n\t\thq: boolean,\n\t\tpreview: boolean\n\t): RenderContext {\n\t\treturn new RenderContext(canvas, canvas.getContext('2d')!, hq, preview);\n\t}\n\n\tpublic static makeWithContext(\n\t\tcanvas: HTMLCanvasElement,\n\t\tcontext: CanvasRenderingContext2D,\n\t\thq: boolean,\n\t\tpreview: boolean\n\t): RenderContext {\n\t\treturn new RenderContext(canvas, context, hq, preview);\n\t}\n\n\tpublic drawText(\n\t\tparams: { text: string; align?: CanvasTextAlign; font?: string } & IRPos &\n\t\t\tIOOutline &\n\t\t\tIOFill\n\t) {\n\t\tif (this.aborted) throw new RenderAbortedException();\n\t\tthis.fsCtx.save();\n\n\t\tconst { font, align, x = 0, y = 0, text = '' } = {\n\t\t\t...{\n\t\t\t\tfont: '20px aller',\n\t\t\t\talign: 'left' as CanvasTextAlign,\n\t\t\t},\n\t\t\t...params,\n\t\t};\n\n\t\tthis.fsCtx.lineJoin = 'round';\n\t\tthis.fsCtx.textAlign = align;\n\t\tthis.fsCtx.font = font;\n\n\t\tif (params.outline) {\n\t\t\tthis.fsCtx.strokeStyle = params.outline.style;\n\t\t\tthis.fsCtx.lineWidth = params.outline.width;\n\t\t\tthis.fsCtx.strokeText(text, x, y);\n\t\t}\n\n\t\tif (params.fill) {\n\t\t\tthis.fsCtx.fillStyle = params.fill.style;\n\t\t\tthis.fsCtx.fillText(text, x, y);\n\t\t}\n\n\t\tthis.fsCtx.restore();\n\t}\n\n\tpublic measureText(\n\t\tparams: {\n\t\t\ttext: string;\n\t\t\talign?: CanvasTextAlign;\n\t\t\tfont?: string;\n\t\t} & IOOutline &\n\t\t\tIOFill\n\t): TextMetrics {\n\t\tif (this.aborted) throw new RenderAbortedException();\n\t\tthis.fsCtx.save();\n\n\t\tconst { font, align, text = '' } = {\n\t\t\t...{\n\t\t\t\tfont: '20px aller',\n\t\t\t\talign: 'left' as CanvasTextAlign,\n\t\t\t},\n\t\t\t...params,\n\t\t};\n\n\t\tthis.fsCtx.lineJoin = 'round';\n\t\tthis.fsCtx.textAlign = align;\n\t\tthis.fsCtx.font = font;\n\n\t\tif (params.outline) {\n\t\t\tthis.fsCtx.strokeStyle = params.outline.style;\n\t\t\tthis.fsCtx.lineWidth = params.outline.width;\n\t\t}\n\n\t\tif (params.fill) {\n\t\t\tthis.fsCtx.fillStyle = params.fill.style;\n\t\t}\n\t\tconst ret = this.fsCtx.measureText(text);\n\t\tthis.fsCtx.restore();\n\t\treturn ret;\n\t}\n\n\tpublic drawImage(\n\t\tparams: {\n\t\t\timage: HTMLImageElement | ErrorAsset | Renderer;\n\t\t\tflip?: boolean;\n\t\t\tcomposite?: CompositeModes;\n\t\t} & IRPos &\n\t\t\tIOSize &\n\t\t\tIOShadow &\n\t\t\tIOFilters &\n\t\t\tIORotation\n\t): void {\n\t\tif (this.aborted) throw new RenderAbortedException();\n\t\tif (params.image instanceof ErrorAsset) return;\n\t\tconst { image, flip, x, y, w, h, filters, composite } = {\n\t\t\tflip: false,\n\t\t\tw: params.image.width,\n\t\t\th: params.image.height,\n\t\t\tcomposite: 'source-over' as 'source-over',\n\t\t\t...params,\n\t\t};\n\n\t\tthis.fsCtx.save();\n\t\tthis.fsCtx.globalCompositeOperation = composite;\n\n\t\tif (filters) {\n\t\t\t// Safari fallback\n\t\t\tif (!(('filter' in this.fsCtx) as any)) {\n\t\t\t\tlet opacityCombined = 1;\n\t\t\t\tfor (const filter of filters) {\n\t\t\t\t\tif (filter.type === 'opacity') {\n\t\t\t\t\t\topacityCombined *= filter.value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.fsCtx.globalAlpha = opacityCombined;\n\t\t\t} else {\n\t\t\t\tconst filterList: string[] = [];\n\t\t\t\tfor (const filter of filters) {\n\t\t\t\t\tif (filter.type === 'drop-shadow') {\n\t\t\t\t\t\tfilterList.push(\n\t\t\t\t\t\t\t`drop-shadow(${filter.offsetX}px ${filter.offsetY}px ${filter.blurRadius}px ${filter.color})`\n\t\t\t\t\t\t);\n\t\t\t\t\t} else if (filter.type === 'hue-rotate') {\n\t\t\t\t\t\tfilterList.push(`hue-rotate(${filter.value}deg)`);\n\t\t\t\t\t} else if (filter.type === 'blur') {\n\t\t\t\t\t\tfilterList.push(`blur(${filter.value}px)`);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfilterList.push(`${filter.type}(${filter.value * 100}%)`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.fsCtx.filter = filterList.join(' ');\n\t\t\t}\n\t\t}\n\n\t\tif (params.shadow) {\n\t\t\tconst shadow = params.shadow;\n\t\t\tif (shadow.color) {\n\t\t\t\tthis.fsCtx.shadowColor = shadow.color;\n\t\t\t}\n\t\t\tif (shadow.blur) {\n\t\t\t\tthis.fsCtx.shadowBlur = shadow.blur;\n\t\t\t}\n\t\t\tif (shadow.offsetX) {\n\t\t\t\tthis.fsCtx.shadowOffsetX = shadow.offsetX;\n\t\t\t}\n\t\t\tif (shadow.offsetY) {\n\t\t\t\tthis.fsCtx.shadowOffsetY = shadow.offsetY;\n\t\t\t}\n\t\t}\n\n\t\tif (params.rotation) {\n\t\t\tconst rotX = params.rotationAnchor ? params.rotationAnchor.x : 0;\n\t\t\tconst rotY = params.rotationAnchor ? params.rotationAnchor.y : 0;\n\t\t\tif (params.rotationAnchor) {\n\t\t\t\tthis.fsCtx.translate(rotX, rotY);\n\t\t\t}\n\t\t\tthis.fsCtx.fillRect(-10, -1, 21, 3);\n\t\t\tthis.fsCtx.rotate(params.rotation);\n\t\t\tif (params.rotationAnchor) {\n\t\t\t\tthis.fsCtx.translate(-rotX, -rotY);\n\t\t\t}\n\t\t}\n\n\t\tthis.fsCtx.translate(x + w / 2, y + h / 2);\n\t\tthis.fsCtx.scale(flip ? -1 : 1, 1);\n\t\tif (image instanceof Renderer) {\n\t\t\timage.paintOnto(this.fsCtx, { x: -w / 2, y: -h / 2, w, h });\n\t\t} else {\n\t\t\tthis.fsCtx.drawImage(image as HTMLImageElement, -w / 2, -h / 2, w, h);\n\t\t}\n\t\tthis.fsCtx.restore();\n\t\tthis.fsCtx.globalCompositeOperation = 'source-over';\n\t}\n\n\tpublic drawRect({\n\t\tx,\n\t\ty,\n\t\tw,\n\t\th,\n\t\toutline,\n\t\tfill,\n\t\tcomposition,\n\t}: IRPos & IRSize & IOOutline & IOFill & IOComposition) {\n\t\tif (this.aborted) throw new RenderAbortedException();\n\t\tthis.fsCtx.save();\n\t\tthis.fsCtx.beginPath();\n\t\tthis.fsCtx.rect(x, y, w, h);\n\n\t\tif (composition) {\n\t\t\tthis.fsCtx.globalCompositeOperation = composition;\n\t\t}\n\n\t\tif (fill) {\n\t\t\tthis.fsCtx.fillStyle = fill.style;\n\t\t\tthis.fsCtx.fill();\n\t\t}\n\t\tif (outline) {\n\t\t\tthis.fsCtx.strokeStyle = outline.style;\n\t\t\tthis.fsCtx.lineWidth = outline.width;\n\t\t\tthis.fsCtx.stroke();\n\t\t}\n\t\tthis.fsCtx.restore();\n\t}\n\n\tpublic drawPath({\n\t\toutline,\n\t\tfill,\n\t\tpath,\n\t}: { path: (ctx: CanvasPath) => void } & IOOutline & IOFill) {\n\t\tif (this.aborted) throw new RenderAbortedException();\n\t\tthis.fsCtx.save();\n\t\tthis.fsCtx.beginPath();\n\t\tpath(this.fsCtx);\n\n\t\tif (fill) {\n\t\t\tthis.fsCtx.fillStyle = fill.style;\n\t\t\tthis.fsCtx.fill();\n\t\t}\n\t\tif (outline) {\n\t\t\tthis.fsCtx.strokeStyle = outline.style;\n\t\t\tthis.fsCtx.lineWidth = outline.width;\n\t\t\tthis.fsCtx.stroke();\n\t\t}\n\t\tthis.fsCtx.restore();\n\t}\n\n\tpublic patternFrom(\n\t\timage: HTMLImageElement | Renderer,\n\t\trepetition: 'repeat' | 'repeat-x' | 'repeat-y' | 'no-repeat' = 'repeat'\n\t): CanvasPattern {\n\t\tif (image instanceof Renderer) {\n\t\t\timage = (image as any).previewCanvas;\n\t\t}\n\t\treturn this.fsCtx.createPattern(\n\t\t\t(image as any) as CanvasImageSource,\n\t\t\trepetition\n\t\t)!;\n\t}\n\n\tpublic async customTransform(\n\t\ttransform: (transformContext: CanvasRenderingContext2D) => Promise<void>,\n\t\trender: (rx: RenderContext) => Promise<void>\n\t) {\n\t\tthis.fsCtx.save();\n\t\tawait transform(this.fsCtx);\n\t\tawait render(this);\n\t\tthis.fsCtx.restore();\n\t}\n\n\tpublic linearGradient(\n\t\tx0: number,\n\t\ty0: number,\n\t\tx1: number,\n\t\ty1: number\n\t): CanvasGradient {\n\t\treturn this.fsCtx.createLinearGradient(x0, y0, x1, y1);\n\t}\n\n\tpublic applyFilters(filters: DeepReadonly<SpriteFilter[]>) {\n\t\tif (filters.length === 0) return;\n\t\t// Safari fallback\n\t\tthis.fsCtx.save();\n\t\tlet opacityCombined = 1;\n\t\tfor (const filter of filters) {\n\t\t\tif (filter.type === 'opacity') {\n\t\t\t\topacityCombined *= filter.value;\n\t\t\t}\n\t\t}\n\t\tif ('filter' in this.fsCtx) {\n\t\t\tconst filterList: string[] = [];\n\t\t\tfor (const filter of filters) {\n\t\t\t\tif (filter.type === 'opacity') continue;\n\t\t\t\tif (filter.type === 'drop-shadow') {\n\t\t\t\t\tfilterList.push(\n\t\t\t\t\t\t`drop-shadow(${filter.offsetX}px ${filter.offsetY}px ${filter.blurRadius}px ${filter.color})`\n\t\t\t\t\t);\n\t\t\t\t} else if (filter.type === 'hue-rotate') {\n\t\t\t\t\tfilterList.push(`hue-rotate(${filter.value}deg)`);\n\t\t\t\t} else if (filter.type === 'blur') {\n\t\t\t\t\tfilterList.push(`blur(${filter.value}px)`);\n\t\t\t\t} else {\n\t\t\t\t\tfilterList.push(`${filter.type}(${filter.value * 100}%)`);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.fsCtx.filter = filterList.join(' ');\n\t\t}\n\n\t\tthis.fsCtx.drawImage(this.canvas, 0, 0);\n\n\t\tif (opacityCombined !== 1) {\n\t\t\tthis.fsCtx.globalCompositeOperation = 'destination-atop';\n\t\t\tthis.fsCtx.fillStyle = `rgba(0,0,0,${opacityCombined})`;\n\t\t\tthis.fsCtx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n\t\t\tthis.fsCtx.globalCompositeOperation = 'source-over';\n\t\t}\n\n\t\tif ('filter' in this.fsCtx) {\n\t\t\tthis.fsCtx.filter = 'none';\n\t\t}\n\t\tthis.fsCtx.restore();\n\t}\n\n\tpublic abort(): void {\n\t\tthis.aborted = true;\n\t}\n}\n\nexport interface IShadow {\n\tblur?: number;\n\tcolor?: string;\n\toffsetX?: number;\n\toffsetY?: number;\n}\n\nexport interface IOutline {\n\tstyle: string;\n\twidth: number;\n}\n\nexport interface IFill {\n\tstyle: string | CanvasGradient | CanvasPattern;\n}\n\ninterface IOShadow {\n\tshadow?: IShadow;\n}\n\ninterface IOComposition {\n\tcomposition?: CompositeModes;\n}\n\ninterface IRPos {\n\tx: number;\n\ty: number;\n}\n\ninterface IRSize {\n\tw: number;\n\th: number;\n}\n\ninterface IOSize {\n\tw?: number;\n\th?: number;\n}\n\ninterface IOOutline {\n\toutline?: IOutline;\n}\ninterface IOFilters {\n\tfilters?: DeepReadonly<SpriteFilter[]>;\n}\n\ninterface IORotation {\n\trotation?: number;\n\trotationAnchor?: {\n\t\tx: number;\n\t\ty: number;\n\t};\n}\n\ninterface IOFill {\n\tfill?: IFill;\n}\n","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./button.vue?vue&type=style&index=0&id=09138076&lang=scss&scoped=true\"","import { HSLAColor } from '@/util/colors/hsl';\n\nexport const textboxDefaultColor = '#ffa8d2';\nexport const controlsDefaultColor = '#552222';\nexport const nameboxDefaultColor = '#ffeef6';\nexport const nameboxStrokeDefaultColor = '#bb5599';\n\n// tslint:disable: no-magic-numbers\nexport const nameboxTextOutlineDelta = new HSLAColor(\n\t-0.03065134099616873,\n\t-0.5714285714285714,\n\t-0.29607843137254896,\n\t0\n);\n\nexport const nameboxBackgroundDelta = new HSLAColor(\n\t0.002028397565922768,\n\t0,\n\t0.13725490196078438,\n\t0\n);\n\nexport const nameboxGradientMiddleStopPosition = 0.82;\n\nexport const nameboxGradientEndDelta = new HSLAColor(\n\t-0.004901960784313708,\n\t-0.8599999999999999,\n\t-0.16274509803921566,\n\t0\n);\n\nexport const nameboxRounding = 15;\nexport const nameboxRoundingBuffer = 1.5;\n\nexport const textboxRounding = 19;\nexport const textboxRoundingBuffer = 1.5;\n\nexport const nameColorThreshold = 0.6;\n\nexport const controlColorDelta = new HSLAColor(\n\t0.08045977011494243,\n\t-0.5714285714285714,\n\t-0.5960784313725489,\n\t0\n);\n\nexport const controlDisableColorDelta = new HSLAColor(\n\t0,\n\t-0.14285714285714296,\n\t0.3,\n\t0\n);\n\nexport const dotColorDelta = new HSLAColor(\n\t0.004269293924466178,\n\t-0.01869158878504662,\n\t-0.039215686274509665,\n\t0\n);\n\nexport const dotRadius = 9.5 * 1.5;\nexport const dotPatternSize = 47 * 1.5;\n\nexport const textboxOutlineColorDelta = new HSLAColor(\n\t0.0023347701149424305,\n\t0,\n\t0.10784313725490202,\n\t0\n);\nexport const textboxOutlineWidth = 5;\n","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./layers.vue?vue&type=style&index=0&id=90b83fd8&lang=scss&scoped=true\"","export class RenderAbortedException {}\n","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./poem.vue?vue&type=style&index=0&id=67d04474&lang=scss&scoped=true\"","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./image-options.vue?vue&type=style&index=0&id=4dd06317&lang=scss&scoped=true\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./positionAndSize.vue?vue&type=style&index=0&id=3e1f568a&lang=scss&scoped=true\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./toggle.vue?vue&type=style&index=0&id=7b1bf059&lang=scss\"","export function rotateAround(\r\n\tx: number,\r\n\ty: number,\r\n\trelX: number,\r\n\trelY: number,\r\n\tangle: number\r\n): [number, number] {\r\n\tconst angleCos = Math.cos(angle);\r\n\tconst angleSin = Math.sin(angle);\r\n\tconst translatedX = x - relX;\r\n\tconst translatedY = y - relY;\r\n\tconst rotatedX = angleCos * translatedX - angleSin * translatedY + relX;\r\n\tconst rotatedY = angleSin * translatedX + angleCos * translatedY + relY;\r\n\treturn [rotatedX, rotatedY];\r\n}\r\n","import { HSLAColor } from '@/util/colors/hsl';\nimport { ITextStyle } from '@/renderer/textRenderer/textRenderer';\nimport { screenHeight } from './base';\n\n// tslint:disable: no-magic-numbers\nexport const nameboxTextOutlineDelta = new HSLAColor(\n\t-0.03065134099616873,\n\t-0.5714285714285714,\n\t-0.29607843137254896,\n\t0\n);\n\nexport const ChoiceButtonColor = '#ffe6f4';\nexport const ChoiceButtonBorderColor = '#ffbde1';\nexport const ChoiceButtonWidth = 420;\nexport const ChoiceSpacing = 22;\nexport const ChoiceX = 640;\nexport const ChoiceYOffset = 270;\nexport const ChoicePadding = 7;\nexport const Outline = 3;\n\nexport const ChoiceY = (screenHeight - ChoiceYOffset) / 2;\n\nexport const ChoiceTextStyle: ITextStyle = {\n\talpha: 1,\n\tcolor: 'black',\n\tfontName: 'aller',\n\tfontSize: 24,\n\tisBold: false,\n\tisItalic: false,\n\tisStrikethrough: false,\n\tisUnderlined: false,\n\tletterSpacing: 0,\n\tlineSpacing: 1,\n\tstrokeColor: '',\n\tstrokeWidth: 0,\n};\n","import { ITextStyle } from '@/renderer/textRenderer/textRenderer';\nimport { BaseTextStyle } from './textBox';\nimport { nameboxStrokeDefaultColor } from './textBoxCustom';\n\n// tslint:disable: no-magic-numbers\nexport const NotificationBackgroundColor = '#ffe6f4';\nexport const NotificationBorderColor = '#ffbde1';\nexport const NotificationBackdropColor = 'rgba(255,255,255,0.6)';\n// export const NotificationMaxWidth = 744;\nexport const NotificationPadding = 40;\nexport const NotificationSpacing = 30;\n\nexport const NotificationOkTextStyle: ITextStyle = {\n\t...BaseTextStyle,\n\tfontName: 'riffic',\n\tfontSize: 24,\n\tstrokeColor: nameboxStrokeDefaultColor,\n\tstrokeWidth: 8,\n\tletterSpacing: 1,\n\tcolor: 'white',\n};\n\nexport const NotificationTextStyle: ITextStyle = {\n\talpha: 1,\n\tcolor: 'black',\n\tfontName: 'aller',\n\tfontSize: 24,\n\tisBold: false,\n\tisItalic: false,\n\tisStrikethrough: false,\n\tisUnderlined: false,\n\tletterSpacing: 0,\n\tlineSpacing: 1.2,\n\tstrokeColor: '',\n\tstrokeWidth: 0,\n};\n","import * as Base from './base';\nimport * as Choices from './choices';\nimport * as Notification from './notification';\nimport * as Poem from './poem';\nimport * as TextBox from './textBox';\nimport * as TextBoxCustom from './textBoxCustom';\n\nexport default {\n\tBase,\n\tChoices,\n\tNotification,\n\tPoem,\n\tTextBox,\n\tTextBoxCustom,\n};\n","import { HSLAColor } from '@/util/colors/hsl';\nimport { ITextStyle } from '@/renderer/textRenderer/textRenderer';\nimport { screenHeight } from './base';\n\n// tslint:disable: no-magic-numbers\nexport const nameboxTextOutlineDelta = new HSLAColor(\n\t-0.03065134099616873,\n\t-0.5714285714285714,\n\t-0.29607843137254896,\n\t0\n);\n\nexport const ChoiceButtonColor = '#ffe6f4';\nexport const ChoiceButtonBorderColor = '#ffbde1';\nexport const ChoiceButtonWidth = 630;\nexport const ChoiceSpacing = 33;\nexport const ChoiceX = 960;\nexport const ChoiceYOffset = 405;\nexport const ChoicePadding = 10.5;\nexport const Outline = 4.5;\n\nexport const ChoiceY = (screenHeight - ChoiceYOffset) / 2;\n\nexport const ChoiceTextStyle: ITextStyle = {\n\talpha: 1,\n\tcolor: 'black',\n\tfontName: 'aller',\n\tfontSize: 36,\n\tisBold: false,\n\tisItalic: false,\n\tisStrikethrough: false,\n\tisUnderlined: false,\n\tletterSpacing: 0,\n\tlineSpacing: 1,\n\tstrokeColor: '',\n\tstrokeWidth: 0,\n};\n","import { ITextStyle } from '@/renderer/textRenderer/textRenderer';\nimport { BaseTextStyle } from './textBox';\nimport { nameboxStrokeDefaultColor } from './textBoxCustom';\n\n// tslint:disable: no-magic-numbers\nexport const NotificationBackgroundColor = '#ffe6f4';\nexport const NotificationBorderColor = '#ffbde1';\nexport const NotificationBackdropColor = 'rgba(255,255,255,0.6)';\n// export const NotificationMaxWidth = 744;\nexport const NotificationPadding = 60;\nexport const NotificationSpacing = 45;\n\nexport const NotificationOkTextStyle: ITextStyle = {\n\t...BaseTextStyle,\n\tfontName: 'riffic',\n\tfontSize: 36,\n\tstrokeColor: nameboxStrokeDefaultColor,\n\tstrokeWidth: 12,\n\tletterSpacing: 1,\n\tcolor: 'white',\n};\n\nexport const NotificationTextStyle: ITextStyle = {\n\talpha: 1,\n\tcolor: 'black',\n\tfontName: 'aller',\n\tfontSize: 36,\n\tisBold: false,\n\tisItalic: false,\n\tisStrikethrough: false,\n\tisUnderlined: false,\n\tletterSpacing: 0,\n\tlineSpacing: 1.2,\n\tstrokeColor: '',\n\tstrokeWidth: 0,\n};\n","import { ITextStyle } from '@/renderer/textRenderer/textRenderer';\nimport { screenHeight, screenWidth } from './base';\n\n// tslint:disable: no-magic-numbers\nexport const poemBackgrounds = [\n\t{ name: 'Normal paper', file: 'poem.jpg' },\n\t{ name: 'Lightly soiled paper', file: 'poem_y1.jpg' },\n\t{ name: 'Heavily soiled paper', file: 'poem_y2.jpg' },\n\t{ name: 'Console', file: 'internal:console' },\n\t{ name: 'Transparent', file: 'internal:transparent' },\n];\nexport const defaultPoemBackground = 0;\nexport const defaultPoemStyle = 0;\nexport const defaultX = screenWidth / 2;\nexport const defaultY = screenHeight / 2;\nexport const poemTopPadding = 33;\nexport const poemBottomPadding = 100;\nexport const poemPadding = 30;\nexport const defaultPoemWidth = 800;\nexport const defaultPoemHeight = 720;\n\n//#region Console style\nexport const consoleBackgroundColor = 'rgba(51,51,51,0.75)';\nexport const consoleWidth = 480;\nexport const consoleHeight = 180;\nexport const defaultConsoleBackground = 3;\nexport const defaultConsoleStyle = 7;\n//#endregion Console style\n\nconst BasePoemStyle: ITextStyle = {\n\talpha: 1,\n\tcolor: 'black',\n\tisBold: false,\n\tisItalic: false,\n\tisStrikethrough: false,\n\tisUnderlined: false,\n\tletterSpacing: 0,\n\tlineSpacing: 1.2,\n\tstrokeColor: '',\n\tstrokeWidth: 0,\n\tfontName: 'aller',\n\tfontSize: 12,\n};\n\nexport interface IPoemTextStyle extends ITextStyle {\n\tname: string;\n}\n\nexport const poemTextStyles: IPoemTextStyle[] = [\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Sayori',\n\t\tfontName: 'hashtag',\n\t\tfontSize: 34,\n\t\tlineSpacing: 1.05,\n\t\tletterSpacing: 0,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Natsuki',\n\t\tfontName: 'ammy_handwriting',\n\t\tfontSize: 28,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Monika',\n\t\tfontName: 'journal',\n\t\tfontSize: 34,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Yuri',\n\t\tfontName: 'jp_hand_slanted',\n\t\tlineSpacing: 1.5,\n\t\tfontSize: 32,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Yuri Act 2',\n\t\tfontName: 'damagrafik_script',\n\t\tfontSize: 18,\n\t\tletterSpacing: -8,\n\t\t// justify: true,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Yuri Unused',\n\t\tfontName: 'as_i_lay_dying',\n\t\tfontSize: 40,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'MC',\n\t\tfontName: 'halogen',\n\t\tfontSize: 30,\n\t\tlineSpacing: 1.53,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Console',\n\t\tfontName: 'f25_bank_printer',\n\t\tfontSize: 18,\n\t\tcolor: 'white',\n\t\tlineSpacing: 1.1,\n\t},\n];\n","import * as Base from './base';\nimport * as Choices from './choices';\nimport * as Notification from './notification';\nimport * as Poem from './poem';\nimport * as TextBox from './textBox';\nimport * as TextBoxCustom from './textBoxCustom';\n\nexport default {\n\tBase,\n\tChoices,\n\tNotification,\n\tPoem,\n\tTextBox,\n\tTextBoxCustom,\n};\n","import enviroment from '@/environments/environment';\nimport { ITextStyle } from '@/renderer/textRenderer/textRenderer';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport { HSLAColor } from '@/util/colors/hsl';\nimport Ddlc from './game_modes/ddlc';\nimport { IPoemTextStyle } from './game_modes/ddlc/poem';\nimport DdlcPlus from './game_modes/ddlc_plus';\n\nexport default function getConstants() {\n\tif (enviroment.gameMode === 'ddlc_plus') return DdlcPlus;\n\treturn Ddlc;\n}\n\nexport interface IConstants {\n\treadonly Base: {\n\t\treadonly screenWidth: number;\n\t\treadonly screenHeight: number;\n\t\treadonly sdCharacterScaleFactor: number;\n\t\treadonly hdCharacterScaleFactor: number;\n\t\treadonly positions: string[];\n\t\treadonly characterPositions: number[];\n\t};\n\treadonly Choices: {\n\t\treadonly nameboxTextOutlineDelta: HSLAColor;\n\t\treadonly ChoiceButtonColor: string;\n\t\treadonly ChoiceButtonBorderColor: string;\n\t\treadonly ChoiceButtonWidth: number;\n\t\treadonly ChoiceSpacing: number;\n\t\treadonly ChoiceX: number;\n\t\treadonly ChoiceYOffset: number;\n\t\treadonly ChoicePadding: number;\n\t\treadonly ChoiceY: number;\n\t\treadonly ChoiceTextStyle: ITextStyle;\n\t\treadonly Outline: number;\n\t};\n\treadonly Notification: {\n\t\treadonly NotificationBackgroundColor: string;\n\t\treadonly NotificationBorderColor: string;\n\t\treadonly NotificationBackdropColor: string;\n\t\treadonly NotificationPadding: number;\n\t\treadonly NotificationSpacing: number;\n\t\treadonly NotificationOkTextStyle: ITextStyle;\n\t\treadonly NotificationTextStyle: ITextStyle;\n\t};\n\treadonly Poem: {\n\t\treadonly poemBackgrounds: { name: string; file: string }[];\n\t\treadonly defaultPoemBackground: number;\n\t\treadonly defaultPoemStyle: number;\n\t\treadonly defaultX: number;\n\t\treadonly defaultY: number;\n\t\treadonly poemTopPadding: number;\n\t\treadonly poemBottomPadding: number;\n\t\treadonly poemPadding: number;\n\t\treadonly defaultPoemWidth: number;\n\t\treadonly defaultPoemHeight: number;\n\n\t\t//#region Console style\n\t\treadonly consoleBackgroundColor: string;\n\t\treadonly consoleWidth: number;\n\t\treadonly consoleHeight: number;\n\t\treadonly defaultConsoleBackground: number;\n\t\treadonly defaultConsoleStyle: number;\n\t\t//#endregion Console style\n\n\t\treadonly poemTextStyles: IPoemTextStyle[];\n\t};\n\treadonly TextBox: {\n\t\treadonly DefaultTextboxStyle: ITextBox['style'];\n\t};\n\treadonly TextBoxCustom: {};\n}\n","export class ErrorAsset {}\n","export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./App.vue?vue&type=style&index=0&id=7ed1cde7&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./d-flow.vue?vue&type=style&index=0&id=64adfc9c&lang=scss&scoped=true\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./object-tool.vue?vue&type=style&index=1&id=16d40063&lang=scss\"","import { ComponentOptionsMixin } from 'vue';\n\nconst firefoxDeltaFactor = 25;\n\nexport const VerticalScrollRedirect: ComponentOptionsMixin = {\n\tmethods: {\n\t\tverticalScrollRedirect(e: WheelEvent) {\n\t\t\tif (e.type !== 'wheel') return;\n\t\t\tif (!e.currentTarget) return;\n\t\t\tconst currentTarget = e.currentTarget as HTMLElement;\n\t\t\tconst target = getComputedStyle(currentTarget);\n\n\t\t\tconst ev = e as WheelEvent;\n\t\t\tif (ev.deltaY === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (target.overflowY === 'auto') {\n\t\t\t\tif (ev.deltaY > 0) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tcurrentTarget.scrollHeight >\n\t\t\t\t\t\tcurrentTarget.scrollTop + currentTarget.clientHeight\n\t\t\t\t\t) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (currentTarget.scrollTop > 0) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst oldScrollLeft = currentTarget.scrollLeft;\n\t\t\tif ((ev as any).mozInputSource) {\n\t\t\t\t// Firefox sends wierdly low delta values :/\n\t\t\t\tcurrentTarget.scrollLeft += ev.deltaY * firefoxDeltaFactor;\n\t\t\t} else {\n\t\t\t\tcurrentTarget.scrollLeft += ev.deltaY;\n\t\t\t}\n\t\t\tif (currentTarget.scrollLeft !== oldScrollLeft) {\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t},\n\t},\n};\n","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./slider.vue?vue&type=style&index=0&id=f14035dc&lang=scss&scoped=true\"","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./text.vue?vue&type=style&index=0&id=358bd1b6&lang=scss&scoped=true\"","<template>\n\t<div class=\"fieldset_wrapper\">\n\t\t<fieldset>\n\t\t\t<legend v-if=\"title > ''\">{{ title }}</legend>\n\t\t\t<div class=\"fieldset_contents\">\n\t\t\t\t<slot />\n\t\t\t</div>\n\t\t</fieldset>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\nexport default defineComponent({\n\tprops: {\n\t\ttitle: {\n\t\t\trequired: true,\n\t\t\ttype: String,\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.fieldset_contents {\n\tmargin-top: 0.5em;\n\theight: calc(100% - 0.5em);\n}\n\nlegend {\n\tline-height: 0px;\n\tuser-select: none;\n}\n\nfieldset {\n\tborder: 3px solid $default-border;\n\tborder: 3px solid var(--border);\n\theight: 100%;\n}\n.fieldset_wrapper {\n\tpadding-top: 0.5em;\n}\n</style>\n","\nimport { defineComponent } from 'vue';\nexport default defineComponent({\n\tprops: {\n\t\ttitle: {\n\t\t\trequired: true,\n\t\t\ttype: String,\n\t\t},\n\t},\n});\n","import { render } from \"./d-fieldset.vue?vue&type=template&id=36ffea9a&scoped=true\"\nimport script from \"./d-fieldset.vue?vue&type=script&lang=ts\"\nexport * from \"./d-fieldset.vue?vue&type=script&lang=ts\"\n\nimport \"./d-fieldset.vue?vue&type=style&index=0&id=36ffea9a&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-36ffea9a\"\n\nexport default script","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./backgrounds.vue?vue&type=style&index=0&id=42a773bc&lang=scss&scoped=true\"","import { ICommand } from '@/eventbus/command';\nimport {\n\tIObjectsState,\n\tICreateObjectMutation,\n\tIObject,\n\tISetPositionAction,\n\tISetObjectPositionMutation,\n\tIRemoveObjectAction,\n} from '@/store/objects';\nimport { MutationTree, ActionTree, Store, Commit, ActionContext } from 'vuex';\nimport { arraySeeker } from '@/models/seekers';\nimport { IHistoryOptions } from '@/plugins/vuex-history';\nimport {\n\tCharacter,\n\tPose,\n\tHeadCollection,\n\tContentPack,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '../content';\nimport { IRootState } from '..';\nimport { DeepReadonly } from '@/util/readonly';\nimport { baseProps } from './baseObjectProps';\nimport getConstants from '@/constants';\n\nexport interface ICharacter extends IObject {\n\ttype: 'character';\n\tcharacterType: string;\n\tfreeMove: boolean;\n\tclose: boolean;\n\tstyleGroupId: number;\n\tstyleId: number;\n\tposeId: number;\n\tposePositions: {\n\t\t[id: string]: number;\n\t};\n}\n\nexport const characterMutations: MutationTree<IObjectsState> = {\n\tsetPose(state, command: ISetPoseMutation) {\n\t\tconst obj = state.objects[command.id] as ICharacter;\n\t\tobj.poseId = command.poseId;\n\t\t++obj.version;\n\t},\n\tsetCharStyleGroup(state, { id, styleGroupId }: ISetCharStyleGroupMutation) {\n\t\tconst obj = state.objects[id] as ICharacter;\n\t\tobj.styleGroupId = styleGroupId;\n\t\t++obj.version;\n\t},\n\tsetCharStyle(state, { id, styleId }: ISetCharStyleMutation) {\n\t\tconst obj = state.objects[id] as ICharacter;\n\t\tobj.styleId = styleId;\n\t\t++obj.version;\n\t},\n\tsetPosePosition(state, command: ISetPosePositionMutation) {\n\t\tconst obj = state.objects[command.id] as ICharacter;\n\t\tobj.posePositions = {\n\t\t\t...obj.posePositions,\n\t\t\t...command.posePositions,\n\t\t};\n\t\t++obj.version;\n\t},\n\tsetClose(state, command: ISetCloseMutation) {\n\t\tconst obj = state.objects[command.id] as ICharacter;\n\t\tobj.close = command.close;\n\t\t++obj.version;\n\t},\n\tsetFreeMove(state, command: ISetFreeMoveMutation) {\n\t\tconst obj = state.objects[command.id] as ICharacter;\n\t\tobj.freeMove = command.freeMove;\n\t\tif (!obj.freeMove) {\n\t\t\tconst constants = getConstants();\n\t\t\tobj.x = constants.Base.characterPositions[closestCharacterSlot(obj.x)];\n\t\t\tobj.y = constants.Base.BaseCharacterYPos;\n\t\t}\n\t},\n};\n\nexport function getData(\n\tstore: Store<DeepReadonly<IRootState>>,\n\tstate: DeepReadonly<ICharacter>\n): DeepReadonly<Character<IAsset>> {\n\tconst characters = store.getters['content/getCharacters'] as Map<\n\t\tCharacter<IAsset>['id'],\n\t\tCharacter<IAsset>\n\t>;\n\treturn characters.get(state.characterType)!;\n}\n\nexport function getDataG(\n\trootGetters: any,\n\tcharacterType: string\n): Readonly<Character<IAsset>> {\n\tconst characters = rootGetters['content/getCharacters'] as Map<\n\t\tCharacter<IAsset>['id'],\n\t\tCharacter<IAsset>\n\t>;\n\treturn characters.get(characterType)!;\n}\n\nexport function getPose(\n\tdata: DeepReadonly<Character<IAsset>>,\n\tstate: DeepReadonly<ICharacter>\n): DeepReadonly<Pose<IAsset>> {\n\treturn data.styleGroups[state.styleGroupId].styles[state.styleId].poses[\n\t\tstate.poseId\n\t];\n}\n\nexport function getParts(\n\tdata: DeepReadonly<Character<IAsset>>,\n\tstate: DeepReadonly<ICharacter>\n): DeepReadonly<string[]> {\n\tconst pose = getPose(data, state);\n\tconst positionKeys = [\n\t\t...Object.keys(pose.positions).filter(\n\t\t\tpositionKey => pose.positions[positionKey].length > 1\n\t\t),\n\t];\n\tif (pose.compatibleHeads.length > 0) positionKeys.unshift('head');\n\treturn positionKeys;\n}\n\nexport function getHeads(\n\tdata: DeepReadonly<Character<IAsset>>,\n\tstate: DeepReadonly<ICharacter>,\n\theadTypeId: number = state.posePositions.headType || 0\n): DeepReadonly<HeadCollection<IAsset>> | null {\n\tconst compatibleHeads = getPose(data, state).compatibleHeads;\n\tif (!compatibleHeads || compatibleHeads.length === 0) {\n\t\treturn null;\n\t}\n\tconst heads = data.heads[compatibleHeads[headTypeId]];\n\treturn heads;\n}\n\nexport function closestCharacterSlot(pos: number): number {\n\tconst constants = getConstants();\n\tconst sorted = constants.Base.characterPositions\n\t\t.map((x, idx) => ({ pos: Math.abs(pos - x), idx }))\n\t\t.sort((a, b) => a.pos - b.pos);\n\treturn sorted[0].idx;\n}\n\nlet lastSpriteId = 0;\n\nexport const characterActions: ActionTree<IObjectsState, IRootState> = {\n\tcreateCharacters(\n\t\t{ rootState, rootGetters, commit },\n\t\tcommand: ICreateCharacterAction\n\t) {\n\t\tconst constants = getConstants();\n\t\tconst char = getDataG(rootGetters, command.characterType);\n\t\tconst charScale = char.hd\n\t\t\t? constants.Base.hdCharacterScaleFactor\n\t\t\t: constants.Base.sdCharacterScaleFactor;\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\t...baseProps(),\n\t\t\t\tid: 'characters_' + ++lastSpriteId,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tonTop: false,\n\t\t\t\ttype: 'character',\n\t\t\t\ty: constants.Base.BaseCharacterYPos,\n\t\t\t\tpreserveRatio: true,\n\t\t\t\tratio: 1,\n\t\t\t\twidth: char.size[0] * char.defaultScale[0] * charScale,\n\t\t\t\theight: char.size[1] * char.defaultScale[1] * charScale,\n\t\t\t\tcharacterType: command.characterType,\n\t\t\t\tclose: false,\n\t\t\t\tfreeMove: false,\n\t\t\t\tposeId: 0,\n\t\t\t\tstyleId: 0,\n\t\t\t\tstyleGroupId: 0,\n\t\t\t\tposePositions: {},\n\t\t\t\tlabel: char.label || char.id,\n\t\t\t\tenlargeWhenTalking: rootState.ui.defaultCharacterTalkingZoom,\n\t\t\t} as ICharacter,\n\t\t} as ICreateObjectMutation);\n\t},\n\n\tseekPart(\n\t\t{ state, commit, dispatch, rootGetters },\n\t\t{ delta, id, part }: ISeekPosePartAction\n\t) {\n\t\tif (part === 'head') {\n\t\t\tdispatch('seekHead', { id, delta } as ISeekHeadAction);\n\t\t\treturn;\n\t\t}\n\t\tconst obj = state.objects[id] as Readonly<ICharacter>;\n\t\tconst pose = getPose(getDataG(rootGetters, obj.characterType), obj);\n\t\tif (!pose.positions[part]) return;\n\t\tcommit('setPosePosition', {\n\t\t\tid,\n\t\t\tposePositions: {\n\t\t\t\t[part]: arraySeeker(\n\t\t\t\t\tpose.positions[part],\n\t\t\t\t\tobj.posePositions[part] || 0,\n\t\t\t\t\tdelta\n\t\t\t\t),\n\t\t\t},\n\t\t} as ISetPosePositionMutation);\n\t},\n\n\tseekPose({ state, commit, rootGetters }, { id, delta }: ISeekPoseAction) {\n\t\tconst obj = state.objects[id] as Readonly<ICharacter>;\n\t\tconst data = getDataG(rootGetters, obj.characterType);\n\t\tconst poses = data.styleGroups[obj.styleGroupId].styles[obj.styleId].poses;\n\t\tmutatePoseAndPositions(commit, obj, data, change => {\n\t\t\tchange.poseId = arraySeeker(poses, change.poseId, delta);\n\t\t});\n\t},\n\n\tseekStyle({ state, commit, rootGetters }, { id, delta }: ISeekStyleAction) {\n\t\tconst obj = state.objects[id] as Readonly<ICharacter>;\n\t\tconst data = getDataG(rootGetters, obj.characterType);\n\t\tconst linearStyles = data.styleGroups\n\t\t\t.flatMap((styleGroup, styleGroupIdx) => {\n\t\t\t\treturn styleGroup.styles.map((style, styleIdx) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tstyleGroupIdx,\n\t\t\t\t\t\tstyleIdx,\n\t\t\t\t\t\tstyleGroupJson: JSON.stringify(style.components),\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t})\n\t\t\t.sort((styleA, styleB) =>\n\t\t\t\tstyleA.styleGroupJson.localeCompare(styleB.styleGroupJson)\n\t\t\t);\n\t\tconst linearIdx = linearStyles.findIndex(\n\t\t\tstyle =>\n\t\t\t\tstyle.styleGroupIdx === obj.styleGroupId &&\n\t\t\t\tstyle.styleIdx === obj.styleId\n\t\t);\n\t\tmutatePoseAndPositions(commit, obj, data, change => {\n\t\t\tconst nextIdx = arraySeeker(linearStyles, linearIdx, delta);\n\t\t\tconst style = linearStyles[nextIdx];\n\t\t\tchange.styleGroupId = style.styleGroupIdx;\n\t\t\tchange.styleId = style.styleIdx;\n\t\t});\n\t},\n\n\tseekHead({ state, commit, rootGetters }, { id, delta }: ISeekHeadAction) {\n\t\tconst obj = state.objects[id] as Readonly<ICharacter>;\n\t\tconst data = getDataG(rootGetters, obj.characterType);\n\t\tconst pose = getPose(data, obj);\n\t\tlet currentHeads = getHeads(data, obj);\n\t\tif (!currentHeads) return;\n\t\tlet head = (obj.posePositions.head || 0) + delta;\n\t\tlet headType = obj.posePositions.headType || 0;\n\t\tif (head < 0 || head >= currentHeads.variants.length) {\n\t\t\theadType = arraySeeker(\n\t\t\t\tpose.compatibleHeads.map(headKey => data.heads[headKey]),\n\t\t\t\theadType,\n\t\t\t\tdelta\n\t\t\t);\n\t\t\tcurrentHeads = getHeads(data, obj, headType)!;\n\t\t\thead = delta === 1 ? 0 : currentHeads.variants.length - 1;\n\t\t}\n\t\tcommit('setPosePosition', {\n\t\t\tid,\n\t\t\tposePositions: {\n\t\t\t\thead,\n\t\t\t\theadType,\n\t\t\t},\n\t\t} as ISetPosePositionMutation);\n\t},\n\n\tsetPart(\n\t\t{ state, commit, rootGetters },\n\t\t{ id, part, val }: ISetPartAction\n\t): void {\n\t\tconst obj = state.objects[id] as Readonly<ICharacter>;\n\t\tconst data = getDataG(rootGetters, obj.characterType);\n\t\tif (part === 'pose') {\n\t\t\tmutatePoseAndPositions(commit, obj, data, change => {\n\t\t\t\tchange.poseId = val;\n\t\t\t});\n\t\t} else if (part === 'style') {\n\t\t\tmutatePoseAndPositions(commit, obj, data, change => {\n\t\t\t\tchange.styleId = val;\n\t\t\t});\n\t\t} else {\n\t\t\tmutatePoseAndPositions(commit, obj, data, change => {\n\t\t\t\tchange.posePositions[part] = val;\n\t\t\t});\n\t\t}\n\t},\n\n\tsetCharStyle(\n\t\t{ state, commit, rootGetters },\n\t\t{ id, styleGroupId, styleId }: ISetStyleAction\n\t) {\n\t\tconst obj = state.objects[id] as Readonly<ICharacter>;\n\t\tconst data = getDataG(rootGetters, obj.characterType);\n\t\tmutatePoseAndPositions(commit, obj, data, change => {\n\t\t\tchange.styleGroupId = styleGroupId;\n\t\t\tchange.styleId = styleId;\n\t\t});\n\t},\n\n\tsetCharacterPosition(\n\t\t{ state, commit },\n\t\t{ id, x, y }: ISetPositionAction\n\t): void {\n\t\tconst obj = state.objects[id] as ICharacter;\n\t\tif (obj.freeMove) {\n\t\t\tcommit('setPosition', {\n\t\t\t\tid,\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t} as ISetObjectPositionMutation);\n\t\t} else {\n\t\t\tconst constants = getConstants();\n\t\t\tcommit('setPosition', {\n\t\t\t\tid,\n\t\t\t\tx: constants.Base.characterPositions[closestCharacterSlot(x)],\n\t\t\t\ty:\n\t\t\t\t\tconstants.Base.BaseCharacterYPos +\n\t\t\t\t\t(obj.close ? constants.Base.CloseUpYOffset : 0),\n\t\t\t} as ISetObjectPositionMutation);\n\t\t}\n\t},\n\n\tshiftCharacterSlot(\n\t\t{ state, commit },\n\t\t{ id, delta }: IShiftCharacterSlotAction\n\t): void {\n\t\tconst obj = state.objects[id] as ICharacter;\n\t\tconst constants = getConstants();\n\t\tconst currentSlotNr = closestCharacterSlot(obj.x);\n\t\tlet newSlotNr = currentSlotNr + delta;\n\t\tif (newSlotNr < 0) {\n\t\t\tnewSlotNr = 0;\n\t\t}\n\t\tif (newSlotNr >= constants.Base.characterPositions.length) {\n\t\t\tnewSlotNr = constants.Base.characterPositions.length - 1;\n\t\t}\n\t\tcommit('setPosition', {\n\t\t\tid,\n\t\t\tx: constants.Base.characterPositions[newSlotNr],\n\t\t\ty: obj.y,\n\t\t} as ISetObjectPositionMutation);\n\t},\n};\n\nexport async function fixContentPackRemovalFromCharacter(\n\tcontext: ActionContext<IObjectsState, IRootState>,\n\tid: string,\n\toldPack: ContentPack<IAsset>\n) {\n\tconst obj = context.state.objects[id] as ICharacter;\n\tconst oldCharData = oldPack.characters.find(\n\t\tchar => char.id === obj.characterType\n\t);\n\tif (!oldCharData) {\n\t\tconsole.error('Character data is missing. Dropping the character.');\n\t\tcontext.dispatch('removeObject', {\n\t\t\tid,\n\t\t} as IRemoveObjectAction);\n\t\treturn;\n\t}\n\tconst poseAndPositionChange = buildPoseAndPositionData(obj);\n\tconst oldStyleGroup = oldCharData.styleGroups[obj.styleGroupId];\n\tconst oldStyle = oldStyleGroup.styles[poseAndPositionChange.styleId];\n\tconst oldPose = oldStyle.poses[poseAndPositionChange.poseId];\n\n\tconst newCharData = context.rootState.content.current.characters.find(\n\t\tchr => chr.id === oldCharData.id\n\t);\n\tif (!newCharData) {\n\t\tconsole.error('Character data is missing. Dropping the character.');\n\t\tcontext.dispatch('removeObject', {\n\t\t\tid,\n\t\t} as IRemoveObjectAction);\n\t\treturn;\n\t}\n\tconst newStyleGroupIdx = newCharData.styleGroups.findIndex(\n\t\tstyleGroup => styleGroup.id === oldStyleGroup.id\n\t);\n\tposeAndPositionChange.styleGroupId =\n\t\tnewStyleGroupIdx === -1 ? 0 : newStyleGroupIdx;\n\n\tconst newStyleGroup =\n\t\tnewCharData.styleGroups[poseAndPositionChange.styleGroupId];\n\tconst styleProperies = JSON.stringify(oldStyle.components);\n\tconst newStyleIdx = newStyleGroup.styles.findIndex(\n\t\tstyle => JSON.stringify(style.components) === styleProperies\n\t);\n\tposeAndPositionChange.styleId = newStyleIdx === -1 ? 0 : newStyleIdx;\n\n\tconst newStyle = newStyleGroup.styles[poseAndPositionChange.styleId];\n\tconst newPoseIdx = newStyle.poses.findIndex(pose => pose.id === oldPose.id);\n\tposeAndPositionChange.poseId = newPoseIdx === -1 ? 0 : newPoseIdx;\n\n\t// Styles and poses have been restored. Proceding with pose parts\n\tconst newPose = newStyle.poses[poseAndPositionChange.poseId];\n\n\tconst newPosePositions: ICharacter['posePositions'] = {};\n\n\tfor (const key in newPose.positions) {\n\t\tif (!newPose.positions.hasOwnProperty(key)) continue;\n\t\tconst newPosition = newPose.positions[key];\n\n\t\tif (oldPose.positions[key]) {\n\t\t\tconst oldPositionIdx = poseAndPositionChange.posePositions[key];\n\t\t\tif (oldPositionIdx >= 0 && oldPositionIdx < newPosition.length) {\n\t\t\t\tnewPosePositions[key] = oldPositionIdx;\n\t\t\t} else {\n\t\t\t\tnewPosePositions[key] = 0;\n\t\t\t}\n\t\t} else {\n\t\t\tnewPosePositions[key] = 0;\n\t\t}\n\t}\n\n\tconst oldHeadGroup = oldPose.compatibleHeads[obj.posePositions.headType];\n\tconst newHeadGroupIdx = newPose.compatibleHeads.indexOf(oldHeadGroup);\n\n\tif (newHeadGroupIdx === -1) {\n\t\tposeAndPositionChange.posePositions.headType = 0;\n\t\tposeAndPositionChange.posePositions.head = 0;\n\t} else {\n\t\tif (newHeadGroupIdx !== obj.posePositions.headType) {\n\t\t\tposeAndPositionChange.posePositions.headType = newHeadGroupIdx;\n\t\t}\n\t\tconst oldHead = JSON.stringify(\n\t\t\toldCharData.heads[oldHeadGroup].variants[obj.posePositions.head]\n\t\t);\n\t\tconst newHeadIdx = newCharData.heads[oldHeadGroup].variants.findIndex(\n\t\t\tvariant => JSON.stringify(variant) === oldHead\n\t\t);\n\t\tif (newHeadIdx === -1) {\n\t\t\tposeAndPositionChange.posePositions.head = 0;\n\t\t} else {\n\t\t\tposeAndPositionChange.posePositions.head = newHeadIdx;\n\t\t}\n\t}\n\n\tcommitPoseAndPositionChanges(context.commit, obj, poseAndPositionChange);\n}\n\nexport const propertyOptions: IHistoryOptions = {\n\tmutations: {\n\t\tsetPosePosition: {\n\t\t\tcombinable: (oldMut, newMut) => oldMut.payload.id === newMut.payload.id,\n\t\t\tcombinator: (oldMut, newMut) => ({\n\t\t\t\ttype: newMut.type,\n\t\t\t\tpayload: {\n\t\t\t\t\tid: newMut.payload.id,\n\t\t\t\t\tposePositions: {\n\t\t\t\t\t\t...oldMut.payload.posePositions,\n\t\t\t\t\t\t...newMut.payload.posePositions,\n\t\t\t\t\t},\n\t\t\t\t} as ISetPosePositionMutation,\n\t\t\t}),\n\t\t},\n\t},\n};\n\nfunction buildPoseAndPositionData(\n\tcharacter: Readonly<ICharacter>\n): PoseAndPositionChange {\n\treturn {\n\t\tstyleGroupId: character.styleGroupId,\n\t\tstyleId: character.styleId,\n\t\tposeId: character.poseId,\n\t\tposePositions: { ...character.posePositions },\n\t};\n}\n\nfunction commitPoseAndPositionChanges(\n\tcommit: Commit,\n\tcharacter: Readonly<ICharacter>,\n\tposeAndPosition: PoseAndPositionChange\n) {\n\tif (poseAndPosition.styleGroupId !== character.styleGroupId) {\n\t\tcommit('setCharStyleGroup', {\n\t\t\tid: character.id,\n\t\t\tstyleGroupId: poseAndPosition.styleGroupId,\n\t\t} as ISetCharStyleGroupMutation);\n\t}\n\tif (poseAndPosition.styleId !== character.styleId) {\n\t\tconsole.log(\n\t\t\t`Setting style of ${character.id} to ${poseAndPosition.styleId}`\n\t\t);\n\t\tcommit('setCharStyle', {\n\t\t\tid: character.id,\n\t\t\tstyleId: poseAndPosition.styleId,\n\t\t} as ISetCharStyleMutation);\n\t}\n\tif (poseAndPosition.poseId !== character.poseId) {\n\t\tcommit('setPose', {\n\t\t\tid: character.id,\n\t\t\tposeId: poseAndPosition.poseId,\n\t\t} as ISetPoseMutation);\n\t}\n\tif (\n\t\tJSON.stringify(poseAndPosition.posePositions) !==\n\t\tJSON.stringify(character.posePositions)\n\t) {\n\t\tcommit('setPosePosition', {\n\t\t\tid: character.id,\n\t\t\tposePositions: poseAndPosition.posePositions,\n\t\t} as ISetPosePositionMutation);\n\t}\n}\n\nfunction mutatePoseAndPositions(\n\tcommit: Commit,\n\tcharacter: Readonly<ICharacter>,\n\tdata: Character<IAsset>,\n\tcallback: (change: PoseAndPositionChange) => void\n) {\n\tconst poseAndPosition = buildPoseAndPositionData(character);\n\tcallback(poseAndPosition);\n\n\tif (!data.styleGroups[poseAndPosition.styleGroupId]) {\n\t\tposeAndPosition.styleGroupId = 0;\n\t}\n\tconst styleGroup = data.styleGroups[poseAndPosition.styleGroupId];\n\n\tif (!styleGroup.styles[poseAndPosition.styleId]) {\n\t\tposeAndPosition.styleId = 0;\n\t}\n\tconst style = styleGroup.styles[poseAndPosition.styleId];\n\n\t// ensure pose integrity\n\tif (!style.poses[poseAndPosition.poseId]) {\n\t\tposeAndPosition.poseId = 0;\n\t}\n\tconst pose = style.poses[poseAndPosition.poseId];\n\n\tfor (const positionKey in pose.positions) {\n\t\tif (!pose.positions[positionKey]) continue;\n\t\tif (\n\t\t\t!pose.positions[positionKey][poseAndPosition.posePositions[positionKey]]\n\t\t) {\n\t\t\tposeAndPosition.posePositions[positionKey] = 0;\n\t\t}\n\t}\n\n\t// restore head group\n\tconst oldPose =\n\t\tdata.styleGroups[character.styleGroupId].styles[character.styleId].poses[\n\t\t\tcharacter.poseId\n\t\t];\n\tconst oldHeadCollection =\n\t\toldPose.compatibleHeads[character.posePositions.headType || 0];\n\tconst newHeadCollectionNr = pose.compatibleHeads.indexOf(oldHeadCollection);\n\tif (newHeadCollectionNr >= 0) {\n\t\tposeAndPosition.posePositions.headType = newHeadCollectionNr;\n\t} else {\n\t\tposeAndPosition.posePositions.headType = 0;\n\t\tposeAndPosition.posePositions.head = 0;\n\t}\n\n\tcommitPoseAndPositionChanges(commit, character, poseAndPosition);\n}\n\ninterface PoseAndPositionChange {\n\tstyleGroupId: ICharacter['styleGroupId'];\n\tstyleId: ICharacter['styleId'];\n\tposeId: ICharacter['poseId'];\n\tposePositions: ICharacter['posePositions'];\n}\n\nexport interface ISetPoseMutation extends ICommand {\n\treadonly poseId: number;\n}\n\nexport interface ISetCharStyleGroupMutation extends ICommand {\n\treadonly styleGroupId: number;\n}\n\nexport interface ISetCharStyleMutation extends ICommand {\n\treadonly styleId: number;\n}\n\nexport interface ISetPosePositionMutation extends ICommand {\n\treadonly posePositions: {\n\t\t[id: string]: number;\n\t};\n}\n\nexport interface ISetFreeMoveMutation extends ICommand {\n\treadonly freeMove: boolean;\n}\n\nexport interface ISetCloseMutation extends ICommand {\n\treadonly close: boolean;\n}\n\nexport interface ICreateCharacterAction {\n\treadonly characterType: string;\n}\n\nexport interface ISeekPoseAction extends ICommand {\n\treadonly delta: -1 | 1;\n}\n\nexport interface ISeekStyleAction extends ICommand {\n\treadonly delta: -1 | 1;\n}\n\nexport interface ISeekHeadAction extends ICommand {\n\treadonly delta: -1 | 1;\n}\n\nexport interface ISetPartAction extends ICommand {\n\treadonly part: string;\n\treadonly val: number;\n}\n\nexport interface ISetStyleAction extends ICommand {\n\treadonly styleGroupId: number;\n\treadonly styleId: number;\n}\n\nexport interface INsfwCheckAction extends ICommand {}\n\nexport interface ISeekPosePartAction extends ICommand {\n\treadonly part: string;\n\treadonly delta: -1 | 1;\n}\n\nexport interface ISetSpriteSizeMutation extends ICommand {\n\treadonly width: number;\n\treadonly height: number;\n}\n\nexport interface ISetSpriteRatioMutation extends ICommand {\n\treadonly preserveRatio: boolean;\n\treadonly ratio: number;\n}\n\nexport interface ISetSpriteWidthAction extends ICommand {\n\treadonly width: number;\n}\n\nexport interface ISetSpriteHeightAction extends ICommand {\n\treadonly height: number;\n}\n\nexport interface ISetSpriteRatioAction extends ICommand {\n\treadonly preserveRatio: boolean;\n}\n\nexport interface ICreateSpriteAction extends ICommand {\n\treadonly assetName: string;\n}\n\nexport interface IShiftCharacterSlotAction extends ICommand {\n\treadonly delta: -1 | 1;\n}\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./ModalDialog.vue?vue&type=style&index=0&id=64aeb4c5&scoped=true&lang=scss\"","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./color.vue?vue&type=style&index=0&id=8ecc10b2&lang=scss&scoped=true\"","<template>\r\n\t<div class=\"toggle_box\">\r\n\t\t<input :id=\"_.uid\" type=\"checkbox\" ref=\"checkbox\" v-model=\"value\" />\r\n\t\t<label :for=\"_.uid\" class=\"switch\"></label>\r\n\t\t<label :for=\"_.uid\" class=\"toggle_label\">{{ label }}</label>\r\n\t</div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from 'vue';\r\n\r\nexport default defineComponent({\r\n\tprops: {\r\n\t\tlabel: String,\r\n\t\tmodelValue: { type: Boolean, default: false },\r\n\t},\r\n\tcomputed: {\r\n\t\tvalue: {\r\n\t\t\tget(): boolean {\r\n\t\t\t\treturn this.modelValue;\r\n\t\t\t},\r\n\t\t\tset(value: boolean) {\r\n\t\t\t\tthis.$emit('update:modelValue', value);\r\n\t\t\t},\r\n\t\t},\r\n\t\tcheckbox(): HTMLInputElement {\r\n\t\t\treturn this.$refs.checkbox as HTMLInputElement;\r\n\t\t},\r\n\t},\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.toggle_box {\r\n\tdiv {\r\n\t\toverflow: visible;\r\n\t}\r\n\r\n\t/* The switch - the box around the slider */\r\n\t.switch {\r\n\t\theight: 20px;\r\n\t\twidth: 20px;\r\n\t\tdisplay: inline-block;\r\n\t\tbackground: url('./toggle/inactive.svg');\r\n\t\tbackground-size: cover;\r\n\t\tvertical-align: text-bottom;\r\n\t}\r\n\r\n\t/* Hide default HTML checkbox */\r\n\tinput {\r\n\t\topacity: 0;\r\n\t\twidth: 0;\r\n\t\theight: 0;\r\n\t\tposition: absolute;\r\n\t\tpointer-events: none;\r\n\t}\r\n\r\n\tinput:checked + .switch {\r\n\t\tbackground: url('./toggle/active.svg');\r\n\t\tbackground-size: cover;\r\n\t}\r\n\r\n\t.toggle_label {\r\n\t\tuser-select: none;\r\n\t}\r\n}\r\n\r\nbody.dark-theme {\r\n\t.toggle_box {\r\n\t\t.switch {\r\n\t\t\tbackground: url('./toggle/inactive-dark.svg');\r\n\t\t}\r\n\r\n\t\tinput:checked + .switch {\r\n\t\t\tbackground: url('./toggle/active-dark.svg');\r\n\t\t}\r\n\t}\r\n}\r\n</style>\r\n","\r\nimport { defineComponent } from 'vue';\r\n\r\nexport default defineComponent({\r\n\tprops: {\r\n\t\tlabel: String,\r\n\t\tmodelValue: { type: Boolean, default: false },\r\n\t},\r\n\tcomputed: {\r\n\t\tvalue: {\r\n\t\t\tget(): boolean {\r\n\t\t\t\treturn this.modelValue;\r\n\t\t\t},\r\n\t\t\tset(value: boolean) {\r\n\t\t\t\tthis.$emit('update:modelValue', value);\r\n\t\t\t},\r\n\t\t},\r\n\t\tcheckbox(): HTMLInputElement {\r\n\t\t\treturn this.$refs.checkbox as HTMLInputElement;\r\n\t\t},\r\n\t},\r\n});\r\n","import { render } from \"./toggle.vue?vue&type=template&id=7b1bf059\"\nimport script from \"./toggle.vue?vue&type=script&lang=ts\"\nexport * from \"./toggle.vue?vue&type=script&lang=ts\"\n\nimport \"./toggle.vue?vue&type=style&index=0&id=7b1bf059&lang=scss\"\nscript.render = render\n\nexport default script","import { DeepReadonly } from '@/util/readonly';\n\nexport function arraySeeker(\n\tarray: DeepReadonly<any[]>,\n\tpos: number,\n\tdelta: number\n) {\n\tlet val = pos + delta;\n\tconst length = array.length;\n\n\tif (val < 0) {\n\t\tval += length;\n\t}\n\tif (val >= length) {\n\t\tval -= length;\n\t}\n\treturn val;\n}\n\nexport function nsfwArraySeeker(\n\tarray: Array<{ nsfw?: boolean }>,\n\tpos: number,\n\tdelta: number,\n\tnsfw: boolean\n) {\n\tlet val = pos;\n\tconst length = array.length;\n\tdo {\n\t\tval += delta;\n\t\tif (val < 0) {\n\t\t\tval += length;\n\t\t}\n\t\tif (val >= length) {\n\t\t\tval -= length;\n\t\t}\n\t} while (array[val].nsfw && !nsfw);\n\treturn val;\n}\n","import { ITextStyle } from '@/renderer/textRenderer/textRenderer';\nimport { screenWidth } from '@/constants/game_modes/ddlc_plus/base';\nimport { nameboxStrokeDefaultColor } from './textBoxCustom';\n\n// tslint:disable: no-magic-numbers\nexport const TextBoxWidth = 1220;\nexport const TextBoxCorruptedWidth = 900;\nexport const TextBoxHeight = 219;\nexport const TextBoxKerning = 0;\nexport const TextBoxLineHeight = 29;\nexport const TextBoxCorruptedKerning = 8;\nexport const TextBoxTextXOffset = 57;\nexport const TextBoxTextYOffset = 68;\nexport const TextBoxBottomSpacing = 54;\n\nexport const TextBoxTextCorruptedXOffset = 9;\nexport const TextBoxTextCorruptedYOffset = 9;\n\nexport const NameboxHeight = 59;\nexport const NameboxWidth = 252;\nexport const NameboxXOffset = 49;\nexport const NameboxTextYOffset = 43;\n\nexport const ControlsYBottomOffset = 12 * 1.5;\nexport const ControlsXHistoryOffset = -126 * 1.5;\nexport const ControlsXSkipOffset = -72 * 1.5;\nexport const ControlsXStuffOffset = -38 * 1.5;\n\nexport const ArrowXRightOffset = 30.75 * 1.5;\nexport const ArrowYBottomOffset = 26 * 1.5;\n\nexport const GlowRX = 426 * 1.5;\nexport const GlowRY = 58 * 1.5;\n\nexport const BaseTextStyle: ITextStyle = {\n\talpha: 1,\n\tcolor: 'black',\n\tfontName: 'aller',\n\tfontSize: 24,\n\tisBold: false,\n\tisItalic: false,\n\tisStrikethrough: false,\n\tisUnderlined: false,\n\tletterSpacing: 1,\n\tlineSpacing: 1.2,\n\tstrokeColor: '',\n\tstrokeWidth: 0,\n};\n\nexport const NameboxTextStyle: ITextStyle = {\n\t...BaseTextStyle,\n\tfontName: 'riffic',\n\tfontSize: 36,\n\tstrokeColor: nameboxStrokeDefaultColor,\n\tstrokeWidth: 9,\n\tcolor: 'white',\n\tletterSpacing: 2,\n};\n\nexport const ControlsTextStyle = {\n\talign: 'left' as CanvasTextAlign,\n\tfont: '24px aller',\n\tfill: {\n\t\tstyle: '#522',\n\t},\n};\n\nexport const ControlsTextDisabledStyle = {\n\t...ControlsTextStyle,\n\tfill: {\n\t\tstyle: '#a66',\n\t},\n};\n\nexport const TextBoxStyle = {\n\talpha: 1,\n\tcolor: '#ffffff',\n\tfontName: 'aller',\n\tfontSize: 30,\n\tisBold: false,\n\tisItalic: false,\n\tisStrikethrough: false,\n\tisUnderlined: false,\n\tletterSpacing: 0,\n\tstrokeColor: '#523140',\n\tstrokeWidth: 5,\n\tlineSpacing: 1.2,\n};\n\nexport const TextBoxCorruptedStyle = {\n\talign: 'left' as CanvasTextAlign,\n\tfont: '24px verily',\n\toutline: {\n\t\tstyle: '#000',\n\t\twidth: 20,\n\t},\n\tfill: {\n\t\tstyle: '#fff',\n\t},\n};\n\nexport const TextBoxX = screenWidth / 2 - TextBoxWidth / 2; // 232\nexport const TextBoxCorruptedX = screenWidth / 2 - TextBoxCorruptedWidth / 2;\nexport const TextBoxTextX = TextBoxX + TextBoxTextXOffset;\n\nexport const NameboxX = TextBoxX + NameboxXOffset;\nexport const NameboxTextX = NameboxX + NameboxWidth / 2;\n\nexport const ControlsXHistory = TextBoxX + ControlsXHistoryOffset;\nexport const ControlsXSkip = TextBoxX + ControlsXSkipOffset;\nexport const ControlsXStuff = TextBoxX + ControlsXStuffOffset;\n\nexport const DefaultTextboxStyle = 'custom_plus';\n","<template>\n\t<div v-if=\"canvasTooSmall && isSafari\">\n\t\tProtrait mode is not supported by safari. Please turn the device sideways.\n\t</div>\n\t<div v-else id=\"app\">\n\t\t<div id=\"container\">\n\t\t\t<render\n\t\t\t\tref=\"render\"\n\t\t\t\t:canvasWidth=\"canvasWidth\"\n\t\t\t\t:canvasHeight=\"canvasHeight\"\n\t\t\t\t:preLoading=\"preLoading\"\n\t\t\t/>\n\t\t</div>\n\t\t<message-console />\n\t\t<tool-box\n\t\t\t@show-prev-render=\"drawLastDownload\"\n\t\t\t@download=\"$refs.render.download()\"\n\t\t\t@show-dialog=\"showDialog\"\n\t\t\t@show-expression-dialog=\"showExpressionDialog\"\n\t\t/>\n\t\t<keep-alive>\n\t\t\t<modal-dialog\n\t\t\t\tv-if=\"dialogVisable\"\n\t\t\t\tref=\"dialog\"\n\t\t\t\t@leave=\"dialogVisable = false\"\n\t\t\t>\n\t\t\t\t<single-box ref=\"packDialog\" @leave=\"dialogVisable = false\" />\n\t\t\t</modal-dialog>\n\t\t</keep-alive>\n\t\t<modal-dialog\n\t\t\tv-if=\"expressionBuilderVisible\"\n\t\t\tref=\"dialog\"\n\t\t\t@leave=\"expressionBuilderVisible = false\"\n\t\t>\n\t\t\t<expression-builder\n\t\t\t\t:character=\"expressionBuilderCharacter\"\n\t\t\t\t:initHeadGroup=\"expressionBuilderHeadGroup\"\n\t\t\t\t@leave=\"expressionBuilderVisible = false\"\n\t\t\t/>\n\t\t</modal-dialog>\n\t</div>\n\t<div id=\"modal-messages\"></div>\n</template>\n\n<script lang=\"ts\">\n// App.vue has currently so many responsiblities that it's best to break it into chunks\nimport { ICreateTextBoxAction } from '@/store/objectTypes/textbox';\nimport {\n\tISetObjectPositionMutation,\n\tIRemoveObjectAction,\n\tICopyObjectToClipboardAction,\n\tIPasteFromClipboardAction,\n} from '@/store/objects';\nimport {\n\tIShiftCharacterSlotAction,\n\tICharacter,\n} from '@/store/objectTypes/characters';\nimport ToolBox from '@/components/toolbox/toolbox.vue';\nimport MessageConsole from '@/components/message-console.vue';\nimport Render from '@/components/render.vue';\nimport ModalDialog from '@/components/ModalDialog.vue';\nimport { ISetCurrentMutation } from '@/store/panels';\nimport { defineAsyncComponent, defineComponent } from 'vue';\nimport { Repo } from './models/repo';\nimport enviroment from '@/environments/environment';\nimport { IRemovePacksAction } from './store';\n\n// tslint:disable-next-line: no-magic-numbers\nconst aspectRatio = 16 / 9;\nconst arrowMoveStepSize = 20;\nconst packDialogWaitMs = 50;\nconst canvasTooSmallThreshold = 200;\n\nconst nsfwPacks = {\n\t'dddg.buildin.backgrounds.nsfw': `${process.env.BASE_URL}packs/buildin.base.backgrounds.nsfw.json`,\n\t'dddg.buildin.sayori.nsfw': `${process.env.BASE_URL}packs/buildin.base.sayori.nsfw.json`,\n\t'dddg.buildin.base.natsuki.nsfw': `${process.env.BASE_URL}packs/buildin.base.natsuki.nsfw.json`,\n\t'dddg.buildin.yuri.nsfw': `${process.env.BASE_URL}packs/buildin.base.yuri.nsfw.json`,\n};\n\nconst names = new Set(Object.keys(nsfwPacks));\nconst paths = Object.values(nsfwPacks);\n\nexport default defineComponent({\n\tcomponents: {\n\t\tToolBox,\n\t\tMessageConsole,\n\t\tRender,\n\t\tModalDialog,\n\t\tSingleBox: defineAsyncComponent(() =>\n\t\t\timport('@/components/repo/layouts/SingleBox.vue')\n\t\t),\n\t\tExpressionBuilder: defineAsyncComponent(() =>\n\t\t\timport('@/components/content-pack-builder/expression-builder/index.vue')\n\t\t),\n\t},\n\tdata: () => ({\n\t\tcanvasWidth: 0,\n\t\tcanvasHeight: 0,\n\t\tblendOver: null as string | null,\n\t\tuiSize: 192,\n\t\tcurrentlyRendering: false,\n\t\tpanel: '',\n\t\tdialogVisable: false,\n\t\tcanvasTooSmall: false,\n\t\texpressionBuilderVisible: false,\n\t\texpressionBuilderCharacter: '',\n\t\texpressionBuilderHeadGroup: undefined as string | undefined,\n\t\tsystemPrefersDarkMode: false,\n\t\tpreLoading: true,\n\t}),\n\tcomputed: {\n\t\tisSafari(): boolean {\n\t\t\treturn false;\n\t\t\t/*\t\treturn !!(\n\t\t\tnavigator.vendor &&\n\t\t\tnavigator.vendor.indexOf('Apple') > -1 &&\n\t\t\tnavigator.userAgent &&\n\t\t\tnavigator.userAgent.indexOf('CriOS') === -1 &&\n\t\t\tnavigator.userAgent.indexOf('FxiOS') === -1\n\t\t);*/\n\t\t},\n\t\tuseDarkTheme(): boolean {\n\t\t\treturn this.userPrefersDarkMode ?? this.systemPrefersDarkMode;\n\t\t},\n\t\tuserPrefersDarkMode(): boolean | null {\n\t\t\treturn this.$store.state.ui.useDarkTheme;\n\t\t},\n\t\tnsfw(): boolean {\n\t\t\treturn this.$store.state.ui.nsfw;\n\t\t},\n\t},\n\tmethods: {\n\t\tdrawLastDownload(): void {\n\t\t\tconst last = this.$store.state.ui.lastDownload;\n\t\t\tif (!last) return;\n\t\t\t(this.$refs.render as typeof Render).blendOver(last);\n\t\t},\n\t\tsetBlendOver(): void {\n\t\t\tthis.blendOver = this.$store.state.ui.lastDownload;\n\t\t},\n\t\toptimum(sw: number, sh: number): [number, number] {\n\t\t\tlet rh = sw / aspectRatio;\n\t\t\tlet rw = sh * aspectRatio;\n\n\t\t\tif (rh > sh) {\n\t\t\t\trh = sh;\n\t\t\t} else {\n\t\t\t\trw = sw;\n\t\t\t}\n\n\t\t\treturn [rw, rh];\n\t\t},\n\t\toptimizeWithMenu(sw: number, sh: number): [number, number, boolean] {\n\t\t\tconst opth = this.optimum(sw, sh - this.uiSize);\n\t\t\tconst optv = this.optimum(sw - this.uiSize, sh);\n\n\t\t\tif (!this.isSafari && opth[0] * opth[1] > optv[0] * optv[1]) {\n\t\t\t\treturn [opth[0], opth[1], false];\n\t\t\t} else {\n\t\t\t\treturn [optv[0], optv[1], true];\n\t\t\t}\n\t\t},\n\t\tupdateArea(): void {\n\t\t\tconst [cw, ch, v] = this.optimizeWithMenu(\n\t\t\t\tdocument.documentElement.clientWidth,\n\t\t\t\tdocument.documentElement.clientHeight\n\t\t\t);\n\n\t\t\tthis.canvasWidth = cw;\n\t\t\tthis.canvasHeight = ch;\n\n\t\t\tthis.canvasTooSmall = Math.max(cw, ch) < canvasTooSmallThreshold;\n\n\t\t\tif (this.$store.state.ui.vertical === v) return;\n\t\t\tthis.$store.commit('ui/setVertical', v);\n\t\t},\n\t\tshowDialog(search: string | undefined) {\n\t\t\tthis.dialogVisable = true;\n\t\t\tif (search) {\n\t\t\t\tconst wait = () => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.$refs.packDialog &&\n\t\t\t\t\t\t(this.$refs.packDialog as any).$refs.packDialog\n\t\t\t\t\t) {\n\t\t\t\t\t\t// This strange doubling is to get around the async component wrapper\n\t\t\t\t\t\t(this.$refs.packDialog as any).$refs.packDialog.setSearch(search);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetTimeout(wait, packDialogWaitMs);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tthis.$nextTick(wait);\n\t\t\t}\n\t\t},\n\t\tshowExpressionDialog(e: IShowExpressionDialogEvent) {\n\t\t\tthis.expressionBuilderVisible = true;\n\t\t\tthis.expressionBuilderCharacter = e.character;\n\t\t\tthis.expressionBuilderHeadGroup = e.headGroup;\n\t\t},\n\t\tonKeydown(e: KeyboardEvent) {\n\t\t\tif (\n\t\t\t\te.target instanceof HTMLInputElement ||\n\t\t\t\te.target instanceof HTMLTextAreaElement\n\t\t\t) {\n\t\t\t\tconsole.log('skip keydown on potential target');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tconst selection = this.$store.state.objects.objects[\n\t\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t\t];\n\t\t\t\tif (e.ctrlKey) {\n\t\t\t\t\tif (e.key === 'z') {\n\t\t\t\t\t\t// this.$store.commit('history/undo');\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (e.key === 'y') {\n\t\t\t\t\t\t// this.$store.commit('history/redo');\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (e.key === 'v') {\n\t\t\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t\t\t'objects/pasteObjectFromClipboard',\n\t\t\t\t\t\t\t{} as IPasteFromClipboardAction\n\t\t\t\t\t\t);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!selection) return;\n\t\t\t\tif (e.key === 'Delete') {\n\t\t\t\t\tthis.$store.dispatch('objects/removeObject', {\n\t\t\t\t\t\tid: selection.id,\n\t\t\t\t\t} as IRemoveObjectAction);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e.key === 'c' || e.key === 'x') {\n\t\t\t\t\tthis.$store.dispatch('objects/copyObjectToClipboard', {\n\t\t\t\t\t\tid: selection.id,\n\t\t\t\t\t} as ICopyObjectToClipboardAction);\n\t\t\t\t\tif (e.key === 'x') {\n\t\t\t\t\t\tthis.$store.dispatch('objects/removeObject', {\n\t\t\t\t\t\t\tid: selection.id,\n\t\t\t\t\t\t} as IRemoveObjectAction);\n\t\t\t\t\t}\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (selection.type === 'character') {\n\t\t\t\t\tconst character = selection as ICharacter;\n\t\t\t\t\tif (!character.freeMove) {\n\t\t\t\t\t\tif (e.key === 'ArrowLeft') {\n\t\t\t\t\t\t\tthis.$store.dispatch('objects/shiftCharacterSlot', {\n\t\t\t\t\t\t\t\tid: character.id,\n\t\t\t\t\t\t\t\tdelta: -1,\n\t\t\t\t\t\t\t} as IShiftCharacterSlotAction);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (e.key === 'ArrowRight') {\n\t\t\t\t\t\t\tthis.$store.dispatch('objects/shiftCharacterSlot', {\n\t\t\t\t\t\t\t\tid: character.id,\n\t\t\t\t\t\t\t\tdelta: 1,\n\t\t\t\t\t\t\t} as IShiftCharacterSlotAction);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet { x, y } = selection;\n\t\t\t\tif (e.key === 'ArrowLeft') {\n\t\t\t\t\tx -= e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else if (selection && e.key === 'ArrowRight') {\n\t\t\t\t\tx += e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else if (selection && e.key === 'ArrowUp') {\n\t\t\t\t\ty -= e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else if (selection && e.key === 'ArrowDown') {\n\t\t\t\t\ty += e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.$store.dispatch('objects/setPosition', {\n\t\t\t\t\tid: selection.id,\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\treturn;\n\t\t\t});\n\t\t},\n\t\tdestroyed(): void {\n\t\t\twindow.removeEventListener('keydown', this.onKeydown);\n\t\t},\n\t\tapplyTheme(): void {\n\t\t\tdocument.body.classList.toggle('dark-theme', this.useDarkTheme);\n\t\t},\n\t},\n\twatch: {\n\t\tsystemPrefersDarkMode() {\n\t\t\tthis.applyTheme();\n\t\t},\n\t\tuserPrefersDarkMode() {\n\t\t\tthis.applyTheme();\n\t\t},\n\t\tasync nsfw(value: boolean) {\n\t\t\tif (value) {\n\t\t\t\tawait this.$store.dispatch('content/loadContentPacks', paths);\n\t\t\t} else {\n\t\t\t\tawait this.$store.dispatch('removePacks', {\n\t\t\t\t\tpacks: names,\n\t\t\t\t} as IRemovePacksAction);\n\t\t\t}\n\t\t},\n\t},\n\tmounted(): void {\n\t\twindow.addEventListener('keypress', e => {\n\t\t\tif (e.key === 'Escape') {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tif (this.$store.state.ui.selection === null) return;\n\t\t\t\t\tthis.$store.commit('ui/setSelection', null);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tif (window.matchMedia) {\n\t\t\t/* The viewport is less than, or equal to, 700 pixels wide */\n\t\t\tconst matcher = window.matchMedia('(prefers-color-scheme: dark)');\n\t\t\tthis.systemPrefersDarkMode = matcher.matches;\n\t\t\tmatcher.addListener(match => {\n\t\t\t\tthis.systemPrefersDarkMode = match.matches;\n\t\t\t});\n\t\t}\n\t},\n\tasync created(): Promise<void> {\n\t\t// Moving this to the \"mounted\"-handler crashes safari over version 12.\n\t\t// My best guess is because it runs in a microtask, which have been added in that Version.\n\t\tthis.updateArea();\n\t\tRepo.setStore(this.$store);\n\t\twindow.addEventListener('resize', this.updateArea);\n\t\twindow.removeEventListener('keydown', this.onKeydown);\n\t\twindow.addEventListener('keydown', this.onKeydown);\n\n\t\t(window as any).app = this;\n\t\t(window as any).store = this.$store;\n\t\t(window as any).env = enviroment;\n\n\t\tdocument.body.addEventListener(\n\t\t\t'drop',\n\t\t\t(event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\t\tdocument.body.addEventListener(\n\t\t\t'dragover',\n\t\t\t(event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\tawait enviroment.loadGameMode();\n\t\tthis.preLoading = false;\n\t\tenviroment.connectToStore(this.vuexHistory, this.$store);\n\t\tconst settings = await enviroment.loadSettings();\n\n\t\tthis.vuexHistory.transaction(async () => {\n\t\t\tthis.$store.commit('ui/setLqRendering', settings.lq ?? false);\n\t\t\tthis.$store.commit('ui/setDarkTheme', settings.darkMode ?? null);\n\t\t\tthis.$store.commit(\n\t\t\t\t'ui/setDefaultCharacterTalkingZoom',\n\t\t\t\tsettings.defaultCharacterTalkingZoom ?? true\n\t\t\t);\n\n\t\t\tawait this.$store.dispatch('content/loadContentPacks', [\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.backgrounds.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.monika.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.sayori.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.natsuki.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.yuri.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.mc.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.mc_chad.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.mc_classic.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.femc.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.classic_amy.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.amy.json`,\n\t\t\t]);\n\n\t\t\tawait this.$store.dispatch('panels/createPanel');\n\t\t\tif (Object.keys(this.$store.state.objects.objects).length === 0) {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createTextBox',\n\t\t\t\t\t{} as ICreateTextBoxAction\n\t\t\t\t);\n\t\t\t}\n\t\t\tawait this.$store.commit('panels/setCurrentBackground', {\n\t\t\t\tcurrent: 'dddg.buildin.backgrounds:ddlc.clubroom',\n\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t} as ISetCurrentMutation);\n\n\t\t\tawait this.$store.commit('ui/setNsfw', settings.nsfw ?? false);\n\t\t});\n\t},\n});\n\nexport interface IShowExpressionDialogEvent {\n\tcharacter: string;\n\theadGroup?: string;\n}\n</script>\n\n<style lang=\"scss\">\n@import '@/styles/globals.scss';\n</style>\n","<template>\n\t<div id=\"panels\" :class=\"{ vertical }\">\n\t\t<div id=\"toolbar\">\n\t\t\t<button\n\t\t\t\t:class=\"{ active: panel === 'add' }\"\n\t\t\t\t@click=\"setPanel('add')\"\n\t\t\t\ttitle=\"Add new objects to the scene\"\n\t\t\t\taria-label=\"Add new objects to the scene\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\" aria-hidden=\"true\">add_box</i>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t:class=\"{ active: panel === 'backgrounds' }\"\n\t\t\t\t@click=\"setPanel('backgrounds')\"\n\t\t\t\taria-label=\"Change the current background\"\n\t\t\t\ttitle=\"Change the current background\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\" aria-hidden=\"true\">panorama</i>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t:class=\"{ active: panel === 'panels' }\"\n\t\t\t\ttitle=\"Panels\"\n\t\t\t\taria-label=\"Panels\"\n\t\t\t\t@click=\"setPanel('panels')\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\" aria-hidden=\"true\">view_module</i>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t:class=\"{ active: panel === 'settings' }\"\n\t\t\t\ttitle=\"Settings\"\n\t\t\t\taria-label=\"Settings\"\n\t\t\t\t@click=\"setPanel('settings')\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\" aria-hidden=\"true\">settings_applications</i>\n\t\t\t</button>\n\t\t</div>\n\t\t<settings-panel v-if=\"panel === 'settings'\" />\n\t\t<content-packs-panel v-else-if=\"panel === 'packs'\" />\n\t\t<backgrounds-panel\n\t\t\tv-else-if=\"panel === 'backgrounds'\"\n\t\t\t@show-dialog=\"$emit('show-dialog', $event)\"\n\t\t/>\n\t\t<credits-panel v-else-if=\"panel === 'help_credits'\" />\n\t\t<character-panel\n\t\t\tv-else-if=\"panel === 'character'\"\n\t\t\t@show-dialog=\"$emit('show-dialog', $event)\"\n\t\t\t@show-expression-dialog=\"$emit('show-expression-dialog', $event)\"\n\t\t/>\n\t\t<sprite-panel v-else-if=\"panel === 'sprite'\" />\n\t\t<text-box-panel v-else-if=\"panel === 'textBox'\" />\n\t\t<choice-panel v-else-if=\"panel === 'choice'\" />\n\t\t<panels-panel v-else-if=\"panel === 'panels'\" />\n\t\t<notification-panel v-else-if=\"panel === 'notification'\" />\n\t\t<poem-panel v-else-if=\"panel === 'poem'\" />\n\t\t<add-panel v-else @show-dialog=\"$emit('show-dialog', $event)\" />\n\t\t<div id=\"toolbar-end\">\n\t\t\t<button\n\t\t\t\t:class=\"{ active: panel === 'help_credits' }\"\n\t\t\t\t@click=\"setPanel('help_credits')\"\n\t\t\t\ttitle=\"Help &amp; Credits\"\n\t\t\t\taria-label=\"Help &amp; Credits\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\" aria-hidden=\"true\">help</i>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t:class=\"{ active: panel === 'packs' }\"\n\t\t\t\t@click=\"$emit('show-dialog')\"\n\t\t\t\ttitle=\"Content packs\"\n\t\t\t\taria-label=\"Content packs\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\" aria-hidden=\"true\">extension</i>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t@click=\"$emit('show-prev-render')\"\n\t\t\t\ttitle=\"Show last downloaded panel\"\n\t\t\t\taria-label=\"Show last downloaded panel\"\n\t\t\t\t:disabled=\"!hasPrevRender\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\" aria-hidden=\"true\">flip_to_back</i>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\ttitle=\"Take a screenshot of the current scene\"\n\t\t\t\taria-label=\"Take a screenshot of the current scene\"\n\t\t\t\t@click=\"$emit('download')\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\" aria-hidden=\"true\">photo_camera</i>\n\t\t\t</button>\n\t\t</div>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport SettingsPanel from './tools/settings.vue';\nimport AddPanel from './tools/add.vue';\nimport CharacterPanel from './tools/character.vue';\nimport SpritePanel from './tools/sprite.vue';\nimport TextBoxPanel from './tools/textbox.vue';\nimport ChoicePanel from './tools/choice.vue';\nimport CreditsPanel from './tools/credits.vue';\nimport BackgroundsPanel from './tools/backgrounds.vue';\nimport ContentPacksPanel from './tools/content-pack.vue';\nimport PanelsPanel from './tools/panels.vue';\nimport NotificationPanel from './tools/notification.vue';\nimport PoemPanel from './tools/poem.vue';\nimport { IObject, ObjectTypes } from '@/store/objects';\nimport environment from '@/environments/environment';\nimport { defineComponent } from 'vue';\n\ntype PanelNames =\n\t| 'add'\n\t| 'backgrounds'\n\t| 'help_credits'\n\t| 'selection'\n\t| 'packs'\n\t| 'settings'\n\t| 'panels'\n\t| 'notification'\n\t| 'poem';\n\nexport default defineComponent({\n\tcomponents: {\n\t\tSettingsPanel,\n\t\tAddPanel,\n\t\tBackgroundsPanel,\n\t\tCreditsPanel,\n\t\tCharacterPanel,\n\t\tTextBoxPanel,\n\t\tChoicePanel,\n\t\tSpritePanel,\n\t\tContentPacksPanel,\n\t\tPanelsPanel,\n\t\tNotificationPanel,\n\t\tPoemPanel,\n\t},\n\tdata: () => ({\n\t\tpanelSelection: 'add' as PanelNames,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tselection(): string | null {\n\t\t\treturn this.$store.state.ui.selection;\n\t\t},\n\t\tpanel(): PanelNames | ObjectTypes {\n\t\t\tif (this.panelSelection === 'selection') {\n\t\t\t\tif (this.selection === null) {\n\t\t\t\t\t// eslint-disable-next-line vue/no-side-effects-in-computed-properties\n\t\t\t\t\tthis.panelSelection = 'add';\n\t\t\t\t} else {\n\t\t\t\t\tconst obj = this.$store.state.objects.objects[this.selection];\n\t\t\t\t\treturn obj.type;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this.panelSelection;\n\t\t},\n\t\thasPrevRender(): boolean {\n\t\t\treturn this.$store.state.ui.lastDownload !== null;\n\t\t},\n\t},\n\tmethods: {\n\t\tcreate() {\n\t\t\tenvironment.onPanelChange((panel: string) => {\n\t\t\t\tthis.panelSelection = panel as PanelNames;\n\t\t\t});\n\t\t},\n\t\tsetPanel(name: PanelNames) {\n\t\t\tif (name === this.panelSelection) name = 'add';\n\t\t\tthis.panelSelection = name;\n\t\t\tif (this.selection) {\n\t\t\t\tif (this.$store.state.ui.selection === null) return;\n\t\t\t\tthis.$store.commit('ui/setSelection', null);\n\t\t\t}\n\t\t},\n\t},\n\twatch: {\n\t\tselection(newSelection: IObject | null) {\n\t\t\tif (newSelection) {\n\t\t\t\tthis.panelSelection = 'selection';\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.panelSelection === 'selection') {\n\t\t\t\tthis.panelSelection = 'add';\n\t\t\t}\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\">\n#panels {\n\tbackground-color: $default-native-background;\n\tbackground-color: var(--native-background);\n\tborder: 3px solid $default-border;\n\tborder: 3px solid var(--border);\n\tposition: absolute;\n\tdisplay: flex;\n\toverflow: hidden;\n\n\t.panel {\n\t\tdisplay: flex;\n\t\tflex-grow: 1;\n\t\tflex-direction: column;\n\t\tpadding: 4px;\n\t}\n\n\t&:not(.vertical) {\n\t\tflex-direction: row;\n\t\tleft: 0;\n\t\tbottom: 0;\n\t\theight: 192px;\n\t\twidth: 100vw;\n\n\t\t.panel {\n\t\t\tflex-grow: 1;\n\t\t\tflex-wrap: wrap;\n\t\t\talign-content: flex-start;\n\t\t\toverflow-x: auto;\n\t\t\toverflow-y: hidden;\n\n\t\t\t> * {\n\t\t\t\tmargin-right: 8px;\n\t\t\t}\n\t\t}\n\n\t\t#toolbar,\n\t\t#toolbar-end {\n\t\t\twidth: 48px;\n\t\t\theight: 100%;\n\t\t\tfloat: left;\n\t\t\tmargin-top: -3px;\n\t\t}\n\n\t\t#toolbar {\n\t\t\tbutton {\n\t\t\t\tborder-bottom: none;\n\n\t\t\t\t&:nth-child(4) {\n\t\t\t\t\tborder: 3px solid $default-border;\n\t\t\t\t\tborder: 3px solid var(--border);\n\t\t\t\t}\n\n\t\t\t\t&.active {\n\t\t\t\t\tborder-right: 3px solid $default-native-background;\n\t\t\t\t\tborder-right: 3px solid var(--native-background);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t#toolbar-end {\n\t\t\tbutton {\n\t\t\t\tborder-bottom: none;\n\t\t\t\t&:nth-child(4) {\n\t\t\t\t\tborder: 3px solid $default-border;\n\t\t\t\t\tborder: 3px solid var(--border);\n\t\t\t\t}\n\n\t\t\t\t&.active {\n\t\t\t\t\tborder-left: 3px solid $default-native-background;\n\t\t\t\t\tborder-left: 3px solid var(--native-background);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\th1 {\n\t\t\twriting-mode: vertical-rl;\n\t\t\theight: 100%;\n\t\t\twidth: min-content;\n\t\t}\n\t}\n\n\t&.vertical {\n\t\tflex-direction: column;\n\t\ttop: 0;\n\t\tright: 0;\n\t\theight: 100%;\n\t\twidth: 192px;\n\n\t\t.panel {\n\t\t\toverflow-x: hidden;\n\t\t\toverflow-y: auto;\n\n\t\t\t> * {\n\t\t\t\tflex-shrink: 0;\n\t\t\t}\n\t\t}\n\n\t\t#toolbar,\n\t\t#toolbar-end {\n\t\t\twidth: calc(100% + 6px);\n\t\t}\n\n\t\t#toolbar {\n\t\t\tbutton {\n\t\t\t\tborder-right: none;\n\t\t\t\t&:nth-child(4) {\n\t\t\t\t\tborder-right: 3px solid $default-border;\n\t\t\t\t\tborder-right: 3px solid var(--border);\n\t\t\t\t}\n\n\t\t\t\t&.active {\n\t\t\t\t\tborder-bottom: 3px solid $default-native-background;\n\t\t\t\t\tborder-bottom: 3px solid var(--native-background);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t#toolbar-end {\n\t\t\tmargin-bottom: -3px;\n\t\t\tbutton {\n\t\t\t\tborder-left: none;\n\n\t\t\t\t&:nth-child(4) {\n\t\t\t\t\tborder-right: 3px solid $default-border;\n\t\t\t\t\tborder-right: 3px solid var(--border);\n\t\t\t\t}\n\n\t\t\t\t&.active {\n\t\t\t\t\tborder-top: 3px solid $default-native-background;\n\t\t\t\t\tborder-top: 3px solid var(--native-background);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#toolbar {\n\t\tmargin-top: -3px;\n\t\tmargin-left: -3px;\n\t\tbutton {\n\t\t\toutline: 0;\n\t\t\twidth: 48px;\n\t\t\theight: 48px;\n\t\t\tline-height: 48px;\n\t\t\tbackground-color: $default-accent-background;\n\t\t\tbackground-color: var(--accent-background);\n\t\t\tborder: 3px solid $default-border;\n\t\t\tborder: 3px solid var(--border);\n\n\t\t\ti {\n\t\t\t\tvertical-align: sub;\n\t\t\t}\n\n\t\t\t&.active {\n\t\t\t\tbackground: $default-native-background;\n\t\t\t\tbackground: var(--native-background);\n\t\t\t}\n\t\t}\n\t}\n\n\t#toolbar-end {\n\t\tmargin-right: -3px;\n\t\tbutton {\n\t\t\toutline: 0;\n\t\t\twidth: 48px;\n\t\t\theight: 48px;\n\t\t\tline-height: 48px;\n\t\t\tbackground-color: $default-accent-background;\n\t\t\tbackground-color: var(--accent-background);\n\t\t\tborder: 3px solid $default-border;\n\t\t\tborder: 3px solid var(--border);\n\n\t\t\ti {\n\t\t\t\tvertical-align: sub;\n\t\t\t}\n\n\t\t\t&.active {\n\t\t\t\tbackground: $default-native-background;\n\t\t\t\tbackground: var(--native-background);\n\t\t\t}\n\t\t}\n\t}\n}\n\nh1,\nlabel {\n\tuser-select: none;\n}\n</style>\n","<template>\n\t<div class=\"panel\">\n\t\t<h1>Settings</h1>\n\t\t<teleport to=\"#modal-messages\">\n\t\t\t<modal-dialog\n\t\t\t\t:options=\"['Allow', 'Deny']\"\n\t\t\t\tv-if=\"allowSavesModal\"\n\t\t\t\t@leave=\"allowSaves('Deny')\"\n\t\t\t\t@option=\"allowSaves\"\n\t\t\t\tno-base-size\n\t\t\t>\n\t\t\t\t<div class=\"modal-scroll-area\">\n\t\t\t\t\t<p>\n\t\t\t\t\t\tDo you want to allow DDDG to save settings on your device?\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tBy choosing to enable saving settings, DDDG can save data to your\n\t\t\t\t\t\tdevice, and nowhere else. However, your browser and any installed\n\t\t\t\t\t\tbrowser extensions might possibly read and send this data to other\n\t\t\t\t\t\tservers, e.g. to sync between devices. This is outside of our\n\t\t\t\t\t\tcontrol. But in general, we recommend only using browsers and\n\t\t\t\t\t\tbrowser extensions that you trust with your personal data.\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tYou can revoke this permission at any time.\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tOur usual <l to=\"wiki://Privacy Statement\">privacy policy</l> still\n\t\t\t\t\t\tapplies.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</modal-dialog>\n\t\t\t<modal-dialog\n\t\t\t\t:options=\"['Deny', 'Cancle']\"\n\t\t\t\tv-if=\"denySavesModal\"\n\t\t\t\t@leave=\"denySaves('Cancle')\"\n\t\t\t\t@option=\"denySaves\"\n\t\t\t\tno-base-size\n\t\t\t>\n\t\t\t\t<div class=\"modal-scroll-area\">\n\t\t\t\t\t<p>\n\t\t\t\t\t\tDo you want to deny DDDG from saving settings on your device?\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tThis will cause all your settings to reset when leaving the page.\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\tOur usual <l to=\"wiki://Privacy Statement\">privacy policy</l> still\n\t\t\t\t\t\tapplies.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</modal-dialog>\n\t\t\t<modal-dialog\n\t\t\t\t:options=\"[\n\t\t\t\t\tinPlusMode ? 'Enter Classic Mode' : 'Enter Plus mode',\n\t\t\t\t\t'Stay',\n\t\t\t\t]\"\n\t\t\t\tv-if=\"showModeDialog\"\n\t\t\t\t@leave=\"showModeDialog = false\"\n\t\t\t\t@option=\"modeChange\"\n\t\t\t\tno-base-size\n\t\t\t>\n\t\t\t\t<div class=\"modal-scroll-area\">\n\t\t\t\t\t<p>\n\t\t\t\t\t\tWARNING: Swiching modes will discard everything you have done in\n\t\t\t\t\t\tthis session. All dialouge will be lost!\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</modal-dialog>\n\t\t</teleport>\n\t\t<button v-if=\"waitOnSaveChange\" disabled>\n\t\t\tApplying...\n\t\t</button>\n\t\t<button\n\t\t\tv-else-if=\"!savesAllowed && savesEnabledInEnv\"\n\t\t\t@click=\"allowSavesModal = true\"\n\t\t>\n\t\t\tAllow saving options\n\t\t</button>\n\t\t<button\n\t\t\tv-else-if=\"savesAllowed && savesEnabledInEnv\"\n\t\t\t@click=\"denySavesModal = true\"\n\t\t>\n\t\t\tDeny saving options\n\t\t</button>\n\t\t<button @click=\"showModeDialog = true\">\n\t\t\t<template v-if=\"inPlusMode\">\n\t\t\t\tEnter Classic Mode\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\tEnter DDLC Plus Mode\n\t\t\t</template>\n\t\t</button>\n\t\t<toggle\n\t\t\tv-if=\"lqAllowed\"\n\t\t\tlabel=\"Low quality preview?\"\n\t\t\ttitle=\"Reduces the quality of the preview images to speed up the user experience and consume less data. Does not effect final render.\"\n\t\t\tv-model=\"lqRendering\"\n\t\t/>\n\t\t<toggle label=\"NSFW Mode?\" v-model=\"nsfw\" />\n\t\t<toggle\n\t\t\tlabel=\"Enlarge talking objects? (Default value)\"\n\t\t\tv-model=\"defaultCharacterTalkingZoom\"\n\t\t/>\n\t\t<table>\n\t\t\t<tr>\n\t\t\t\t<td><label>Theme:</label></td>\n\t\t\t\t<td>\n\t\t\t\t\t<select v-model=\"theme\">\n\t\t\t\t\t\t<option :value=\"null\">System</option>\n\t\t\t\t\t\t<option :value=\"false\">Light</option>\n\t\t\t\t\t\t<option :value=\"true\">Dark</option>\n\t\t\t\t\t</select>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\n\t\t<table v-if=\"showDownloadFolder\" class=\"downloadTable\">\n\t\t\t<tr>\n\t\t\t\t<td><label>Download folder:</label></td>\n\t\t\t\t<td>{{ downloadFolder }}</td>\n\t\t\t\t<td>\n\t\t\t\t\t<button @click=\"setDownloadFolder\">\n\t\t\t\t\t\tSet\n\t\t\t\t\t</button>\n\t\t\t\t\t<button @click=\"openDownloadFolder\">\n\t\t\t\t\t\tOpen\n\t\t\t\t\t</button>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport { PanelMixin } from './panelMixin';\nimport environment from '@/environments/environment';\nimport { defineComponent } from 'vue';\nimport ModalDialog from '@/components/ModalDialog.vue';\nimport L from '@/components/ui/link.vue';\nimport { safeAsync } from '@/util/errors';\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { Toggle, ModalDialog, L },\n\tdata: () => ({\n\t\tallowSavesModal: false,\n\t\tdenySavesModal: false,\n\t\twaitOnSaveChange: false,\n\t\tshowModeDialog: false,\n\t}),\n\tcomputed: {\n\t\tsavesAllowed: {\n\t\t\tget(): boolean {\n\t\t\t\treturn environment.savingEnabled;\n\t\t\t},\n\t\t\tset(allowed: boolean) {\n\t\t\t\tthis.waitOnSaveChange = true;\n\t\t\t\tenvironment.savingEnabled = allowed;\n\t\t\t\tthis.saveSettings();\n\t\t\t},\n\t\t},\n\t\tinPlusMode(): boolean {\n\t\t\treturn environment.gameMode === 'ddlc_plus';\n\t\t},\n\t\tsavesEnabledInEnv(): boolean {\n\t\t\treturn environment.supports.optionalSaving;\n\t\t},\n\t\tlqAllowed(): boolean {\n\t\t\treturn environment.supports.lq;\n\t\t},\n\t\tlqRendering: {\n\t\t\tget(): boolean {\n\t\t\t\treturn this.$store.state.ui.lqRendering;\n\t\t\t},\n\t\t\tset(lqRendering: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store.commit('ui/setLqRendering', lqRendering);\n\t\t\t\t});\n\t\t\t\tthis.saveSettings();\n\t\t\t},\n\t\t},\n\t\tnsfw: {\n\t\t\tget(): boolean {\n\t\t\t\treturn !!this.$store.state.ui.nsfw;\n\t\t\t},\n\t\t\tset(value: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store.commit('ui/setNsfw', value);\n\t\t\t\t\tthis.saveSettings();\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tdefaultCharacterTalkingZoom: {\n\t\t\tget(): boolean {\n\t\t\t\treturn !!this.$store.state.ui.defaultCharacterTalkingZoom;\n\t\t\t},\n\t\t\tset(value: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store.commit('ui/setDefaultCharacterTalkingZoom', value);\n\t\t\t\t\tthis.saveSettings();\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\ttheme: {\n\t\t\tget(): boolean | null {\n\t\t\t\treturn this.$store.state.ui.useDarkTheme;\n\t\t\t},\n\t\t\tset(value: boolean | null) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store.commit('ui/setDarkTheme', value);\n\t\t\t\t\tthis.saveSettings();\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tshowDownloadFolder(): boolean {\n\t\t\treturn environment.supports.setDownloadFolder;\n\t\t},\n\t\tdownloadFolder(): string {\n\t\t\treturn environment.state.downloadLocation;\n\t\t},\n\t},\n\twatch: {\n\t\tsavesAllowed() {\n\t\t\tthis.waitOnSaveChange = false;\n\t\t},\n\t},\n\tmethods: {\n\t\tallowSaves(choice: 'Allow' | 'Deny') {\n\t\t\tthis.allowSavesModal = false;\n\t\t\tif (choice === 'Allow') {\n\t\t\t\tthis.savesAllowed = true;\n\t\t\t}\n\t\t},\n\t\tdenySaves(choice: 'Deny' | 'Cancel') {\n\t\t\tthis.denySavesModal = false;\n\t\t\tif (choice === 'Deny') {\n\t\t\t\tthis.savesAllowed = false;\n\t\t\t}\n\t\t},\n\t\tmodeChange(choice: 'Enter Classic Mode' | 'Enter Plus mode' | 'Stay') {\n\t\t\tsafeAsync('changing modes', async () => {\n\t\t\t\tconst baseLoc = `${location.protocol}//${location.host}${location.pathname}`;\n\t\t\t\tif (choice === 'Enter Classic Mode') {\n\t\t\t\t\tawait environment.saveGameMode('ddlc');\n\t\t\t\t\tlocation.href = `${baseLoc}?mode=ddlc`;\n\t\t\t\t} else if (choice === 'Enter Plus mode') {\n\t\t\t\t\tawait environment.saveGameMode('ddlc_plus');\n\t\t\t\t\tlocation.href = `${baseLoc}?mode=ddlc_plus`;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tsaveSettings() {\n\t\t\tenvironment.saveSettings({\n\t\t\t\tlq: this.$store.state.ui.lqRendering,\n\t\t\t\tnsfw: this.$store.state.ui.nsfw,\n\t\t\t\tdarkMode: this.$store.state.ui.useDarkTheme ?? undefined,\n\t\t\t\tdefaultCharacterTalkingZoom: this.$store.state.ui\n\t\t\t\t\t.defaultCharacterTalkingZoom,\n\t\t\t});\n\t\t},\n\t\tsetDownloadFolder() {\n\t\t\tenvironment.updateDownloadFolder();\n\t\t},\n\t\topenDownloadFolder() {\n\t\t\tenvironment.openFolder('downloads');\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.panel {\n\t&.vertical {\n\t\t#dialog_text_wrapper {\n\t\t\twidth: 173px;\n\n\t\t\ttextarea {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\n\t\t.downloadTable {\n\t\t\ttd {\n\t\t\t\tdisplay: table-row;\n\t\t\t\tline-break: anywhere;\n\t\t\t}\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\t#dialog_text_wrapper {\n\t\t\theight: 181px;\n\t\t\tdisplay: table;\n\n\t\t\t* {\n\t\t\t\tdisplay: table-row;\n\t\t\t}\n\t\t}\n\t}\n}\n\ntextarea {\n\tmin-height: 148px;\n}\n\n.btn_link {\n\tappearance: button;\n\ttext-align: center;\n}\n</style>\n","import { VerticalScrollRedirect } from '@/components/vertical-scroll-redirect';\nimport { ComponentOptionsMixin } from 'vue';\n\nexport const PanelMixin: ComponentOptionsMixin = {\n\tmixins: [VerticalScrollRedirect],\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\tmounted() {\n\t\tthis.updateVertical();\n\t\tthis.$el.addEventListener(\n\t\t\t'wheel',\n\t\t\t(e: WheelEvent) => {\n\t\t\t\tif (!this.vertical) this.verticalScrollRedirect(e as WheelEvent);\n\t\t\t},\n\t\t\t{\n\t\t\t\tpassive: true,\n\t\t\t}\n\t\t);\n\t},\n\tmethods: {\n\t\tupdateVertical() {\n\t\t\tif (!this.$el) return;\n\t\t\tif (this.vertical) {\n\t\t\t\tthis.$el.classList.add('vertical');\n\t\t\t} else {\n\t\t\t\tthis.$el.classList.remove('vertical');\n\t\t\t}\n\t\t},\n\t},\n\twatch: {\n\t\tvertical() {\n\t\t\t(this as any).updateVertical();\n\t\t},\n\t},\n};\n","<template>\n\t<div class=\"dialog-wrapper\" @click=\"$emit('leave')\">\n\t\t<dialog open :class=\"{ 'base-size': !noBaseSize }\" @click.stop>\n\t\t\t<slot />\n\t\t\t<div v-if=\"options.length > 0\" id=\"submit-options\">\n\t\t\t\t<button\n\t\t\t\t\tv-for=\"option of options\"\n\t\t\t\t\t:key=\"option\"\n\t\t\t\t\tclass=\"option\"\n\t\t\t\t\t@click=\"$emit('option', option)\"\n\t\t\t\t>\n\t\t\t\t\t{{ option }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</dialog>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue';\n\nexport default defineComponent({\n\tprops: {\n\t\tnoBaseSize: Boolean,\n\t\toptions: {\n\t\t\ttype: Array as PropType<string[]>,\n\t\t\tdefault: [],\n\t\t},\n\t},\n});\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped lang=\"scss\">\n.dialog-wrapper {\n\tposition: absolute;\n\ttop: 0;\n\tbottom: 0;\n\tright: 0;\n\tleft: 0;\n\tbackground: rgba($color: #000000, $alpha: 0.5);\n\tdisplay: flex;\n\ttransition: all 0.15s;\n}\n\ndialog {\n\tmax-width: 90vw;\n\tmax-height: 90vh;\n\tbackground-attachment: scroll;\n\tbackground-color: $default-native-background;\n\tbackground-color: var(--native-background);\n\tbackground-position: right center;\n\tbackground-repeat: no-repeat;\n\tbackground-size: contain;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-self: center;\n\toverflow: hidden;\n\tpadding: 0;\n\tborder: 4px solid $default-border;\n\tborder: 4px solid var(--border);\n\toverflow: hidden;\n\talign-self: center;\n\tjustify-self: center;\n\tmargin: auto;\n\n\t&.base-size {\n\t\twidth: 860px;\n\t\theight: 860px;\n\t}\n\n\t#submit-options {\n\t\tdisplay: flex;\n\t\tjustify-content: space-evenly;\n\n\t\tbutton.option {\n\t\t\tborder: 0;\n\t\t\tbackground: none;\n\t\t\tfont-family: riffic;\n\t\t\tfont-size: 24px;\n\t\t}\n\t}\n}\n</style>\n","\nimport { defineComponent, PropType } from 'vue';\n\nexport default defineComponent({\n\tprops: {\n\t\tnoBaseSize: Boolean,\n\t\toptions: {\n\t\t\ttype: Array as PropType<string[]>,\n\t\t\tdefault: [],\n\t\t},\n\t},\n});\n","import { render } from \"./ModalDialog.vue?vue&type=template&id=64aeb4c5&scoped=true\"\nimport script from \"./ModalDialog.vue?vue&type=script&lang=ts\"\nexport * from \"./ModalDialog.vue?vue&type=script&lang=ts\"\n\nimport \"./ModalDialog.vue?vue&type=style&index=0&id=64aeb4c5&scoped=true&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-64aeb4c5\"\n\nexport default script","import eventBus, { FailureEvent } from '@/eventbus/event-bus';\n\nexport async function safeAsync(name: string, callback: () => Promise<void>) {\n\ttry {\n\t\tawait callback();\n\t} catch (e) {\n\t\tconsole.error('Error in promise', name, e);\n\t\teventBus.fire(\n\t\t\tnew FailureEvent(\n\t\t\t\t\"Unexpected error! Please copy the following message and send it to /u/edave64: Error in '\" +\n\t\t\t\t\tname +\n\t\t\t\t\t'\", ' +\n\t\t\t\t\tnormalizeError(e)\n\t\t\t)\n\t\t);\n\t}\n}\n\nfunction normalizeError(e: any): string {\n\tif (e instanceof Error) {\n\t\tif (e.stack) {\n\t\t\tconst stackLines = e.stack.split('\\n');\n\t\t\tif (stackLines[0].includes(e.name) && stackLines[0].includes(e.message)) {\n\t\t\t\treturn stackLines[0] + '\\n<br />' + stackLines[1];\n\t\t\t} else {\n\t\t\t\treturn e.name + ': ' + e.message + '\\n<br />' + stackLines[0];\n\t\t\t}\n\t\t}\n\t\treturn e.name + ': ' + e.message;\n\t}\n\tif (e instanceof Object) {\n\t\treturn JSON.stringify(e);\n\t}\n\treturn '' + e;\n}\n","\nimport Toggle from '@/components/toggle.vue';\nimport { PanelMixin } from './panelMixin';\nimport environment from '@/environments/environment';\nimport { defineComponent } from 'vue';\nimport ModalDialog from '@/components/ModalDialog.vue';\nimport L from '@/components/ui/link.vue';\nimport { safeAsync } from '@/util/errors';\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { Toggle, ModalDialog, L },\n\tdata: () => ({\n\t\tallowSavesModal: false,\n\t\tdenySavesModal: false,\n\t\twaitOnSaveChange: false,\n\t\tshowModeDialog: false,\n\t}),\n\tcomputed: {\n\t\tsavesAllowed: {\n\t\t\tget(): boolean {\n\t\t\t\treturn environment.savingEnabled;\n\t\t\t},\n\t\t\tset(allowed: boolean) {\n\t\t\t\tthis.waitOnSaveChange = true;\n\t\t\t\tenvironment.savingEnabled = allowed;\n\t\t\t\tthis.saveSettings();\n\t\t\t},\n\t\t},\n\t\tinPlusMode(): boolean {\n\t\t\treturn environment.gameMode === 'ddlc_plus';\n\t\t},\n\t\tsavesEnabledInEnv(): boolean {\n\t\t\treturn environment.supports.optionalSaving;\n\t\t},\n\t\tlqAllowed(): boolean {\n\t\t\treturn environment.supports.lq;\n\t\t},\n\t\tlqRendering: {\n\t\t\tget(): boolean {\n\t\t\t\treturn this.$store.state.ui.lqRendering;\n\t\t\t},\n\t\t\tset(lqRendering: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store.commit('ui/setLqRendering', lqRendering);\n\t\t\t\t});\n\t\t\t\tthis.saveSettings();\n\t\t\t},\n\t\t},\n\t\tnsfw: {\n\t\t\tget(): boolean {\n\t\t\t\treturn !!this.$store.state.ui.nsfw;\n\t\t\t},\n\t\t\tset(value: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store.commit('ui/setNsfw', value);\n\t\t\t\t\tthis.saveSettings();\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tdefaultCharacterTalkingZoom: {\n\t\t\tget(): boolean {\n\t\t\t\treturn !!this.$store.state.ui.defaultCharacterTalkingZoom;\n\t\t\t},\n\t\t\tset(value: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store.commit('ui/setDefaultCharacterTalkingZoom', value);\n\t\t\t\t\tthis.saveSettings();\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\ttheme: {\n\t\t\tget(): boolean | null {\n\t\t\t\treturn this.$store.state.ui.useDarkTheme;\n\t\t\t},\n\t\t\tset(value: boolean | null) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tawait this.$store.commit('ui/setDarkTheme', value);\n\t\t\t\t\tthis.saveSettings();\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tshowDownloadFolder(): boolean {\n\t\t\treturn environment.supports.setDownloadFolder;\n\t\t},\n\t\tdownloadFolder(): string {\n\t\t\treturn environment.state.downloadLocation;\n\t\t},\n\t},\n\twatch: {\n\t\tsavesAllowed() {\n\t\t\tthis.waitOnSaveChange = false;\n\t\t},\n\t},\n\tmethods: {\n\t\tallowSaves(choice: 'Allow' | 'Deny') {\n\t\t\tthis.allowSavesModal = false;\n\t\t\tif (choice === 'Allow') {\n\t\t\t\tthis.savesAllowed = true;\n\t\t\t}\n\t\t},\n\t\tdenySaves(choice: 'Deny' | 'Cancel') {\n\t\t\tthis.denySavesModal = false;\n\t\t\tif (choice === 'Deny') {\n\t\t\t\tthis.savesAllowed = false;\n\t\t\t}\n\t\t},\n\t\tmodeChange(choice: 'Enter Classic Mode' | 'Enter Plus mode' | 'Stay') {\n\t\t\tsafeAsync('changing modes', async () => {\n\t\t\t\tconst baseLoc = `${location.protocol}//${location.host}${location.pathname}`;\n\t\t\t\tif (choice === 'Enter Classic Mode') {\n\t\t\t\t\tawait environment.saveGameMode('ddlc');\n\t\t\t\t\tlocation.href = `${baseLoc}?mode=ddlc`;\n\t\t\t\t} else if (choice === 'Enter Plus mode') {\n\t\t\t\t\tawait environment.saveGameMode('ddlc_plus');\n\t\t\t\t\tlocation.href = `${baseLoc}?mode=ddlc_plus`;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tsaveSettings() {\n\t\t\tenvironment.saveSettings({\n\t\t\t\tlq: this.$store.state.ui.lqRendering,\n\t\t\t\tnsfw: this.$store.state.ui.nsfw,\n\t\t\t\tdarkMode: this.$store.state.ui.useDarkTheme ?? undefined,\n\t\t\t\tdefaultCharacterTalkingZoom: this.$store.state.ui\n\t\t\t\t\t.defaultCharacterTalkingZoom,\n\t\t\t});\n\t\t},\n\t\tsetDownloadFolder() {\n\t\t\tenvironment.updateDownloadFolder();\n\t\t},\n\t\topenDownloadFolder() {\n\t\t\tenvironment.openFolder('downloads');\n\t\t},\n\t},\n});\n","import { render } from \"./settings.vue?vue&type=template&id=82bbca46&scoped=true\"\nimport script from \"./settings.vue?vue&type=script&lang=ts\"\nexport * from \"./settings.vue?vue&type=script&lang=ts\"\n\nimport \"./settings.vue?vue&type=style&index=0&id=82bbca46&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-82bbca46\"\n\nexport default script","<template>\n\t<div\n\t\tclass=\"panel\"\n\t\tv-if=\"isWebPSupported !== undefined\"\n\t\t@dragenter=\"showDropTarget\"\n\t\t@mouseleave=\"hideDropTarget\"\n\t>\n\t\t<drop-target ref=\"spriteDt\" class=\"drop-target\" @drop=\"addCustomSpriteFile\"\n\t\t\t>Drop here to add as a new sprite</drop-target\n\t\t>\n\t\t<h1>Add</h1>\n\t\t<div :class=\"{ 'group-selector': true, vertical }\">\n\t\t\t<d-button\n\t\t\t\t:class=\"{ active: group === 'characters' }\"\n\t\t\t\ticon-pos=\"top\"\n\t\t\t\ticon=\"emoji_people\"\n\t\t\t\t@click=\"group = 'characters'\"\n\t\t\t>\n\t\t\t\tChar&shy;acters\n\t\t\t</d-button>\n\t\t\t<d-button\n\t\t\t\t:class=\"{ active: group === 'sprites' }\"\n\t\t\t\ticon-pos=\"top\"\n\t\t\t\ticon=\"change_history\"\n\t\t\t\t@click=\"group = 'sprites'\"\n\t\t\t>\n\t\t\t\tSprites\n\t\t\t</d-button>\n\t\t\t<d-button\n\t\t\t\t:class=\"{ active: group === 'ui' }\"\n\t\t\t\ticon-pos=\"top\"\n\t\t\t\ticon=\"view_quilt\"\n\t\t\t\t@click=\"group = 'ui'\"\n\t\t\t>\n\t\t\t\tUI\n\t\t\t</d-button>\n\t\t</div>\n\t\t<div :class=\"{ 'item-grid': true, vertical }\">\n\t\t\t<template v-if=\"group === 'characters'\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"character\"\n\t\t\t\t\tv-for=\"character of characters\"\n\t\t\t\t\t:key=\"character.id\"\n\t\t\t\t\t:title=\"character.label\"\n\t\t\t\t\t@click=\"onChosen(character.id.toLowerCase())\"\n\t\t\t\t>\n\t\t\t\t\t<img :src=\"assetPath(character)\" :alt=\"character.label\" />\n\t\t\t\t</div>\n\t\t\t\t<d-button\n\t\t\t\t\tclass=\"custom-sprite\"\n\t\t\t\t\ticon=\"extension\"\n\t\t\t\t\t@click=\"$emit('show-dialog', 'type: Characters')\"\n\t\t\t\t>\n\t\t\t\t\tSearch in content packs\n\t\t\t\t</d-button>\n\t\t\t</template>\n\t\t\t<template v-if=\"group === 'sprites'\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"sprite\"\n\t\t\t\t\tv-for=\"sprite of sprites\"\n\t\t\t\t\t:key=\"sprite.label\"\n\t\t\t\t\t:title=\"sprite.label\"\n\t\t\t\t\t:style=\"{ background: assetSpriteBackground(sprite) }\"\n\t\t\t\t\t@click=\"addSpriteToScene(sprite)\"\n\t\t\t\t>\n\t\t\t\t\t{{ sprite.label }}\n\t\t\t\t</div>\n\n\t\t\t\t<d-button\n\t\t\t\t\tclass=\"custom-sprite\"\n\t\t\t\t\ticon=\"publish\"\n\t\t\t\t\t@click=\"$refs.spriteUpload.click()\"\n\t\t\t\t>\n\t\t\t\t\tUpload new sprite\n\t\t\t\t\t<input type=\"file\" ref=\"spriteUpload\" @change=\"onSpriteFileUpload\" />\n\t\t\t\t</d-button>\n\t\t\t\t<d-button icon=\"insert_link\" @click=\"uploadFromURL\">\n\t\t\t\t\tNew sprite from URL\n\t\t\t\t</d-button>\n\t\t\t\t<d-button\n\t\t\t\t\ticon=\"extension\"\n\t\t\t\t\t@click=\"$emit('show-dialog', 'type: Sprites')\"\n\t\t\t\t>\n\t\t\t\t\tSearch in content packs\n\t\t\t\t</d-button>\n\t\t\t\t<d-button\n\t\t\t\t\tv-if=\"showSpritesFolder\"\n\t\t\t\t\ticon=\"folder\"\n\t\t\t\t\t@click=\"openSpritesFolder\"\n\t\t\t\t>\n\t\t\t\t\tOpen sprites folder\n\t\t\t\t</d-button>\n\t\t\t</template>\n\t\t\t<template v-if=\"group === 'ui'\">\n\t\t\t\t<button @click=\"addTextBox\">Textbox</button>\n\t\t\t\t<button @click=\"addPoem\">Poem</button>\n\t\t\t\t<button @click=\"addDialog\">Notification</button>\n\t\t\t\t<button @click=\"addChoice\">Choice</button>\n\t\t\t\t<button @click=\"addConsole\">Console</button>\n\t\t\t</template>\n\t\t\t<button @click=\"paste\" :disabled=\"!hasClipboardContent\">\n\t\t\t\tPaste\n\t\t\t</button>\n\t\t</div>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { isWebPSupported } from '@/asset-manager';\nimport { ICreateCharacterAction } from '@/store/objectTypes/characters';\nimport { ICreateTextBoxAction } from '@/store/objectTypes/textbox';\nimport { IAsset, ReplaceContentPackAction } from '@/store/content';\nimport {\n\tCharacter,\n\tContentPack,\n\tSprite,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { PanelMixin } from './panelMixin';\nimport DropTarget from '../drop-target.vue';\nimport DButton from '@/components/ui/d-button.vue';\nimport { ICreateSpriteAction } from '@/store/objectTypes/sprite';\nimport { ICreateChoicesAction } from '@/store/objectTypes/choices';\nimport { ICreateNotificationAction } from '@/store/objectTypes/notification';\nimport { ICreatePoemAction } from '@/store/objectTypes/poem';\nimport environment, { Folder } from '@/environments/environment';\nimport { defineComponent } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\nimport { IPasteFromClipboardAction } from '@/store/objects';\n\nconst uploadedSpritesPack: ContentPack<string> = {\n\tpackId: 'dddg.buildin.uploadedSprites',\n\tpackCredits: [''],\n\tdependencies: [],\n\tcharacters: [],\n\tfonts: [],\n\tsprites: [],\n\tpoemStyles: [],\n\tpoemBackgrounds: [],\n\tbackgrounds: [],\n\tcolors: [],\n};\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { DropTarget, DButton },\n\tdata: () => ({\n\t\tisWebPSupported: null as boolean | null,\n\t\tcustomAssetCount: 0,\n\t\tgroup: 'characters' as 'characters' | 'sprites' | 'ui',\n\t}),\n\tcomputed: {\n\t\tcharacters(): DeepReadonly<Array<Character<IAsset>>> {\n\t\t\treturn this.$store.state.content.current.characters;\n\t\t},\n\t\tsprites(): DeepReadonly<Array<Sprite<IAsset>>> {\n\t\t\treturn this.$store.state.content.current.sprites;\n\t\t},\n\t\thasClipboardContent(): boolean {\n\t\t\treturn !!this.$store.state.ui.clipboard;\n\t\t},\n\t\tshowSpritesFolder(): boolean {\n\t\t\treturn (environment.supports.openableFolders as ReadonlySet<Folder>).has(\n\t\t\t\t'sprites'\n\t\t\t);\n\t\t},\n\t},\n\tmethods: {\n\t\tassetSpriteBackground(sprite: Sprite<IAsset>) {\n\t\t\treturn sprite.variants[0]\n\t\t\t\t.map(variant => `url('${variant.lq}')`)\n\t\t\t\t.join(',');\n\t\t},\n\t\tassetPath(character: Character<IAsset>) {\n\t\t\treturn character.chibi\n\t\t\t\t? environment.supports.lq\n\t\t\t\t\t? character.chibi.lq\n\t\t\t\t\t: character.chibi.hq\n\t\t\t\t: '';\n\t\t},\n\t\tshowDropTarget(e: DragEvent) {\n\t\t\tif (!e.dataTransfer) return;\n\t\t\te.dataTransfer.effectAllowed = 'none';\n\t\t\tif (\n\t\t\t\t!Array.from(e.dataTransfer.items).find(item =>\n\t\t\t\t\titem.type.match(/^image.*$/)\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.dataTransfer.effectAllowed = 'link';\n\t\t\tif (this.group === 'sprites') {\n\t\t\t\t(this.$refs.spriteDt as any).show();\n\t\t\t}\n\t\t},\n\t\thideDropTarget() {\n\t\t\tif (this.group === 'sprites') {\n\t\t\t\t(this.$refs.spriteDt as any).hide();\n\t\t\t}\n\t\t},\n\t\tonSpriteFileUpload() {\n\t\t\tconst uploadInput = this.$refs.spriteUpload as HTMLInputElement;\n\t\t\tif (!uploadInput.files) return;\n\t\t\tfor (const file of uploadInput.files) {\n\t\t\t\tthis.addCustomSpriteFile(file);\n\t\t\t}\n\t\t},\n\t\tasync uploadFromURL() {\n\t\t\tconst url = prompt('Enter the URL of the image');\n\t\t\tif (!url) return;\n\t\t\tconst lastSegment = url.split('/').slice(-1)[0];\n\t\t\tthis.addNewCustomSprite(lastSegment, url);\n\t\t},\n\t\tasync addSpriteToScene(sprite: Sprite<IAsset>) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tawait this.$store.dispatch('objects/createSprite', {\n\t\t\t\t\tassets: sprite.variants[0],\n\t\t\t\t} as ICreateSpriteAction);\n\t\t\t});\n\t\t},\n\t\taddTextBox() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createTextBox',\n\t\t\t\t\t{} as ICreateTextBoxAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\taddChoice() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createChoice',\n\t\t\t\t\t{} as ICreateChoicesAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\taddDialog() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createNotification',\n\t\t\t\t\t{} as ICreateNotificationAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\taddPoem() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/createPoem', {} as ICreatePoemAction);\n\t\t\t});\n\t\t},\n\t\taddConsole() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/createConsole', {} as ICreatePoemAction);\n\t\t\t});\n\t\t},\n\t\tpaste() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/pasteObjectFromClipboard',\n\t\t\t\t\t{} as IPasteFromClipboardAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\tonChosen(id: string) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/createCharacters', {\n\t\t\t\t\tcharacterType: id,\n\t\t\t\t} as ICreateCharacterAction);\n\t\t\t});\n\t\t},\n\t\taddCustomSpriteFile(file: File) {\n\t\t\tconst url = URL.createObjectURL(file);\n\t\t\tthis.addNewCustomSprite(file.name, url);\n\t\t},\n\t\taddNewCustomSprite(label: string, url: string) {\n\t\t\tuploadedSpritesPack.sprites.push({\n\t\t\t\tid: url,\n\t\t\t\tlabel,\n\t\t\t\tvariants: [[url]],\n\t\t\t\tdefaultScale: [1.0, 1.0],\n\t\t\t\thd: null,\n\t\t\t});\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('content/replaceContentPack', {\n\t\t\t\t\tcontentPack: uploadedSpritesPack,\n\t\t\t\t\tprocessed: false,\n\t\t\t\t} as ReplaceContentPackAction);\n\t\t\t});\n\t\t},\n\t\topenSpritesFolder() {\n\t\t\tenvironment.openFolder('sprites');\n\t\t},\n\t},\n\tasync created() {\n\t\tthis.isWebPSupported = await isWebPSupported();\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\ntextarea {\n\tflex-grow: 1;\n}\n\n#panels {\n\t&:not(.vertical) .panel {\n\t\tjustify-content: center;\n\t}\n}\n\n.panel {\n\tflex-wrap: nowrap;\n\n\t.custom-sprite {\n\t\tinput {\n\t\t\tdisplay: none;\n\t\t}\n\t}\n}\n\n.group-selector {\n\tdisplay: flex;\n\n\t&.vertical {\n\t\twidth: 100%;\n\t\tflex-direction: row;\n\t}\n\n\t&:not(.vertical) {\n\t\t@include height-100();\n\t\tflex-direction: column;\n\t}\n\n\tbutton {\n\t\tflex-grow: 1;\n\t\t&.active {\n\t\t\tbackground: $default-native-background;\n\t\t\tbackground: var(--native-background);\n\t\t}\n\t}\n}\n\n.item-grid {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tjustify-content: space-evenly;\n\n\t&.vertical {\n\t\tmargin-top: 4px;\n\t\twidth: 100%;\n\t\tflex-direction: row;\n\n\t\tbutton {\n\t\t\twidth: 100%;\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\tmargin-left: 4px;\n\t\t@include height-100();\n\t\tflex-direction: column;\n\t}\n\n\t.character img {\n\t\tmax-height: 72px;\n\t\tmax-width: 72px;\n\t}\n}\n\n.item-grid {\n\t.sprite {\n\t\tbox-shadow: inset 0 0 1px 3px $default-modal-backdrop;\n\t\tbox-shadow: inset 0 0 1px 3px var(--modal-backdrop);\n\t\theight: 256px;\n\t\twidth: 256px;\n\t\tbackground-size: contain !important;\n\t\tbackground-repeat: no-repeat !important;\n\t\tbackground-position: center center !important;\n\t\tmargin-right: 4px;\n\t\ttext-shadow: 0 0 4px #000, -1px -1px 0 #000, 1px -1px 0 #000,\n\t\t\t-1px 1px 0 #000, 1px 1px 0 #000;\n\t\tcolor: white;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n}\n</style>\n","<template>\n\t<button :class=\"[iconPos]\" :disabled=\"disabled\">\n\t\t<div class=\"material-icons\" aria-hidden=\"true\">{{ icon }}</div>\n\t\t<div class=\"content\"><slot /></div>\n\t</button>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue';\nexport default defineComponent({\n\tprops: {\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ticonPos: {\n\t\t\ttype: String as PropType<'left' | 'top'>,\n\t\t\tdefault: 'left',\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\nbutton {\n\tborder: 2px solid $default-border;\n\tborder: 2px solid var(--border);\n\tbackground: $default-accent-background;\n\tbackground: var(--accent-background);\n\tpadding: 1px;\n\tdisplay: flex;\n\ttext-align: center;\n\tjustify-content: center;\n\talign-items: center;\n\n\t&.left {\n\t\tflex-direction: row;\n\t\t> .content {\n\t\t\tflex-grow: 1;\n\t\t}\n\t}\n\t&.top {\n\t\tflex-direction: column;\n\t}\n}\n</style>\n","\nimport { defineComponent, PropType } from 'vue';\nexport default defineComponent({\n\tprops: {\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ticonPos: {\n\t\t\ttype: String as PropType<'left' | 'top'>,\n\t\t\tdefault: 'left',\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n});\n","import { render } from \"./d-button.vue?vue&type=template&id=465f5994&scoped=true\"\nimport script from \"./d-button.vue?vue&type=script&lang=ts\"\nexport * from \"./d-button.vue?vue&type=script&lang=ts\"\n\nimport \"./d-button.vue?vue&type=style&index=0&id=465f5994&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-465f5994\"\n\nexport default script","\nimport { isWebPSupported } from '@/asset-manager';\nimport { ICreateCharacterAction } from '@/store/objectTypes/characters';\nimport { ICreateTextBoxAction } from '@/store/objectTypes/textbox';\nimport { IAsset, ReplaceContentPackAction } from '@/store/content';\nimport {\n\tCharacter,\n\tContentPack,\n\tSprite,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { PanelMixin } from './panelMixin';\nimport DropTarget from '../drop-target.vue';\nimport DButton from '@/components/ui/d-button.vue';\nimport { ICreateSpriteAction } from '@/store/objectTypes/sprite';\nimport { ICreateChoicesAction } from '@/store/objectTypes/choices';\nimport { ICreateNotificationAction } from '@/store/objectTypes/notification';\nimport { ICreatePoemAction } from '@/store/objectTypes/poem';\nimport environment, { Folder } from '@/environments/environment';\nimport { defineComponent } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\nimport { IPasteFromClipboardAction } from '@/store/objects';\n\nconst uploadedSpritesPack: ContentPack<string> = {\n\tpackId: 'dddg.buildin.uploadedSprites',\n\tpackCredits: [''],\n\tdependencies: [],\n\tcharacters: [],\n\tfonts: [],\n\tsprites: [],\n\tpoemStyles: [],\n\tpoemBackgrounds: [],\n\tbackgrounds: [],\n\tcolors: [],\n};\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { DropTarget, DButton },\n\tdata: () => ({\n\t\tisWebPSupported: null as boolean | null,\n\t\tcustomAssetCount: 0,\n\t\tgroup: 'characters' as 'characters' | 'sprites' | 'ui',\n\t}),\n\tcomputed: {\n\t\tcharacters(): DeepReadonly<Array<Character<IAsset>>> {\n\t\t\treturn this.$store.state.content.current.characters;\n\t\t},\n\t\tsprites(): DeepReadonly<Array<Sprite<IAsset>>> {\n\t\t\treturn this.$store.state.content.current.sprites;\n\t\t},\n\t\thasClipboardContent(): boolean {\n\t\t\treturn !!this.$store.state.ui.clipboard;\n\t\t},\n\t\tshowSpritesFolder(): boolean {\n\t\t\treturn (environment.supports.openableFolders as ReadonlySet<Folder>).has(\n\t\t\t\t'sprites'\n\t\t\t);\n\t\t},\n\t},\n\tmethods: {\n\t\tassetSpriteBackground(sprite: Sprite<IAsset>) {\n\t\t\treturn sprite.variants[0]\n\t\t\t\t.map(variant => `url('${variant.lq}')`)\n\t\t\t\t.join(',');\n\t\t},\n\t\tassetPath(character: Character<IAsset>) {\n\t\t\treturn character.chibi\n\t\t\t\t? environment.supports.lq\n\t\t\t\t\t? character.chibi.lq\n\t\t\t\t\t: character.chibi.hq\n\t\t\t\t: '';\n\t\t},\n\t\tshowDropTarget(e: DragEvent) {\n\t\t\tif (!e.dataTransfer) return;\n\t\t\te.dataTransfer.effectAllowed = 'none';\n\t\t\tif (\n\t\t\t\t!Array.from(e.dataTransfer.items).find(item =>\n\t\t\t\t\titem.type.match(/^image.*$/)\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.dataTransfer.effectAllowed = 'link';\n\t\t\tif (this.group === 'sprites') {\n\t\t\t\t(this.$refs.spriteDt as any).show();\n\t\t\t}\n\t\t},\n\t\thideDropTarget() {\n\t\t\tif (this.group === 'sprites') {\n\t\t\t\t(this.$refs.spriteDt as any).hide();\n\t\t\t}\n\t\t},\n\t\tonSpriteFileUpload() {\n\t\t\tconst uploadInput = this.$refs.spriteUpload as HTMLInputElement;\n\t\t\tif (!uploadInput.files) return;\n\t\t\tfor (const file of uploadInput.files) {\n\t\t\t\tthis.addCustomSpriteFile(file);\n\t\t\t}\n\t\t},\n\t\tasync uploadFromURL() {\n\t\t\tconst url = prompt('Enter the URL of the image');\n\t\t\tif (!url) return;\n\t\t\tconst lastSegment = url.split('/').slice(-1)[0];\n\t\t\tthis.addNewCustomSprite(lastSegment, url);\n\t\t},\n\t\tasync addSpriteToScene(sprite: Sprite<IAsset>) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tawait this.$store.dispatch('objects/createSprite', {\n\t\t\t\t\tassets: sprite.variants[0],\n\t\t\t\t} as ICreateSpriteAction);\n\t\t\t});\n\t\t},\n\t\taddTextBox() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createTextBox',\n\t\t\t\t\t{} as ICreateTextBoxAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\taddChoice() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createChoice',\n\t\t\t\t\t{} as ICreateChoicesAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\taddDialog() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createNotification',\n\t\t\t\t\t{} as ICreateNotificationAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\taddPoem() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/createPoem', {} as ICreatePoemAction);\n\t\t\t});\n\t\t},\n\t\taddConsole() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/createConsole', {} as ICreatePoemAction);\n\t\t\t});\n\t\t},\n\t\tpaste() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/pasteObjectFromClipboard',\n\t\t\t\t\t{} as IPasteFromClipboardAction\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\tonChosen(id: string) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/createCharacters', {\n\t\t\t\t\tcharacterType: id,\n\t\t\t\t} as ICreateCharacterAction);\n\t\t\t});\n\t\t},\n\t\taddCustomSpriteFile(file: File) {\n\t\t\tconst url = URL.createObjectURL(file);\n\t\t\tthis.addNewCustomSprite(file.name, url);\n\t\t},\n\t\taddNewCustomSprite(label: string, url: string) {\n\t\t\tuploadedSpritesPack.sprites.push({\n\t\t\t\tid: url,\n\t\t\t\tlabel,\n\t\t\t\tvariants: [[url]],\n\t\t\t\tdefaultScale: [1.0, 1.0],\n\t\t\t\thd: null,\n\t\t\t});\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('content/replaceContentPack', {\n\t\t\t\t\tcontentPack: uploadedSpritesPack,\n\t\t\t\t\tprocessed: false,\n\t\t\t\t} as ReplaceContentPackAction);\n\t\t\t});\n\t\t},\n\t\topenSpritesFolder() {\n\t\t\tenvironment.openFolder('sprites');\n\t\t},\n\t},\n\tasync created() {\n\t\tthis.isWebPSupported = await isWebPSupported();\n\t},\n});\n","import { render } from \"./add.vue?vue&type=template&id=32ed20c5&scoped=true\"\nimport script from \"./add.vue?vue&type=script&lang=ts\"\nexport * from \"./add.vue?vue&type=script&lang=ts\"\n\nimport \"./add.vue?vue&type=style&index=0&id=32ed20c5&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-32ed20c5\"\n\nexport default script","<template>\n\t<object-tool :object=\"object\" :title=\"label\" :showAltPanel=\"panelForParts\">\n\t\t<template v-slot:alt-panel>\n\t\t\t<parts\n\t\t\t\tv-if=\"panelForParts\"\n\t\t\t\t:character=\"object\"\n\t\t\t\t:part=\"panelForParts\"\n\t\t\t\t@leave=\"panelForParts = null\"\n\t\t\t\t@show-dialog=\"$emit('show-dialog', $event)\"\n\t\t\t\t@show-expression-dialog=\"$emit('show-expression-dialog', $event)\"\n\t\t\t/>\n\t\t</template>\n\t\t<template v-slot:default>\n\t\t\t<d-fieldset\n\t\t\t\tv-if=\"hasMultiplePoses || parts.length > 0\"\n\t\t\t\tclass=\"pose-list\"\n\t\t\t\ttitle=\"Pose:\"\n\t\t\t>\n\t\t\t\t<table>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t<tr v-if=\"hasMultipleStyles\">\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"seekStyle(-1)\">&lt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<button class=\"middle-button\" @click=\"panelForParts = 'style'\">\n\t\t\t\t\t\t\t\t\tStyle\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"seekStyle(1)\">&gt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr v-if=\"hasMultiplePoses\">\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"seekPose(-1)\">&lt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<button class=\"middle-button\" @click=\"panelForParts = 'pose'\">\n\t\t\t\t\t\t\t\t\tPose\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"seekPose(1)\">&gt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr v-for=\"part of parts\" :key=\"part\">\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"seekPart(part, -1)\">&lt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<button class=\"middle-button\" @click=\"panelForParts = part\">\n\t\t\t\t\t\t\t\t\t{{ captialize(part) }}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"seekPart(part, 1)\">&gt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t</d-fieldset>\n\t\t</template>\n\t\t<template v-slot:options>\n\t\t\t<toggle v-model=\"closeUp\" label=\"Close up?\" />\n\t\t</template>\n\t</object-tool>\n</template>\n\n<script lang=\"ts\">\nimport {\n\tgetData,\n\tgetParts,\n\tISeekPoseAction,\n\tISeekPosePartAction,\n\tICharacter,\n\tISeekStyleAction,\n} from '@/store/objectTypes/characters';\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport Parts from './character/parts.vue';\nimport { Character } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport { PanelMixin } from './panelMixin';\nimport { DeepReadonly } from '@/util/readonly';\nimport { defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\nimport ObjectTool from './object-tool.vue';\n\nconst setable = genericSetable<ICharacter>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tParts,\n\t\tDFieldset,\n\t\tObjectTool,\n\t},\n\tdata: () => ({\n\t\tpanelForParts: null as string | null,\n\t}),\n\tcomputed: {\n\t\tflip: setable('flip', 'objects/setFlip'),\n\t\tcloseUp: setable('close', 'objects/setClose'),\n\t\tselection(): string {\n\t\t\treturn this.$store.state.ui.selection!;\n\t\t},\n\t\tobject(): DeepReadonly<ICharacter> {\n\t\t\tconst obj = this.$store.state.objects.objects[this.selection];\n\t\t\tif (obj.type !== 'character') return undefined!;\n\t\t\treturn obj as ICharacter;\n\t\t},\n\t\tcharData(): DeepReadonly<Character<IAsset>> {\n\t\t\treturn getData(this.$store, this.object);\n\t\t},\n\t\tlabel(): string {\n\t\t\treturn this.charData.label || '';\n\t\t},\n\t\tparts(): DeepReadonly<string[]> {\n\t\t\treturn getParts(this.charData, this.object);\n\t\t},\n\t\thasMultipleStyles(): boolean {\n\t\t\treturn (\n\t\t\t\tthis.charData.styleGroups[this.object.styleGroupId].styles.length > 1 ||\n\t\t\t\tthis.charData.styleGroups.length > 1\n\t\t\t);\n\t\t},\n\t\thasMultiplePoses(): boolean {\n\t\t\tconst styleGroup = this.charData.styleGroups[this.object.styleGroupId];\n\t\t\tconst style = styleGroup.styles[this.object.styleId];\n\t\t\treturn style.poses.length > 1;\n\t\t},\n\t},\n\tmethods: {\n\t\tseekPose(delta: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/seekPose', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tdelta,\n\t\t\t\t} as ISeekPoseAction);\n\t\t\t});\n\t\t},\n\t\tseekStyle(delta: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/seekStyle', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tdelta,\n\t\t\t\t} as ISeekStyleAction);\n\t\t\t});\n\t\t},\n\t\tseekPart(part: string, delta: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/seekPart', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tdelta,\n\t\t\t\t\tpart,\n\t\t\t\t} as ISeekPosePartAction);\n\t\t\t});\n\t\t},\n\t\tcaptialize(str: string) {\n\t\t\treturn str.charAt(0).toUpperCase() + str.substring(1);\n\t\t},\n\t},\n\twatch: {\n\t\tselection() {\n\t\t\tthis.panelForParts = null;\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\nfieldset {\n\ttable {\n\t\twidth: 100%;\n\t}\n}\n\n.panel:not(.vertical) {\n\tfieldset {\n\t\tmax-height: 100%;\n\t\toverflow: auto;\n\t}\n}\n\n.panel.vertical {\n\tfieldset {\n\t\tinput {\n\t\t\twidth: 60px;\n\t\t}\n\t}\n}\n\n.middle-button {\n\twidth: 100%;\n}\n\n.arrow-col {\n\twidth: 24px;\n\n\tbutton {\n\t\twidth: 24px;\n\t}\n}\n</style>\n","<template>\n\t<d-flow no-wraping>\n\t\t<button @click=\"$emit('leave')\">Back</button>\n\t\t<button\n\t\t\t@click=\"\n\t\t\t\t$emit('show-expression-dialog', { character: character.characterType })\n\t\t\t\"\n\t\t\tv-if=\"part === 'head'\"\n\t\t\tclass=\"icon-button\"\n\t\t>\n\t\t\t<i class=\"material-icons\">extension</i>\n\t\t\t<span class=\"text-block\">Create new expressions</span>\n\t\t</button>\n\t\t<button\n\t\t\t@click=\"\n\t\t\t\t$emit('show-dialog', 'type: Expressions character: ' + charData.label)\n\t\t\t\"\n\t\t\tv-if=\"part === 'head'\"\n\t\t\tclass=\"icon-button\"\n\t\t>\n\t\t\t<i class=\"material-icons\">extension</i>\n\t\t\t<span class=\"text-block\">Search in content packs</span>\n\t\t</button>\n\t\t<button\n\t\t\t@click=\"$emit('show-dialog', 'type: Styles character: ' + charData.label)\"\n\t\t\tv-else-if=\"part === 'style'\"\n\t\t\tclass=\"icon-button\"\n\t\t>\n\t\t\t<i class=\"material-icons\">extension</i>\n\t\t\t<span>Search in content packs</span>\n\t\t</button>\n\t\t<button\n\t\t\t@click=\"$emit('show-dialog', 'type: Poses character: ' + charData.label)\"\n\t\t\tv-else\n\t\t\tclass=\"icon-button\"\n\t\t>\n\t\t\t<i class=\"material-icons\">extension</i>\n\t\t\t<span>Search in content packs</span>\n\t\t</button>\n\t\t<part-button\n\t\t\tv-for=\"(part, index) of parts\"\n\t\t\t:key=\"index\"\n\t\t\t:value=\"index\"\n\t\t\t:part=\"part\"\n\t\t\t@click=\"\n\t\t\t\tchoose(index);\n\t\t\t\t$emit('leave');\n\t\t\t\"\n\t\t/>\n\t\t<d-fieldset\n\t\t\tv-for=\"styleComponent of styleComponents\"\n\t\t\t:key=\"styleComponent.name\"\n\t\t\t:title=\"styleComponent.label\"\n\t\t>\n\t\t\t<d-flow noWraping>\n\t\t\t\t<part-button\n\t\t\t\t\tv-for=\"(button, id) of styleComponent.buttons\"\n\t\t\t\t\t:size=\"130\"\n\t\t\t\t\t:key=\"id\"\n\t\t\t\t\t:value=\"id\"\n\t\t\t\t\t:part=\"button\"\n\t\t\t\t\t@click=\"choose_component(styleComponent.name, id)\"\n\t\t\t\t/>\n\t\t\t</d-flow>\n\t\t</d-fieldset>\n\t</d-flow>\n</template>\n\n<script lang=\"ts\">\nimport { isWebPSupported } from '@/asset-manager';\nimport PartButton, { IPartButtonImage, IPartImage } from './partButton.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport {\n\tPose,\n\tCharacter,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport {\n\tgetPose,\n\tISetPosePositionMutation,\n\tISetPartAction,\n\tgetData,\n\tICharacter,\n\tISetStyleAction,\n} from '@/store/objectTypes/characters';\nimport { DeepReadonly } from '@/util/readonly';\nimport { defineComponent, PropType } from 'vue';\n\ninterface IPartStyleGroup {\n\tlabel: string;\n\tname: string;\n\tbuttons: { [id: string]: IPartButtonImage };\n}\n\nexport default defineComponent({\n\tcomponents: { PartButton, DFieldset, DFlow },\n\tprops: {\n\t\tcharacter: {\n\t\t\ttype: Object as PropType<ICharacter>,\n\t\t\trequired: true,\n\t\t},\n\t\tpart: {\n\t\t\trequired: true,\n\t\t\ttype: String as PropType<string | 'pose' | 'style'>,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tisWebPSupported: null as boolean | null,\n\t\t/**\n\t\t * [styleComponentKey, styleComponentValue]\n\t\t */\n\t\tstylePriorities: [] as Array<[string, string]>,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tstyleComponents(): DeepReadonly<IPartStyleGroup[]> {\n\t\t\tif (this.part !== 'style') return [];\n\t\t\tconst styleComponents = this.charData.styleGroups[\n\t\t\t\tthis.character.styleGroupId\n\t\t\t];\n\t\t\treturn styleComponents.styleComponents.map(component => {\n\t\t\t\tconst buttons: IPartStyleGroup['buttons'] = {};\n\t\t\t\tfor (const key in component.variants) {\n\t\t\t\t\t// eslint-disable-next-line no-prototype-builtins\n\t\t\t\t\tif (!component.variants.hasOwnProperty(key)) continue;\n\t\t\t\t\tconst variant = component.variants[key];\n\t\t\t\t\tbuttons[key] = {\n\t\t\t\t\t\tsize: styleComponents.styles[0].poses[0].size,\n\t\t\t\t\t\toffset: [0, 0],\n\t\t\t\t\t\timages: [{ offset: [0, 0], asset: variant }],\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn { label: component.label, name: component.id, buttons };\n\t\t\t});\n\t\t},\n\t\tparts(): { [id: number]: DeepReadonly<IPartButtonImage> } {\n\t\t\tconst ret: { [id: string]: DeepReadonly<IPartButtonImage> } = {};\n\t\t\tlet collection: DeepReadonly<IAsset[][]>;\n\t\t\tlet offset: DeepReadonly<IPartButtonImage['offset']>;\n\t\t\tlet size: DeepReadonly<IPartButtonImage['size']>;\n\t\t\tconst data = this.charData;\n\t\t\tconst currentPose = getPose(data, this.character);\n\t\t\tswitch (this.part) {\n\t\t\t\tcase 'head':\n\t\t\t\t\tfor (\n\t\t\t\t\t\tlet headKeyIdx = 0;\n\t\t\t\t\t\theadKeyIdx < currentPose.compatibleHeads.length;\n\t\t\t\t\t\t++headKeyIdx\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst headKey = currentPose.compatibleHeads[headKeyIdx];\n\t\t\t\t\t\tconst heads = data.heads[headKey];\n\t\t\t\t\t\tfor (let headIdx = 0; headIdx < heads.variants.length; ++headIdx) {\n\t\t\t\t\t\t\tconst headImages = heads.variants[headIdx];\n\t\t\t\t\t\t\tret[`${headKeyIdx}_${headIdx}`] = {\n\t\t\t\t\t\t\t\tsize: heads.previewSize,\n\t\t\t\t\t\t\t\toffset: heads.previewOffset,\n\t\t\t\t\t\t\t\timages: headImages.map(\n\t\t\t\t\t\t\t\t\t(image): IPartImage => ({ asset: image, offset: [0, 0] })\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\t\t\t\tcase 'pose':\n\t\t\t\t\t// eslint-disable-next-line no-case-declarations\n\t\t\t\t\tconst currentStyle =\n\t\t\t\t\t\tdata.styleGroups[this.character.styleGroupId].styles[\n\t\t\t\t\t\t\tthis.character.styleId\n\t\t\t\t\t\t];\n\t\t\t\t\tfor (\n\t\t\t\t\t\tlet poseIdx = 0;\n\t\t\t\t\t\tposeIdx < currentStyle.poses.length;\n\t\t\t\t\t\t++poseIdx\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst pose = currentStyle.poses[poseIdx];\n\t\t\t\t\t\tret[poseIdx] = this.generatePosePreview(pose);\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\t\t\t\tcase 'style':\n\t\t\t\t\tfor (const styleGroup of data.styleGroups) {\n\t\t\t\t\t\tret[styleGroup.id] = this.generatePosePreview(\n\t\t\t\t\t\t\tstyleGroup.styles[0].poses[0]\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\n\t\t\t\tdefault:\n\t\t\t\t\tcollection = currentPose.positions[this.part];\n\t\t\t\t\tsize = currentPose.previewSize;\n\t\t\t\t\toffset = currentPose.previewOffset;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tfor (let partIdx = 0; partIdx < collection.length; ++partIdx) {\n\t\t\t\tconst part = collection[partIdx];\n\t\t\t\tret[partIdx] = {\n\t\t\t\t\timages: part.map((partImage: IAsset) => ({\n\t\t\t\t\t\toffset: [0, 0],\n\t\t\t\t\t\tasset: partImage,\n\t\t\t\t\t})),\n\t\t\t\t\tsize,\n\t\t\t\t\toffset,\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\t\tcharData(): DeepReadonly<Character<IAsset>> {\n\t\t\treturn getData(this.$store, this.character);\n\t\t},\n\t},\n\tmethods: {\n\t\tupdateStyleData(): void {\n\t\t\tconst baseStyle = this.charData.styleGroups[this.character.styleGroupId]\n\t\t\t\t.styles[this.character.styleId];\n\t\t\tthis.stylePriorities = Object.keys(baseStyle.components).map(key => [\n\t\t\t\tkey,\n\t\t\t\tbaseStyle.components[key],\n\t\t\t]);\n\t\t},\n\t\tgeneratePosePreview(\n\t\t\tpose: DeepReadonly<Pose<IAsset>>\n\t\t): DeepReadonly<IPartButtonImage> {\n\t\t\tconst data = this.charData;\n\t\t\tconst heads = data.heads[pose.compatibleHeads[0]];\n\t\t\tconst head = heads ? heads.variants[0] : null;\n\t\t\tlet images: IAsset[] = [];\n\n\t\t\tfor (const command of pose.renderCommands) {\n\t\t\t\tswitch (command.type) {\n\t\t\t\t\tcase 'pose-part':\n\t\t\t\t\t\t// eslint-disable-next-line no-case-declarations\n\t\t\t\t\t\tconst part = pose.positions[command.part];\n\t\t\t\t\t\tif (!part || part.length === 0) break;\n\t\t\t\t\t\timages = images.concat(part[0] as IAsset[]);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'head':\n\t\t\t\t\t\tif (head) images = images.concat(head);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'image':\n\t\t\t\t\t\timages = images.concat(command.images);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\timages: images.map(image => ({ asset: image, offset: [0, 0] })),\n\t\t\t\tsize: pose.previewSize,\n\t\t\t\toffset: pose.previewOffset,\n\t\t\t};\n\t\t},\n\t\tupdatePose(styleGroupId?: number) {\n\t\t\tif (styleGroupId === undefined)\n\t\t\t\tstyleGroupId = this.character.styleGroupId;\n\n\t\t\tconst data = this.charData;\n\t\t\tconst styleGroups = data.styleGroups[styleGroupId];\n\t\t\tlet selection = styleGroups.styles;\n\t\t\tfor (const priority of this.stylePriorities) {\n\t\t\t\tconst subSelect = selection.filter(style => {\n\t\t\t\t\treturn style.components[priority[0]] === priority[1];\n\t\t\t\t});\n\t\t\t\tif (subSelect.length > 0) selection = subSelect;\n\t\t\t}\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/setCharStyle', {\n\t\t\t\t\tid: this.character.id,\n\t\t\t\t\tstyleGroupId,\n\t\t\t\t\tstyleId: styleGroups.styles.indexOf(selection[0]),\n\t\t\t\t} as ISetStyleAction);\n\t\t\t});\n\t\t},\n\t\tchoose(index: string) {\n\t\t\tif (this.part === 'style') {\n\t\t\t\tthis.updatePose(\n\t\t\t\t\tthis.charData.styleGroups.findIndex(group => group.id === index)\n\t\t\t\t);\n\t\t\t} else if (this.part === 'head') {\n\t\t\t\tconst [headTypeIdx, headIdx] = index\n\t\t\t\t\t.split('_', 2)\n\t\t\t\t\t.map(part => parseInt(part, 10));\n\t\t\t\tthis.$store.commit('objects/setPosePosition', {\n\t\t\t\t\tid: this.character.id,\n\t\t\t\t\tposePositions: {\n\t\t\t\t\t\theadType: headTypeIdx,\n\t\t\t\t\t\thead: headIdx,\n\t\t\t\t\t},\n\t\t\t\t} as ISetPosePositionMutation);\n\t\t\t} else {\n\t\t\t\tthis.setPart(this.part, parseInt(index, 10));\n\t\t\t}\n\t\t},\n\t\t// eslint-disable-next-line @typescript-eslint/camelcase\n\t\tchoose_component(component: string, id: string) {\n\t\t\tconst prioIdx = this.stylePriorities.findIndex(\n\t\t\t\tstylePriority => stylePriority[0] === component\n\t\t\t);\n\t\t\tthis.stylePriorities.splice(prioIdx, 1);\n\t\t\tthis.stylePriorities.unshift([component, id]);\n\t\t\tthis.updatePose();\n\t\t},\n\t\tsetPart(part: ISetPartAction['part'], index: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/setPart', {\n\t\t\t\t\tid: this.character.id,\n\t\t\t\t\tpart,\n\t\t\t\t\tval: index,\n\t\t\t\t} as ISetPartAction);\n\t\t\t});\n\t\t},\n\t},\n\tasync created() {\n\t\tthis.updateStyleData();\n\t\tthis.isWebPSupported = await isWebPSupported();\n\t},\n\twatch: {\n\t\tcharacter() {\n\t\t\tthis.updateStyleData();\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.icon-button {\n\tvertical-align: middle;\n\twidth: 100px;\n}\n</style>\n","<template>\n\t<div\n\t\t:class=\"{ part: true, active: false /*background === value*/ }\"\n\t\t:style=\"style\"\n\t\t@click=\"$emit('click')\"\n\t></div>\n</template>\n\n<script lang=\"ts\">\nimport { getAAsset, getAsset } from '@/asset-manager';\nimport { ErrorAsset } from '@/models/error-asset';\nimport { IAsset } from '@/store/content';\nimport { DeepReadonly } from '@/util/readonly';\nimport { defineComponent, Prop } from 'vue';\n\nexport interface IPartButtonImage {\n\timages: IPartImage[];\n\tsize: DeepReadonly<[number, number]>;\n\toffset: DeepReadonly<[number, number]>;\n}\n\nexport interface IPartImage {\n\tasset: IAsset | string;\n\toffset: DeepReadonly<[number, number]>;\n}\n\nconst spriteSize = 960;\n\nexport default defineComponent({\n\tprops: {\n\t\tpart: {\n\t\t\trequired: true,\n\t\t} as Prop<IPartButtonImage>,\n\t\tvalue: {\n\t\t\trequired: true,\n\t\t},\n\t\tsize: {\n\t\t\ttype: Number,\n\t\t\tdefault: 150,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tlookups: [] as Array<HTMLImageElement | ErrorAsset | null>,\n\t\tloaded: false,\n\t}),\n\tcomputed: {\n\t\tscaleX(): number {\n\t\t\treturn this.size / this.part!.size[0];\n\t\t},\n\t\tscaleY(): number {\n\t\t\treturn this.size / this.part!.size[1];\n\t\t},\n\t\tbackgroundSize(): string {\n\t\t\treturn `${Math.floor(spriteSize * this.scaleX)}px ${Math.floor(\n\t\t\t\tspriteSize * this.scaleY\n\t\t\t)}px`;\n\t\t},\n\t\tbackgroundPosition(): string {\n\t\t\treturn (\n\t\t\t\t`${Math.floor(this.part!.offset[0] * -this.scaleX)}px ` +\n\t\t\t\t`${Math.floor(this.part!.offset[1] * -this.scaleY)}px`\n\t\t\t);\n\t\t},\n\t\tstyle(): { [id: string]: string } {\n\t\t\tconst images = (this.lookups.filter(\n\t\t\t\tlookup => lookup instanceof HTMLImageElement\n\t\t\t) as HTMLImageElement[]).map(\n\t\t\t\tlookup => `url('${lookup.src.replace(\"'\", \"\\\\'\")}')`\n\t\t\t);\n\t\t\treturn {\n\t\t\t\tbackgroundImage: images.join(','),\n\t\t\t\theight: this.size + 'px',\n\t\t\t\twidth: this.size + 'px',\n\t\t\t\tbackgroundPosition: this.backgroundPosition,\n\t\t\t\tbackgroundSize: this.backgroundSize,\n\t\t\t};\n\t\t},\n\t},\n\tasync created() {\n\t\tthis.lookups = await Promise.all(\n\t\t\tthis.part!.images.map(image => {\n\t\t\t\tif (typeof image.asset === 'string') {\n\t\t\t\t\treturn getAsset(image.asset, false);\n\t\t\t\t} else {\n\t\t\t\t\treturn getAAsset(image.asset, false);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.part {\n\tmargin-top: 4px;\n\ttext-shadow: 0 0 2px black;\n\tcolor: white;\n\tbox-shadow: inset 0 0 1px 3px $default-modal-backdrop;\n\tbox-shadow: inset 0 0 1px 3px var(--modal-backdrop);\n\ttext-align: center;\n\tuser-select: none;\n\tvertical-align: middle;\n\n\t&.active {\n\t\tbox-shadow: inset 0 0 1px 3px $default-modal-backdrop-light;\n\t\tbox-shadow: inset 0 0 1px 3px var(--modal-backdrop-light);\n\t}\n}\n\n.partList:not(.vertical) .part {\n\tdisplay: inline-block;\n}\n\n.partList.vertical .part {\n\tdisplay: block;\n}\n</style>\n","\nimport { getAAsset, getAsset } from '@/asset-manager';\nimport { ErrorAsset } from '@/models/error-asset';\nimport { IAsset } from '@/store/content';\nimport { DeepReadonly } from '@/util/readonly';\nimport { defineComponent, Prop } from 'vue';\n\nexport interface IPartButtonImage {\n\timages: IPartImage[];\n\tsize: DeepReadonly<[number, number]>;\n\toffset: DeepReadonly<[number, number]>;\n}\n\nexport interface IPartImage {\n\tasset: IAsset | string;\n\toffset: DeepReadonly<[number, number]>;\n}\n\nconst spriteSize = 960;\n\nexport default defineComponent({\n\tprops: {\n\t\tpart: {\n\t\t\trequired: true,\n\t\t} as Prop<IPartButtonImage>,\n\t\tvalue: {\n\t\t\trequired: true,\n\t\t},\n\t\tsize: {\n\t\t\ttype: Number,\n\t\t\tdefault: 150,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tlookups: [] as Array<HTMLImageElement | ErrorAsset | null>,\n\t\tloaded: false,\n\t}),\n\tcomputed: {\n\t\tscaleX(): number {\n\t\t\treturn this.size / this.part!.size[0];\n\t\t},\n\t\tscaleY(): number {\n\t\t\treturn this.size / this.part!.size[1];\n\t\t},\n\t\tbackgroundSize(): string {\n\t\t\treturn `${Math.floor(spriteSize * this.scaleX)}px ${Math.floor(\n\t\t\t\tspriteSize * this.scaleY\n\t\t\t)}px`;\n\t\t},\n\t\tbackgroundPosition(): string {\n\t\t\treturn (\n\t\t\t\t`${Math.floor(this.part!.offset[0] * -this.scaleX)}px ` +\n\t\t\t\t`${Math.floor(this.part!.offset[1] * -this.scaleY)}px`\n\t\t\t);\n\t\t},\n\t\tstyle(): { [id: string]: string } {\n\t\t\tconst images = (this.lookups.filter(\n\t\t\t\tlookup => lookup instanceof HTMLImageElement\n\t\t\t) as HTMLImageElement[]).map(\n\t\t\t\tlookup => `url('${lookup.src.replace(\"'\", \"\\\\'\")}')`\n\t\t\t);\n\t\t\treturn {\n\t\t\t\tbackgroundImage: images.join(','),\n\t\t\t\theight: this.size + 'px',\n\t\t\t\twidth: this.size + 'px',\n\t\t\t\tbackgroundPosition: this.backgroundPosition,\n\t\t\t\tbackgroundSize: this.backgroundSize,\n\t\t\t};\n\t\t},\n\t},\n\tasync created() {\n\t\tthis.lookups = await Promise.all(\n\t\t\tthis.part!.images.map(image => {\n\t\t\t\tif (typeof image.asset === 'string') {\n\t\t\t\t\treturn getAsset(image.asset, false);\n\t\t\t\t} else {\n\t\t\t\t\treturn getAAsset(image.asset, false);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t},\n});\n","import { render } from \"./partButton.vue?vue&type=template&id=7d67a652&scoped=true\"\nimport script from \"./partButton.vue?vue&type=script&lang=ts\"\nexport * from \"./partButton.vue?vue&type=script&lang=ts\"\n\nimport \"./partButton.vue?vue&type=style&index=0&id=7d67a652&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-7d67a652\"\n\nexport default script","\nimport { defineComponent, h, Prop, PropType, VNode } from 'vue';\nimport { VerticalScrollRedirect } from '../vertical-scroll-redirect';\nexport default defineComponent({\n\tmixins: [VerticalScrollRedirect],\n\tprops: {\n\t\t/**\n\t\t * Indicates whether or not line-breaks are allowed. Otherwise all elements automatically get the maximum\n\t\t * width/hight (depending on direction)\n\t\t */\n\t\tnoWraping: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tdirection: {\n\t\t\ttype: String as PropType<\n\t\t\t\t'global' | 'inverted' | 'horizontal' | 'vertical'\n\t\t\t>,\n\t\t\tdefault: 'global',\n\t\t},\n\t\tmaxSize: {} as Prop<string | [string, string]>,\n\t\tgap: {\n\t\t\ttype: String,\n\t\t\tdefault: '0px',\n\t\t},\n\t},\n\tcomputed: {\n\t\tfinalDirection(): 'horizontal' | 'vertical' {\n\t\t\tif (this.direction === 'global') {\n\t\t\t\treturn this.$store.state.ui.vertical ? 'vertical' : 'horizontal';\n\t\t\t}\n\t\t\tif (this.direction === 'inverted') {\n\t\t\t\treturn this.$store.state.ui.vertical ? 'horizontal' : 'vertical';\n\t\t\t}\n\t\t\treturn this.direction;\n\t\t},\n\t},\n\trender(): VNode {\n\t\tconst wrapingClass = this.noWraping ? 'no-wraping' : 'wraping';\n\t\tconst attrs: { [s: string]: any } = {};\n\t\tconst flowContainer = h(\n\t\t\t'div',\n\t\t\t{\n\t\t\t\t...attrs,\n\t\t\t\tclass: ['d-flow', this.finalDirection, wrapingClass],\n\t\t\t\tstyle: {\n\t\t\t\t\tgap: this.gap,\n\t\t\t\t},\n\t\t\t},\n\t\t\tthis.$slots.default!()\n\t\t);\n\t\tif (this.maxSize) {\n\t\t\tconst maxSize =\n\t\t\t\tthis.maxSize instanceof Array\n\t\t\t\t\t? this.maxSize[this.finalDirection === 'horizontal' ? 0 : 1]\n\t\t\t\t\t: this.maxSize;\n\t\t\treturn h(\n\t\t\t\t'div',\n\t\t\t\t{\n\t\t\t\t\tref: 'scrollContainer',\n\t\t\t\t\tclass: ['d-flow-scroll-container', this.finalDirection],\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\t[this.finalDirection === 'horizontal'\n\t\t\t\t\t\t\t? 'maxWidth'\n\t\t\t\t\t\t\t: 'maxHeight']: maxSize,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t[flowContainer]\n\t\t\t);\n\t\t}\n\t\treturn flowContainer;\n\t},\n\tmounted() {\n\t\tif (this.$refs.scrollContainer) {\n\t\t\t(this.$refs.scrollContainer as HTMLDivElement).addEventListener(\n\t\t\t\t'wheel',\n\t\t\t\t(this as any).verticalScrollRedirect\n\t\t\t);\n\t\t}\n\t},\n});\n","import script from \"./d-flow.vue?vue&type=script&lang=ts\"\nexport * from \"./d-flow.vue?vue&type=script&lang=ts\"\n\nimport \"./d-flow.vue?vue&type=style&index=0&id=64adfc9c&lang=scss&scoped=true\"\nscript.__scopeId = \"data-v-64adfc9c\"\n\nexport default script","\nimport { isWebPSupported } from '@/asset-manager';\nimport PartButton, { IPartButtonImage, IPartImage } from './partButton.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport {\n\tPose,\n\tCharacter,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport {\n\tgetPose,\n\tISetPosePositionMutation,\n\tISetPartAction,\n\tgetData,\n\tICharacter,\n\tISetStyleAction,\n} from '@/store/objectTypes/characters';\nimport { DeepReadonly } from '@/util/readonly';\nimport { defineComponent, PropType } from 'vue';\n\ninterface IPartStyleGroup {\n\tlabel: string;\n\tname: string;\n\tbuttons: { [id: string]: IPartButtonImage };\n}\n\nexport default defineComponent({\n\tcomponents: { PartButton, DFieldset, DFlow },\n\tprops: {\n\t\tcharacter: {\n\t\t\ttype: Object as PropType<ICharacter>,\n\t\t\trequired: true,\n\t\t},\n\t\tpart: {\n\t\t\trequired: true,\n\t\t\ttype: String as PropType<string | 'pose' | 'style'>,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tisWebPSupported: null as boolean | null,\n\t\t/**\n\t\t * [styleComponentKey, styleComponentValue]\n\t\t */\n\t\tstylePriorities: [] as Array<[string, string]>,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tstyleComponents(): DeepReadonly<IPartStyleGroup[]> {\n\t\t\tif (this.part !== 'style') return [];\n\t\t\tconst styleComponents = this.charData.styleGroups[\n\t\t\t\tthis.character.styleGroupId\n\t\t\t];\n\t\t\treturn styleComponents.styleComponents.map(component => {\n\t\t\t\tconst buttons: IPartStyleGroup['buttons'] = {};\n\t\t\t\tfor (const key in component.variants) {\n\t\t\t\t\t// eslint-disable-next-line no-prototype-builtins\n\t\t\t\t\tif (!component.variants.hasOwnProperty(key)) continue;\n\t\t\t\t\tconst variant = component.variants[key];\n\t\t\t\t\tbuttons[key] = {\n\t\t\t\t\t\tsize: styleComponents.styles[0].poses[0].size,\n\t\t\t\t\t\toffset: [0, 0],\n\t\t\t\t\t\timages: [{ offset: [0, 0], asset: variant }],\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn { label: component.label, name: component.id, buttons };\n\t\t\t});\n\t\t},\n\t\tparts(): { [id: number]: DeepReadonly<IPartButtonImage> } {\n\t\t\tconst ret: { [id: string]: DeepReadonly<IPartButtonImage> } = {};\n\t\t\tlet collection: DeepReadonly<IAsset[][]>;\n\t\t\tlet offset: DeepReadonly<IPartButtonImage['offset']>;\n\t\t\tlet size: DeepReadonly<IPartButtonImage['size']>;\n\t\t\tconst data = this.charData;\n\t\t\tconst currentPose = getPose(data, this.character);\n\t\t\tswitch (this.part) {\n\t\t\t\tcase 'head':\n\t\t\t\t\tfor (\n\t\t\t\t\t\tlet headKeyIdx = 0;\n\t\t\t\t\t\theadKeyIdx < currentPose.compatibleHeads.length;\n\t\t\t\t\t\t++headKeyIdx\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst headKey = currentPose.compatibleHeads[headKeyIdx];\n\t\t\t\t\t\tconst heads = data.heads[headKey];\n\t\t\t\t\t\tfor (let headIdx = 0; headIdx < heads.variants.length; ++headIdx) {\n\t\t\t\t\t\t\tconst headImages = heads.variants[headIdx];\n\t\t\t\t\t\t\tret[`${headKeyIdx}_${headIdx}`] = {\n\t\t\t\t\t\t\t\tsize: heads.previewSize,\n\t\t\t\t\t\t\t\toffset: heads.previewOffset,\n\t\t\t\t\t\t\t\timages: headImages.map(\n\t\t\t\t\t\t\t\t\t(image): IPartImage => ({ asset: image, offset: [0, 0] })\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\t\t\t\tcase 'pose':\n\t\t\t\t\t// eslint-disable-next-line no-case-declarations\n\t\t\t\t\tconst currentStyle =\n\t\t\t\t\t\tdata.styleGroups[this.character.styleGroupId].styles[\n\t\t\t\t\t\t\tthis.character.styleId\n\t\t\t\t\t\t];\n\t\t\t\t\tfor (\n\t\t\t\t\t\tlet poseIdx = 0;\n\t\t\t\t\t\tposeIdx < currentStyle.poses.length;\n\t\t\t\t\t\t++poseIdx\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst pose = currentStyle.poses[poseIdx];\n\t\t\t\t\t\tret[poseIdx] = this.generatePosePreview(pose);\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\t\t\t\tcase 'style':\n\t\t\t\t\tfor (const styleGroup of data.styleGroups) {\n\t\t\t\t\t\tret[styleGroup.id] = this.generatePosePreview(\n\t\t\t\t\t\t\tstyleGroup.styles[0].poses[0]\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\n\t\t\t\tdefault:\n\t\t\t\t\tcollection = currentPose.positions[this.part];\n\t\t\t\t\tsize = currentPose.previewSize;\n\t\t\t\t\toffset = currentPose.previewOffset;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tfor (let partIdx = 0; partIdx < collection.length; ++partIdx) {\n\t\t\t\tconst part = collection[partIdx];\n\t\t\t\tret[partIdx] = {\n\t\t\t\t\timages: part.map((partImage: IAsset) => ({\n\t\t\t\t\t\toffset: [0, 0],\n\t\t\t\t\t\tasset: partImage,\n\t\t\t\t\t})),\n\t\t\t\t\tsize,\n\t\t\t\t\toffset,\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\t\tcharData(): DeepReadonly<Character<IAsset>> {\n\t\t\treturn getData(this.$store, this.character);\n\t\t},\n\t},\n\tmethods: {\n\t\tupdateStyleData(): void {\n\t\t\tconst baseStyle = this.charData.styleGroups[this.character.styleGroupId]\n\t\t\t\t.styles[this.character.styleId];\n\t\t\tthis.stylePriorities = Object.keys(baseStyle.components).map(key => [\n\t\t\t\tkey,\n\t\t\t\tbaseStyle.components[key],\n\t\t\t]);\n\t\t},\n\t\tgeneratePosePreview(\n\t\t\tpose: DeepReadonly<Pose<IAsset>>\n\t\t): DeepReadonly<IPartButtonImage> {\n\t\t\tconst data = this.charData;\n\t\t\tconst heads = data.heads[pose.compatibleHeads[0]];\n\t\t\tconst head = heads ? heads.variants[0] : null;\n\t\t\tlet images: IAsset[] = [];\n\n\t\t\tfor (const command of pose.renderCommands) {\n\t\t\t\tswitch (command.type) {\n\t\t\t\t\tcase 'pose-part':\n\t\t\t\t\t\t// eslint-disable-next-line no-case-declarations\n\t\t\t\t\t\tconst part = pose.positions[command.part];\n\t\t\t\t\t\tif (!part || part.length === 0) break;\n\t\t\t\t\t\timages = images.concat(part[0] as IAsset[]);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'head':\n\t\t\t\t\t\tif (head) images = images.concat(head);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'image':\n\t\t\t\t\t\timages = images.concat(command.images);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\timages: images.map(image => ({ asset: image, offset: [0, 0] })),\n\t\t\t\tsize: pose.previewSize,\n\t\t\t\toffset: pose.previewOffset,\n\t\t\t};\n\t\t},\n\t\tupdatePose(styleGroupId?: number) {\n\t\t\tif (styleGroupId === undefined)\n\t\t\t\tstyleGroupId = this.character.styleGroupId;\n\n\t\t\tconst data = this.charData;\n\t\t\tconst styleGroups = data.styleGroups[styleGroupId];\n\t\t\tlet selection = styleGroups.styles;\n\t\t\tfor (const priority of this.stylePriorities) {\n\t\t\t\tconst subSelect = selection.filter(style => {\n\t\t\t\t\treturn style.components[priority[0]] === priority[1];\n\t\t\t\t});\n\t\t\t\tif (subSelect.length > 0) selection = subSelect;\n\t\t\t}\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/setCharStyle', {\n\t\t\t\t\tid: this.character.id,\n\t\t\t\t\tstyleGroupId,\n\t\t\t\t\tstyleId: styleGroups.styles.indexOf(selection[0]),\n\t\t\t\t} as ISetStyleAction);\n\t\t\t});\n\t\t},\n\t\tchoose(index: string) {\n\t\t\tif (this.part === 'style') {\n\t\t\t\tthis.updatePose(\n\t\t\t\t\tthis.charData.styleGroups.findIndex(group => group.id === index)\n\t\t\t\t);\n\t\t\t} else if (this.part === 'head') {\n\t\t\t\tconst [headTypeIdx, headIdx] = index\n\t\t\t\t\t.split('_', 2)\n\t\t\t\t\t.map(part => parseInt(part, 10));\n\t\t\t\tthis.$store.commit('objects/setPosePosition', {\n\t\t\t\t\tid: this.character.id,\n\t\t\t\t\tposePositions: {\n\t\t\t\t\t\theadType: headTypeIdx,\n\t\t\t\t\t\thead: headIdx,\n\t\t\t\t\t},\n\t\t\t\t} as ISetPosePositionMutation);\n\t\t\t} else {\n\t\t\t\tthis.setPart(this.part, parseInt(index, 10));\n\t\t\t}\n\t\t},\n\t\t// eslint-disable-next-line @typescript-eslint/camelcase\n\t\tchoose_component(component: string, id: string) {\n\t\t\tconst prioIdx = this.stylePriorities.findIndex(\n\t\t\t\tstylePriority => stylePriority[0] === component\n\t\t\t);\n\t\t\tthis.stylePriorities.splice(prioIdx, 1);\n\t\t\tthis.stylePriorities.unshift([component, id]);\n\t\t\tthis.updatePose();\n\t\t},\n\t\tsetPart(part: ISetPartAction['part'], index: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/setPart', {\n\t\t\t\t\tid: this.character.id,\n\t\t\t\t\tpart,\n\t\t\t\t\tval: index,\n\t\t\t\t} as ISetPartAction);\n\t\t\t});\n\t\t},\n\t},\n\tasync created() {\n\t\tthis.updateStyleData();\n\t\tthis.isWebPSupported = await isWebPSupported();\n\t},\n\twatch: {\n\t\tcharacter() {\n\t\t\tthis.updateStyleData();\n\t\t},\n\t},\n});\n","import { render } from \"./parts.vue?vue&type=template&id=47f2e1e8&scoped=true\"\nimport script from \"./parts.vue?vue&type=script&lang=ts\"\nexport * from \"./parts.vue?vue&type=script&lang=ts\"\n\nimport \"./parts.vue?vue&type=style&index=0&id=47f2e1e8&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-47f2e1e8\"\n\nexport default script","import { IObject } from '@/store/objects';\r\nimport { ComponentCustomProperties } from 'vue';\r\n\r\nexport function genericSetable<T extends IObject>() {\r\n\treturn function setable<K extends keyof T>(\r\n\t\tkey: K,\r\n\t\tmessage: string,\r\n\t\taction = false\r\n\t) {\r\n\t\treturn {\r\n\t\t\tget(this: IThis<T>): T[K] {\r\n\t\t\t\treturn this.object[key];\r\n\t\t\t},\r\n\t\t\tset(this: IThis<T>, val: T[K]): void {\r\n\t\t\t\tthis.vuexHistory.transaction(() => {\r\n\t\t\t\t\tthis.$store[action ? 'dispatch' : 'commit'](message, {\r\n\t\t\t\t\t\tid: this.object.id,\r\n\t\t\t\t\t\t[key]: val,\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t};\r\n\t};\r\n}\r\n\r\ninterface IThis<T extends IObject> extends ComponentCustomProperties {\r\n\tobject: T;\r\n}\r\n","<template>\n\t<div class=\"panel\">\n\t\t<h1\n\t\t\t:style=\"{ fontStyle: hasLabel ? 'italic' : 'normal' }\"\n\t\t\t@click=\"enableNameEdit\"\n\t\t>\n\t\t\t{{ heading }}\n\t\t\t<span class=\"icon material-icons\">edit</span>\n\t\t</h1>\n\t\t<teleport to=\"#modal-messages\">\n\t\t\t<modal-dialog\n\t\t\t\t:options=\"['Apply', 'Cancel']\"\n\t\t\t\tno-base-size\n\t\t\t\tclass=\"modal-rename\"\n\t\t\t\tv-if=\"showRename\"\n\t\t\t\t@option=\"renameOption\"\n\t\t\t\t@leave=\"renameOption('Cancel')\"\n\t\t\t>\n\t\t\t\t<p class=\"modal-text\">\n\t\t\t\t\tEnter the new name\n\t\t\t\t</p>\n\t\t\t\t<p class=\"modal-text\">\n\t\t\t\t\t<input v-model=\"modalNameInput\" style=\"width: 100%\" />\n\t\t\t\t</p>\n\t\t\t</modal-dialog>\n\t\t</teleport>\n\t\t<text-editor\n\t\t\tv-if=\"textHandler\"\n\t\t\t:title=\"textHandler.title\"\n\t\t\t:modelValue=\"textHandler.get()\"\n\t\t\t@update:modelValue=\"textHandler.set($event)\"\n\t\t\t@leave=\"textHandler.leave()\"\n\t\t/>\n\t\t<color\n\t\t\tv-else-if=\"finalColorHandler\"\n\t\t\t:title=\"finalColorHandler.title\"\n\t\t\t:modelValue=\"finalColorHandler.get()\"\n\t\t\t@update:modelValue=\"finalColorHandler.set($event)\"\n\t\t\t@leave=\"finalColorHandler.leave()\"\n\t\t/>\n\t\t<image-options\n\t\t\tv-else-if=\"imageOptionsOpen\"\n\t\t\ttype=\"object\"\n\t\t\t:id=\"object.id\"\n\t\t\t@leave=\"imageOptionsOpen = false\"\n\t\t/>\n\t\t<slot v-else-if=\"showAltPanel\" name=\"alt-panel\" />\n\t\t<template v-else>\n\t\t\t<slot />\n\t\t\t<position-and-size :obj=\"object\" />\n\t\t\t<layers :object=\"object\" />\n\t\t\t<toggle v-model=\"flip\" label=\"Flip?\" />\n\t\t\t<table class=\"input-table\">\n\t\t\t\t<tr>\n\t\t\t\t\t<td><label for=\"rotation\">Rotation: °</label></td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"rotation\"\n\t\t\t\t\t\t\tclass=\"smol\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tv-model=\"rotation\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr v-if=\"object.type === 'character' || object.type === 'sprite'\">\n\t\t\t\t\t<td><label for=\"zoom\">Zoom: </label></td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"zoom\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tclass=\"smol\"\n\t\t\t\t\t\t\tstep=\"1\"\n\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\tv-model=\"zoom\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\n\t\t\t<slot name=\"options\" />\n\t\t\t<d-fieldset v-if=\"hasLabel\" title=\"Textbox settings\">\n\t\t\t\t<toggle\n\t\t\t\t\tlabel=\"Enlarge when talking\"\n\t\t\t\t\tv-model=\"enlargeWhenTalking\"\n\t\t\t\t\tv-if=\"object.type === 'character' || object.type === 'sprite'\"\n\t\t\t\t/>\n\t\t\t\t<toggle\n\t\t\t\t\tlabel=\"Use custom textbox color\"\n\t\t\t\t\tv-model=\"useCustomTextboxColor\"\n\t\t\t\t/>\n\t\t\t\t<table>\n\t\t\t\t\t<tr v-if=\"useCustomTextboxColor\">\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<label for=\"textbox_color\">Color:</label>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tid=\"textbox_color\"\n\t\t\t\t\t\t\t\tclass=\"color-button\"\n\t\t\t\t\t\t\t\t:style=\"{ background: object.textboxColor }\"\n\t\t\t\t\t\t\t\t@click=\"selectTextboxColor\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<label for=\"namebox_width\">Namebox width:</label>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tid=\"namebox_width\"\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t:placeholder=\"defaultNameboxWidth\"\n\t\t\t\t\t\t\t\tv-model.lazy=\"nameboxWidth\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t</d-fieldset>\n\t\t\t<button @click=\"imageOptionsOpen = true\">Image options</button>\n\t\t\t<button @click=\"copy\">Copy</button>\n\t\t\t<delete :obj=\"object\" />\n\t\t</template>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport PositionAndSize from '@/components/toolbox/commonsFieldsets/positionAndSize.vue';\nimport Layers from '@/components/toolbox/commonsFieldsets/layers.vue';\nimport Delete from '@/components/toolbox/commonsFieldsets/delete.vue';\nimport ImageOptions from '@/components/toolbox/subtools/image-options/image-options.vue';\nimport Color from '@/components/toolbox/subtools/color/color.vue';\nimport { PanelMixin } from './panelMixin';\nimport TextEditor from '../subtools/text/text.vue';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport { defineComponent, PropType } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\nimport {\n\tICopyObjectToClipboardAction,\n\tIObject,\n\tISetLabelMutation,\n\tISetNameboxWidthMutation,\n\tISetObjectZoomMutation,\n\tISetTextBoxColor,\n} from '@/store/objects';\nimport ModalDialog from '@/components/ModalDialog.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport getConstants from '@/constants';\n\nconst setable = genericSetable<IPoem>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tPositionAndSize,\n\t\tLayers,\n\t\tDelete,\n\t\tTextEditor,\n\t\tImageOptions,\n\t\tColor,\n\t\tModalDialog,\n\t\tDFieldset,\n\t},\n\tprops: {\n\t\tobject: {\n\t\t\ttype: Object as PropType<IObject>,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: String,\n\t\ttextHandler: {\n\t\t\ttype: Object as PropType<Handler>,\n\t\t},\n\t\tcolorHandler: {\n\t\t\ttype: Object as PropType<Handler>,\n\t\t},\n\t\tshowAltPanel: Boolean,\n\t},\n\tdata: () => ({\n\t\timageOptionsOpen: false,\n\t\tcanEdit: true,\n\t\tmodalNameInput: '',\n\t\tshowRename: false,\n\t\tlocalColorHandler: null as Handler | null,\n\t}),\n\tcomputed: {\n\t\tflip: setable('flip', 'objects/setFlip'),\n\t\trotation: setable('rotation', 'objects/setRotation'),\n\t\tenlargeWhenTalking: setable(\n\t\t\t'enlargeWhenTalking',\n\t\t\t'objects/setEnlargeWhenTalking'\n\t\t),\n\t\tnameboxWidth: {\n\t\t\tget(): string {\n\t\t\t\tconst val = this.object.nameboxWidth;\n\t\t\t\tif (val === null) return '';\n\t\t\t\treturn val + '';\n\t\t\t},\n\t\t\tset(value: string) {\n\t\t\t\tconst val = value.trim() === '' ? null : parseInt(value);\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tthis.$store.commit('objects/setObjectNameboxWidth', {\n\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\tnameboxWidth: val,\n\t\t\t\t\t} as ISetNameboxWidthMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tzoom: {\n\t\t\tget(): number {\n\t\t\t\treturn this.object.zoom * 100;\n\t\t\t},\n\t\t\tset(zoom: number): void {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tthis.$store.commit('objects/setObjectZoom', {\n\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\tzoom: zoom / 100,\n\t\t\t\t\t} as ISetObjectZoomMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tdefaultNameboxWidth(): number {\n\t\t\treturn getConstants().TextBox.NameboxWidth;\n\t\t},\n\t\tfinalColorHandler(): Handler | null {\n\t\t\treturn this.localColorHandler || this.colorHandler || null;\n\t\t},\n\t\thasLabel(): boolean {\n\t\t\treturn this.object.label !== null;\n\t\t},\n\t\theading(): string {\n\t\t\tconsole.log('heading', this.object.label, this.title, 'Object');\n\t\t\treturn this.object.label || this.title || 'Object';\n\t\t},\n\t\tuseCustomTextboxColor: {\n\t\t\tget(): boolean {\n\t\t\t\treturn this.object.textboxColor !== null;\n\t\t\t},\n\t\t\tset(val: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tthis.$store.commit('objects/setTextboxColor', {\n\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\ttextboxColor: val\n\t\t\t\t\t\t\t? getConstants().TextBoxCustom.textboxDefaultColor\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t} as ICopyObjectToClipboardAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t},\n\tmethods: {\n\t\tcopy() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/copyObjectToClipboard', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t} as ICopyObjectToClipboardAction);\n\t\t\t});\n\t\t},\n\t\tenableNameEdit() {\n\t\t\tthis.modalNameInput = this.object.label || '';\n\t\t\tthis.showRename = true;\n\t\t},\n\t\trenameOption(option: 'Apply' | 'Cancel') {\n\t\t\tthis.showRename = false;\n\t\t\tif (option === 'Apply') {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tthis.$store.commit('objects/setLabel', {\n\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\tlabel: this.modalNameInput,\n\t\t\t\t\t} as ISetLabelMutation);\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tselectTextboxColor() {\n\t\t\tthis.localColorHandler = {\n\t\t\t\ttitle: 'Textbox color',\n\t\t\t\tget: () => this.object.textboxColor,\n\t\t\t\tset: (color: string) => {\n\t\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\t\tthis.$store.commit('objects/setTextboxColor', {\n\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\ttextboxColor: color,\n\t\t\t\t\t\t} as ISetTextBoxColor);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.localColorHandler = null;\n\t\t\t\t},\n\t\t\t} as Handler;\n\t\t},\n\t},\n});\n\nexport interface Handler {\n\ttitle: string;\n\tget: () => string;\n\tset: (value: string) => void;\n\tleave: () => void;\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.panel.vertical {\n\t.input-table {\n\t\twidth: 100%;\n\t}\n}\n\n.input-table {\n\tinput {\n\t\twidth: 64px;\n\t}\n}\n\n.color-button {\n\theight: 24px;\n\twidth: 48px;\n\tvertical-align: middle;\n}\n\n#namebox_width {\n\twidth: 5em;\n}\n</style>\n<style lang=\"scss\">\n.modal-rename dialog {\n\tpadding: 4px;\n\tp {\n\t\tfont-family: aller;\n\t\tfont-size: 24px;\n\t}\n}\n</style>\n","<template>\n\t<d-fieldset :title=\"'Position' + (allowSize ? '/Size' : '')\">\n\t\t<table>\n\t\t\t<tr>\n\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t<toggle\n\t\t\t\t\t\tv-if=\"allowStepMove\"\n\t\t\t\t\t\tv-model=\"freeMove\"\n\t\t\t\t\t\tlabel=\"Move freely?\"\n\t\t\t\t\t/>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr v-if=\"allowStepMove && !freeMove\">\n\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t<table>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"--pos\" :disabled=\"isFirstPos\">&lt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<select id=\"current_talking\" v-model.number=\"pos\">\n\t\t\t\t\t\t\t\t\t<option\n\t\t\t\t\t\t\t\t\t\tv-for=\"(val, key) of positionNames\"\n\t\t\t\t\t\t\t\t\t\t:key=\"key\"\n\t\t\t\t\t\t\t\t\t\t:value=\"key\"\n\t\t\t\t\t\t\t\t\t\t>{{ val }}</option\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t\t\t\t<button @click=\"++pos\" :disabled=\"isLastPos\">&gt;</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<template v-else>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"sprite_x\">X:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"sprite_x\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tv-model.number=\"x\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"sprite_y\">Y:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"sprite_y\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tv-model.number=\"y\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</template>\n\t\t\t<template v-if=\"allowSize\">\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"sprite_w\">Width:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"sprite_w\"\n\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tv-model.number=\"width\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"sprite_h\">Height:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"sprite_h\"\n\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\tv-model.number=\"height\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t<toggle v-model=\"preserveRatio\" label=\"Lock ratio?\" />\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</template>\n\t\t</table>\n\t</d-fieldset>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport {\n\tclosestCharacterSlot,\n\tISetFreeMoveMutation,\n\tICharacter,\n} from '@/store/objectTypes/characters';\nimport {\n\tISetPositionAction,\n\tISetObjectPositionMutation,\n\tIObject,\n\tISetHeightAction,\n\tISetWidthAction,\n\tISetRatioAction,\n} from '@/store/objects';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport { defineComponent, Prop } from 'vue';\nimport getConstants from '@/constants';\nimport { rendererLookup } from '@/renderables/textbox';\n\nexport default defineComponent({\n\tcomponents: { Toggle, DFieldset },\n\tprops: {\n\t\tobj: {\n\t\t\trequired: true,\n\t\t} as Prop<IObject>,\n\t},\n\tcomputed: {\n\t\tfreeMove: {\n\t\t\tget(): boolean {\n\t\t\t\treturn (this.obj! as ICharacter).freeMove;\n\t\t\t},\n\t\t\tset(freeMove: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setFreeMove', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tfreeMove,\n\t\t\t\t\t} as ISetFreeMoveMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tpreserveRatio: {\n\t\t\tget(): boolean {\n\t\t\t\treturn (this.obj! as ICharacter).preserveRatio;\n\t\t\t},\n\t\t\tset(preserveRatio: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setPreserveRatio', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tpreserveRatio,\n\t\t\t\t\t} as ISetRatioAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tpos: {\n\t\t\tget(): number {\n\t\t\t\treturn closestCharacterSlot(this.obj!.x);\n\t\t\t},\n\t\t\tset(value: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setPosition', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tx: getConstants().Base.characterPositions[value],\n\t\t\t\t\t\ty: this.obj!.y,\n\t\t\t\t\t} as ISetPositionAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tx: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.x;\n\t\t\t},\n\t\t\tset(x: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setPosition', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty: this.y,\n\t\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\ty: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.y;\n\t\t\t},\n\t\t\tset(y: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setPosition', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tx: this.x,\n\t\t\t\t\t\ty,\n\t\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\theight: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.height;\n\t\t\t},\n\t\t\tset(height: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setHeight', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\theight,\n\t\t\t\t\t} as ISetHeightAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\twidth: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.width;\n\t\t\t},\n\t\t\tset(width: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setWidth', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\twidth,\n\t\t\t\t\t} as ISetWidthAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tallowSize(): boolean {\n\t\t\tconst obj = this.obj!;\n\t\t\tif (obj.type === 'textBox') {\n\t\t\t\tconst renderer = rendererLookup[(obj as ITextBox).style];\n\t\t\t\treturn renderer.resizable;\n\t\t\t}\n\t\t\tif (obj.type === 'character' && !(obj as ICharacter).freeMove) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\tallowStepMove(): boolean {\n\t\t\treturn 'freeMove' in this.obj!;\n\t\t},\n\t\tpositionNames(): string[] {\n\t\t\treturn getConstants().Base.positions;\n\t\t},\n\n\t\tisFirstPos(): boolean {\n\t\t\treturn this.pos === 0;\n\t\t},\n\n\t\tisLastPos(): boolean {\n\t\t\treturn this.pos === getConstants().Base.positions.length - 1;\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\nfieldset {\n\t> table {\n\t\twidth: 100%;\n\n\t\t> tr > td:nth-child(2) {\n\t\t\twidth: 64px;\n\t\t}\n\n\t\ttable {\n\t\t\twidth: 100%;\n\t\t\tselect {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\t}\n}\n\n.vertical {\n\tfieldset {\n\t\tinput {\n\t\t\twidth: 64px;\n\t\t}\n\t}\n}\n\ninput {\n\twidth: 80px;\n}\n\n.arrow-col {\n\twidth: 24px;\n\n\tbutton {\n\t\twidth: 24px;\n\t}\n}\n</style>\n","const aroundContextSize = 5;\n\nexport class StringWalker {\n\tprivate i: number = 0;\n\tpublic constructor(private readonly str: string) {}\n\n\tpublic get pos(): number {\n\t\treturn this.i;\n\t}\n\n\tpublic current(): string {\n\t\treturn this.str[this.i];\n\t}\n\n\tpublic get around(): string {\n\t\treturn this.str.slice(\n\t\t\tMath.max(0, this.i - aroundContextSize),\n\t\t\tthis.i + aroundContextSize\n\t\t);\n\t}\n\n\tpublic get ahead(): string {\n\t\treturn this.str[this.i + 1];\n\t}\n\n\tpublic get behind(): string {\n\t\treturn this.str[this.i + 1];\n\t}\n\n\tpublic next(): string {\n\t\t++this.i;\n\t\treturn this.current();\n\t}\n}\n","import { StringWalker } from './string-walker';\n\ninterface ITextToken {\n\tcontent: string;\n\tpos: number;\n\ttype: 'text';\n}\nexport interface ICommandToken {\n\tcommandName: string;\n\targument: string;\n\tpos: number;\n\ttype: 'command';\n}\ninterface ICommandCloseToken {\n\tcommandName: string;\n\tpos: number;\n\ttype: 'commandClose';\n}\ninterface INewlineToken {\n\ttype: 'newline';\n\tpos: number;\n}\n\nexport type Token =\n\t| ITextToken\n\t| ICommandToken\n\t| ICommandCloseToken\n\t| INewlineToken;\n\nexport function tokenize(str: string): Token[] {\n\tconst tokens: Token[] = [];\n\tconst stringWalker = new StringWalker(str);\n\tlet currentTokenState: TokenizerState = tokenStateNormal;\n\twhile (currentTokenState !== tokenStateEnd) {\n\t\tcurrentTokenState = currentTokenState(tokens, stringWalker);\n\t}\n\treturn tokens;\n}\n\ntype TokenizerState = (\n\tcontents: Token[],\n\twalker: StringWalker\n) => TokenizerState;\n\nfunction tokenStateNormal(\n\tcontents: Token[],\n\twalker: StringWalker\n): TokenizerState {\n\tif (walker.current() === undefined) return tokenStateEnd;\n\tif (walker.current() === '{') return tokenStateCommand;\n\tif (walker.current() === '\\n') return tokenStateNewLine;\n\treturn tokenText;\n}\n\nfunction tokenStateEnd(): TokenizerState {\n\treturn tokenStateEnd;\n}\n\nfunction tokenText(contents: Token[], walker: StringWalker): TokenizerState {\n\tconst { pos } = walker;\n\tlet textContent = '';\n\tlet escape = false;\n\tlet nextState: TokenizerState;\n\twhile (true) {\n\t\tif (walker.current() === undefined) {\n\t\t\tnextState = tokenStateEnd;\n\t\t\tbreak;\n\t\t} else if (escape) {\n\t\t\ttextContent += walker.current();\n\t\t\tescape = false;\n\t\t} else if (walker.current() === '\\\\') {\n\t\t\tescape = true;\n\t\t} else if (walker.current() === '{' || walker.current() === '\\n') {\n\t\t\tnextState = tokenStateNormal;\n\t\t\tbreak;\n\t\t} else {\n\t\t\ttextContent += walker.current();\n\t\t}\n\t\twalker.next();\n\t}\n\tcontents.push({\n\t\ttype: 'text',\n\t\tpos,\n\t\tcontent: textContent,\n\t});\n\treturn nextState;\n}\n\nfunction error(walker: StringWalker, msg: string): never {\n\tthrow new Error(\n\t\t`Error at position ${walker.pos}: (around: ${walker.around}) ${msg}`\n\t);\n}\n\nfunction tokenStateCommand(\n\tcontents: Token[],\n\twalker: StringWalker\n): TokenizerState {\n\tconst { pos } = walker;\n\tif (walker.current() !== '{') {\n\t\tthrow new Error('Parser error: Command does not start with {');\n\t}\n\tconst closing = walker.next() === '/';\n\tif (closing) {\n\t\twalker.next();\n\t}\n\tlet commandName = '';\n\tlet argument = '';\n\tlet argumentsState = false;\n\n\twhile (true) {\n\t\tif (walker.current() === undefined) {\n\t\t\terror(walker, 'Unexpected end of text inside a command');\n\t\t}\n\t\tif (walker.current() === '}') {\n\t\t\tbreak;\n\t\t} else if (!argumentsState) {\n\t\t\tif (walker.current().match(/[a-z]/i)) {\n\t\t\t\tcommandName += walker.current();\n\t\t\t} else if (walker.current() === '=') {\n\t\t\t\tif (closing) {\n\t\t\t\t\terror(walker, 'Closing commands may not contain arguments');\n\t\t\t\t}\n\t\t\t\targumentsState = true;\n\t\t\t} else {\n\t\t\t\terror(walker, 'Unexpected character in command name.');\n\t\t\t}\n\t\t} else {\n\t\t\targument += walker.current();\n\t\t}\n\t\twalker.next();\n\t}\n\twalker.next();\n\tif (closing) {\n\t\tcontents.push({\n\t\t\ttype: 'commandClose',\n\t\t\tcommandName,\n\t\t\tpos,\n\t\t});\n\t} else {\n\t\tcontents.push({\n\t\t\ttype: 'command',\n\t\t\tpos,\n\t\t\targument,\n\t\t\tcommandName,\n\t\t});\n\t}\n\treturn tokenStateNormal;\n}\n\nfunction tokenStateNewLine(\n\tcontents: Token[],\n\twalker: StringWalker\n): TokenizerState {\n\tcontents.push({ type: 'newline', pos: walker.pos });\n\twalker.next();\n\treturn tokenStateNormal;\n}\n","import { ITextStyle } from './textRenderer';\n\ntype Command = (style: ITextStyle, parameter?: string) => ITextStyle;\n\nexport default new Map<string, Command>([\n\tparamlessOp('i', style => ({ ...style, isItalic: true })),\n\tparamlessOp('b', style => ({ ...style, isBold: true })),\n\tparamlessOp('u', style => ({ ...style, isUnderlined: true })),\n\tparamlessOp('s', style => ({\n\t\t...style,\n\t\tisStrikethrough: true,\n\t})),\n\tparamlessOp('plain', style => ({\n\t\t...style,\n\t\tisStrikethrough: false,\n\t\tisUnderlined: false,\n\t\tisBold: false,\n\t\tisItalic: false,\n\t})),\n\tparamlessOp('edited', style => ({\n\t\t...style,\n\t\tfontName: 'verily',\n\t\tstrokeColor: '#000000',\n\t\tstrokeWidth: 20,\n\t\tletterSpacing: 8,\n\t})),\n\trelativeNumberOp('k', (style, relative, parameter) => ({\n\t\t...style,\n\t\tletterSpacing: relative ? style.letterSpacing + parameter : parameter,\n\t})),\n\trelativeNumberOp('size', (style, relative, parameter) => ({\n\t\t...style,\n\t\tfontSize: relative ? style.fontSize + parameter : parameter,\n\t})),\n\trelativeNumberOp('alpha', (style, relative, parameter) => ({\n\t\t...style,\n\t\talpha: relative ? style.alpha + parameter : parameter,\n\t})),\n\trelativeNumberOp('stroke', (style, relative, parameter) => ({\n\t\t...style,\n\t\tstrokeWidth: relative ? style.strokeWidth + parameter : parameter,\n\t})),\n\t[\n\t\t'font',\n\t\t(style, parameter?) => {\n\t\t\treturn { ...style, fontName: parameter! };\n\t\t},\n\t],\n\t[\n\t\t'color',\n\t\t(style, parameter?) => {\n\t\t\treturn { ...style, color: parameter! };\n\t\t},\n\t],\n\t[\n\t\t'outlinecolor',\n\t\t(style, parameter?) => {\n\t\t\treturn { ...style, strokeColor: parameter! };\n\t\t},\n\t],\n]);\n\nfunction paramlessOp(\n\tname: string,\n\top: (style: ITextStyle) => ITextStyle\n): [string, Command] {\n\treturn [\n\t\tname,\n\t\t(style: ITextStyle, parameter?: string) => {\n\t\t\tif (parameter) {\n\t\t\t\tthrow new Error(`Operator '${name}' does not take any arguments.`);\n\t\t\t}\n\t\t\treturn op(style);\n\t\t},\n\t];\n}\n\nfunction numberOp(\n\tname: string,\n\top: (style: ITextStyle, param: number) => ITextStyle\n): [string, Command] {\n\treturn [\n\t\tname,\n\t\t(style: ITextStyle, parameter?: string) => {\n\t\t\tif (!parameter) throw new Error(`Operator '${name}' needs an argument.`);\n\t\t\tconst num = Number(parameter);\n\t\t\tif (isNaN(num)) {\n\t\t\t\tthrow new Error(`Operator '${name}' needs a numeric argument.`);\n\t\t\t}\n\t\t\treturn op(style, num);\n\t\t},\n\t];\n}\n\nfunction relativeNumberOp(\n\tname: string,\n\top: (style: ITextStyle, relative: boolean, param: number) => ITextStyle\n): [string, Command] {\n\treturn [\n\t\tname,\n\t\t(style: ITextStyle, parameter?: string) => {\n\t\t\tif (!parameter) throw new Error(`Operator '${name}' needs an argument.`);\n\t\t\tconst relative = parameter[0] === '+' || parameter[0] === '-';\n\t\t\tconst num = Number(parameter);\n\t\t\tif (isNaN(num)) {\n\t\t\t\tthrow new Error(`Operator '${name}' needs a numeric argument.`);\n\t\t\t}\n\t\t\treturn op(style, relative, num);\n\t\t},\n\t];\n}\n","export function exhaust(a: never): never {\n\tthrow new Error(`Unexpected value \"${a}\"`);\n}\n","import { tokenize, Token, ICommandToken } from './tokenizer';\n\nimport textCommands from './textCommands';\nimport { exhaust } from '@/util/exhaust';\n\nexport interface ITextStyle {\n\tfontName: string;\n\tfontSize: number;\n\tisBold: boolean;\n\tisUnderlined: boolean;\n\tisStrikethrough: boolean;\n\tisItalic: boolean;\n\tcolor: string;\n\tstrokeWidth: number;\n\tstrokeColor: string;\n\tletterSpacing: number;\n\tlineSpacing: number;\n\talpha: number;\n}\n\ninterface ITextRenderItem {\n\tx: number;\n\ty: number;\n\theight: number;\n\twidth: number;\n}\n\ninterface IDrawCharacterItem extends ITextRenderItem {\n\ttype: 'character';\n\tcharacter: string;\n\tstyle: ITextStyle;\n}\n\ninterface INewlineItem extends ITextRenderItem {\n\ttype: 'newline';\n}\n\ntype RenderItem = IDrawCharacterItem | INewlineItem;\n\n// const widthCache = new Map<ITextStyle, Map<string, number>>();\n// const heightCache = new Map<ITextStyle, number>();\n\nexport class TextRenderer {\n\tpublic static textCommands = textCommands;\n\tprivate renderParts!: RenderItem[];\n\tprivate readonly tokens: Token[];\n\n\tpublic constructor(\n\t\tprivate str: string,\n\t\tprivate readonly baseStyle: ITextStyle\n\t) {\n\t\tthis.tokens = tokenize(str);\n\t\tthis.rebuildParts();\n\t}\n\n\tpublic rebuildParts() {\n\t\tthis.renderParts = this.getRenderParts(this.tokens, this.baseStyle);\n\t}\n\n\tpublic async loadFonts() {\n\t\tif (!('fonts' in document)) return;\n\t\tconst fonts = new Set<string>();\n\t\tlet currentStyle: ITextStyle | null = null;\n\t\tfor (const part of this.renderParts) {\n\t\t\tif (!('style' in part)) continue;\n\t\t\tif (part.style !== currentStyle) {\n\t\t\t\tcurrentStyle = part.style;\n\t\t\t\tif (currentStyle.fontName) {\n\t\t\t\t\tfonts.add(currentStyle.fontName);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet neededToLoad = false;\n\t\tfor (const font of fonts) {\n\t\t\tconst doc = document as any;\n\t\t\tconst fontString = `8px ${font}`;\n\t\t\tif (!doc.fonts.check(fontString)) {\n\t\t\t\tneededToLoad = true;\n\t\t\t\tawait doc.fonts.load(fontString);\n\t\t\t}\n\t\t}\n\n\t\tif (neededToLoad) {\n\t\t\tconst tokens = tokenize(this.str);\n\t\t\tthis.renderParts = this.getRenderParts(tokens, this.baseStyle);\n\t\t}\n\t}\n\n\tpublic render(ctx: CanvasRenderingContext2D): void {\n\t\tctx.save();\n\t\tlet currentStyle: ITextStyle | null = null;\n\t\tfor (const part of this.renderParts) {\n\t\t\tif (part.type === 'newline') continue;\n\t\t\tif (part.style !== currentStyle) {\n\t\t\t\tcurrentStyle = part.style;\n\t\t\t\tapplyTextStyleToCanvas(currentStyle, ctx);\n\t\t\t}\n\t\t\tif (currentStyle.strokeWidth > 0 && currentStyle.strokeColor > '') {\n\t\t\t\tctx.strokeText(part.character, part.x, part.y);\n\t\t\t}\n\t\t}\n\t\tfor (const part of this.renderParts) {\n\t\t\tif (part.type === 'newline') continue;\n\t\t\tif (part.style !== currentStyle) {\n\t\t\t\tcurrentStyle = part.style;\n\t\t\t\tapplyTextStyleToCanvas(currentStyle, ctx);\n\t\t\t}\n\t\t\tctx.fillText(part.character, part.x, part.y);\n\t\t}\n\t\tctx.restore();\n\t}\n\n\tpublic quote() {\n\t\tenum State {\n\t\t\tNone,\n\t\t\tExplictQuote,\n\t\t\tImplictQuote,\n\t\t\tStar,\n\t\t}\n\n\t\tlet lastChar = -1;\n\t\tlet state = State.None;\n\n\t\tfor (let i = 0; i < this.renderParts.length; ++i) {\n\t\t\tconst part = this.renderParts[i];\n\t\t\tif (part.type !== 'character') continue;\n\t\t\tswitch (state) {\n\t\t\t\tcase State.None:\n\t\t\t\t\tif (part.character.match(/\\s/)) continue;\n\t\t\t\t\tif (part.character === '\"') {\n\t\t\t\t\t\tstate = State.ExplictQuote;\n\t\t\t\t\t\tlastChar = i;\n\t\t\t\t\t} else if (part.character === '*') {\n\t\t\t\t\t\tstate = State.Star;\n\t\t\t\t\t\tlastChar = i;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.renderParts.splice(i, 0, {\n\t\t\t\t\t\t\ttype: 'character',\n\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t\tstyle: part.style,\n\t\t\t\t\t\t\tcharacter: '\"',\n\t\t\t\t\t\t\theight: part.height,\n\t\t\t\t\t\t\twidth: measureWidth(part.style, '\"'),\n\t\t\t\t\t\t});\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tlastChar = i;\n\t\t\t\t\t\tstate = State.ImplictQuote;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase State.ExplictQuote:\n\t\t\t\t\tlastChar = i;\n\t\t\t\t\tif (part.character === '\"') {\n\t\t\t\t\t\tstate = State.None;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase State.ImplictQuote:\n\t\t\t\t\tif (part.character.match(/\\s/)) continue;\n\t\t\t\t\tif (part.character === '*') {\n\t\t\t\t\t\tthis.renderParts.splice(lastChar + 1, 0, {\n\t\t\t\t\t\t\ttype: 'character',\n\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t\tstyle: part.style,\n\t\t\t\t\t\t\tcharacter: '\"',\n\t\t\t\t\t\t\theight: part.height,\n\t\t\t\t\t\t\twidth: measureWidth(part.style, '\"'),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tstate = State.Star;\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t\tlastChar = i;\n\t\t\t\t\tbreak;\n\t\t\t\tcase State.Star:\n\t\t\t\t\tif (part.character === '*') {\n\t\t\t\t\t\tstate = State.None;\n\t\t\t\t\t}\n\t\t\t\t\tlastChar = i;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tconst lastPart = this.renderParts[lastChar] as IDrawCharacterItem;\n\t\tif (lastPart && state === State.Star) {\n\t\t\tthis.renderParts.splice(lastChar + 1, 0, {\n\t\t\t\ttype: 'character',\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\tstyle: lastPart.style,\n\t\t\t\tcharacter: '*',\n\t\t\t\theight: lastPart.height,\n\t\t\t\twidth: measureWidth(lastPart.style, '\"'),\n\t\t\t});\n\t\t}\n\t\tif (\n\t\t\tlastPart &&\n\t\t\t(state === State.ExplictQuote || state === State.ImplictQuote)\n\t\t) {\n\t\t\tthis.renderParts.splice(lastChar + 1, 0, {\n\t\t\t\ttype: 'character',\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\tstyle: lastPart.style,\n\t\t\t\tcharacter: '\"',\n\t\t\t\theight: lastPart.height,\n\t\t\t\twidth: measureWidth(lastPart.style, '\"'),\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic fixAlignment(\n\t\talignment: 'left' | 'center' | 'right',\n\t\txStart: number,\n\t\txEnd: number,\n\t\tyStart: number,\n\t\tmaxLineWidth: number\n\t) {\n\t\tlet lineWidth = 0;\n\t\tlet currentLine: RenderItem[] = [];\n\n\t\tfunction fixLine() {\n\t\t\tlet x = xStart;\n\t\t\tif (alignment === 'center') {\n\t\t\t\tx = xStart + (xEnd - xStart) / 2 - lineWidth / 2;\n\t\t\t} else if (alignment === 'right') {\n\t\t\t\tx = xEnd - lineWidth;\n\t\t\t}\n\t\t\tfor (const item of currentLine) {\n\t\t\t\titem.x = x;\n\t\t\t\tx += item.width;\n\t\t\t}\n\t\t}\n\t\tlet renderParts = this.renderParts;\n\n\t\tif (maxLineWidth > 0) {\n\t\t\trenderParts = this.applyLineWrapping(\n\t\t\t\tthis.renderParts.slice(0),\n\t\t\t\tmaxLineWidth\n\t\t\t);\n\t\t}\n\n\t\tlet y = yStart;\n\t\tconst lineHeights = [];\n\t\tlet lineHeight = 0;\n\n\t\tfor (const item of renderParts) {\n\t\t\tlineHeight = Math.max(lineHeight, item.height);\n\n\t\t\tif (item.type === 'newline') {\n\t\t\t\tlineHeights.push(lineHeight);\n\t\t\t\tlineHeight = 0;\n\t\t\t}\n\t\t}\n\t\tlineHeights.push(lineHeight);\n\n\t\tlet line = 0;\n\n\t\tfor (const item of renderParts) {\n\t\t\tlineHeight = Math.max(lineHeight, item.height);\n\t\t\titem.y = y;\n\t\t\tcurrentLine.push(item);\n\t\t\tlineWidth += item.width;\n\n\t\t\tif (item.type === 'newline') {\n\t\t\t\tfixLine();\n\t\t\t\ty += lineHeights[++line] || 0;\n\t\t\t\tlineWidth = 0;\n\t\t\t\tlineHeight = 0;\n\t\t\t\tcurrentLine = [];\n\t\t\t} else if (item.type === 'character') {\n\t\t\t\tconst lastItem = currentLine[currentLine.length - 1];\n\t\t\t\tif (lastItem.type === 'character') {\n\t\t\t\t\tlineWidth += lastItem.style.letterSpacing;\n\t\t\t\t\tlastItem.width += lastItem.style.letterSpacing;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfixLine();\n\t}\n\n\tpublic getHeight(maxLineWidth: number) {\n\t\tlet lineHeight = 0;\n\t\tlet height = 0;\n\t\tconst renderParts =\n\t\t\tmaxLineWidth === 0\n\t\t\t\t? this.renderParts\n\t\t\t\t: this.applyLineWrapping(this.renderParts.slice(0), maxLineWidth);\n\n\t\tfor (const item of renderParts) {\n\t\t\tlineHeight = Math.max(lineHeight, item.height);\n\n\t\t\tif (item.type === 'newline') {\n\t\t\t\theight += lineHeight;\n\t\t\t\tlineHeight = 0;\n\t\t\t}\n\t\t}\n\t\theight += lineHeight;\n\n\t\treturn height;\n\t}\n\n\tpublic getWidth() {\n\t\tlet lineWidth = 0;\n\t\tlet maxLineWidth = 0;\n\t\tlet lastItemInLine: RenderItem | null = null;\n\n\t\tfor (const item of this.renderParts) {\n\t\t\tlineWidth += item.width;\n\n\t\t\tif (item.type === 'newline') {\n\t\t\t\tmaxLineWidth = Math.max(maxLineWidth, lineWidth);\n\t\t\t\tlineWidth = 0;\n\t\t\t\tlastItemInLine = null;\n\t\t\t} else if (item.type === 'character') {\n\t\t\t\tif (lastItemInLine && lastItemInLine.type === 'character') {\n\t\t\t\t\tlineWidth += lastItemInLine.style.letterSpacing;\n\t\t\t\t}\n\t\t\t\tlastItemInLine = item;\n\t\t\t}\n\t\t}\n\t\tmaxLineWidth = Math.max(maxLineWidth, lineWidth);\n\t\treturn maxLineWidth;\n\t}\n\n\tprivate getRenderParts(tokens: Token[], baseStyle: ITextStyle): RenderItem[] {\n\t\tconst renderParts: RenderItem[] = [];\n\t\tconst styleStack: ITextStyle[] = [];\n\t\tconst tagStack: Array<ICommandToken | null> = [];\n\t\tlet currentStyleHeight: number = measureHeight(baseStyle);\n\t\tlet currentStyle = baseStyle;\n\t\tlet currentTag: ICommandToken | null = null;\n\t\tfor (const token of tokens) {\n\t\t\tswitch (token.type) {\n\t\t\t\tcase 'command':\n\t\t\t\t\tif (TextRenderer.textCommands.has(token.commandName)) {\n\t\t\t\t\t\tstyleStack.push(currentStyle);\n\t\t\t\t\t\ttagStack.push(currentTag);\n\t\t\t\t\t\tcurrentStyle = TextRenderer.textCommands.get(token.commandName)!(\n\t\t\t\t\t\t\tcurrentStyle,\n\t\t\t\t\t\t\ttoken.argument\n\t\t\t\t\t\t);\n\t\t\t\t\t\tcurrentStyleHeight = measureHeight(currentStyle);\n\t\t\t\t\t\tcurrentTag = token;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t`There is no text command called '${token.commandName}' at position ${token.pos}.`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'commandClose':\n\t\t\t\t\tif (!currentTag) {\n\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t`Unmatched closing command at position ${token.pos}. Closed '${token.commandName}', but no commands are currently open.`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tif (token.commandName !== currentTag.commandName) {\n\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t`Unmatched closing command at position ${token.pos}. Closed '${token.commandName}', expected to close '${currentTag}' first. (Opened at position ${currentTag.pos})`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tcurrentTag = tagStack.pop()!;\n\t\t\t\t\tcurrentStyle = styleStack.pop()!;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'newline':\n\t\t\t\t\trenderParts.push({\n\t\t\t\t\t\theight: currentStyleHeight,\n\t\t\t\t\t\twidth: 0,\n\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\ttype: 'newline',\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'text':\n\t\t\t\t\tfor (const character of token.content) {\n\t\t\t\t\t\trenderParts.push({\n\t\t\t\t\t\t\ttype: 'character',\n\t\t\t\t\t\t\tcharacter,\n\t\t\t\t\t\t\theight: currentStyleHeight,\n\t\t\t\t\t\t\twidth: measureWidth(currentStyle, character),\n\t\t\t\t\t\t\tstyle: currentStyle,\n\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn renderParts;\n\t}\n\n\tprivate applyLineWrapping(\n\t\tparts: RenderItem[],\n\t\tmaxLineWidth: number\n\t): RenderItem[] {\n\t\tlet lastBreakPoint = -1;\n\t\tlet currentLineWidth = 0;\n\t\tlet lastBreakLineWidth = 0;\n\t\tconst newParts: RenderItem[] = [];\n\n\t\tfor (const item of parts) {\n\t\t\tif (item.type === 'newline') {\n\t\t\t\tlastBreakPoint = -1;\n\t\t\t\tcurrentLineWidth = 0;\n\t\t\t\tlastBreakLineWidth = 0;\n\t\t\t\tnewParts.push(item);\n\t\t\t} else if (item.type === 'character') {\n\t\t\t\tif (item.character === ' ') {\n\t\t\t\t\tif (currentLineWidth > maxLineWidth) {\n\t\t\t\t\t\tlastBreakPoint = -1;\n\t\t\t\t\t\tcurrentLineWidth = 0;\n\t\t\t\t\t\tlastBreakLineWidth = 0;\n\t\t\t\t\t\tnewParts.push({\n\t\t\t\t\t\t\ttype: 'newline',\n\t\t\t\t\t\t\theight: item.height,\n\t\t\t\t\t\t\twidth: 0,\n\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcurrentLineWidth += item.width;\n\t\t\t\t\t\tlastBreakLineWidth = currentLineWidth;\n\t\t\t\t\t\tlastBreakPoint = newParts.length;\n\t\t\t\t\t\tnewParts.push(item);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tcurrentLineWidth += item.width;\n\n\t\t\t\t\tif (currentLineWidth > maxLineWidth && lastBreakPoint !== -1) {\n\t\t\t\t\t\tcurrentLineWidth -= lastBreakLineWidth;\n\t\t\t\t\t\tnewParts.splice(lastBreakPoint, 1, {\n\t\t\t\t\t\t\ttype: 'newline',\n\t\t\t\t\t\t\theight: item.height,\n\t\t\t\t\t\t\twidth: 0,\n\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tlastBreakPoint = -1;\n\t\t\t\t\t\tlastBreakLineWidth = 0;\n\t\t\t\t\t\tnewParts.push(item);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewParts.push(item);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\texhaust(item);\n\t\t\t}\n\t\t}\n\n\t\treturn newParts;\n\t}\n}\n\nconst tmpContext = document.createElement('canvas').getContext('2d')!;\nlet lastStyle: ITextStyle | null = null;\n\nfunction measureWidth(textStyle: ITextStyle, character: string): number {\n\tif (textStyle !== lastStyle) {\n\t\tapplyTextStyleToCanvas(textStyle, tmpContext);\n\t\tlastStyle = textStyle;\n\t}\n\treturn tmpContext.measureText(character).width;\n}\n\nconst heightCache = new Map<string, number>();\n\nfunction measureHeight(textStyle: ITextStyle): number {\n\tconst font = textStyle.fontSize + ' ' + textStyle.fontName;\n\tif (heightCache.has(font)) {\n\t\treturn heightCache.get(font)! * textStyle.lineSpacing;\n\t}\n\n\tconst text = document.createElement('span');\n\ttext.innerHTML = 'Hg';\n\ttext.style.fontFamily = textStyle.fontName;\n\ttext.style.fontSize = `${textStyle.fontSize}px`;\n\ttext.style.lineHeight = '1';\n\n\tconst div = document.createElement('div');\n\tdiv.style.opacity = '0';\n\tdiv.style.fontFamily = textStyle.fontName;\n\tdiv.style.fontSize = `${textStyle.fontSize}px`;\n\tdiv.style.lineHeight = '1';\n\tdiv.style.position = 'absolute';\n\tdiv.style.top = '0';\n\tdiv.style.left = '0';\n\tdiv.appendChild(text);\n\n\tdocument.body.appendChild(div);\n\n\ttry {\n\t\tconst height = div.offsetHeight;\n\t\theightCache.set(font, height);\n\t\treturn height * textStyle.lineSpacing;\n\t} finally {\n\t\tdiv.remove();\n\t}\n}\n\nfunction applyTextStyleToCanvas(\n\tstyle: ITextStyle,\n\tctx: CanvasRenderingContext2D\n) {\n\tctx.textAlign = 'left';\n\tctx.font =\n\t\t(style.isItalic ? 'italic ' : '') +\n\t\t(style.isBold ? 'bold ' : '') +\n\t\tstyle.fontSize +\n\t\t'px ' +\n\t\tstyle.fontName;\n\tctx.lineJoin = 'round';\n\n\tif (style.strokeWidth > 0 && style.strokeColor > '') {\n\t\tctx.strokeStyle = style.strokeColor;\n\t\tctx.lineWidth = style.strokeWidth;\n\t} else {\n\t\tctx.strokeStyle = '';\n\t\tctx.lineWidth = 0;\n\t}\n\n\tctx.globalAlpha = style.alpha || 0;\n\tctx.fillStyle = style.color;\n}\n","import { OffscreenRenderable } from './offscreenRenderable';\nimport { IObject } from '@/store/objects';\nimport { RenderContext } from '@/renderer/rendererContext';\nimport { IHitbox } from './renderable';\nimport getConstants from '@/constants';\nimport { DeepReadonly } from '@/util/readonly';\n\nexport abstract class ScalingRenderable<\n\tObj extends IObject\n> extends OffscreenRenderable<Obj> {\n\tprotected lastWidth = -1;\n\tprotected lastHeight = -1;\n\tprotected lastX = -1;\n\tprotected lastY = -1;\n\tprotected lastFlip: boolean | null = null;\n\n\tprotected readonly canvasHeight: number;\n\tprotected readonly canvasWidth: number;\n\tprotected readonly canvasDrawHeight: number;\n\tprotected readonly canvasDrawWidth: number;\n\tprotected readonly canvasDrawPosX = 0;\n\tprotected readonly canvasDrawPosY = 0;\n\n\tpublic constructor(obj: DeepReadonly<Obj>) {\n\t\tsuper(obj);\n\t\tconst constants = getConstants().Base;\n\t\tthis.canvasHeight = constants.screenHeight;\n\t\tthis.canvasWidth = constants.screenWidth;\n\t\tthis.canvasDrawHeight = constants.screenHeight;\n\t\tthis.canvasDrawWidth = constants.screenWidth;\n\t}\n\n\tpublic getRenderRotation(): [number, { x: number; y: number } | undefined] {\n\t\treturn [0, undefined];\n\t}\n\n\tpublic needsRedraw(): boolean {\n\t\tif (super.needsRedraw()) return true;\n\t\treturn (\n\t\t\tthis.width !== this.lastWidth ||\n\t\t\tthis.height !== this.lastHeight ||\n\t\t\tthis.x !== this.lastX ||\n\t\t\tthis.y !== this.lastY ||\n\t\t\tthis.flip !== this.lastFlip\n\t\t);\n\t}\n\n\tpublic async updateLocalCanvas(hq: boolean) {\n\t\tthis.lastWidth = this.width;\n\t\tthis.lastHeight = this.height;\n\t\tthis.lastX = this.x;\n\t\tthis.lastY = this.y;\n\t\tthis.lastFlip = this.flip;\n\t\tawait super.updateLocalCanvas(hq);\n\t}\n\n\tprotected async renderLocal(rx: RenderContext): Promise<void> {\n\t\tconst constants = getConstants().Base;\n\t\tif (this.rotation === 0) return this.draw(rx);\n\t\tawait rx.customTransform(async trx => {\n\t\t\tconst hitbox = this.getHitbox();\n\t\t\tconst centerX = hitbox.x0 + (hitbox.x1 - hitbox.x0) / 2;\n\t\t\tconst centerY = hitbox.y0 + (hitbox.y1 - hitbox.y0) / 2;\n\n\t\t\tconst flipNormalizedCenterX = this.flip\n\t\t\t\t? constants.screenWidth - centerX\n\t\t\t\t: centerX;\n\n\t\t\ttrx.translate(flipNormalizedCenterX, centerY);\n\t\t\ttrx.rotate(this.rotation);\n\t\t\ttrx.translate(-flipNormalizedCenterX, -centerY);\n\t\t}, this.draw.bind(this));\n\t}\n\n\tpublic getHitbox(): IHitbox {\n\t\tconst vCentered = this.centeredVertically;\n\t\tconst w2 = this.width / 2;\n\t\tconst h2 = this.height / 2;\n\t\treturn {\n\t\t\tx0: this.x - w2,\n\t\t\tx1: this.x + w2,\n\t\t\ty0: vCentered ? this.y - h2 : this.y,\n\t\t\ty1: vCentered ? this.y + h2 : this.y + this.height,\n\t\t};\n\t}\n\n\tprotected abstract draw(rx: RenderContext): Promise<void>;\n\n\tprotected get centeredVertically(): boolean {\n\t\treturn false;\n\t}\n}\n","import getConstants from '@/constants';\nimport {\n\tControlsTextDisabledStyle,\n\tControlsTextStyle,\n\tTextBoxWidth,\n\tTextBoxHeight,\n\tNameboxHeight,\n\tControlsYBottomOffset,\n\tControlsXHistoryOffset,\n\tControlsXSkipOffset,\n\tControlsXStuffOffset,\n\tTextBoxStyle,\n} from '@/constants/game_modes/ddlc/textBox';\nimport { RenderContext } from '@/renderer/rendererContext';\nimport { DeepReadonly } from 'vue';\nimport { TextBox } from '../textbox';\n\nexport abstract class DdlcBase {\n\tpublic abstract readonly width: number;\n\tpublic abstract readonly height: number;\n\n\tpublic static get resizable() {\n\t\treturn false;\n\t}\n\tpublic static get defaultWidth() {\n\t\treturn TextBoxWidth;\n\t}\n\tpublic static get defaultHeight() {\n\t\treturn TextBoxHeight;\n\t}\n\tpublic static get defaultX() {\n\t\treturn getConstants().Base.screenWidth / 2;\n\t}\n\tpublic static get defaultY() {\n\t\treturn (\n\t\t\tgetConstants().Base.screenHeight -\n\t\t\tthis.defaultHeight -\n\t\t\tNameboxHeight -\n\t\t\tgetConstants().TextBox.TextBoxBottomSpacing\n\t\t);\n\t}\n\n\tpublic get obj() {\n\t\treturn this.base.obj;\n\t}\n\n\tpublic get refObject() {\n\t\treturn this.base.refObject;\n\t}\n\n\tpublic constructor(protected base: DeepReadonly<TextBox>) {}\n\n\tprotected getControlsStyle() {\n\t\treturn ControlsTextStyle;\n\t}\n\n\tprotected getControlsDisabledStyle() {\n\t\treturn ControlsTextDisabledStyle;\n\t}\n\tpublic get textboxStyle() {\n\t\treturn TextBoxStyle;\n\t}\n\n\tpublic renderControls(rx: RenderContext, y: number) {\n\t\tconst constants = getConstants();\n\t\tconst w = this.width;\n\t\tconst w2 = w / 2;\n\t\tconst baseX = this.base.obj.flip\n\t\t\t? constants.Base.screenWidth - this.base.obj.x\n\t\t\t: this.base.obj.x;\n\t\tconst x = baseX - w2;\n\n\t\tconst controlsCenter = x + w / 2;\n\n\t\tconst controlsStyle = this.getControlsStyle();\n\n\t\trx.drawText({\n\t\t\ttext: 'History',\n\t\t\tx: controlsCenter + ControlsXHistoryOffset,\n\t\t\ty,\n\t\t\t...controlsStyle,\n\t\t});\n\t\trx.drawText({\n\t\t\ttext: 'Skip',\n\t\t\tx: controlsCenter + ControlsXSkipOffset,\n\t\t\ty,\n\t\t\t...(this.base.obj.skip ? controlsStyle : this.getControlsDisabledStyle()),\n\t\t});\n\t\trx.drawText({\n\t\t\ttext: 'Auto   Save   Load   Settings',\n\t\t\tx: controlsCenter + ControlsXStuffOffset,\n\t\t\ty,\n\t\t\t...controlsStyle,\n\t\t});\n\t}\n}\n","import { ITextboxRenderer } from '../textbox';\nimport * as TBConstants from '@/constants/game_modes/ddlc/textBox';\nimport { DdlcBase } from './ddlc_base';\nimport { RenderContext } from '@/renderer/rendererContext';\nimport getConstants from '@/constants';\nimport { getAsset } from '@/asset-manager';\nimport environment from '@/environments/environment';\nimport { ITextBox } from '@/store/objectTypes/textbox';\n\nexport class Default extends DdlcBase implements ITextboxRenderer {\n\tstatic readonly id: ITextBox['style'] = 'normal';\n\tstatic readonly label: string = 'Normal';\n\tstatic readonly priority: number = 0;\n\tstatic readonly gameMode: string = 'ddlc';\n\n\tpublic get height() {\n\t\treturn TBConstants.TextBoxHeight + TBConstants.NameboxHeight;\n\t}\n\tpublic get width() {\n\t\treturn TBConstants.TextBoxWidth;\n\t}\n\tpublic get nameboxWidth() {\n\t\treturn TBConstants.NameboxWidth;\n\t}\n\tpublic get nameboxHeight() {\n\t\treturn TBConstants.NameboxHeight;\n\t}\n\tpublic get nameboxOffsetX() {\n\t\treturn TBConstants.NameboxXOffset;\n\t}\n\tpublic get nameboxOffsetY() {\n\t\treturn TBConstants.NameboxTextYOffset;\n\t}\n\tpublic get nameboxStyle() {\n\t\treturn TBConstants.NameboxTextStyle;\n\t}\n\tpublic get textOffsetX() {\n\t\treturn TBConstants.TextBoxTextXOffset;\n\t}\n\tpublic get textOffsetY() {\n\t\treturn TBConstants.TextBoxTextYOffset;\n\t}\n\n\tprotected backgroundImage = 'textbox';\n\tprotected xOffset = 0;\n\n\tprotected async renderNamebox(\n\t\trx: RenderContext,\n\t\tx: number,\n\t\ty: number\n\t): Promise<void> {\n\t\trx.drawImage({\n\t\t\timage: await getAsset('namebox'),\n\t\t\tx,\n\t\t\ty,\n\t\t});\n\t}\n\tprotected async renderBackdrop(\n\t\trx: RenderContext,\n\t\tx: number,\n\t\ty: number\n\t): Promise<void> {\n\t\tx += this.xOffset;\n\t\tconst image = await getAsset(this.backgroundImage);\n\t\trx.drawImage({ image, x, y });\n\t}\n\n\tpublic async render(rx: RenderContext): Promise<void> {\n\t\tconst constants = getConstants();\n\t\tconst w = this.width;\n\t\tconst h = this.height;\n\t\tconst w2 = w / 2;\n\t\tconst baseX = this.obj.flip\n\t\t\t? constants.Base.screenWidth - this.obj.x\n\t\t\t: this.obj.x;\n\t\tconst x = baseX - w2;\n\t\tconst y = this.obj.y;\n\n\t\tawait this.renderBackdrop(rx, x, y + this.nameboxHeight);\n\n\t\tif (this.obj.talkingObjId !== null) {\n\t\t\tawait this.renderNamebox(rx, x + this.nameboxOffsetX, y);\n\t\t}\n\n\t\tconst bottom = y + h;\n\t\tconst controlsY = bottom - TBConstants.ControlsYBottomOffset;\n\n\t\tif (this.obj.controls) this.renderControls(rx, controlsY);\n\n\t\tif (this.obj.continue) {\n\t\t\trx.drawImage({\n\t\t\t\timage: await getAsset('next'),\n\t\t\t\tx: x + w - TBConstants.ArrowXRightOffset,\n\t\t\t\ty: bottom - TBConstants.ArrowYBottomOffset,\n\t\t\t});\n\t\t}\n\t}\n\tpublic appliesTo(type: string): boolean {\n\t\treturn type === Default.id;\n\t}\n}\n","import {\n\tTextBoxCorruptedWidth,\n\tTextBoxWidth,\n} from '@/constants/game_modes/ddlc/textBox';\nimport { Default } from './default';\n\nexport class Corrupted extends Default {\n\tstatic readonly id = 'corrupt';\n\tstatic readonly label = 'Corrupted';\n\tstatic readonly priority = 1;\n\tstatic readonly gameMode = 'ddlc';\n\n\tprotected backgroundImage = 'textbox_monika';\n\tprotected xOffset = (TextBoxWidth - TextBoxCorruptedWidth) / 2;\n\n\tpublic appliesTo(type: string): boolean {\n\t\treturn type === Corrupted.id;\n\t}\n}\n","export function roundedRectangle(\n\tctx: CanvasPath,\n\tx: number,\n\ty: number,\n\tw: number,\n\th: number,\n\tr: number\n) {\n\tif (w < 0) w = 0;\n\tif (h < 0) h = 0;\n\tif (w < 2 * r) r = w / 2;\n\tif (h < 2 * r) r = h / 2;\n\tctx.moveTo(x + r, y);\n\tctx.arcTo(x + w, y, x + w, y + h, r);\n\tctx.arcTo(x + w, y + h, x, y + h, r);\n\tctx.arcTo(x, y + h, x, y, r);\n\tctx.arcTo(x, y, x + w, y, r);\n\tctx.closePath();\n}\n\nexport function roundedTopRectangle(\n\tctx: CanvasPath,\n\tx: number,\n\ty: number,\n\tw: number,\n\th: number,\n\tr: number\n) {\n\tif (w < 0) w = 0;\n\tif (h < 0) h = 0;\n\tif (w < 2 * r) r = w / 2;\n\tif (h < 2 * r) r = h / 2;\n\tctx.moveTo(x + r, y);\n\tctx.arcTo(x + w, y, x + w, y + h, r);\n\tctx.lineTo(x + w, y + h);\n\tctx.lineTo(x, y + h);\n\tctx.arcTo(x, y, x + w, y, r);\n\tctx.closePath();\n}\n","import { ITextboxRenderer } from '../textbox';\nimport * as TBConstants from '@/constants/game_modes/ddlc/textBox';\nimport { DdlcBase } from './ddlc_base';\nimport { RenderContext } from '@/renderer/rendererContext';\nimport getConstants from '@/constants';\nimport { getAsset } from '@/asset-manager';\nimport environment from '@/environments/environment';\nimport { roundedRectangle, roundedTopRectangle } from '@/renderer/pathTools';\nimport {\n\tdotColorDelta,\n\tdotPatternSize,\n\tdotRadius,\n\tnameboxBackgroundDelta,\n\tnameboxGradientEndDelta,\n\tnameboxGradientMiddleStopPosition,\n\tnameboxRounding,\n\tnameboxTextOutlineDelta,\n\ttextboxDefaultColor,\n\ttextboxOutlineColorDelta,\n\ttextboxOutlineWidth,\n\ttextboxRounding,\n\ttextboxRoundingBuffer,\n} from '@/constants/game_modes/ddlc/textBoxCustom';\nimport { RGBAColor } from '@/util/colors/rgb';\nimport { Renderer } from '@/renderer/renderer';\n\nexport class Custom extends DdlcBase implements ITextboxRenderer {\n\tstatic readonly id = 'custom';\n\tstatic readonly label: string = 'Custom';\n\tstatic readonly priority: number = 0;\n\tstatic readonly gameMode: string = 'ddlc';\n\n\tpublic static get resizable() {\n\t\treturn true;\n\t}\n\tpublic get height() {\n\t\treturn this.obj.height + TBConstants.NameboxHeight;\n\t}\n\tpublic get width() {\n\t\treturn this.obj.width;\n\t}\n\tpublic get nameboxWidth() {\n\t\tif (this.refObject && this.refObject.nameboxWidth !== null) {\n\t\t\treturn this.refObject.nameboxWidth;\n\t\t}\n\t\tif (this.obj.customNameboxWidth !== null)\n\t\t\treturn this.obj.customNameboxWidth;\n\t\treturn TBConstants.NameboxWidth;\n\t}\n\tpublic get nameboxHeight() {\n\t\treturn TBConstants.NameboxHeight;\n\t}\n\tpublic get nameboxOffsetX() {\n\t\treturn TBConstants.NameboxXOffset;\n\t}\n\tpublic get nameboxOffsetY() {\n\t\treturn TBConstants.NameboxTextYOffset;\n\t}\n\tpublic get nameboxStyle() {\n\t\treturn {\n\t\t\t...TBConstants.NameboxTextStyle,\n\t\t\tstrokeColor: this.nameboxOutlineColor,\n\t\t\tcolor: '#FFFFFF',\n\t\t};\n\t}\n\tpublic get textOffsetX() {\n\t\treturn TBConstants.TextBoxTextXOffset;\n\t}\n\tpublic get textOffsetY() {\n\t\treturn TBConstants.TextBoxTextYOffset;\n\t}\n\n\tpublic get customColor(): string {\n\t\tif (this.obj.overrideColor) return this.obj.customColor;\n\t\tif (this.refObject && this.refObject.textboxColor)\n\t\t\treturn this.refObject.textboxColor;\n\t\treturn textboxDefaultColor;\n\t}\n\n\tprivate get nameboxOutlineColor(): string {\n\t\tif (this.obj.deriveCustomColors) {\n\t\t\tconst base = RGBAColor.fromCss(this.customColor).toHSL();\n\t\t\treturn base\n\t\t\t\t.shift(nameboxTextOutlineDelta)\n\t\t\t\t.toRgb()\n\t\t\t\t.toCss();\n\t\t}\n\t\treturn this.obj.customNameboxStroke;\n\t}\n\n\tprivate get nameboxBackgroundColor(): string {\n\t\tif (this.obj.deriveCustomColors) {\n\t\t\tconst base = RGBAColor.fromCss(this.customColor).toHSL();\n\t\t\treturn base\n\t\t\t\t.shift(nameboxBackgroundDelta)\n\t\t\t\t.toRgb()\n\t\t\t\t.toCss();\n\t\t}\n\t\treturn this.obj.customNameboxColor;\n\t}\n\n\tprotected backgroundImage = 'textbox';\n\tprotected xOffset = 0;\n\n\tprotected async renderNamebox(\n\t\trx: RenderContext,\n\t\tx: number,\n\t\ty: number\n\t): Promise<void> {\n\t\tconst w = this.nameboxWidth;\n\t\tconst h = this.nameboxHeight;\n\t\tawait rx.customTransform(\n\t\t\tasync ctx => {\n\t\t\t\tctx.beginPath();\n\t\t\t\troundedTopRectangle(ctx, x, y, w, h, nameboxRounding);\n\t\t\t\tctx.clip();\n\t\t\t},\n\t\t\tasync subRx => {\n\t\t\t\tconst gradient = subRx.linearGradient(x, y, x, y + h);\n\t\t\t\tconst baseBG = RGBAColor.fromCss(this.nameboxBackgroundColor);\n\t\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\t\tconst color = new RGBAColor(baseBG.r, baseBG.g, baseBG.b, 0.95);\n\t\t\t\tconst targetColor = color\n\t\t\t\t\t.toHSL()\n\t\t\t\t\t.shift(nameboxGradientEndDelta)\n\t\t\t\t\t.toRgb();\n\t\t\t\tgradient.addColorStop(0, color.toCss());\n\t\t\t\tgradient.addColorStop(nameboxGradientMiddleStopPosition, color.toCss());\n\t\t\t\tgradient.addColorStop(1, targetColor.toCss());\n\t\t\t\tsubRx.drawRect({\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t\tw: this.obj.width,\n\t\t\t\t\th,\n\t\t\t\t\tfill: {\n\t\t\t\t\t\tstyle: gradient,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t}\n\tprotected async renderBackdrop(\n\t\trx: RenderContext,\n\t\tx: number,\n\t\ty: number\n\t): Promise<void> {\n\t\tconst hslColor = RGBAColor.fromCss(this.customColor).toHSL();\n\t\tconst dotPattern = new Renderer(dotPatternSize, dotPatternSize);\n\t\tdotPattern.render(async (dotRx: RenderContext) => {\n\t\t\tconst fill = {\n\t\t\t\tstyle: hslColor\n\t\t\t\t\t.shift(dotColorDelta)\n\t\t\t\t\t.toRgb()\n\t\t\t\t\t.toCss(),\n\t\t\t};\n\n\t\t\tfunction drawDot(dotX: number, dotY: number) {\n\t\t\t\tdotRx.drawPath({\n\t\t\t\t\tpath: ctx => {\n\t\t\t\t\t\tctx.ellipse(dotX, dotY, dotRadius, dotRadius, 0, 0, 2 * Math.PI);\n\t\t\t\t\t},\n\t\t\t\t\tfill,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tdrawDot(0, 0);\n\t\t\tdrawDot(dotPatternSize, 0);\n\t\t\tdrawDot(0, dotPatternSize);\n\t\t\tdrawDot(dotPatternSize, dotPatternSize);\n\t\t\tdrawDot(dotPatternSize / 2, dotPatternSize / 2);\n\t\t}, true);\n\t\tawait rx.customTransform(\n\t\t\tasync ctx => {\n\t\t\t\tctx.beginPath();\n\t\t\t\troundedRectangle(\n\t\t\t\t\tctx,\n\t\t\t\t\tx + textboxRoundingBuffer,\n\t\t\t\t\ty + textboxRoundingBuffer,\n\t\t\t\t\tthis.width - textboxRoundingBuffer * 2,\n\t\t\t\t\tthis.height - TBConstants.NameboxHeight - textboxRoundingBuffer * 2,\n\t\t\t\t\ttextboxRounding\n\t\t\t\t);\n\t\t\t\tctx.clip();\n\t\t\t},\n\t\t\tasync subRx => {\n\t\t\t\tconst h = this.obj.height;\n\t\t\t\tconst w = this.obj.width;\n\t\t\t\tconst gradient = subRx.linearGradient(x, y, x, y + h);\n\t\t\t\tconst color = RGBAColor.fromHex(this.customColor);\n\t\t\t\tgradient.addColorStop(0, color.toCss());\n\t\t\t\tgradient.addColorStop(\n\t\t\t\t\t1,\n\t\t\t\t\t`rgba(${color.r},${color.g},${color.b},0.6667)`\n\t\t\t\t);\n\t\t\t\tsubRx.drawRect({\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t\tw,\n\t\t\t\t\th,\n\t\t\t\t\tfill: {\n\t\t\t\t\t\tstyle: gradient,\n\t\t\t\t\t},\n\t\t\t\t\toutline: {\n\t\t\t\t\t\tstyle: '#ffdfee',\n\t\t\t\t\t\twidth: 6,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tawait subRx.customTransform(\n\t\t\t\t\tasync ctx => {\n\t\t\t\t\t\tctx.translate(x, y);\n\t\t\t\t\t},\n\t\t\t\t\tasync _subSubRx => {\n\t\t\t\t\t\tconst pattern = subRx.patternFrom(dotPattern);\n\t\t\t\t\t\tsubRx.drawRect({\n\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t\tw,\n\t\t\t\t\t\t\th,\n\t\t\t\t\t\t\tfill: {\n\t\t\t\t\t\t\t\tstyle: pattern,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcomposition: 'source-atop',\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tconst glowGradient = subRx.linearGradient(\n\t\t\t\t\tx,\n\t\t\t\t\ty + h - TBConstants.GlowRY,\n\t\t\t\t\tx,\n\t\t\t\t\ty + h\n\t\t\t\t);\n\t\t\t\tglowGradient.addColorStop(0, 'rgba(255,255,255,0.3137)');\n\t\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\t\tglowGradient.addColorStop(0.5, 'rgba(255,255,255,0.0627)');\n\t\t\t\tglowGradient.addColorStop(1, 'rgba(255,255,255,0)');\n\t\t\t\tsubRx.drawPath({\n\t\t\t\t\tpath: ctx => {\n\t\t\t\t\t\tctx.ellipse(\n\t\t\t\t\t\t\tx + w / 2,\n\t\t\t\t\t\t\ty + h,\n\t\t\t\t\t\t\tTBConstants.GlowRX,\n\t\t\t\t\t\t\tTBConstants.GlowRY,\n\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t2 * Math.PI\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\tfill: {\n\t\t\t\t\t\tstyle: glowGradient,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t\tconst outlineColor = hslColor\n\t\t\t.shift(textboxOutlineColorDelta)\n\t\t\t.toRgb()\n\t\t\t.toCss();\n\t\trx.drawPath({\n\t\t\tpath: path => {\n\t\t\t\troundedRectangle(\n\t\t\t\t\tpath,\n\t\t\t\t\tx + textboxRoundingBuffer,\n\t\t\t\t\ty + textboxRoundingBuffer,\n\t\t\t\t\tthis.width - textboxRoundingBuffer * 2,\n\t\t\t\t\tthis.height - TBConstants.NameboxHeight - textboxRoundingBuffer * 2,\n\t\t\t\t\ttextboxRounding\n\t\t\t\t);\n\t\t\t},\n\t\t\toutline: {\n\t\t\t\tstyle: outlineColor,\n\t\t\t\twidth: textboxOutlineWidth,\n\t\t\t},\n\t\t});\n\t}\n\n\tpublic async render(rx: RenderContext): Promise<void> {\n\t\tconst constants = getConstants();\n\t\tconst w = this.width;\n\t\tconst h = this.height;\n\t\tconst w2 = w / 2;\n\t\tconst baseX = this.obj.flip\n\t\t\t? constants.Base.screenWidth - this.obj.x\n\t\t\t: this.obj.x;\n\t\tconst x = baseX - w2;\n\t\tconst y = this.obj.y;\n\n\t\tif (this.obj.talkingObjId !== null) {\n\t\t\tawait this.renderNamebox(rx, x + this.nameboxOffsetX, y);\n\t\t}\n\n\t\tawait this.renderBackdrop(rx, x, y + this.nameboxHeight);\n\n\t\tconst bottom = y + h;\n\t\tconst controlsY = bottom - TBConstants.ControlsYBottomOffset;\n\n\t\tif (this.obj.controls) this.renderControls(rx, controlsY);\n\n\t\tif (this.obj.continue) {\n\t\t\trx.drawImage({\n\t\t\t\timage: await getAsset('next'),\n\t\t\t\tx: x + w - TBConstants.ArrowXRightOffset,\n\t\t\t\ty: bottom - TBConstants.ArrowYBottomOffset,\n\t\t\t});\n\t\t}\n\t}\n\tpublic appliesTo(type: string): boolean {\n\t\treturn type === Custom.id;\n\t}\n}\n","import { ITextboxRenderer } from '../textbox';\nimport * as TBConstants from '@/constants/game_modes/ddlc/textBox';\nimport { DdlcBase } from './ddlc_base';\nimport { RenderContext } from '@/renderer/rendererContext';\nimport environment from '@/environments/environment';\n\nexport class None extends DdlcBase implements ITextboxRenderer {\n\tstatic readonly id = 'none';\n\tstatic readonly label: string = 'None';\n\tstatic readonly priority: number = 0;\n\tstatic readonly gameMode: string = 'ddlc';\n\n\tpublic get height() {\n\t\treturn TBConstants.TextBoxHeight + TBConstants.NameboxHeight;\n\t}\n\tpublic get width() {\n\t\treturn TBConstants.TextBoxWidth;\n\t}\n\tpublic get nameboxWidth() {\n\t\treturn TBConstants.NameboxWidth;\n\t}\n\tpublic get nameboxHeight() {\n\t\treturn TBConstants.NameboxHeight;\n\t}\n\tpublic get nameboxOffsetX() {\n\t\treturn TBConstants.NameboxXOffset;\n\t}\n\tpublic get nameboxOffsetY() {\n\t\treturn TBConstants.NameboxTextYOffset;\n\t}\n\tpublic get nameboxStyle() {\n\t\treturn TBConstants.NameboxTextStyle;\n\t}\n\tpublic get textOffsetX() {\n\t\treturn TBConstants.TextBoxTextXOffset;\n\t}\n\tpublic get textOffsetY() {\n\t\treturn TBConstants.TextBoxTextYOffset;\n\t}\n\tpublic get textboxStyle() {\n\t\treturn TBConstants.TextBoxStyle;\n\t}\n\n\tpublic async render(rx: RenderContext): Promise<void> {}\n\tpublic appliesTo(type: string): boolean {\n\t\treturn type === None.id;\n\t}\n}\n","import getConstants from '@/constants';\nimport {\n\tControlsTextDisabledStyle,\n\tControlsTextStyle,\n\tTextBoxWidth,\n\tTextBoxHeight,\n\tNameboxHeight,\n} from '@/constants/game_modes/ddlc_plus/textBox';\nimport { RenderContext } from '@/renderer/rendererContext';\nimport { DeepReadonly } from 'vue';\nimport { TextBox } from '../textbox';\n\nexport abstract class DdlcPlusBase {\n\tpublic abstract readonly width: number;\n\tpublic abstract readonly height: number;\n\n\tpublic static get resizable() {\n\t\treturn false;\n\t}\n\tpublic static get defaultWidth() {\n\t\treturn TextBoxWidth;\n\t}\n\tpublic static get defaultHeight() {\n\t\treturn TextBoxHeight;\n\t}\n\tpublic static get defaultX() {\n\t\treturn getConstants().Base.screenWidth / 2;\n\t}\n\tpublic static get defaultY() {\n\t\treturn (\n\t\t\tgetConstants().Base.screenHeight -\n\t\t\tthis.defaultHeight -\n\t\t\tNameboxHeight -\n\t\t\tgetConstants().TextBox.TextBoxBottomSpacing\n\t\t);\n\t}\n\n\tpublic get obj() {\n\t\treturn this.base.obj;\n\t}\n\n\tpublic get refObject() {\n\t\treturn this.base.refObject;\n\t}\n\n\tpublic constructor(protected base: DeepReadonly<TextBox>) {}\n\n\tprotected getControlsStyle() {\n\t\treturn ControlsTextStyle;\n\t}\n\n\tprotected getControlsDisabledStyle() {\n\t\treturn ControlsTextDisabledStyle;\n\t}\n\n\tpublic renderControls(rx: RenderContext, y: number) {\n\t\tconst constants = getConstants();\n\t\tconst w = this.width;\n\t\tconst w2 = w / 2;\n\t\tconst baseX = this.base.obj.flip\n\t\t\t? constants.Base.screenWidth - this.base.obj.x\n\t\t\t: this.base.obj.x;\n\t\tconst x = baseX - w2;\n\n\t\tconst controlsStyle = this.getControlsStyle();\n\n\t\tconst texts = ['History', 'Skip', 'Auto', 'Save', 'Load', 'Settings'];\n\t\tconst textWidths = [];\n\t\tlet combinedLength = 0;\n\n\t\tfor (const text of texts) {\n\t\t\tconst width = DdlcPlusBase.controlWidth(rx, text);\n\t\t\ttextWidths.push(width);\n\t\t\tcombinedLength += width;\n\t\t}\n\n\t\tconst spacing = Math.min((w - combinedLength) / texts.length, 78);\n\n\t\tlet controlX = x + (w - combinedLength - spacing * (texts.length - 1)) / 2;\n\t\tfor (let i = 0; i < texts.length; ++i) {\n\t\t\tconst text = texts[i];\n\t\t\tconst textWidth = textWidths[i];\n\t\t\tconst style =\n\t\t\t\ttext === 'Skip' && !this.base.obj.skip\n\t\t\t\t\t? this.getControlsDisabledStyle()\n\t\t\t\t\t: controlsStyle;\n\t\t\trx.drawText({\n\t\t\t\ttext,\n\t\t\t\tx: controlX,\n\t\t\t\ty,\n\t\t\t\t...style,\n\t\t\t});\n\t\t\tcontrolX += textWidth + spacing;\n\t\t}\n\t}\n\n\tprivate static widthCache: { [text: string]: number } = {};\n\tprivate static controlWidth(rx: RenderContext, text: string) {\n\t\tif (this.widthCache[text]) return this.widthCache[text];\n\t\tconst width = rx.measureText({ text, ...ControlsTextStyle }).width;\n\t\tthis.widthCache[text] = width;\n\t\treturn width;\n\t}\n}\n","import { ITextboxRenderer } from '../textbox';\nimport * as TBConstants from '@/constants/game_modes/ddlc_plus/textBox';\nimport { RenderContext } from '@/renderer/rendererContext';\nimport getConstants from '@/constants';\nimport { getAsset } from '@/asset-manager';\nimport { roundedRectangle, roundedTopRectangle } from '@/renderer/pathTools';\nimport {\n\tdotColorDelta,\n\tdotPatternSize,\n\tdotRadius,\n\tnameboxBackgroundDelta,\n\tnameboxGradientEndDelta,\n\tnameboxGradientMiddleStopPosition,\n\tnameboxRounding,\n\tnameboxTextOutlineDelta,\n\ttextboxDefaultColor,\n\ttextboxOutlineColorDelta,\n\ttextboxOutlineWidth,\n\ttextboxRounding,\n\ttextboxRoundingBuffer,\n} from '@/constants/game_modes/ddlc_plus/textBoxCustom';\nimport { RGBAColor } from '@/util/colors/rgb';\nimport { Renderer } from '@/renderer/renderer';\nimport { DdlcPlusBase } from './ddlc_plus_base';\n\nexport class CustomPlus extends DdlcPlusBase implements ITextboxRenderer {\n\tstatic readonly id = 'custom_plus';\n\tstatic readonly label: string = 'Custom (Plus)';\n\tstatic readonly priority: number = 0;\n\tstatic readonly gameMode: string = 'ddlc_plus';\n\n\tpublic static get resizable() {\n\t\treturn true;\n\t}\n\tpublic get height() {\n\t\treturn this.obj.height + TBConstants.NameboxHeight;\n\t}\n\tpublic get width() {\n\t\treturn this.obj.width;\n\t}\n\tpublic get nameboxWidth() {\n\t\tif (this.refObject && this.refObject.nameboxWidth !== null) {\n\t\t\treturn this.refObject.nameboxWidth;\n\t\t}\n\t\tif (this.obj.customNameboxWidth !== null)\n\t\t\treturn this.obj.customNameboxWidth;\n\t\treturn TBConstants.NameboxWidth;\n\t}\n\tpublic get nameboxHeight() {\n\t\treturn TBConstants.NameboxHeight;\n\t}\n\tpublic get nameboxOffsetX() {\n\t\treturn TBConstants.NameboxXOffset;\n\t}\n\tpublic get nameboxOffsetY() {\n\t\treturn TBConstants.NameboxTextYOffset;\n\t}\n\tpublic get nameboxStyle() {\n\t\treturn {\n\t\t\t...TBConstants.NameboxTextStyle,\n\t\t\tstrokeColor: this.nameboxOutlineColor,\n\t\t\tcolor: '#FFFFFF',\n\t\t};\n\t}\n\tpublic get textOffsetX() {\n\t\treturn TBConstants.TextBoxTextXOffset;\n\t}\n\tpublic get textOffsetY() {\n\t\treturn TBConstants.TextBoxTextYOffset;\n\t}\n\tpublic get textboxStyle() {\n\t\treturn TBConstants.TextBoxStyle;\n\t}\n\n\tpublic get customColor(): string {\n\t\tif (this.obj.overrideColor) return this.obj.customColor;\n\t\tif (this.refObject && this.refObject.textboxColor)\n\t\t\treturn this.refObject.textboxColor;\n\t\treturn textboxDefaultColor;\n\t}\n\n\tprivate get nameboxOutlineColor(): string {\n\t\tif (this.obj.deriveCustomColors) {\n\t\t\tconst base = RGBAColor.fromCss(this.customColor).toHSL();\n\t\t\treturn base\n\t\t\t\t.shift(nameboxTextOutlineDelta)\n\t\t\t\t.toRgb()\n\t\t\t\t.toCss();\n\t\t}\n\t\treturn this.obj.customNameboxStroke;\n\t}\n\n\tprivate get nameboxBackgroundColor(): string {\n\t\tif (this.obj.deriveCustomColors) {\n\t\t\tconst base = RGBAColor.fromCss(this.customColor).toHSL();\n\t\t\treturn base\n\t\t\t\t.shift(nameboxBackgroundDelta)\n\t\t\t\t.toRgb()\n\t\t\t\t.toCss();\n\t\t}\n\t\treturn this.obj.customNameboxColor;\n\t}\n\n\tprotected backgroundImage = 'textbox';\n\tprotected xOffset = 0;\n\n\tprotected async renderNamebox(\n\t\trx: RenderContext,\n\t\tx: number,\n\t\ty: number\n\t): Promise<void> {\n\t\tconst w = this.nameboxWidth;\n\t\tconst h = this.nameboxHeight;\n\t\tawait rx.customTransform(\n\t\t\tasync ctx => {\n\t\t\t\tctx.beginPath();\n\t\t\t\troundedTopRectangle(ctx, x, y, w, h, nameboxRounding);\n\t\t\t\tctx.clip();\n\t\t\t},\n\t\t\tasync subRx => {\n\t\t\t\tconst gradient = subRx.linearGradient(x, y, x, y + h);\n\t\t\t\tconst baseBG = RGBAColor.fromCss(this.nameboxBackgroundColor);\n\t\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\t\tconst color = new RGBAColor(baseBG.r, baseBG.g, baseBG.b, 0.95);\n\t\t\t\tconst targetColor = color\n\t\t\t\t\t.toHSL()\n\t\t\t\t\t.shift(nameboxGradientEndDelta)\n\t\t\t\t\t.toRgb();\n\t\t\t\tgradient.addColorStop(0, color.toCss());\n\t\t\t\tgradient.addColorStop(nameboxGradientMiddleStopPosition, color.toCss());\n\t\t\t\tgradient.addColorStop(1, targetColor.toCss());\n\t\t\t\tsubRx.drawRect({\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t\tw: this.obj.width,\n\t\t\t\t\th,\n\t\t\t\t\tfill: {\n\t\t\t\t\t\tstyle: gradient,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t}\n\tprotected async renderBackdrop(\n\t\trx: RenderContext,\n\t\tx: number,\n\t\ty: number\n\t): Promise<void> {\n\t\tconst hslColor = RGBAColor.fromCss(this.customColor).toHSL();\n\t\tconst dotPattern = new Renderer(dotPatternSize, dotPatternSize);\n\t\tdotPattern.render(async (dotRx: RenderContext) => {\n\t\t\tconst fill = {\n\t\t\t\tstyle: hslColor\n\t\t\t\t\t.shift(dotColorDelta)\n\t\t\t\t\t.toRgb()\n\t\t\t\t\t.toCss(),\n\t\t\t};\n\n\t\t\tfunction drawDot(dotX: number, dotY: number) {\n\t\t\t\tdotRx.drawPath({\n\t\t\t\t\tpath: ctx => {\n\t\t\t\t\t\tctx.ellipse(dotX, dotY, dotRadius, dotRadius, 0, 0, 2 * Math.PI);\n\t\t\t\t\t},\n\t\t\t\t\tfill,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tdrawDot(0, 0);\n\t\t\tdrawDot(dotPatternSize, 0);\n\t\t\tdrawDot(0, dotPatternSize);\n\t\t\tdrawDot(dotPatternSize, dotPatternSize);\n\t\t\tdrawDot(dotPatternSize / 2, dotPatternSize / 2);\n\t\t}, true);\n\t\tawait rx.customTransform(\n\t\t\tasync ctx => {\n\t\t\t\tctx.beginPath();\n\t\t\t\troundedRectangle(\n\t\t\t\t\tctx,\n\t\t\t\t\tx + textboxRoundingBuffer,\n\t\t\t\t\ty + textboxRoundingBuffer,\n\t\t\t\t\tthis.width - textboxRoundingBuffer * 2,\n\t\t\t\t\tthis.height - TBConstants.NameboxHeight - textboxRoundingBuffer * 2,\n\t\t\t\t\ttextboxRounding\n\t\t\t\t);\n\t\t\t\tctx.clip();\n\t\t\t},\n\t\t\tasync subRx => {\n\t\t\t\tconst h = this.obj.height;\n\t\t\t\tconst w = this.obj.width;\n\t\t\t\tconst gradient = subRx.linearGradient(x, y, x, y + h);\n\t\t\t\tconst color = RGBAColor.fromHex(this.customColor);\n\t\t\t\tgradient.addColorStop(0, color.toCss());\n\t\t\t\tgradient.addColorStop(\n\t\t\t\t\t1,\n\t\t\t\t\t`rgba(${color.r},${color.g},${color.b},0.6667)`\n\t\t\t\t);\n\t\t\t\tsubRx.drawRect({\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t\tw,\n\t\t\t\t\th,\n\t\t\t\t\tfill: {\n\t\t\t\t\t\tstyle: gradient,\n\t\t\t\t\t},\n\t\t\t\t\toutline: {\n\t\t\t\t\t\tstyle: '#ffdfee',\n\t\t\t\t\t\twidth: 6,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tawait subRx.customTransform(\n\t\t\t\t\tasync ctx => {\n\t\t\t\t\t\tctx.translate(x, y);\n\t\t\t\t\t},\n\t\t\t\t\tasync _subSubRx => {\n\t\t\t\t\t\tconst pattern = subRx.patternFrom(dotPattern);\n\t\t\t\t\t\tsubRx.drawRect({\n\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t\tw,\n\t\t\t\t\t\t\th,\n\t\t\t\t\t\t\tfill: {\n\t\t\t\t\t\t\t\tstyle: pattern,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcomposition: 'source-atop',\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tconst glowGradient = subRx.linearGradient(\n\t\t\t\t\tx,\n\t\t\t\t\ty + h - TBConstants.GlowRY,\n\t\t\t\t\tx,\n\t\t\t\t\ty + h\n\t\t\t\t);\n\t\t\t\tglowGradient.addColorStop(0, 'rgba(255,255,255,0.3137)');\n\t\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\t\tglowGradient.addColorStop(0.5, 'rgba(255,255,255,0.0627)');\n\t\t\t\tglowGradient.addColorStop(1, 'rgba(255,255,255,0)');\n\t\t\t\tsubRx.drawPath({\n\t\t\t\t\tpath: ctx => {\n\t\t\t\t\t\tctx.ellipse(\n\t\t\t\t\t\t\tx + w / 2,\n\t\t\t\t\t\t\ty + h,\n\t\t\t\t\t\t\tTBConstants.GlowRX,\n\t\t\t\t\t\t\tTBConstants.GlowRY,\n\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t2 * Math.PI\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\tfill: {\n\t\t\t\t\t\tstyle: glowGradient,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t\tconst outlineColor = hslColor\n\t\t\t.shift(textboxOutlineColorDelta)\n\t\t\t.toRgb()\n\t\t\t.toCss();\n\t\trx.drawPath({\n\t\t\tpath: path => {\n\t\t\t\troundedRectangle(\n\t\t\t\t\tpath,\n\t\t\t\t\tx + textboxRoundingBuffer,\n\t\t\t\t\ty + textboxRoundingBuffer,\n\t\t\t\t\tthis.width - textboxRoundingBuffer * 2,\n\t\t\t\t\tthis.height - TBConstants.NameboxHeight - textboxRoundingBuffer * 2,\n\t\t\t\t\ttextboxRounding\n\t\t\t\t);\n\t\t\t},\n\t\t\toutline: {\n\t\t\t\tstyle: outlineColor,\n\t\t\t\twidth: textboxOutlineWidth,\n\t\t\t},\n\t\t});\n\t}\n\n\tpublic async render(rx: RenderContext): Promise<void> {\n\t\tconst constants = getConstants();\n\t\tconst w = this.width;\n\t\tconst h = this.height;\n\t\tconst w2 = w / 2;\n\t\tconst baseX = this.obj.flip\n\t\t\t? constants.Base.screenWidth - this.obj.x\n\t\t\t: this.obj.x;\n\t\tconst x = baseX - w2;\n\t\tconst y = this.obj.y;\n\n\t\tif (this.obj.talkingObjId !== null) {\n\t\t\tawait this.renderNamebox(rx, x + this.nameboxOffsetX, y);\n\t\t}\n\n\t\tawait this.renderBackdrop(rx, x, y + this.nameboxHeight);\n\n\t\tconst bottom = y + h;\n\t\tconst controlsY = bottom - TBConstants.ControlsYBottomOffset;\n\n\t\tif (this.obj.controls) this.renderControls(rx, controlsY);\n\n\t\tif (this.obj.continue) {\n\t\t\trx.drawImage({\n\t\t\t\timage: await getAsset('next_plus'),\n\t\t\t\tx: x + w - TBConstants.ArrowXRightOffset,\n\t\t\t\ty: bottom - TBConstants.ArrowYBottomOffset,\n\t\t\t});\n\t\t}\n\t}\n\tpublic appliesTo(type: string): boolean {\n\t\treturn type === CustomPlus.id;\n\t}\n}\n","import { RenderContext } from '@/renderer/rendererContext';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport { RGBAColor } from '@/util/colors/rgb';\nimport { TextRenderer, ITextStyle } from '@/renderer/textRenderer/textRenderer';\nimport { ScalingRenderable } from './scalingRenderable';\nimport { Store } from 'vuex';\nimport { DeepReadonly } from 'vue';\nimport { IRootState } from '@/store';\nimport { IObject } from '@/store/objects';\nimport getConstants from '@/constants';\nimport environment from '@/environments/environment';\nimport { Default } from './textboxRenderers/default';\nimport { Corrupted } from './textboxRenderers/corrupt';\nimport { Custom } from './textboxRenderers/custom';\nimport { None } from './textboxRenderers/none';\nimport { CustomPlus } from './textboxRenderers/custom_plus';\n\nexport const styleRenderers: DeepReadonly<ITextboxRendererClass[]> = [\n\tDefault,\n\tCorrupted,\n\tCustom,\n\tNone,\n\tCustomPlus,\n];\nexport const rendererLookup: DeepReadonly<{\n\t[id: string]: ITextboxRendererClass;\n}> = (() => {\n\tconst ret: { [id: string]: ITextboxRendererClass } = {};\n\n\tfor (const renderer of styleRenderers) {\n\t\tret[renderer.id] = renderer;\n\t}\n\n\treturn ret;\n})();\n\nexport function getStyles(): ITextboxRendererClass[] {\n\tconst ret = [...styleRenderers];\n\tconst gameMode = environment.gameMode;\n\tret.sort((a, b) => {\n\t\tif (a.gameMode !== b.gameMode) {\n\t\t\tif (a.gameMode === gameMode) return -1;\n\t\t\tif (b.gameMode === gameMode) return 1;\n\t\t\tif (a.gameMode < b.gameMode) return -1;\n\t\t\treturn 1;\n\t\t}\n\t\treturn a.priority - b.priority;\n\t});\n\treturn ret;\n}\n\nexport class TextBox extends ScalingRenderable<ITextBox> {\n\tpublic refObject: IObject | null = null;\n\n\tpublic get y(): number {\n\t\treturn this.obj.y;\n\t}\n\n\tpublic get width(): number {\n\t\treturn this.textboxRenderer.width;\n\t}\n\n\tpublic get height(): number {\n\t\treturn this.textboxRenderer.height;\n\t}\n\n\tprivate _lastRenderer: ITextboxRenderer | null = null;\n\tpublic get textboxRenderer() {\n\t\tif (this._lastRenderer && this._lastRenderer.appliesTo(this.obj.style)) {\n\t\t\treturn this._lastRenderer;\n\t\t}\n\t\tconst forcedStyle = this.forcedStyle;\n\t\tif (!rendererLookup[forcedStyle])\n\t\t\tthrow new Error('Unknown textbox style renderer');\n\t\tconst newRenderer = new rendererLookup[forcedStyle](this);\n\n\t\tthis._lastRenderer = newRenderer;\n\t\treturn newRenderer!;\n\t}\n\n\tpublic get forcedStyle(): ITextBox['style'] {\n\t\tif (\n\t\t\t(this.obj.style === 'normal' || this.obj.style === 'normal_plus') &&\n\t\t\tthis.refObject &&\n\t\t\t(this.refObject.textboxColor || this.refObject.nameboxWidth !== null)\n\t\t)\n\t\t\treturn 'custom';\n\t\treturn this.obj.style;\n\t}\n\n\tpublic updatedContent(\n\t\t_current: Store<DeepReadonly<IRootState>>,\n\t\tpanelId: string\n\t): void {\n\t\tsuper.updatedContent(_current, panelId);\n\n\t\tconst talkingObj = this.obj.talkingObjId;\n\t\tif (talkingObj !== null && talkingObj !== '$other$') {\n\t\t\tconst obj = _current.state.objects.objects[talkingObj] as IObject;\n\t\t\tif (obj) {\n\t\t\t\tthis.refObject = obj;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis.refObject = null;\n\t}\n\n\tprotected async draw(rx: RenderContext): Promise<void> {\n\t\tconst constants = getConstants();\n\t\tconst styleRenderer = this.textboxRenderer;\n\t\tconst w = styleRenderer.width;\n\t\tconst h = styleRenderer.height;\n\t\tconst w2 = w / 2;\n\t\tconst baseX = this.flip\n\t\t\t? constants.Base.screenWidth - this.obj.x\n\t\t\t: this.obj.x;\n\t\tconst x = baseX - w2;\n\t\tconst y = this.obj.y;\n\n\t\tawait styleRenderer.render(rx);\n\n\t\tif (this.obj.talkingObjId !== null) {\n\t\t\tconst name =\n\t\t\t\tthis.obj.talkingObjId === '$other$'\n\t\t\t\t\t? this.obj.talkingOther\n\t\t\t\t\t: this.refObject?.label || 'Missing name';\n\t\t\tawait this.renderName(rx, x + styleRenderer.nameboxOffsetX, y, name);\n\t\t}\n\n\t\tawait this.renderText(rx, x, y, this.obj.autoWrap ? w : 0);\n\t}\n\n\tprivate async renderName(\n\t\trx: RenderContext,\n\t\tx: number,\n\t\ty: number,\n\t\tname: string\n\t): Promise<void> {\n\t\tconst styleRenderer = this.textboxRenderer;\n\t\tconst w = styleRenderer.nameboxWidth;\n\t\tconst style: ITextStyle = styleRenderer.nameboxStyle;\n\n\t\tconst render = new TextRenderer(name, style);\n\t\tawait render.loadFonts();\n\n\t\trender.fixAlignment(\n\t\t\t'center',\n\t\t\tx,\n\t\t\tx + w,\n\t\t\ty + styleRenderer.nameboxOffsetY,\n\t\t\t0\n\t\t);\n\n\t\trender.render(rx.fsCtx);\n\t}\n\n\tprivate async renderText(\n\t\trx: RenderContext,\n\t\tbaseX: number,\n\t\tbaseY: number,\n\t\tmaxLineWidth: number\n\t): Promise<void> {\n\t\tconst render = new TextRenderer(\n\t\t\tthis.obj.text,\n\t\t\tthis.textboxRenderer.textboxStyle\n\t\t);\n\t\tif (this.obj.autoQuoting && this.obj.talkingObjId !== null) {\n\t\t\trender.quote();\n\t\t}\n\t\tawait render.loadFonts();\n\n\t\trender.fixAlignment(\n\t\t\t'left',\n\t\t\tbaseX + this.textboxRenderer.textOffsetX,\n\t\t\t0,\n\t\t\tbaseY +\n\t\t\t\tthis.textboxRenderer.nameboxHeight +\n\t\t\t\tthis.textboxRenderer.textOffsetY,\n\t\t\tmaxLineWidth - this.textboxRenderer.textOffsetX * 2\n\t\t);\n\n\t\trender.render(rx.fsCtx);\n\t}\n}\n\nexport interface ITextboxRenderer {\n\treadonly height: number;\n\treadonly width: number;\n\treadonly nameboxWidth: number;\n\treadonly nameboxHeight: number;\n\n\treadonly nameboxOffsetX: number;\n\treadonly nameboxOffsetY: number;\n\treadonly nameboxStyle: ITextStyle;\n\n\treadonly textOffsetX: number;\n\treadonly textOffsetY: number;\n\treadonly textboxStyle: ITextStyle;\n\n\trender(rx: RenderContext): Promise<void>;\n\tappliesTo(type: string): boolean;\n}\n\nexport interface ITextboxRendererClass {\n\treadonly id: ITextBox['style'];\n\treadonly label: string;\n\treadonly priority: number;\n\treadonly gameMode: string;\n\n\treadonly defaultWidth: number;\n\treadonly defaultHeight: number;\n\treadonly defaultX: number;\n\treadonly defaultY: number;\n\treadonly resizable: boolean;\n\n\tprototype: ITextboxRenderer;\n\tnew (obj: TextBox): ITextboxRenderer;\n}\n","\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport {\n\tclosestCharacterSlot,\n\tISetFreeMoveMutation,\n\tICharacter,\n} from '@/store/objectTypes/characters';\nimport {\n\tISetPositionAction,\n\tISetObjectPositionMutation,\n\tIObject,\n\tISetHeightAction,\n\tISetWidthAction,\n\tISetRatioAction,\n} from '@/store/objects';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport { defineComponent, Prop } from 'vue';\nimport getConstants from '@/constants';\nimport { rendererLookup } from '@/renderables/textbox';\n\nexport default defineComponent({\n\tcomponents: { Toggle, DFieldset },\n\tprops: {\n\t\tobj: {\n\t\t\trequired: true,\n\t\t} as Prop<IObject>,\n\t},\n\tcomputed: {\n\t\tfreeMove: {\n\t\t\tget(): boolean {\n\t\t\t\treturn (this.obj! as ICharacter).freeMove;\n\t\t\t},\n\t\t\tset(freeMove: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setFreeMove', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tfreeMove,\n\t\t\t\t\t} as ISetFreeMoveMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tpreserveRatio: {\n\t\t\tget(): boolean {\n\t\t\t\treturn (this.obj! as ICharacter).preserveRatio;\n\t\t\t},\n\t\t\tset(preserveRatio: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setPreserveRatio', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tpreserveRatio,\n\t\t\t\t\t} as ISetRatioAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tpos: {\n\t\t\tget(): number {\n\t\t\t\treturn closestCharacterSlot(this.obj!.x);\n\t\t\t},\n\t\t\tset(value: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setPosition', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tx: getConstants().Base.characterPositions[value],\n\t\t\t\t\t\ty: this.obj!.y,\n\t\t\t\t\t} as ISetPositionAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tx: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.x;\n\t\t\t},\n\t\t\tset(x: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setPosition', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty: this.y,\n\t\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\ty: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.y;\n\t\t\t},\n\t\t\tset(y: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setPosition', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\tx: this.x,\n\t\t\t\t\t\ty,\n\t\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\theight: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.height;\n\t\t\t},\n\t\t\tset(height: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setHeight', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\theight,\n\t\t\t\t\t} as ISetHeightAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\twidth: {\n\t\t\tget(): number {\n\t\t\t\treturn this.obj!.width;\n\t\t\t},\n\t\t\tset(width: number) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setWidth', {\n\t\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t\t\twidth,\n\t\t\t\t\t} as ISetWidthAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tallowSize(): boolean {\n\t\t\tconst obj = this.obj!;\n\t\t\tif (obj.type === 'textBox') {\n\t\t\t\tconst renderer = rendererLookup[(obj as ITextBox).style];\n\t\t\t\treturn renderer.resizable;\n\t\t\t}\n\t\t\tif (obj.type === 'character' && !(obj as ICharacter).freeMove) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\tallowStepMove(): boolean {\n\t\t\treturn 'freeMove' in this.obj!;\n\t\t},\n\t\tpositionNames(): string[] {\n\t\t\treturn getConstants().Base.positions;\n\t\t},\n\n\t\tisFirstPos(): boolean {\n\t\t\treturn this.pos === 0;\n\t\t},\n\n\t\tisLastPos(): boolean {\n\t\t\treturn this.pos === getConstants().Base.positions.length - 1;\n\t\t},\n\t},\n});\n","import { render } from \"./positionAndSize.vue?vue&type=template&id=3e1f568a&scoped=true\"\nimport script from \"./positionAndSize.vue?vue&type=script&lang=ts\"\nexport * from \"./positionAndSize.vue?vue&type=script&lang=ts\"\n\nimport \"./positionAndSize.vue?vue&type=style&index=0&id=3e1f568a&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-3e1f568a\"\n\nexport default script","<template>\n\t<d-fieldset id=\"layerfs\" title=\"Layer:\">\n\t\t<table>\n\t\t\t<tbody>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button @click=\"shiftLayer(-Infinity)\" title=\"Move to back\">\n\t\t\t\t\t\t\t<i class=\"material-icons\">vertical_align_bottom</i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button @click=\"shiftLayer(-1)\" title=\"Move backwards\">\n\t\t\t\t\t\t\t<i class=\"material-icons\">arrow_downward</i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button @click=\"shiftLayer(1)\" title=\"Move forwards\">\n\t\t\t\t\t\t\t<i class=\"material-icons\">arrow_upward</i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button @click=\"shiftLayer(Infinity)\" title=\"Move to front\">\n\t\t\t\t\t\t\t<i class=\"material-icons\">vertical_align_top</i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>\n\t\t<toggle v-model=\"onTop\" label=\"In front?\" />\n\t</d-fieldset>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport { IObjectShiftLayerAction, IObject } from '@/store/objects';\nimport { genericSetable } from '@/util/simpleSettable';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tcomponents: { Toggle, DFieldset },\n\tprops: {\n\t\tobject: {\n\t\t\trequired: true,\n\t\t} as Prop<IObject>,\n\t},\n\tcomputed: {\n\t\tonTop: genericSetable<IObject>()('onTop', 'objects/setOnTop', true),\n\t},\n\tmethods: {\n\t\tshiftLayer(delta: number) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/shiftLayer', {\n\t\t\t\t\tid: this.object!.id,\n\t\t\t\t\tdelta,\n\t\t\t\t} as IObjectShiftLayerAction);\n\t\t\t});\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\ntable {\n\twidth: 100%;\n\n\tbutton {\n\t\twidth: 100%;\n\t}\n}\n</style>\n","\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport { IObjectShiftLayerAction, IObject } from '@/store/objects';\nimport { genericSetable } from '@/util/simpleSettable';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tcomponents: { Toggle, DFieldset },\n\tprops: {\n\t\tobject: {\n\t\t\trequired: true,\n\t\t} as Prop<IObject>,\n\t},\n\tcomputed: {\n\t\tonTop: genericSetable<IObject>()('onTop', 'objects/setOnTop', true),\n\t},\n\tmethods: {\n\t\tshiftLayer(delta: number) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/shiftLayer', {\n\t\t\t\t\tid: this.object!.id,\n\t\t\t\t\tdelta,\n\t\t\t\t} as IObjectShiftLayerAction);\n\t\t\t});\n\t\t},\n\t},\n});\n","import { render } from \"./layers.vue?vue&type=template&id=90b83fd8&scoped=true\"\nimport script from \"./layers.vue?vue&type=script&lang=ts\"\nexport * from \"./layers.vue?vue&type=script&lang=ts\"\n\nimport \"./layers.vue?vue&type=style&index=0&id=90b83fd8&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-90b83fd8\"\n\nexport default script","<template>\n\t<button @click=\"onClick\">Delete</button>\n</template>\n\n<script lang=\"ts\">\nimport { IObject, IRemoveObjectAction } from '@/store/objects';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tprops: {\n\t\tobj: {\n\t\t\trequired: true,\n\t\t} as Prop<IObject>,\n\t},\n\n\tmethods: {\n\t\tonClick() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/removeObject', {\n\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t} as IRemoveObjectAction);\n\t\t\t});\n\t\t},\n\t},\n});\n</script>\n","\nimport { IObject, IRemoveObjectAction } from '@/store/objects';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tprops: {\n\t\tobj: {\n\t\t\trequired: true,\n\t\t} as Prop<IObject>,\n\t},\n\n\tmethods: {\n\t\tonClick() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/removeObject', {\n\t\t\t\t\tid: this.obj!.id,\n\t\t\t\t} as IRemoveObjectAction);\n\t\t\t});\n\t\t},\n\t},\n});\n","import { render } from \"./delete.vue?vue&type=template&id=8ad92c36\"\nimport script from \"./delete.vue?vue&type=script&lang=ts\"\nexport * from \"./delete.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n\t<color\n\t\tv-if=\"showShadowColor\"\n\t\tv-model=\"shadowColor\"\n\t\tformat=\"rgb\"\n\t\t@leave=\"showShadowColor = false\"\n\t/>\n\t<d-flow v-else no-wraping class=\"image-options-subpanel\">\n\t\t<h2>Image options</h2>\n\t\t<div class=\"column ok-col\">\n\t\t\t<button @click=\"$emit('leave')\">Back</button>\n\t\t</div>\n\t\t<div class=\"column\" v-if=\"!noComposition\">\n\t\t\t<label for=\"compositionSelect\">Compositing Mode:</label\n\t\t\t><l\n\t\t\t\tto=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/globalCompositeOperation#Types\"\n\t\t\t\t>[?]</l\n\t\t\t>\n\t\t\t<select id=\"compositionSelect\" v-model=\"compositionMode\" @keydown.stop>\n\t\t\t\t<option value=\"source-over\">source-over</option>\n\t\t\t\t<!--\n\t\t\t\t<option value=\"source-in\">source-in</option>\n\t\t\t\t<option value=\"source-out\">source-out</option>\n\t\t\t\t-->\n\t\t\t\t<option value=\"source-atop\">source-atop</option>\n\t\t\t\t<option value=\"destination-over\">destination-over</option>\n\t\t\t\t<option value=\"destination-in\">destination-in</option>\n\t\t\t\t<option value=\"destination-in\">destination-out</option>\n\t\t\t\t<option value=\"destination-in\">destination-atop</option>\n\t\t\t\t<option value=\"lighter\">lighter</option>\n\t\t\t\t<option value=\"xor\">xor</option>\n\t\t\t\t<option value=\"multiply\">multiply</option>\n\t\t\t\t<option value=\"screen\">screen</option>\n\t\t\t\t<option value=\"overlay\">overlay</option>\n\t\t\t\t<option value=\"darken\">darken</option>\n\t\t\t\t<option value=\"lighten\">lighten</option>\n\t\t\t\t<option value=\"color-dodge\">color-dodge</option>\n\t\t\t\t<option value=\"color-burn\">color-burn</option>\n\t\t\t\t<option value=\"hard-light\">hard-light</option>\n\t\t\t\t<option value=\"soft-light\">soft-light</option>\n\t\t\t\t<option value=\"difference\">difference</option>\n\t\t\t\t<option value=\"exclusion\">exclusion</option>\n\t\t\t\t<option value=\"hue\">hue</option>\n\t\t\t\t<option value=\"saturation\">saturation</option>\n\t\t\t\t<option value=\"color\">color</option>\n\t\t\t\t<option value=\"luminosity\">luminosity</option>\n\t\t\t</select>\n\t\t</div>\n\t\t<d-fieldset class=\"column\" title=\"Effects\" style=\"overflow: hidden\">\n\t\t\t<d-flow class=\"filter-flow\" no-wraping gap=\"8px\">\n\t\t\t\t<d-flow direction=\"vertical\" no-wraping>\n\t\t\t\t\t<label for=\"addEffect\">Add new effect</label>\n\t\t\t\t\t<select id=\"addEffect\" v-model=\"addEffectSelection\" @keydown.stop>\n\t\t\t\t\t\t<option\n\t\t\t\t\t\t\tv-for=\"filterType of filterTypes\"\n\t\t\t\t\t\t\t:key=\"filterType\"\n\t\t\t\t\t\t\t:value=\"filterType\"\n\t\t\t\t\t\t\t>{{ getFilterLabel(filterType) }}</option\n\t\t\t\t\t\t>\n\t\t\t\t\t</select>\n\t\t\t\t\t<button\n\t\t\t\t\t\t:disabled=\"addEffectSelection === ''\"\n\t\t\t\t\t\t@click=\"addFilter\"\n\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t>\n\t\t\t\t\t\tAdd\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\t:disabled=\"!currentFilter\"\n\t\t\t\t\t\t@click=\"removeFilter\"\n\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t>\n\t\t\t\t\t\tRemove\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\t:disabled=\"currentFilterIdx === 0\"\n\t\t\t\t\t\t@click=\"moveFilter(-1)\"\n\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t>\n\t\t\t\t\t\tMove up\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\t:disabled=\"\n\t\t\t\t\t\t\tcurrentFilterIdx === filters.length - 1 || filters.length === 0\n\t\t\t\t\t\t\"\n\t\t\t\t\t\t@click=\"moveFilter(1)\"\n\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t>\n\t\t\t\t\t\tMove down\n\t\t\t\t\t</button>\n\t\t\t\t</d-flow>\n\t\t\t\t<d-flow maxSize=\"100%\" direction=\"vertical\" no-wraping>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-for=\"(filter, filterIdx) in filters\"\n\t\t\t\t\t\t:key=\"filterIdx\"\n\t\t\t\t\t\t:class=\"{ choiceBtn: true, active: filterIdx === currentFilterIdx }\"\n\t\t\t\t\t\t@click=\"selectFilter(filterIdx)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ getFilterText(filter) }}\n\t\t\t\t\t</div>\n\t\t\t\t</d-flow>\n\t\t\t\t<table v-if=\"currentFilter\" class=\"value-input-table\">\n\t\t\t\t\t<template v-if=\"currentFilter.type === 'drop-shadow'\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"shadow_color\">Color:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tid=\"shadow_color\"\n\t\t\t\t\t\t\t\t\tclass=\"color-button\"\n\t\t\t\t\t\t\t\t\t:style=\"{ background: shadowColor }\"\n\t\t\t\t\t\t\t\t\t@click=\"showShadowColor = true\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t&nbsp;\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"filter_x\">X:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tid=\"filter_x\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tv-model.number=\"shadowX\"\n\t\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"filter_y\">Y:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tid=\"filter_y\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tv-model.number=\"shadowY\"\n\t\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"filter_blur\">Blur:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tid=\"filter_blur\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tv-model.number=\"shadowBlur\"\n\t\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if=\"isPercentFilter\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"filter_value\">Value:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tid=\"filter_value\"\n\t\t\t\t\t\t\t\t\t:value=\"(currentFilter.value * 100).toFixed()\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\t:max=\"maxValue\"\n\t\t\t\t\t\t\t\t\t:min=\"minValue\"\n\t\t\t\t\t\t\t\t\t@input=\"\n\t\t\t\t\t\t\t\t\t\tsetValue({ value: Number($event.target.value / 100) })\n\t\t\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t\t/>%\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr v-if=\"minValue === 0 && maxValue !== undefined\">\n\t\t\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t\t\t<slider\n\t\t\t\t\t\t\t\t\t:gradientStops=\"['#000000', '#ffffff']\"\n\t\t\t\t\t\t\t\t\tlabel=\"\"\n\t\t\t\t\t\t\t\t\t:maxValue=\"maxValue\"\n\t\t\t\t\t\t\t\t\t:modelValue=\"currentFilter.value * 100\"\n\t\t\t\t\t\t\t\t\tno-input\n\t\t\t\t\t\t\t\t\t@update:modelValue=\"\n\t\t\t\t\t\t\t\t\t\tsetValue({ value: Math.round($event) / 100 })\n\t\t\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"filter_value\">Value:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tid=\"filter_value\"\n\t\t\t\t\t\t\t\t\t:value=\"currentFilter.value\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\t:max=\"maxValue\"\n\t\t\t\t\t\t\t\t\t:min=\"minValue\"\n\t\t\t\t\t\t\t\t\t@input=\"setValue({ value: Number($event.target.value) })\"\n\t\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr v-if=\"minValue === 0 && maxValue !== undefined\">\n\t\t\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t\t\t<slider\n\t\t\t\t\t\t\t\t\t:gradientStops=\"hueStops\"\n\t\t\t\t\t\t\t\t\tlabel=\"\"\n\t\t\t\t\t\t\t\t\t:maxValue=\"maxValue\"\n\t\t\t\t\t\t\t\t\t:modelValue=\"currentFilter.value\"\n\t\t\t\t\t\t\t\t\tno-input\n\t\t\t\t\t\t\t\t\t@update:modelValue=\"setValue({ value: Math.round($event) })\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<slider\n\t\t\t\t\t\t\t\t\t:gradientStops=\"hueStops\"\n\t\t\t\t\t\t\t\t\tlabel=\"\"\n\t\t\t\t\t\t\t\t\t:maxValue=\"maxValue\"\n\t\t\t\t\t\t\t\t\t:modelValue=\"currentFilter.value\"\n\t\t\t\t\t\t\t\t\tshift-gradient\n\t\t\t\t\t\t\t\t\tno-input\n\t\t\t\t\t\t\t\t\tdisabled\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</template>\n\t\t\t\t</table>\n\t\t\t</d-flow>\n\t\t</d-fieldset>\n\t</d-flow>\n</template>\n\n<script lang=\"ts\">\nimport DFlow from '@/components/ui/d-flow.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport Slider from '@/components/toolbox/subtools/color/slider.vue';\nimport Color from '@/components/toolbox/subtools/color/color.vue';\nimport { defineComponent, Prop, PropType } from 'vue';\nimport { CompositeModes } from '@/renderer/rendererContext';\nimport { DeepReadonly } from '@/util/readonly';\nimport {\n\tIHasSpriteFilters,\n\tINumericSpriteFilter,\n\tpercentageValue,\n\tSpriteFilter,\n} from '@/store/sprite_options';\nimport { exhaust } from '@/util/exhaust';\nimport {\n\tIAddFilterAction,\n\tIMoveFilterAction,\n\tIRemoveFilterAction,\n\tISetCompositionMutation,\n\tISetFilterAction,\n} from '@/store/sprite_options';\nimport { IColor } from '@/util/colors/color';\nimport { HSLAColor } from '@/util/colors/hsl';\nimport L from '@/components/ui/link.vue';\n\nconst filterText: ReadonlyMap<SpriteFilter['type'], string> = new Map<\n\tSpriteFilter['type'],\n\tstring\n>([\n\t['blur', 'Blur'],\n\t['brightness', 'Brightness'],\n\t['contrast', 'Contrast'],\n\t['grayscale', 'Grayscale'],\n\t['hue-rotate', 'Rotate hue'],\n\t['invert', 'Invert colors'],\n\t['opacity', 'Opacity'],\n\t['saturate', 'Saturate'],\n\t['sepia', 'Sepia'],\n\t['drop-shadow', 'Drop shadow'],\n]);\n\nconst filters: ReadonlyArray<SpriteFilter['type']> = Array.from(\n\tfilterText.keys()\n).sort();\n\nexport default defineComponent({\n\tcomponents: { DFlow, DFieldset, Color, Slider, L },\n\tprops: {\n\t\ttype: {\n\t\t\ttype: String as PropType<'object' | 'background' | 'panel'>,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t},\n\t\tid: {\n\t\t\trequired: true,\n\t\t} as Prop<string | number>,\n\t\tnoComposition: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['leave'],\n\tdata: () => ({\n\t\taddEffectSelection: '' as SpriteFilter['type'] | '',\n\t\tcurrentFilterIdx: 0,\n\t\tshowShadowColor: false,\n\t}),\n\tcomputed: {\n\t\tobject(): DeepReadonly<IHasSpriteFilters> {\n\t\t\tswitch (this.type) {\n\t\t\t\tcase 'object':\n\t\t\t\t\treturn this.$store.state.objects.objects[this.id!];\n\t\t\t\tcase 'background':\n\t\t\t\t\treturn this.$store.state.panels.panels[this.id!].background;\n\t\t\t\tcase 'panel':\n\t\t\t\t\treturn this.$store.state.panels.panels[this.id!];\n\t\t\t\tdefault:\n\t\t\t\t\texhaust(this.type);\n\t\t\t\t\treturn null!;\n\t\t\t}\n\t\t},\n\t\tcompositionMode: {\n\t\t\tget(): CompositeModes {\n\t\t\t\treturn this.object.composite;\n\t\t\t},\n\t\t\tset(composite: CompositeModes): void {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tswitch (this.type) {\n\t\t\t\t\t\tcase 'object':\n\t\t\t\t\t\t\tthis.$store.commit('objects/setComposition', {\n\t\t\t\t\t\t\t\tid: this.id,\n\t\t\t\t\t\t\t\tcomposite,\n\t\t\t\t\t\t\t} as ISetCompositionMutation);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'background':\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'panel':\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\texhaust(this.type);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tfilters(): DeepReadonly<SpriteFilter[]> {\n\t\t\treturn this.object.filters;\n\t\t},\n\t\tfilterTypes(): ReadonlyArray<SpriteFilter['type']> {\n\t\t\ttry {\n\t\t\t\tconst canvas = document.createElement('canvas');\n\t\t\t\tconst context = canvas.getContext('2d')!;\n\t\t\t\tif ('filter' in context) {\n\t\t\t\t\treturn filters;\n\t\t\t\t}\n\t\t\t} catch (_e) {}\n\t\t\treturn ['opacity'];\n\t\t},\n\t\tcurrentFilter(): DeepReadonly<SpriteFilter> | null {\n\t\t\treturn this.filters[this.currentFilterIdx] || null;\n\t\t},\n\t\tisPercentFilter(): boolean {\n\t\t\tconst filter = this.currentFilter;\n\t\t\tif (!filter) return false;\n\t\t\treturn percentageValue.has(filter.type);\n\t\t},\n\t\tmaxValue(): number | undefined {\n\t\t\tconst filter = this.currentFilter;\n\t\t\tif (!filter) return undefined;\n\n\t\t\tif (filter.type === 'hue-rotate') return 360;\n\t\t\tif (\n\t\t\t\tfilter.type === 'grayscale' ||\n\t\t\t\tfilter.type === 'sepia' ||\n\t\t\t\tfilter.type === 'opacity' ||\n\t\t\t\tfilter.type === 'invert'\n\t\t\t)\n\t\t\t\treturn 100;\n\n\t\t\treturn undefined;\n\t\t},\n\t\tminValue(): number | undefined {\n\t\t\tconst filter = this.currentFilter;\n\t\t\tif (!filter) return undefined;\n\n\t\t\tswitch (filter.type) {\n\t\t\t\tcase 'blur':\n\t\t\t\tcase 'brightness':\n\t\t\t\tcase 'contrast':\n\t\t\t\tcase 'grayscale':\n\t\t\t\tcase 'hue-rotate':\n\t\t\t\tcase 'invert':\n\t\t\t\tcase 'opacity':\n\t\t\t\tcase 'saturate':\n\t\t\t\tcase 'sepia':\n\t\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t},\n\t\tshadowColor: {\n\t\t\tget(): string | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('color' in filter)) return undefined;\n\t\t\t\treturn filter.color;\n\t\t\t},\n\t\t\tset(color: string) {\n\t\t\t\tthis.setValue({ color });\n\t\t\t},\n\t\t},\n\t\tshadowX: {\n\t\t\tget(): number | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('offsetX' in filter)) return undefined;\n\t\t\t\treturn filter.offsetX;\n\t\t\t},\n\t\t\tset(offsetX: number) {\n\t\t\t\tthis.setValue({ offsetX });\n\t\t\t},\n\t\t},\n\t\tshadowY: {\n\t\t\tget(): number | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('offsetY' in filter)) return undefined;\n\t\t\t\treturn filter.offsetY;\n\t\t\t},\n\t\t\tset(offsetY: number) {\n\t\t\t\tthis.setValue({ offsetY });\n\t\t\t},\n\t\t},\n\t\tshadowBlur: {\n\t\t\tget(): number | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('blurRadius' in filter)) return undefined;\n\t\t\t\treturn filter.blurRadius;\n\t\t\t},\n\t\t\tset(blurRadius: number) {\n\t\t\t\tthis.setValue({ blurRadius });\n\t\t\t},\n\t\t},\n\t\thueStops(): string[] {\n\t\t\tconst stops = this.eightsStops(i => new HSLAColor(i, 1, 0.5, 1));\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t},\n\tmethods: {\n\t\tgetFilterLabel(type: SpriteFilter['type']): string {\n\t\t\treturn filterText.get(type)!;\n\t\t},\n\t\tgetFilterText(filter: SpriteFilter): string {\n\t\t\tif (percentageValue.has(filter.type)) {\n\t\t\t\treturn `${filterText.get(filter.type)} ${(\n\t\t\t\t\t(filter as INumericSpriteFilter<any>).value * 100\n\t\t\t\t).toFixed()}%`;\n\t\t\t} else if (filter.type === 'hue-rotate') {\n\t\t\t\treturn `${filterText.get(filter.type)} ${filter.value.toFixed()}°`;\n\t\t\t} else if (filter.type === 'blur') {\n\t\t\t\treturn `${filterText.get(filter.type)} ${filter.value.toFixed()}px`;\n\t\t\t}\n\t\t\treturn filterText.get(filter.type)!;\n\t\t},\n\t\tobjectTypeScope(command: string): string {\n\t\t\tswitch (this.type) {\n\t\t\t\tcase 'object':\n\t\t\t\t\treturn 'objects/' + command;\n\t\t\t\tcase 'background':\n\t\t\t\t\treturn (\n\t\t\t\t\t\t'panels/background' + command[0].toUpperCase() + command.slice(1)\n\t\t\t\t\t);\n\t\t\t\tcase 'panel':\n\t\t\t\t\treturn 'panels/' + command;\n\t\t\t}\n\t\t},\n\t\taddFilter() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch(this.objectTypeScope('addFilter'), {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\ttype: this.addEffectSelection,\n\t\t\t\t\tidx: this.currentFilterIdx + 1,\n\t\t\t\t} as IAddFilterAction);\n\t\t\t\treturn;\n\t\t\t});\n\t\t},\n\t\tselectFilter(idx: number) {\n\t\t\tthis.currentFilterIdx = idx;\n\t\t},\n\t\tremoveFilter() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch(this.objectTypeScope('removeFilter'), {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tidx: this.currentFilterIdx,\n\t\t\t\t} as IRemoveFilterAction);\n\t\t\t\treturn;\n\t\t\t});\n\t\t},\n\t\tmoveFilter(moveBy: number) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch(this.objectTypeScope('moveFilter'), {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tidx: this.currentFilterIdx,\n\t\t\t\t\tmoveBy,\n\t\t\t\t} as IMoveFilterAction);\n\t\t\t\tthis.currentFilterIdx += moveBy;\n\t\t\t\treturn;\n\t\t\t});\n\t\t},\n\t\tsetValue(value: Omit<ISetFilterAction, 'id' | 'idx'>) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch(this.objectTypeScope('setFilter'), {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tidx: this.currentFilterIdx,\n\t\t\t\t\t...value,\n\t\t\t\t} as ISetFilterAction);\n\t\t\t});\n\t\t},\n\t\teightsStops(gen: (i: number) => IColor): IColor[] {\n\t\t\tconst stops: IColor[] = [];\n\t\t\tfor (let i = 0; i <= 8; ++i) {\n\t\t\t\tstops.push(gen(i / 8));\n\t\t\t}\n\t\t\treturn stops;\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\nh2 {\n\ttext-align: center;\n\tcolor: $default-text;\n\tcolor: var(--text);\n}\n.image-options-subpanel {\n\t&.vertical {\n\t\t.column {\n\t\t\twidth: 100%;\n\t\t\tmargin-top: 8px;\n\n\t\t\tbutton,\n\t\t\tselect {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\t}\n\n\t&.horizontal {\n\t\th2 {\n\t\t\twriting-mode: vertical-rl;\n\t\t\theight: inherit;\n\t\t\twidth: min-content;\n\t\t}\n\t\t.column {\n\t\t\tdisplay: flex;\n\t\t\t@include height-100();\n\t\t\tflex-direction: column;\n\t\t\tflex-wrap: wrap;\n\t\t\tmargin-left: 8px;\n\t\t}\n\t\t.ok-col {\n\t\t\twidth: 42px;\n\t\t\tbutton {\n\t\t\t\t@include height-100();\n\t\t\t}\n\t\t}\n\n\t\t.filter-flow {\n\t\t\t> .vertical {\n\t\t\t\twidth: auto;\n\t\t\t}\n\t\t}\n\t}\n}\n\n.choiceBtn {\n\toverflow: hidden;\n\twidth: 100%;\n\theight: 24px;\n\ttext-overflow: ellipsis;\n\tpadding: 2px;\n\n\t&.active {\n\t\tbackground-color: $default-border;\n\t\tbackground-color: var(--border);\n\t}\n}\n\n.value-input-table {\n\ttd {\n\t\tvertical-align: top;\n\t}\n\tinput,\n\t.color-button {\n\t\twidth: 100px;\n\t}\n}\n</style>\n","<template>\n\t<div :class=\"{ slider: true, vertical }\" @keydown.stop>\n\t\t<label :for=\"_.uid\" v-if=\"!noInput\">{{ label }}</label>\n\t\t<div>\n\t\t\t<svg\n\t\t\t\tref=\"svg\"\n\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\tviewBox=\"0 0 271 24\"\n\t\t\t\t@mousedown=\"enterSlide\"\n\t\t\t\t@touchstart=\"enterSlide\"\n\t\t\t\t@mousemove=\"moveSlide\"\n\t\t\t\t@touchmove=\"moveSlide\"\n\t\t\t\t@mouseup=\"exitSlide\"\n\t\t\t\t@touchend=\"exitSlide\"\n\t\t\t>\n\t\t\t\t<defs>\n\t\t\t\t\t<linearGradient\n\t\t\t\t\t\t:id=\"`gradient${_.uid}`\"\n\t\t\t\t\t\t:x1=\"gradientOffset * 100 + '%'\"\n\t\t\t\t\t\ty1=\"0%\"\n\t\t\t\t\t\t:x2=\"(gradientOffset + 1) * 100 + '%'\"\n\t\t\t\t\t\ty2=\"0%\"\n\t\t\t\t\t\tspreadMethod=\"repeat\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<stop\n\t\t\t\t\t\t\tv-for=\"(color, idx) in gradientStops\"\n\t\t\t\t\t\t\t:key=\"idx\"\n\t\t\t\t\t\t\t:offset=\"(idx / (gradientStops.length - 1)) * 100 + '%'\"\n\t\t\t\t\t\t\t:style=\"'stop-color:' + color\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</linearGradient>\n\t\t\t\t</defs>\n\t\t\t\t<g>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M7 0H262V24H7z\"\n\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\tpaint-order=\"fill stroke markers\"\n\t\t\t\t\t\t:fill=\"`url(#gradient${_.uid})`\"\n\t\t\t\t\t/>\n\t\t\t\t\t<path :d=\"pointerPath\" stroke-width=\"2\" class=\"slider-pointer\" />\n\t\t\t\t</g>\n\t\t\t</svg>\n\t\t</div>\n\t\t<input\n\t\t\t:id=\"_.uid\"\n\t\t\tclass=\"sliderInput\"\n\t\t\tmin=\"0\"\n\t\t\t:max=\"maxValue\"\n\t\t\t:value=\"modelValue\"\n\t\t\ttype=\"number\"\n\t\t\tv-if=\"!noInput\"\n\t\t\t@input=\"$emit('update:modelValue', parseFloat($event.target.value))\"\n\t\t\t@keydown.stop\n\t\t/>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, Prop } from 'vue';\n\nconst sliderLength = 255;\nconst sliderOffset = 8;\n\nexport default defineComponent({\n\tprops: {\n\t\tlabel: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tgradientStops: {\n\t\t\trequired: true,\n\t\t} as Prop<string[]>,\n\t\tmodelValue: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tmaxValue: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tshiftGradient: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tnoInput: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tslideActive: false,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tpointerPath(): string {\n\t\t\tconst val = (this.modelValue / this.maxValue) * sliderLength;\n\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\treturn `M${val} 0L${val + 14} 0L${val + 7} 12Z`;\n\t\t},\n\t\tgradientOffset(): number {\n\t\t\tif (!this.shiftGradient) return 0;\n\t\t\tif (this.modelValue === 0) return 0;\n\t\t\treturn this.modelValue / this.maxValue;\n\t\t},\n\t},\n\tmethods: {\n\t\tenterSlide(event: MouseEvent | TouchEvent): void {\n\t\t\tthis.slideActive = true;\n\t\t\tthis.moveSlide(event);\n\t\t},\n\t\tmoveSlide(event: MouseEvent | TouchEvent) {\n\t\t\tif (!this.slideActive) return;\n\t\t\tconst svg = this.$refs.svg as HTMLElement;\n\t\t\tif (!svg.contains(event.target as Node) && event.target !== svg) return;\n\t\t\tif (event instanceof MouseEvent && event.which !== 1) {\n\t\t\t\tthis.slideActive = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst bounding = svg.getBoundingClientRect();\n\t\t\tconst scale =\n\t\t\t\tbounding.width / (sliderOffset + sliderLength + sliderOffset);\n\t\t\tconst x =\n\t\t\t\t(event instanceof MouseEvent\n\t\t\t\t\t? event.clientX\n\t\t\t\t\t: event.touches[0].clientX) - bounding.x;\n\t\t\tconst scaledX = x / scale;\n\t\t\tevent.preventDefault();\n\t\t\tconst value =\n\t\t\t\t(Math.max(Math.min(scaledX - sliderOffset, sliderLength), 0) /\n\t\t\t\t\tsliderLength) *\n\t\t\t\tthis.maxValue;\n\t\t\tthis.$emit('update:modelValue', value);\n\t\t},\n\t\texitSlide() {\n\t\t\tthis.slideActive = false;\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.slider {\n\tdisplay: table;\n\tlabel {\n\t\ttext-align: right;\n\t\twidth: 100px;\n\t}\n\n\tinput {\n\t\twidth: 52px;\n\t}\n\n\t&.vertical {\n\t\tsvg {\n\t\t\twidth: 100%;\n\t\t\theight: 24px;\n\t\t}\n\n\t\t> * {\n\t\t\tdisplay: table-row;\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\tsvg {\n\t\t\twidth: 271px;\n\t\t\theight: 24px;\n\t\t}\n\n\t\t> * {\n\t\t\tdisplay: table-cell;\n\t\t\tvertical-align: middle;\n\t\t}\n\t}\n}\n\nsvg g {\n\tstroke: $default-border;\n\tstroke: var(--border);\n\n\t.slider-pointer {\n\t\tfill: $default-text;\n\t\tfill: var(--text);\n\t}\n}\n</style>\n","\nimport { defineComponent, Prop } from 'vue';\n\nconst sliderLength = 255;\nconst sliderOffset = 8;\n\nexport default defineComponent({\n\tprops: {\n\t\tlabel: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tgradientStops: {\n\t\t\trequired: true,\n\t\t} as Prop<string[]>,\n\t\tmodelValue: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tmaxValue: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tshiftGradient: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tnoInput: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tslideActive: false,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tpointerPath(): string {\n\t\t\tconst val = (this.modelValue / this.maxValue) * sliderLength;\n\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\treturn `M${val} 0L${val + 14} 0L${val + 7} 12Z`;\n\t\t},\n\t\tgradientOffset(): number {\n\t\t\tif (!this.shiftGradient) return 0;\n\t\t\tif (this.modelValue === 0) return 0;\n\t\t\treturn this.modelValue / this.maxValue;\n\t\t},\n\t},\n\tmethods: {\n\t\tenterSlide(event: MouseEvent | TouchEvent): void {\n\t\t\tthis.slideActive = true;\n\t\t\tthis.moveSlide(event);\n\t\t},\n\t\tmoveSlide(event: MouseEvent | TouchEvent) {\n\t\t\tif (!this.slideActive) return;\n\t\t\tconst svg = this.$refs.svg as HTMLElement;\n\t\t\tif (!svg.contains(event.target as Node) && event.target !== svg) return;\n\t\t\tif (event instanceof MouseEvent && event.which !== 1) {\n\t\t\t\tthis.slideActive = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst bounding = svg.getBoundingClientRect();\n\t\t\tconst scale =\n\t\t\t\tbounding.width / (sliderOffset + sliderLength + sliderOffset);\n\t\t\tconst x =\n\t\t\t\t(event instanceof MouseEvent\n\t\t\t\t\t? event.clientX\n\t\t\t\t\t: event.touches[0].clientX) - bounding.x;\n\t\t\tconst scaledX = x / scale;\n\t\t\tevent.preventDefault();\n\t\t\tconst value =\n\t\t\t\t(Math.max(Math.min(scaledX - sliderOffset, sliderLength), 0) /\n\t\t\t\t\tsliderLength) *\n\t\t\t\tthis.maxValue;\n\t\t\tthis.$emit('update:modelValue', value);\n\t\t},\n\t\texitSlide() {\n\t\t\tthis.slideActive = false;\n\t\t},\n\t},\n});\n","import { render } from \"./slider.vue?vue&type=template&id=f14035dc&scoped=true\"\nimport script from \"./slider.vue?vue&type=script&lang=ts\"\nexport * from \"./slider.vue?vue&type=script&lang=ts\"\n\nimport \"./slider.vue?vue&type=style&index=0&id=f14035dc&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-f14035dc\"\n\nexport default script","<template>\n\t<div :class=\"{ color: true, vertical }\">\n\t\t<h2>{{ title }}</h2>\n\t\t<button @click=\"$emit('leave')\">OK</button>\n\t\t<table>\n\t\t\t<tr>\n\t\t\t\t<td>\n\t\t\t\t\t<button @click=\"mode = 'hsla'\">HSLA</button>\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<button @click=\"mode = 'rgba'\">RGBA</button>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\n\t\t<div class=\"column\">\n\t\t\t<slider-group :mode=\"mode\" v-model=\"color\" :relative=\"true\" />\n\t\t\t<div class=\"hex-selector\">\n\t\t\t\t<label class=\"hex-label\" :for=\"`hex_${_.uid}`\">Hex</label>\n\t\t\t\t<input\n\t\t\t\t\t:id=\"`hex_${_.uid}`\"\n\t\t\t\t\t:value=\"color\"\n\t\t\t\t\t@input=\"updateHex\"\n\t\t\t\t\t@keydown.stop\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<button @click=\"addSwatch\">Add as swatch</button>\n\t\t\t<d-button icon=\"colorize\" @click=\"pickColor\">Pick color</d-button>\n\t\t</div>\n\t\t<div id=\"color-swatches\" :class=\"{ vertical }\">\n\t\t\t<button\n\t\t\t\tv-for=\"swatch of swatches\"\n\t\t\t\tclass=\"swatch\"\n\t\t\t\t:key=\"swatch.color\"\n\t\t\t\t:style=\"{ backgroundColor: swatch.color }\"\n\t\t\t\t:title=\"swatch.label\"\n\t\t\t\t@click=\"\n\t\t\t\t\tcolor = swatch.color;\n\t\t\t\t\t$emit('leave');\n\t\t\t\t\"\n\t\t\t></button>\n\t\t</div>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport {\n\tColor,\n\tContentPack,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset, ReplaceContentPackAction } from '@/store/content';\nimport SliderGroup from './sliderGroup.vue';\nimport DButton from '../../../ui/d-button.vue';\nimport { RGBAColor } from '@/util/colors/rgb';\nimport { defineComponent, PropType } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\nimport eventBus, { ColorPickedEvent } from '@/eventbus/event-bus';\n\nconst generatedPackId = 'dddg.generated.colors';\n\nexport default defineComponent({\n\tcomponents: {\n\t\tSliderGroup,\n\t\tDButton,\n\t},\n\tinheritAttrs: false,\n\temits: ['leave', 'update:modelValue'],\n\tprops: {\n\t\tmodelValue: {\n\t\t\trequired: true,\n\t\t\ttype: String,\n\t\t},\n\t\ttitle: { default: '' },\n\t\tformat: {\n\t\t\ttype: String as PropType<'rgb' | 'hex'>,\n\t\t\tdefault: 'hex',\n\t\t},\n\t},\n\tdata: () => ({\n\t\tmode: 'hsla',\n\t\trelative: true,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tswatches(): DeepReadonly<Color[]> {\n\t\t\treturn this.$store.state.content.current.colors;\n\t\t},\n\t\tcolor: {\n\t\t\tget(): string {\n\t\t\t\tif (this.format === 'rgb') {\n\t\t\t\t\tconst rgb = RGBAColor.fromCss(this.modelValue);\n\t\t\t\t\treturn rgb.toHex();\n\t\t\t\t} else {\n\t\t\t\t\treturn this.modelValue;\n\t\t\t\t}\n\t\t\t},\n\t\t\tset(newColor: string) {\n\t\t\t\tif (this.format === 'rgb') {\n\t\t\t\t\tconst rgb = RGBAColor.fromCss(newColor);\n\t\t\t\t\tthis.$emit('update:modelValue', rgb.toCss());\n\t\t\t\t} else {\n\t\t\t\t\tthis.$emit('update:modelValue', newColor);\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t},\n\tmounted() {\n\t\teventBus.subscribe(ColorPickedEvent, this.settingColor);\n\t},\n\tunmounted() {\n\t\teventBus.unsubscribe(ColorPickedEvent, this.settingColor);\n\t},\n\tmethods: {\n\t\tsettingColor(ev: ColorPickedEvent) {\n\t\t\tthis.color = RGBAColor.fromCss(ev.color).toHex();\n\t\t},\n\t\tupdateHex(event: Event) {\n\t\t\tconst hex = (event.target as HTMLInputElement).value;\n\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\tif (RGBAColor.validHex(hex) && (hex.length === 7 || hex.length === 9)) {\n\t\t\t\tthis.color = hex;\n\t\t\t}\n\t\t},\n\t\taddSwatch() {\n\t\t\tif (this.swatches.find(swatch => swatch.color === this.color)) return;\n\n\t\t\tconst existingPack = this.$store.state.content.contentPacks.find(\n\t\t\t\tpack => pack.packId === 'generatedPackId'\n\t\t\t) || {\n\t\t\t\tpackId: generatedPackId,\n\t\t\t\tpackCredits: [''],\n\t\t\t\tdependencies: [],\n\t\t\t\tcharacters: [],\n\t\t\t\tfonts: [],\n\t\t\t\tbackgrounds: [],\n\t\t\t\tsprites: [],\n\t\t\t\tpoemStyles: [],\n\t\t\t\tpoemBackgrounds: [],\n\t\t\t\tcolors: [],\n\t\t\t};\n\n\t\t\tconst newPack: ContentPack<IAsset> = {\n\t\t\t\t...existingPack,\n\t\t\t\tcolors: [\n\t\t\t\t\t...existingPack.colors,\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: this.color,\n\t\t\t\t\t\tcolor: this.color,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t} as any;\n\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('content/replaceContentPack', {\n\t\t\t\t\tcontentPack: newPack,\n\t\t\t\t\tprocessed: true,\n\t\t\t\t} as ReplaceContentPackAction);\n\t\t\t});\n\t\t},\n\t\tpickColor(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.commit('ui/setColorPicker', true);\n\t\t\t});\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.color {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\n\th2 {\n\t\tfont-size: 20px;\n\t\tcolor: $default-text;\n\t\tcolor: var(--text);\n\t\tfont-family: riffic, sans-serif;\n\t\ttext-align: center;\n\t}\n\n\t&.vertical {\n\t\tflex-direction: row;\n\t\twidth: 100%;\n\n\t\t.column {\n\t\t\twidth: 100%;\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\tflex-direction: column;\n\t\t@include height-100();\n\n\t\th2 {\n\t\t\twriting-mode: vertical-rl;\n\t\t\theight: inherit;\n\t\t\twidth: min-content;\n\t\t}\n\n\t\t.column {\n\t\t\t@include height-100();\n\t\t}\n\t}\n}\n\n.hex-selector {\n\tdisplay: table;\n\tlabel {\n\t\ttext-align: right;\n\t\twidth: 100px;\n\t}\n\n\tinput {\n\t\tmargin-left: 7px;\n\t}\n\n\t&.vertical {\n\t\t> * {\n\t\t\tdisplay: table-row;\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\t> * {\n\t\t\tdisplay: table-cell;\n\t\t\tvertical-align: middle;\n\t\t}\n\t}\n}\n\n#color-swatches {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tjustify-content: space-evenly;\n\n\t&.vertical {\n\t\tmargin-top: 4px;\n\t\twidth: 100%;\n\t\tflex-direction: row;\n\t}\n\n\t&:not(.vertical) {\n\t\tmargin-left: 4px;\n\t\t@include height-100();\n\t\tflex-direction: column;\n\t}\n\n\t.swatch {\n\t\theight: 42px;\n\t\twidth: 42px;\n\t\tmargin: 1px;\n\t\tborder-color: black;\n\t}\n}\n</style>\n","<template>\n\t<div>\n\t\t<slider\n\t\t\t:label=\"label1\"\n\t\t\tv-model=\"v1\"\n\t\t\t:max-value=\"maxValue1\"\n\t\t\t:gradient-stops=\"stops1\"\n\t\t/>\n\t\t<slider\n\t\t\t:label=\"label2\"\n\t\t\tv-model=\"v2\"\n\t\t\t:max-value=\"maxValue2\"\n\t\t\t:gradient-stops=\"stops2\"\n\t\t/>\n\t\t<slider\n\t\t\t:label=\"label3\"\n\t\t\tv-model=\"v3\"\n\t\t\t:max-value=\"maxValue3\"\n\t\t\t:gradient-stops=\"stops3\"\n\t\t/>\n\t\t<slider\n\t\t\tlabel=\"Alpha\"\n\t\t\tv-model=\"a\"\n\t\t\t:max-value=\"255\"\n\t\t\t:gradient-stops=\"stopsAlpha\"\n\t\t/>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { IColor } from '@/util/colors/color';\nimport { RGBAColor } from '@/util/colors/rgb';\nimport { HSLAColor } from '@/util/colors/hsl';\nimport Slider from './slider.vue';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tcomponents: { Slider },\n\tprops: {\n\t\tmodelValue: {\n\t\t\ttype: String,\n\t\t\tvalidator: (val: string): boolean => !!val.match(/^#[0-9a-f]{6,8}$/i),\n\t\t},\n\t\tmode: {\n\t\t\ttype: String,\n\t\t} as Prop<'hsla' | 'rgba'>,\n\t\trelative: Boolean,\n\t},\n\tdata: () => ({\n\t\tlastRGBEmit: null as string | null,\n\t\tv1: 0,\n\t\tv2: 0,\n\t\tv3: 0,\n\t\ta: 0,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tmaxValue1(): number {\n\t\t\tif (this.mode === 'rgba') return 255;\n\t\t\treturn 360;\n\t\t},\n\t\tlabel1(): string {\n\t\t\tif (this.mode === 'rgba') return 'Red';\n\t\t\treturn 'Hue';\n\t\t},\n\t\tstops1(): string[] {\n\t\t\tlet stops: IColor[] = [];\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tconst g = this.relative ? this.v2 : 0;\n\t\t\t\tconst b = this.relative ? this.v3 : 0;\n\t\t\t\tstops = [new RGBAColor(0, g, b, 1), new RGBAColor(255, g, b, 1)];\n\t\t\t} else {\n\t\t\t\tconst s = this.relative ? this.v2 / 100 : 1;\n\t\t\t\tconst l = this.relative ? this.v3 / 100 : 0.5;\n\t\t\t\tstops = this.eightsStops(i => new HSLAColor(i, s, l, 1));\n\t\t\t}\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t\tmaxValue2(): number {\n\t\t\tif (this.mode === 'rgba') return 255;\n\t\t\treturn 100;\n\t\t},\n\t\tlabel2(): string {\n\t\t\tif (this.mode === 'rgba') return 'Green';\n\t\t\treturn 'Saturation';\n\t\t},\n\t\tstops2(): string[] {\n\t\t\tlet stops: IColor[] = [];\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tconst r = this.relative ? this.v1 : 0;\n\t\t\t\tconst b = this.relative ? this.v3 : 0;\n\t\t\t\tstops = [new RGBAColor(r, 0, b, 1), new RGBAColor(r, 255, b, 1)];\n\t\t\t} else {\n\t\t\t\tconst h = this.relative ? this.v1 / 360 : 0;\n\t\t\t\tconst l = this.relative ? this.v3 / 100 : 0.5;\n\t\t\t\tstops = this.eightsStops(i => new HSLAColor(h, i, l, 1));\n\t\t\t}\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t\tmaxValue3(): number {\n\t\t\tif (this.mode === 'rgba') return 255;\n\t\t\treturn 100;\n\t\t},\n\t\tlabel3(): string {\n\t\t\tif (this.mode === 'rgba') return 'Blue';\n\t\t\treturn 'Luminosity';\n\t\t},\n\t\tstops3(): string[] {\n\t\t\tlet stops: IColor[] = [];\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tconst r = this.relative ? this.v1 : 0;\n\t\t\t\tconst g = this.relative ? this.v2 : 0;\n\t\t\t\tstops = [new RGBAColor(r, g, 0, 1), new RGBAColor(r, g, 255, 1)];\n\t\t\t} else {\n\t\t\t\tconst h = this.relative ? this.v1 / 360 : 0;\n\t\t\t\tconst s = this.relative ? this.v2 / 100 : 0.5;\n\t\t\t\tstops = this.eightsStops(i => new HSLAColor(h, s, i, 1));\n\t\t\t}\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t\tstopsAlpha(): string[] {\n\t\t\tconst color = RGBAColor.fromHex(this.modelValue!);\n\t\t\treturn [\n\t\t\t\tnew RGBAColor(color.r, color.g, color.b, 0).toCss(),\n\t\t\t\tnew RGBAColor(color.r, color.g, color.b, 1).toCss(),\n\t\t\t];\n\t\t},\n\t},\n\tcreated() {\n\t\tthis.initValues();\n\t},\n\tmethods: {\n\t\tvalueChanged() {\n\t\t\tif (this.modelValue === this.lastRGBEmit) return;\n\t\t\tthis.initValues();\n\t\t},\n\t\tupdateValue() {\n\t\t\tlet newColor: IColor;\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tnewColor = new RGBAColor(this.v1, this.v2, this.v3, this.a / 255);\n\t\t\t} else {\n\t\t\t\tnewColor = new HSLAColor(\n\t\t\t\t\tthis.v1 / 360,\n\t\t\t\t\tthis.v2 / 100,\n\t\t\t\t\tthis.v3 / 100,\n\t\t\t\t\tthis.a / 255\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst rgbColor = newColor.toRgb().toHex();\n\t\t\tif (this.lastRGBEmit === rgbColor) return;\n\t\t\tif (rgbColor.length !== 9) {\n\t\t\t\tthrow new Error(`Invalid color code: ${rgbColor}`);\n\t\t\t}\n\t\t\tthis.lastRGBEmit = rgbColor;\n\t\t\tthis.$emit('update:modelValue', rgbColor);\n\t\t},\n\t\tinitValues() {\n\t\t\tconst color = RGBAColor.fromHex(this.modelValue!);\n\t\t\tthis.lastRGBEmit = color.toHex();\n\t\t\tthis.a = color.a * 255;\n\t\t\tif (this.mode === 'hsla') {\n\t\t\t\tconst hslColor = color.toHSL();\n\t\t\t\tthis.v1 = hslColor.h * 360;\n\t\t\t\tthis.v2 = hslColor.s * 100;\n\t\t\t\tthis.v3 = hslColor.l * 100;\n\t\t\t} else {\n\t\t\t\tthis.v1 = color.r;\n\t\t\t\tthis.v2 = color.g;\n\t\t\t\tthis.v3 = color.b;\n\t\t\t}\n\t\t},\n\t\teightsStops(gen: (i: number) => IColor): IColor[] {\n\t\t\tconst stops: IColor[] = [];\n\t\t\tfor (let i = 0; i <= 8; ++i) {\n\t\t\t\tstops.push(gen(i / 8));\n\t\t\t}\n\t\t\treturn stops;\n\t\t},\n\t},\n\twatch: {\n\t\tvalue() {\n\t\t\tthis.valueChanged();\n\t\t},\n\t\tv1() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\tv2() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\tv3() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\ta() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\tmode() {\n\t\t\tthis.initValues();\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.slider {\n\tdisplay: table;\n\tlabel {\n\t\ttext-align: right;\n\t\twidth: 100px;\n\t}\n\n\tinput {\n\t\twidth: 52px;\n\t}\n\n\t&.vertical {\n\t\t> * {\n\t\t\tdisplay: table-row;\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\t> * {\n\t\t\tdisplay: table-cell;\n\t\t\tvertical-align: middle;\n\t\t}\n\t}\n}\n</style>\n","\nimport { IColor } from '@/util/colors/color';\nimport { RGBAColor } from '@/util/colors/rgb';\nimport { HSLAColor } from '@/util/colors/hsl';\nimport Slider from './slider.vue';\nimport { defineComponent, Prop } from 'vue';\n\nexport default defineComponent({\n\tcomponents: { Slider },\n\tprops: {\n\t\tmodelValue: {\n\t\t\ttype: String,\n\t\t\tvalidator: (val: string): boolean => !!val.match(/^#[0-9a-f]{6,8}$/i),\n\t\t},\n\t\tmode: {\n\t\t\ttype: String,\n\t\t} as Prop<'hsla' | 'rgba'>,\n\t\trelative: Boolean,\n\t},\n\tdata: () => ({\n\t\tlastRGBEmit: null as string | null,\n\t\tv1: 0,\n\t\tv2: 0,\n\t\tv3: 0,\n\t\ta: 0,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tmaxValue1(): number {\n\t\t\tif (this.mode === 'rgba') return 255;\n\t\t\treturn 360;\n\t\t},\n\t\tlabel1(): string {\n\t\t\tif (this.mode === 'rgba') return 'Red';\n\t\t\treturn 'Hue';\n\t\t},\n\t\tstops1(): string[] {\n\t\t\tlet stops: IColor[] = [];\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tconst g = this.relative ? this.v2 : 0;\n\t\t\t\tconst b = this.relative ? this.v3 : 0;\n\t\t\t\tstops = [new RGBAColor(0, g, b, 1), new RGBAColor(255, g, b, 1)];\n\t\t\t} else {\n\t\t\t\tconst s = this.relative ? this.v2 / 100 : 1;\n\t\t\t\tconst l = this.relative ? this.v3 / 100 : 0.5;\n\t\t\t\tstops = this.eightsStops(i => new HSLAColor(i, s, l, 1));\n\t\t\t}\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t\tmaxValue2(): number {\n\t\t\tif (this.mode === 'rgba') return 255;\n\t\t\treturn 100;\n\t\t},\n\t\tlabel2(): string {\n\t\t\tif (this.mode === 'rgba') return 'Green';\n\t\t\treturn 'Saturation';\n\t\t},\n\t\tstops2(): string[] {\n\t\t\tlet stops: IColor[] = [];\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tconst r = this.relative ? this.v1 : 0;\n\t\t\t\tconst b = this.relative ? this.v3 : 0;\n\t\t\t\tstops = [new RGBAColor(r, 0, b, 1), new RGBAColor(r, 255, b, 1)];\n\t\t\t} else {\n\t\t\t\tconst h = this.relative ? this.v1 / 360 : 0;\n\t\t\t\tconst l = this.relative ? this.v3 / 100 : 0.5;\n\t\t\t\tstops = this.eightsStops(i => new HSLAColor(h, i, l, 1));\n\t\t\t}\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t\tmaxValue3(): number {\n\t\t\tif (this.mode === 'rgba') return 255;\n\t\t\treturn 100;\n\t\t},\n\t\tlabel3(): string {\n\t\t\tif (this.mode === 'rgba') return 'Blue';\n\t\t\treturn 'Luminosity';\n\t\t},\n\t\tstops3(): string[] {\n\t\t\tlet stops: IColor[] = [];\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tconst r = this.relative ? this.v1 : 0;\n\t\t\t\tconst g = this.relative ? this.v2 : 0;\n\t\t\t\tstops = [new RGBAColor(r, g, 0, 1), new RGBAColor(r, g, 255, 1)];\n\t\t\t} else {\n\t\t\t\tconst h = this.relative ? this.v1 / 360 : 0;\n\t\t\t\tconst s = this.relative ? this.v2 / 100 : 0.5;\n\t\t\t\tstops = this.eightsStops(i => new HSLAColor(h, s, i, 1));\n\t\t\t}\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t\tstopsAlpha(): string[] {\n\t\t\tconst color = RGBAColor.fromHex(this.modelValue!);\n\t\t\treturn [\n\t\t\t\tnew RGBAColor(color.r, color.g, color.b, 0).toCss(),\n\t\t\t\tnew RGBAColor(color.r, color.g, color.b, 1).toCss(),\n\t\t\t];\n\t\t},\n\t},\n\tcreated() {\n\t\tthis.initValues();\n\t},\n\tmethods: {\n\t\tvalueChanged() {\n\t\t\tif (this.modelValue === this.lastRGBEmit) return;\n\t\t\tthis.initValues();\n\t\t},\n\t\tupdateValue() {\n\t\t\tlet newColor: IColor;\n\t\t\tif (this.mode === 'rgba') {\n\t\t\t\tnewColor = new RGBAColor(this.v1, this.v2, this.v3, this.a / 255);\n\t\t\t} else {\n\t\t\t\tnewColor = new HSLAColor(\n\t\t\t\t\tthis.v1 / 360,\n\t\t\t\t\tthis.v2 / 100,\n\t\t\t\t\tthis.v3 / 100,\n\t\t\t\t\tthis.a / 255\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst rgbColor = newColor.toRgb().toHex();\n\t\t\tif (this.lastRGBEmit === rgbColor) return;\n\t\t\tif (rgbColor.length !== 9) {\n\t\t\t\tthrow new Error(`Invalid color code: ${rgbColor}`);\n\t\t\t}\n\t\t\tthis.lastRGBEmit = rgbColor;\n\t\t\tthis.$emit('update:modelValue', rgbColor);\n\t\t},\n\t\tinitValues() {\n\t\t\tconst color = RGBAColor.fromHex(this.modelValue!);\n\t\t\tthis.lastRGBEmit = color.toHex();\n\t\t\tthis.a = color.a * 255;\n\t\t\tif (this.mode === 'hsla') {\n\t\t\t\tconst hslColor = color.toHSL();\n\t\t\t\tthis.v1 = hslColor.h * 360;\n\t\t\t\tthis.v2 = hslColor.s * 100;\n\t\t\t\tthis.v3 = hslColor.l * 100;\n\t\t\t} else {\n\t\t\t\tthis.v1 = color.r;\n\t\t\t\tthis.v2 = color.g;\n\t\t\t\tthis.v3 = color.b;\n\t\t\t}\n\t\t},\n\t\teightsStops(gen: (i: number) => IColor): IColor[] {\n\t\t\tconst stops: IColor[] = [];\n\t\t\tfor (let i = 0; i <= 8; ++i) {\n\t\t\t\tstops.push(gen(i / 8));\n\t\t\t}\n\t\t\treturn stops;\n\t\t},\n\t},\n\twatch: {\n\t\tvalue() {\n\t\t\tthis.valueChanged();\n\t\t},\n\t\tv1() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\tv2() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\tv3() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\ta() {\n\t\t\tthis.updateValue();\n\t\t},\n\t\tmode() {\n\t\t\tthis.initValues();\n\t\t},\n\t},\n});\n","import { render } from \"./sliderGroup.vue?vue&type=template&id=24b7dbc3&scoped=true\"\nimport script from \"./sliderGroup.vue?vue&type=script&lang=ts\"\nexport * from \"./sliderGroup.vue?vue&type=script&lang=ts\"\n\nimport \"./sliderGroup.vue?vue&type=style&index=0&id=24b7dbc3&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-24b7dbc3\"\n\nexport default script","\nimport {\n\tColor,\n\tContentPack,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset, ReplaceContentPackAction } from '@/store/content';\nimport SliderGroup from './sliderGroup.vue';\nimport DButton from '../../../ui/d-button.vue';\nimport { RGBAColor } from '@/util/colors/rgb';\nimport { defineComponent, PropType } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\nimport eventBus, { ColorPickedEvent } from '@/eventbus/event-bus';\n\nconst generatedPackId = 'dddg.generated.colors';\n\nexport default defineComponent({\n\tcomponents: {\n\t\tSliderGroup,\n\t\tDButton,\n\t},\n\tinheritAttrs: false,\n\temits: ['leave', 'update:modelValue'],\n\tprops: {\n\t\tmodelValue: {\n\t\t\trequired: true,\n\t\t\ttype: String,\n\t\t},\n\t\ttitle: { default: '' },\n\t\tformat: {\n\t\t\ttype: String as PropType<'rgb' | 'hex'>,\n\t\t\tdefault: 'hex',\n\t\t},\n\t},\n\tdata: () => ({\n\t\tmode: 'hsla',\n\t\trelative: true,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tswatches(): DeepReadonly<Color[]> {\n\t\t\treturn this.$store.state.content.current.colors;\n\t\t},\n\t\tcolor: {\n\t\t\tget(): string {\n\t\t\t\tif (this.format === 'rgb') {\n\t\t\t\t\tconst rgb = RGBAColor.fromCss(this.modelValue);\n\t\t\t\t\treturn rgb.toHex();\n\t\t\t\t} else {\n\t\t\t\t\treturn this.modelValue;\n\t\t\t\t}\n\t\t\t},\n\t\t\tset(newColor: string) {\n\t\t\t\tif (this.format === 'rgb') {\n\t\t\t\t\tconst rgb = RGBAColor.fromCss(newColor);\n\t\t\t\t\tthis.$emit('update:modelValue', rgb.toCss());\n\t\t\t\t} else {\n\t\t\t\t\tthis.$emit('update:modelValue', newColor);\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t},\n\tmounted() {\n\t\teventBus.subscribe(ColorPickedEvent, this.settingColor);\n\t},\n\tunmounted() {\n\t\teventBus.unsubscribe(ColorPickedEvent, this.settingColor);\n\t},\n\tmethods: {\n\t\tsettingColor(ev: ColorPickedEvent) {\n\t\t\tthis.color = RGBAColor.fromCss(ev.color).toHex();\n\t\t},\n\t\tupdateHex(event: Event) {\n\t\t\tconst hex = (event.target as HTMLInputElement).value;\n\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\tif (RGBAColor.validHex(hex) && (hex.length === 7 || hex.length === 9)) {\n\t\t\t\tthis.color = hex;\n\t\t\t}\n\t\t},\n\t\taddSwatch() {\n\t\t\tif (this.swatches.find(swatch => swatch.color === this.color)) return;\n\n\t\t\tconst existingPack = this.$store.state.content.contentPacks.find(\n\t\t\t\tpack => pack.packId === 'generatedPackId'\n\t\t\t) || {\n\t\t\t\tpackId: generatedPackId,\n\t\t\t\tpackCredits: [''],\n\t\t\t\tdependencies: [],\n\t\t\t\tcharacters: [],\n\t\t\t\tfonts: [],\n\t\t\t\tbackgrounds: [],\n\t\t\t\tsprites: [],\n\t\t\t\tpoemStyles: [],\n\t\t\t\tpoemBackgrounds: [],\n\t\t\t\tcolors: [],\n\t\t\t};\n\n\t\t\tconst newPack: ContentPack<IAsset> = {\n\t\t\t\t...existingPack,\n\t\t\t\tcolors: [\n\t\t\t\t\t...existingPack.colors,\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: this.color,\n\t\t\t\t\t\tcolor: this.color,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t} as any;\n\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('content/replaceContentPack', {\n\t\t\t\t\tcontentPack: newPack,\n\t\t\t\t\tprocessed: true,\n\t\t\t\t} as ReplaceContentPackAction);\n\t\t\t});\n\t\t},\n\t\tpickColor(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.commit('ui/setColorPicker', true);\n\t\t\t});\n\t\t},\n\t},\n});\n","import { render } from \"./color.vue?vue&type=template&id=8ecc10b2&scoped=true\"\nimport script from \"./color.vue?vue&type=script&lang=ts\"\nexport * from \"./color.vue?vue&type=script&lang=ts\"\n\nimport \"./color.vue?vue&type=style&index=0&id=8ecc10b2&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-8ecc10b2\"\n\nexport default script","import { ICommand } from '@/eventbus/command';\nimport { CompositeModes } from '@/renderer/rendererContext';\nimport { exhaust } from '@/util/exhaust';\n\nexport type SpriteFilter =\n\t| INumericSpriteFilter<'blur'>\n\t| INumericSpriteFilter<'brightness'>\n\t| INumericSpriteFilter<'contrast'>\n\t| IDropShadowSpriteFilter\n\t| INumericSpriteFilter<'grayscale'>\n\t| INumericSpriteFilter<'hue-rotate'>\n\t| INumericSpriteFilter<'invert'>\n\t| INumericSpriteFilter<'opacity'>\n\t| INumericSpriteFilter<'saturate'>\n\t| INumericSpriteFilter<'sepia'>;\n\nexport const percentageValue = new Set<SpriteFilter['type']>([\n\t'brightness',\n\t'contrast',\n\t'grayscale',\n\t'invert',\n\t'opacity',\n\t'saturate',\n\t'sepia',\n]);\n\nexport interface IHasSpriteFilters {\n\tfilters: SpriteFilter[];\n\tcomposite: CompositeModes;\n}\n\nexport interface INumericSpriteFilter<K extends string> {\n\ttype: K;\n\tvalue: number;\n}\n\nexport interface IDropShadowSpriteFilter {\n\ttype: 'drop-shadow';\n\toffsetX: number;\n\toffsetY: number;\n\tblurRadius: number;\n\tcolor: string;\n}\n\nexport interface ISetFilterValue {\n\ttype: Exclude<SpriteFilter['type'], 'drop-shadow'>;\n\tvalue: number;\n}\n\nexport interface ISetDropShadowFilter {\n\ttype: 'drop-shadow';\n\toffsetX?: number;\n\toffsetY?: number;\n\tblurRadius?: number;\n\tcolor?: string;\n}\n\nexport function addFilter(\n\taction: IAddFilterAction,\n\tobjLookup: (id: string) => IHasSpriteFilters,\n\tsetMutation: (mutation: ISetFiltersMutation) => void\n): void {\n\tconst obj = objLookup(action.id);\n\tconst filters = [...obj.filters];\n\tlet newFilter: SpriteFilter;\n\tswitch (action.type) {\n\t\tcase 'hue-rotate':\n\t\t\tnewFilter = {\n\t\t\t\ttype: action.type,\n\t\t\t\tvalue: 0,\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'sepia':\n\t\tcase 'invert':\n\t\tcase 'blur':\n\t\tcase 'grayscale':\n\t\tcase 'brightness':\n\t\tcase 'contrast':\n\t\tcase 'opacity':\n\t\tcase 'saturate':\n\t\t\tnewFilter = {\n\t\t\t\ttype: action.type,\n\t\t\t\tvalue: 1,\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'drop-shadow':\n\t\t\tnewFilter = {\n\t\t\t\ttype: action.type,\n\t\t\t\tblurRadius: 0,\n\t\t\t\toffsetX: 10,\n\t\t\t\toffsetY: 10,\n\t\t\t\tcolor: '#555555',\n\t\t\t};\n\t\t\tbreak;\n\t\tdefault:\n\t\t\texhaust(action.type);\n\t}\n\tfilters.splice(action.idx, 0, newFilter);\n\n\tsetMutation({\n\t\tid: action.id,\n\t\tfilters,\n\t});\n}\n\nexport function removeFilter(\n\taction: IRemoveFilterAction,\n\tobjLookup: (id: string) => IHasSpriteFilters,\n\tsetMutation: (mutation: ISetFiltersMutation) => void\n) {\n\tconst obj = objLookup(action.id);\n\tconst filters = [...obj.filters];\n\tfilters.splice(action.idx, 1);\n\tsetMutation({\n\t\tid: action.id,\n\t\tfilters,\n\t} as ISetFiltersMutation);\n}\n\nexport function moveFilter(\n\taction: IMoveFilterAction,\n\tobjLookup: (id: string) => IHasSpriteFilters,\n\tsetMutation: (mutation: ISetFiltersMutation) => void\n) {\n\tconst obj = objLookup(action.id);\n\tconst filters = [...obj.filters];\n\tconst filter = filters[action.idx];\n\tfilters.splice(action.idx, 1);\n\tfilters.splice(action.idx + action.moveBy, 0, filter);\n\tsetMutation({\n\t\tid: action.id,\n\t\tfilters,\n\t} as ISetFiltersMutation);\n}\n\nexport function setFilter(\n\taction: ISetFilterAction,\n\tobjLookup: (id: string) => IHasSpriteFilters,\n\tsetMutation: (mutation: ISetFiltersMutation) => void\n) {\n\tconst obj = objLookup(action.id);\n\tconst filters = [...obj.filters];\n\tconst filter = { ...filters[action.idx] } as SpriteFilter;\n\tfilters[action.idx] = filter;\n\n\tif (filter.type === 'drop-shadow') {\n\t\tif (action.blurRadius !== undefined) {\n\t\t\tfilter.blurRadius = action.blurRadius;\n\t\t}\n\t\tif (action.color !== undefined) {\n\t\t\tfilter.color = action.color;\n\t\t}\n\t\tif (action.offsetX !== undefined) {\n\t\t\tfilter.offsetX = action.offsetX;\n\t\t}\n\t\tif (action.offsetY !== undefined) {\n\t\t\tfilter.offsetY = action.offsetY;\n\t\t}\n\t} else {\n\t\tfilter.value = action.value!;\n\t}\n\tsetMutation({\n\t\tid: action.id,\n\t\tfilters,\n\t} as ISetFiltersMutation);\n}\n\nexport type SetFilterValue = ISetFilterValue | ISetDropShadowFilter;\n\nexport function applyFilter(obj: IHasSpriteFilters, command: SetFilterValue) {\n\tconst filter = obj.filters.find(f => f.type === command.type);\n\tif (!filter) return;\n\tObject.assign(filter, command);\n}\n\nexport interface ISetCompositionMutation extends ICommand {\n\treadonly composite: CompositeModes;\n}\n\nexport interface ISetFiltersMutation extends ICommand {\n\treadonly filters: SpriteFilter[];\n}\n\nexport interface IAddFilterAction extends ICommand {\n\treadonly type: SpriteFilter['type'];\n\treadonly idx: number;\n}\n\nexport interface IRemoveFilterAction extends ICommand {\n\treadonly idx: number;\n}\n\nexport interface IMoveFilterAction extends ICommand {\n\treadonly idx: number;\n\treadonly moveBy: number;\n}\n\nexport interface ISetFilterAction extends ICommand {\n\treadonly idx: number;\n\treadonly value?: number;\n\treadonly offsetX?: number;\n\treadonly offsetY?: number;\n\treadonly blurRadius?: number;\n\treadonly color?: string;\n}\n","\nimport DFlow from '@/components/ui/d-flow.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport Slider from '@/components/toolbox/subtools/color/slider.vue';\nimport Color from '@/components/toolbox/subtools/color/color.vue';\nimport { defineComponent, Prop, PropType } from 'vue';\nimport { CompositeModes } from '@/renderer/rendererContext';\nimport { DeepReadonly } from '@/util/readonly';\nimport {\n\tIHasSpriteFilters,\n\tINumericSpriteFilter,\n\tpercentageValue,\n\tSpriteFilter,\n} from '@/store/sprite_options';\nimport { exhaust } from '@/util/exhaust';\nimport {\n\tIAddFilterAction,\n\tIMoveFilterAction,\n\tIRemoveFilterAction,\n\tISetCompositionMutation,\n\tISetFilterAction,\n} from '@/store/sprite_options';\nimport { IColor } from '@/util/colors/color';\nimport { HSLAColor } from '@/util/colors/hsl';\nimport L from '@/components/ui/link.vue';\n\nconst filterText: ReadonlyMap<SpriteFilter['type'], string> = new Map<\n\tSpriteFilter['type'],\n\tstring\n>([\n\t['blur', 'Blur'],\n\t['brightness', 'Brightness'],\n\t['contrast', 'Contrast'],\n\t['grayscale', 'Grayscale'],\n\t['hue-rotate', 'Rotate hue'],\n\t['invert', 'Invert colors'],\n\t['opacity', 'Opacity'],\n\t['saturate', 'Saturate'],\n\t['sepia', 'Sepia'],\n\t['drop-shadow', 'Drop shadow'],\n]);\n\nconst filters: ReadonlyArray<SpriteFilter['type']> = Array.from(\n\tfilterText.keys()\n).sort();\n\nexport default defineComponent({\n\tcomponents: { DFlow, DFieldset, Color, Slider, L },\n\tprops: {\n\t\ttype: {\n\t\t\ttype: String as PropType<'object' | 'background' | 'panel'>,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t},\n\t\tid: {\n\t\t\trequired: true,\n\t\t} as Prop<string | number>,\n\t\tnoComposition: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['leave'],\n\tdata: () => ({\n\t\taddEffectSelection: '' as SpriteFilter['type'] | '',\n\t\tcurrentFilterIdx: 0,\n\t\tshowShadowColor: false,\n\t}),\n\tcomputed: {\n\t\tobject(): DeepReadonly<IHasSpriteFilters> {\n\t\t\tswitch (this.type) {\n\t\t\t\tcase 'object':\n\t\t\t\t\treturn this.$store.state.objects.objects[this.id!];\n\t\t\t\tcase 'background':\n\t\t\t\t\treturn this.$store.state.panels.panels[this.id!].background;\n\t\t\t\tcase 'panel':\n\t\t\t\t\treturn this.$store.state.panels.panels[this.id!];\n\t\t\t\tdefault:\n\t\t\t\t\texhaust(this.type);\n\t\t\t\t\treturn null!;\n\t\t\t}\n\t\t},\n\t\tcompositionMode: {\n\t\t\tget(): CompositeModes {\n\t\t\t\treturn this.object.composite;\n\t\t\t},\n\t\t\tset(composite: CompositeModes): void {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tswitch (this.type) {\n\t\t\t\t\t\tcase 'object':\n\t\t\t\t\t\t\tthis.$store.commit('objects/setComposition', {\n\t\t\t\t\t\t\t\tid: this.id,\n\t\t\t\t\t\t\t\tcomposite,\n\t\t\t\t\t\t\t} as ISetCompositionMutation);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'background':\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'panel':\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\texhaust(this.type);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tfilters(): DeepReadonly<SpriteFilter[]> {\n\t\t\treturn this.object.filters;\n\t\t},\n\t\tfilterTypes(): ReadonlyArray<SpriteFilter['type']> {\n\t\t\ttry {\n\t\t\t\tconst canvas = document.createElement('canvas');\n\t\t\t\tconst context = canvas.getContext('2d')!;\n\t\t\t\tif ('filter' in context) {\n\t\t\t\t\treturn filters;\n\t\t\t\t}\n\t\t\t} catch (_e) {}\n\t\t\treturn ['opacity'];\n\t\t},\n\t\tcurrentFilter(): DeepReadonly<SpriteFilter> | null {\n\t\t\treturn this.filters[this.currentFilterIdx] || null;\n\t\t},\n\t\tisPercentFilter(): boolean {\n\t\t\tconst filter = this.currentFilter;\n\t\t\tif (!filter) return false;\n\t\t\treturn percentageValue.has(filter.type);\n\t\t},\n\t\tmaxValue(): number | undefined {\n\t\t\tconst filter = this.currentFilter;\n\t\t\tif (!filter) return undefined;\n\n\t\t\tif (filter.type === 'hue-rotate') return 360;\n\t\t\tif (\n\t\t\t\tfilter.type === 'grayscale' ||\n\t\t\t\tfilter.type === 'sepia' ||\n\t\t\t\tfilter.type === 'opacity' ||\n\t\t\t\tfilter.type === 'invert'\n\t\t\t)\n\t\t\t\treturn 100;\n\n\t\t\treturn undefined;\n\t\t},\n\t\tminValue(): number | undefined {\n\t\t\tconst filter = this.currentFilter;\n\t\t\tif (!filter) return undefined;\n\n\t\t\tswitch (filter.type) {\n\t\t\t\tcase 'blur':\n\t\t\t\tcase 'brightness':\n\t\t\t\tcase 'contrast':\n\t\t\t\tcase 'grayscale':\n\t\t\t\tcase 'hue-rotate':\n\t\t\t\tcase 'invert':\n\t\t\t\tcase 'opacity':\n\t\t\t\tcase 'saturate':\n\t\t\t\tcase 'sepia':\n\t\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t},\n\t\tshadowColor: {\n\t\t\tget(): string | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('color' in filter)) return undefined;\n\t\t\t\treturn filter.color;\n\t\t\t},\n\t\t\tset(color: string) {\n\t\t\t\tthis.setValue({ color });\n\t\t\t},\n\t\t},\n\t\tshadowX: {\n\t\t\tget(): number | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('offsetX' in filter)) return undefined;\n\t\t\t\treturn filter.offsetX;\n\t\t\t},\n\t\t\tset(offsetX: number) {\n\t\t\t\tthis.setValue({ offsetX });\n\t\t\t},\n\t\t},\n\t\tshadowY: {\n\t\t\tget(): number | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('offsetY' in filter)) return undefined;\n\t\t\t\treturn filter.offsetY;\n\t\t\t},\n\t\t\tset(offsetY: number) {\n\t\t\t\tthis.setValue({ offsetY });\n\t\t\t},\n\t\t},\n\t\tshadowBlur: {\n\t\t\tget(): number | undefined {\n\t\t\t\tconst filter = this.currentFilter;\n\t\t\t\tif (!filter) return undefined;\n\t\t\t\tif (!('blurRadius' in filter)) return undefined;\n\t\t\t\treturn filter.blurRadius;\n\t\t\t},\n\t\t\tset(blurRadius: number) {\n\t\t\t\tthis.setValue({ blurRadius });\n\t\t\t},\n\t\t},\n\t\thueStops(): string[] {\n\t\t\tconst stops = this.eightsStops(i => new HSLAColor(i, 1, 0.5, 1));\n\t\t\treturn stops.map(stop => stop.toRgb().toCss());\n\t\t},\n\t},\n\tmethods: {\n\t\tgetFilterLabel(type: SpriteFilter['type']): string {\n\t\t\treturn filterText.get(type)!;\n\t\t},\n\t\tgetFilterText(filter: SpriteFilter): string {\n\t\t\tif (percentageValue.has(filter.type)) {\n\t\t\t\treturn `${filterText.get(filter.type)} ${(\n\t\t\t\t\t(filter as INumericSpriteFilter<any>).value * 100\n\t\t\t\t).toFixed()}%`;\n\t\t\t} else if (filter.type === 'hue-rotate') {\n\t\t\t\treturn `${filterText.get(filter.type)} ${filter.value.toFixed()}°`;\n\t\t\t} else if (filter.type === 'blur') {\n\t\t\t\treturn `${filterText.get(filter.type)} ${filter.value.toFixed()}px`;\n\t\t\t}\n\t\t\treturn filterText.get(filter.type)!;\n\t\t},\n\t\tobjectTypeScope(command: string): string {\n\t\t\tswitch (this.type) {\n\t\t\t\tcase 'object':\n\t\t\t\t\treturn 'objects/' + command;\n\t\t\t\tcase 'background':\n\t\t\t\t\treturn (\n\t\t\t\t\t\t'panels/background' + command[0].toUpperCase() + command.slice(1)\n\t\t\t\t\t);\n\t\t\t\tcase 'panel':\n\t\t\t\t\treturn 'panels/' + command;\n\t\t\t}\n\t\t},\n\t\taddFilter() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch(this.objectTypeScope('addFilter'), {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\ttype: this.addEffectSelection,\n\t\t\t\t\tidx: this.currentFilterIdx + 1,\n\t\t\t\t} as IAddFilterAction);\n\t\t\t\treturn;\n\t\t\t});\n\t\t},\n\t\tselectFilter(idx: number) {\n\t\t\tthis.currentFilterIdx = idx;\n\t\t},\n\t\tremoveFilter() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch(this.objectTypeScope('removeFilter'), {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tidx: this.currentFilterIdx,\n\t\t\t\t} as IRemoveFilterAction);\n\t\t\t\treturn;\n\t\t\t});\n\t\t},\n\t\tmoveFilter(moveBy: number) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch(this.objectTypeScope('moveFilter'), {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tidx: this.currentFilterIdx,\n\t\t\t\t\tmoveBy,\n\t\t\t\t} as IMoveFilterAction);\n\t\t\t\tthis.currentFilterIdx += moveBy;\n\t\t\t\treturn;\n\t\t\t});\n\t\t},\n\t\tsetValue(value: Omit<ISetFilterAction, 'id' | 'idx'>) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch(this.objectTypeScope('setFilter'), {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tidx: this.currentFilterIdx,\n\t\t\t\t\t...value,\n\t\t\t\t} as ISetFilterAction);\n\t\t\t});\n\t\t},\n\t\teightsStops(gen: (i: number) => IColor): IColor[] {\n\t\t\tconst stops: IColor[] = [];\n\t\t\tfor (let i = 0; i <= 8; ++i) {\n\t\t\t\tstops.push(gen(i / 8));\n\t\t\t}\n\t\t\treturn stops;\n\t\t},\n\t},\n});\n","import { render } from \"./image-options.vue?vue&type=template&id=4dd06317&scoped=true\"\nimport script from \"./image-options.vue?vue&type=script&lang=ts\"\nexport * from \"./image-options.vue?vue&type=script&lang=ts\"\n\nimport \"./image-options.vue?vue&type=style&index=0&id=4dd06317&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-4dd06317\"\n\nexport default script","<template>\n\t<color v-if=\"colorSelector\" v-model=\"selectedColor\" @leave=\"applyColor\" />\n\t<div v-else :class=\"{ 'text-subpanel': true, vertical }\">\n\t\t<h2>{{ title }}</h2>\n\t\t<div class=\"column ok-col\">\n\t\t\t<button @click=\"$emit('leave')\">OK</button>\n\t\t</div>\n\t\t<div class=\"column\">\n\t\t\t<textarea\n\t\t\t\tref=\"textArea\"\n\t\t\t\t:value=\"modelValue\"\n\t\t\t\t@input=\"onValueChanged\"\n\t\t\t\t@keydown.stop\n\t\t\t\t@keypress.stop\n\t\t\t/>\n\t\t</div>\n\t\t<div class=\"column error-col\" v-if=\"error\">{{ error }}</div>\n\t\t<div class=\"column\">\n\t\t\t<button @click=\"insertText('\\\\\\\\')\" class=\"style-button\">Insert \\</button>\n\t\t\t<button @click=\"insertText('\\\\{')\" class=\"style-button\">Insert {</button>\n\t\t\t<button @click=\"insertText('\\\\}')\" class=\"style-button\">Insert }</button>\n\t\t</div>\n\t\t<p class=\"hint-col\">Apply style to selected text:</p>\n\t\t<div class=\"column\">\n\t\t\t<button\n\t\t\t\t@click=\"insertCommand('b')\"\n\t\t\t\tclass=\"style-button\"\n\t\t\t\tstyle=\"font-weight: bold\"\n\t\t\t>\n\t\t\t\tBold\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t@click=\"insertCommand('i')\"\n\t\t\t\tclass=\"style-button\"\n\t\t\t\tstyle=\"font-style: italic\"\n\t\t\t>\n\t\t\t\tItalics\n\t\t\t</button>\n\t\t\t<button @click=\"insertCommand('plain')\" class=\"style-button\">\n\t\t\t\tPlain\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t@click=\"insertCommand('edited')\"\n\t\t\t\tclass=\"style-button edited-style\"\n\t\t\t>\n\t\t\t\tEdited\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\t@click=\"insertCommand('k', 2)\"\n\t\t\t\tclass=\"style-button\"\n\t\t\t\tstyle=\"letter-spacing: 5px;\"\n\t\t\t>\n\t\t\t\tKerning\n\t\t\t</button>\n\t\t</div>\n\t\t<div class=\"column\">\n\t\t\t<button @click=\"insertCommand('alpha', 0.5)\" class=\"style-button\">\n\t\t\t\tAlpha\n\t\t\t</button>\n\t\t</div>\n\t\t<div class=\"column\">\n\t\t\t<button\n\t\t\t\t@click=\"insertCommand('size', 12)\"\n\t\t\t\tclass=\"style-button\"\n\t\t\t\tstyle=\"font-size: 20px\"\n\t\t\t>\n\t\t\t\tFont size\n\t\t\t</button>\n\t\t\t<select v-model=\"selectedFont\" class=\"style-button\">\n\t\t\t\t<option value>Font</option>\n\t\t\t\t<option value=\"aller\" style=\"font-family: aller\"\n\t\t\t\t\t>Aller (Textbox)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"riffic\" style=\"font-family: riffic\"\n\t\t\t\t\t>Riffic (Bold text)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"hashtag\" style=\"font-family: hashtag\"\n\t\t\t\t\t>Hashtag (Sayori)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"ammy_handwriting\" style=\"font-family: ammy_handwriting\"\n\t\t\t\t\t>Ammy's Handwriting (Natsuki)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"journal\" style=\"font-family: journal\"\n\t\t\t\t\t>Journal (Monika)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"jp_hand_slanted\" style=\"font-family: jp_hand_slanted\"\n\t\t\t\t\t>JP Hand Slanted (Yuri)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"damagrafik_script\" style=\"font-family: damagrafik_script\"\n\t\t\t\t\t>Damagrafik (Yuri, Act 2)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"as_i_lay_dying\" style=\"font-family: as_i_lay_dying\"\n\t\t\t\t\t>As I Lay Dying (Yuri, Act Unused)</option\n\t\t\t\t>\n\t\t\t\t<option value=\"halogen\" style=\"font-family: halogen\"\n\t\t\t\t\t>Halogen (MC)</option\n\t\t\t\t>\n\t\t\t</select>\n\t\t\t<button @click=\"selectColor('text')\" class=\"style-button\">\n\t\t\t\tText color\n\t\t\t</button>\n\t\t\t<button @click=\"selectColor('outline')\" class=\"style-button\">\n\t\t\t\tOutline color\n\t\t\t</button>\n\t\t</div>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport Color from '../color/color.vue';\nimport { TextRenderer } from '@/renderer/textRenderer/textRenderer';\nimport { defineComponent } from 'vue';\nimport getConstants from '@/constants';\n\nexport default defineComponent({\n\tinheritAttrs: false,\n\tcomponents: { Color },\n\tprops: {\n\t\tmodelValue: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tdata: () => ({\n\t\tcolorSelector: '' as '' | 'text' | 'outline',\n\t\tselectedFont: '',\n\t\tselectedColor: '#000000',\n\t\trememberedStart: 0,\n\t\trememberedEnd: 0,\n\t\terror: '',\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\twatch: {\n\t\tselectedFont() {\n\t\t\tif (this.selectedFont === '') return;\n\t\t\tthis.insertCommand('font', this.selectedFont);\n\t\t\tthis.selectedFont = '';\n\t\t},\n\t},\n\tmethods: {\n\t\tonValueChanged() {\n\t\t\tconst constants = getConstants();\n\t\t\tconst val = (this.$refs.textArea as HTMLTextAreaElement).value;\n\t\t\ttry {\n\t\t\t\t// tslint:disable-next-line: no-unused-expression\n\t\t\t\tnew TextRenderer(val, constants.TextBox.NameboxTextStyle);\n\t\t\t\tthis.error = '';\n\t\t\t} catch (e) {\n\t\t\t\tthis.error = (e as Error).message;\n\t\t\t}\n\t\t\tthis.$emit('update:modelValue', val);\n\t\t},\n\t\tselectColor(colorSelector: '' | 'text' | 'outline') {\n\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\tthis.colorSelector = colorSelector;\n\t\t\tthis.rememberedStart = el.selectionStart;\n\t\t\tthis.rememberedEnd = el.selectionEnd;\n\t\t},\n\t\tapplyColor() {\n\t\t\tconst color = this.selectedColor;\n\t\t\tconst colorSelector = this.colorSelector;\n\t\t\tconst apply = () => {\n\t\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\t\tif (!el) {\n\t\t\t\t\tthis.$nextTick(apply);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tel.selectionStart = this.rememberedStart;\n\t\t\t\tel.selectionEnd = this.rememberedEnd;\n\t\t\t\tthis.insertCommand(\n\t\t\t\t\tcolorSelector === 'text' ? 'color' : 'outlinecolor',\n\t\t\t\t\tcolor\n\t\t\t\t);\n\t\t\t};\n\t\t\tthis.$nextTick(apply);\n\t\t\tthis.selectedColor = '#000000';\n\t\t\tthis.colorSelector = '';\n\t\t},\n\t\tinsertText(text: string) {\n\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\tconst val = el.value;\n\t\t\tconst selStart = el.selectionStart;\n\t\t\tconst selEnd = el.selectionEnd;\n\t\t\tel.value = val.slice(0, selStart) + text + val.slice(selEnd);\n\t\t\tel.selectionStart = el.selectionEnd = selStart + text.length;\n\t\t\tel.focus();\n\t\t\tthis.onValueChanged();\n\t\t},\n\t\tinsertCommand(command: string, arg?: any) {\n\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\tconst val = el.value;\n\t\t\tconst selStart = el.selectionStart;\n\t\t\tconst selEnd = el.selectionEnd;\n\t\t\tconst selectedText = val.slice(selStart, selEnd);\n\t\t\tconst before = val.slice(0, selStart);\n\t\t\tconst after = val.slice(selEnd);\n\t\t\tlet commandOpen = command;\n\t\t\tif (arg) {\n\t\t\t\tcommandOpen += '=' + arg;\n\t\t\t}\n\t\t\tel.value = `${before}{${commandOpen}}${selectedText}{/${command}}${after}`;\n\t\t\tel.selectionStart = selStart + commandOpen.length + 2;\n\t\t\tel.selectionEnd = el.selectionStart + selectedText.length;\n\t\t\tel.focus();\n\t\t\tthis.onValueChanged();\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.text-subpanel {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\t//flex-flow: nowrap;\n\n\th2 {\n\t\tfont-size: 20px;\n\t\tcolor: $default-text;\n\t\tcolor: var(--text);\n\t\tfont-family: riffic, sans-serif;\n\t\ttext-align: center;\n\t}\n\n\t&.vertical {\n\t\tflex-direction: row;\n\t\twidth: 100%;\n\n\t\t.column {\n\t\t\twidth: 100%;\n\n\t\t\tbutton,\n\t\t\tselect {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\n\t\ttextarea {\n\t\t\theight: 128px;\n\t\t}\n\t}\n\n\t.error-col {\n\t\tcolor: #880000;\n\t}\n\n\t&:not(.vertical) {\n\t\tflex-direction: column;\n\t\t@include height-100();\n\n\t\th2 {\n\t\t\twriting-mode: vertical-rl;\n\t\t\theight: inherit;\n\t\t\twidth: min-content;\n\t\t}\n\n\t\t.column {\n\t\t\tdisplay: flex;\n\t\t\t@include height-100();\n\t\t\tflex-direction: column;\n\t\t\tflex-wrap: wrap;\n\n\t\t\ttextarea {\n\t\t\t\t@include height-100();\n\t\t\t}\n\t\t}\n\n\t\t.hint-col {\n\t\t\twidth: 64px;\n\t\t\tmargin: 4px;\n\t\t}\n\n\t\t.error-col {\n\t\t\theight: 100%;\n\t\t\twidth: 168px;\n\t\t}\n\t\t.ok-col {\n\t\t\twidth: 32px;\n\t\t\tbutton {\n\t\t\t\t@include height-100();\n\t\t\t}\n\t\t}\n\t}\n}\n\n.hex-selector {\n\tdisplay: table;\n\tlabel {\n\t\ttext-align: right;\n\t\twidth: 100px;\n\t}\n\n\tinput {\n\t\tmargin-left: 7px;\n\t}\n\n\t&.vertical {\n\t\t> * {\n\t\t\tdisplay: table-row;\n\t\t}\n\t}\n\n\t&:not(.vertical) {\n\t\t> * {\n\t\t\tdisplay: table-cell;\n\t\t\tvertical-align: middle;\n\t\t}\n\t}\n}\n\n#color-swatches {\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tjustify-content: space-evenly;\n\n\t&.vertical {\n\t\tmargin-top: 4px;\n\t\twidth: 100%;\n\t\tflex-direction: row;\n\t}\n\n\t&:not(.vertical) {\n\t\tmargin-left: 4px;\n\t\theight: 100%;\n\t\tflex-direction: column;\n\t}\n\n\t.swatch {\n\t\theight: 42px;\n\t\twidth: 42px;\n\t\tmargin: 1px;\n\t\tborder-color: black;\n\t}\n}\n\n.style-button {\n\tpadding: 4px;\n}\n\n.edited-style {\n\tcolor: white;\n\ttext-shadow: 0 6px 0.3px #000, 1px 6px 0.3px #000, 2px 5px 0.3px #000,\n\t\t3px 5px 0.3px #000, 4px 4px 0.3px #000, 5px 3px 0.3px #000,\n\t\t5px 2px 0.3px #000, 7px 1px 0.3px #000, 6px 0 0.3px #000,\n\t\t6px -1px 0.3px #000, 5px -2px 0.3px #000, 5px -3px 0.3px #000,\n\t\t4px -4px 0.3px #000, 3px -5px 0.3px #000, 2px -5px 0.3px #000,\n\t\t1px -6px 0.3px #000, 0 -6px 0.3px #000, -1px -6px 0.3px #000,\n\t\t-2px -5px 0.3px #000, -3px -5px 0.3px #000, -4px -4px 0.3px #000,\n\t\t-5px -3px 0.3px #000, -5px -2px 0.3px #000, -6px -1px 0.3px #000,\n\t\t-6px 0 0.3px #000, -6px 1px 0.3px #000, -5px 2px 0.3px #000,\n\t\t-5px 3px 0.3px #000, -4px 4px 0.3px #000, -3px 5px 0.3px #000,\n\t\t-2px 5px 0.3px #000, -1px 6px 0.3px #000, 0 6px 0 #000, 1px 6px 0 #000,\n\t\t2px 5px 0 #000, 3px 5px 0 #000, 4px 4px 0 #000, 5px 3px 0 #000,\n\t\t5px 2px 0 #000, 7px 1px 0 #000, 6px 0 0 #000, 6px -1px 0 #000,\n\t\t5px -2px 0 #000, 5px -3px 0 #000, 4px -4px 0 #000, 3px -5px 0 #000,\n\t\t2px -5px 0 #000, 1px -6px 0 #000, 0 -6px 0 #000, -1px -6px 0 #000,\n\t\t-2px -5px 0 #000, -3px -5px 0 #000, -4px -4px 0 #000, -5px -3px 0 #000,\n\t\t-5px -2px 0 #000, -6px -1px 0 #000, -6px 0 0 #000, -6px 1px 0 #000,\n\t\t-5px 2px 0 #000, -5px 3px 0 #000, -4px 4px 0 #000, -3px 5px 0 #000,\n\t\t-2px 5px 0 #000, -1px 6px 0 #000, 0 5px 0 #000, 1px 5px 0 #000,\n\t\t2px 4px 0 #000, 3px 4px 0 #000, 4px 3px 0 #000, 4px 2px 0 #000,\n\t\t5px 1px 0 #000, 5px 0 0 #000, 5px -1px 0 #000, 4px -2px 0 #000,\n\t\t4px -3px 0 #000, 3px -4px 0 #000, 2px -4px 0 #000, 1px -5px 0 #000,\n\t\t0 -5px 0 #000, -1px -5px 0 #000, -2px -4px 0 #000, -3px -4px 0 #000,\n\t\t-4px -3px 0 #000, -4px -2px 0 #000, -5px -1px 0 #000, -5px 0 0 #000,\n\t\t-5px 1px 0 #000, -4px 2px 0 #000, -4px 3px 0 #000, -3px 4px 0 #000,\n\t\t-2px 4px 0 #000, -1px 5px 0 #000, 0 4px 0 #000, 1px 4px 0 #000,\n\t\t2px 3px 0 #000, 3px 3px 0 #000, 3px 2px 0 #000, 4px 1px 0 #000, 4px 0 0 #000,\n\t\t4px -1px 0 #000, 3px -2px 0 #000, 3px -3px 0 #000, 2px -3px 0 #000,\n\t\t1px -4px 0 #000, 0 -4px 0 #000, -1px -4px 0 #000, -2px -3px 0 #000,\n\t\t-3px -3px 0 #000, -3px -2px 0 #000, -4px -1px 0 #000, -4px 0 0 #000,\n\t\t-4px 1px 0 #000, -3px 2px 0 #000, -3px 3px 0 #000, -2px 3px 0 #000,\n\t\t-1px 4px 0 #000, 0 3px 0 #000, 1px 3px 0 #000, 2px 2px 0 #000,\n\t\t3px 1px 0 #000, 3px 0 0 #000, 1px -3px 0 #000, 2px -2px 0 #000,\n\t\t3px -1px 0 #000, 0 -3px 0 #000, -1px -3px 0 #000, -2px -2px 0 #000,\n\t\t-3px -1px 0 #000, -3px 0 0 #000, -1px 3px 0 #000, -2px 2px 0 #000,\n\t\t-3px 1px 0 #000, 0 2px 0 #000, 1px 2px 0 #000, 2px 1px 0 #000, 2px 0 0 #000,\n\t\t1px -2px 0 #000, 2px -1px 0 #000, 0 -2px 0 #000, -1px -2px 0 #000,\n\t\t-2px -1px 0 #000, -2px 0 0 #000, -1px 2px 0 #000, -2px 1px 0 #000,\n\t\t0 1px 0 #000, 1px 1px 0 #000, 1px 0 0 #000, 1px -1px 0 #000, 0 -1px 0 #000,\n\t\t-1px -1px 0 #000, -1px 0 0 #000, -1px 1px 0 #000;\n}\n</style>\n","\nimport Color from '../color/color.vue';\nimport { TextRenderer } from '@/renderer/textRenderer/textRenderer';\nimport { defineComponent } from 'vue';\nimport getConstants from '@/constants';\n\nexport default defineComponent({\n\tinheritAttrs: false,\n\tcomponents: { Color },\n\tprops: {\n\t\tmodelValue: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tdata: () => ({\n\t\tcolorSelector: '' as '' | 'text' | 'outline',\n\t\tselectedFont: '',\n\t\tselectedColor: '#000000',\n\t\trememberedStart: 0,\n\t\trememberedEnd: 0,\n\t\terror: '',\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\twatch: {\n\t\tselectedFont() {\n\t\t\tif (this.selectedFont === '') return;\n\t\t\tthis.insertCommand('font', this.selectedFont);\n\t\t\tthis.selectedFont = '';\n\t\t},\n\t},\n\tmethods: {\n\t\tonValueChanged() {\n\t\t\tconst constants = getConstants();\n\t\t\tconst val = (this.$refs.textArea as HTMLTextAreaElement).value;\n\t\t\ttry {\n\t\t\t\t// tslint:disable-next-line: no-unused-expression\n\t\t\t\tnew TextRenderer(val, constants.TextBox.NameboxTextStyle);\n\t\t\t\tthis.error = '';\n\t\t\t} catch (e) {\n\t\t\t\tthis.error = (e as Error).message;\n\t\t\t}\n\t\t\tthis.$emit('update:modelValue', val);\n\t\t},\n\t\tselectColor(colorSelector: '' | 'text' | 'outline') {\n\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\tthis.colorSelector = colorSelector;\n\t\t\tthis.rememberedStart = el.selectionStart;\n\t\t\tthis.rememberedEnd = el.selectionEnd;\n\t\t},\n\t\tapplyColor() {\n\t\t\tconst color = this.selectedColor;\n\t\t\tconst colorSelector = this.colorSelector;\n\t\t\tconst apply = () => {\n\t\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\t\tif (!el) {\n\t\t\t\t\tthis.$nextTick(apply);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tel.selectionStart = this.rememberedStart;\n\t\t\t\tel.selectionEnd = this.rememberedEnd;\n\t\t\t\tthis.insertCommand(\n\t\t\t\t\tcolorSelector === 'text' ? 'color' : 'outlinecolor',\n\t\t\t\t\tcolor\n\t\t\t\t);\n\t\t\t};\n\t\t\tthis.$nextTick(apply);\n\t\t\tthis.selectedColor = '#000000';\n\t\t\tthis.colorSelector = '';\n\t\t},\n\t\tinsertText(text: string) {\n\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\tconst val = el.value;\n\t\t\tconst selStart = el.selectionStart;\n\t\t\tconst selEnd = el.selectionEnd;\n\t\t\tel.value = val.slice(0, selStart) + text + val.slice(selEnd);\n\t\t\tel.selectionStart = el.selectionEnd = selStart + text.length;\n\t\t\tel.focus();\n\t\t\tthis.onValueChanged();\n\t\t},\n\t\tinsertCommand(command: string, arg?: any) {\n\t\t\tconst el = this.$refs.textArea as HTMLTextAreaElement;\n\t\t\tconst val = el.value;\n\t\t\tconst selStart = el.selectionStart;\n\t\t\tconst selEnd = el.selectionEnd;\n\t\t\tconst selectedText = val.slice(selStart, selEnd);\n\t\t\tconst before = val.slice(0, selStart);\n\t\t\tconst after = val.slice(selEnd);\n\t\t\tlet commandOpen = command;\n\t\t\tif (arg) {\n\t\t\t\tcommandOpen += '=' + arg;\n\t\t\t}\n\t\t\tel.value = `${before}{${commandOpen}}${selectedText}{/${command}}${after}`;\n\t\t\tel.selectionStart = selStart + commandOpen.length + 2;\n\t\t\tel.selectionEnd = el.selectionStart + selectedText.length;\n\t\t\tel.focus();\n\t\t\tthis.onValueChanged();\n\t\t},\n\t},\n});\n","import { render } from \"./text.vue?vue&type=template&id=358bd1b6&scoped=true\"\nimport script from \"./text.vue?vue&type=script&lang=ts\"\nexport * from \"./text.vue?vue&type=script&lang=ts\"\n\nimport \"./text.vue?vue&type=style&index=0&id=358bd1b6&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-358bd1b6\"\n\nexport default script","\nimport Toggle from '@/components/toggle.vue';\nimport PositionAndSize from '@/components/toolbox/commonsFieldsets/positionAndSize.vue';\nimport Layers from '@/components/toolbox/commonsFieldsets/layers.vue';\nimport Delete from '@/components/toolbox/commonsFieldsets/delete.vue';\nimport ImageOptions from '@/components/toolbox/subtools/image-options/image-options.vue';\nimport Color from '@/components/toolbox/subtools/color/color.vue';\nimport { PanelMixin } from './panelMixin';\nimport TextEditor from '../subtools/text/text.vue';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport { defineComponent, PropType } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\nimport {\n\tICopyObjectToClipboardAction,\n\tIObject,\n\tISetLabelMutation,\n\tISetNameboxWidthMutation,\n\tISetObjectZoomMutation,\n\tISetTextBoxColor,\n} from '@/store/objects';\nimport ModalDialog from '@/components/ModalDialog.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport getConstants from '@/constants';\n\nconst setable = genericSetable<IPoem>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tPositionAndSize,\n\t\tLayers,\n\t\tDelete,\n\t\tTextEditor,\n\t\tImageOptions,\n\t\tColor,\n\t\tModalDialog,\n\t\tDFieldset,\n\t},\n\tprops: {\n\t\tobject: {\n\t\t\ttype: Object as PropType<IObject>,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: String,\n\t\ttextHandler: {\n\t\t\ttype: Object as PropType<Handler>,\n\t\t},\n\t\tcolorHandler: {\n\t\t\ttype: Object as PropType<Handler>,\n\t\t},\n\t\tshowAltPanel: Boolean,\n\t},\n\tdata: () => ({\n\t\timageOptionsOpen: false,\n\t\tcanEdit: true,\n\t\tmodalNameInput: '',\n\t\tshowRename: false,\n\t\tlocalColorHandler: null as Handler | null,\n\t}),\n\tcomputed: {\n\t\tflip: setable('flip', 'objects/setFlip'),\n\t\trotation: setable('rotation', 'objects/setRotation'),\n\t\tenlargeWhenTalking: setable(\n\t\t\t'enlargeWhenTalking',\n\t\t\t'objects/setEnlargeWhenTalking'\n\t\t),\n\t\tnameboxWidth: {\n\t\t\tget(): string {\n\t\t\t\tconst val = this.object.nameboxWidth;\n\t\t\t\tif (val === null) return '';\n\t\t\t\treturn val + '';\n\t\t\t},\n\t\t\tset(value: string) {\n\t\t\t\tconst val = value.trim() === '' ? null : parseInt(value);\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tthis.$store.commit('objects/setObjectNameboxWidth', {\n\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\tnameboxWidth: val,\n\t\t\t\t\t} as ISetNameboxWidthMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tzoom: {\n\t\t\tget(): number {\n\t\t\t\treturn this.object.zoom * 100;\n\t\t\t},\n\t\t\tset(zoom: number): void {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tthis.$store.commit('objects/setObjectZoom', {\n\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\tzoom: zoom / 100,\n\t\t\t\t\t} as ISetObjectZoomMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tdefaultNameboxWidth(): number {\n\t\t\treturn getConstants().TextBox.NameboxWidth;\n\t\t},\n\t\tfinalColorHandler(): Handler | null {\n\t\t\treturn this.localColorHandler || this.colorHandler || null;\n\t\t},\n\t\thasLabel(): boolean {\n\t\t\treturn this.object.label !== null;\n\t\t},\n\t\theading(): string {\n\t\t\tconsole.log('heading', this.object.label, this.title, 'Object');\n\t\t\treturn this.object.label || this.title || 'Object';\n\t\t},\n\t\tuseCustomTextboxColor: {\n\t\t\tget(): boolean {\n\t\t\t\treturn this.object.textboxColor !== null;\n\t\t\t},\n\t\t\tset(val: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tthis.$store.commit('objects/setTextboxColor', {\n\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\ttextboxColor: val\n\t\t\t\t\t\t\t? getConstants().TextBoxCustom.textboxDefaultColor\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t} as ICopyObjectToClipboardAction);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t},\n\tmethods: {\n\t\tcopy() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('objects/copyObjectToClipboard', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t} as ICopyObjectToClipboardAction);\n\t\t\t});\n\t\t},\n\t\tenableNameEdit() {\n\t\t\tthis.modalNameInput = this.object.label || '';\n\t\t\tthis.showRename = true;\n\t\t},\n\t\trenameOption(option: 'Apply' | 'Cancel') {\n\t\t\tthis.showRename = false;\n\t\t\tif (option === 'Apply') {\n\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\tthis.$store.commit('objects/setLabel', {\n\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\tlabel: this.modalNameInput,\n\t\t\t\t\t} as ISetLabelMutation);\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tselectTextboxColor() {\n\t\t\tthis.localColorHandler = {\n\t\t\t\ttitle: 'Textbox color',\n\t\t\t\tget: () => this.object.textboxColor,\n\t\t\t\tset: (color: string) => {\n\t\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\t\tthis.$store.commit('objects/setTextboxColor', {\n\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\ttextboxColor: color,\n\t\t\t\t\t\t} as ISetTextBoxColor);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.localColorHandler = null;\n\t\t\t\t},\n\t\t\t} as Handler;\n\t\t},\n\t},\n});\n\nexport interface Handler {\n\ttitle: string;\n\tget: () => string;\n\tset: (value: string) => void;\n\tleave: () => void;\n}\n","import { render } from \"./object-tool.vue?vue&type=template&id=16d40063&scoped=true\"\nimport script from \"./object-tool.vue?vue&type=script&lang=ts\"\nexport * from \"./object-tool.vue?vue&type=script&lang=ts\"\n\nimport \"./object-tool.vue?vue&type=style&index=0&id=16d40063&lang=scss&scoped=true\"\nimport \"./object-tool.vue?vue&type=style&index=1&id=16d40063&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-16d40063\"\n\nexport default script","\nimport {\n\tgetData,\n\tgetParts,\n\tISeekPoseAction,\n\tISeekPosePartAction,\n\tICharacter,\n\tISeekStyleAction,\n} from '@/store/objectTypes/characters';\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport Parts from './character/parts.vue';\nimport { Character } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport { PanelMixin } from './panelMixin';\nimport { DeepReadonly } from '@/util/readonly';\nimport { defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\nimport ObjectTool from './object-tool.vue';\n\nconst setable = genericSetable<ICharacter>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tParts,\n\t\tDFieldset,\n\t\tObjectTool,\n\t},\n\tdata: () => ({\n\t\tpanelForParts: null as string | null,\n\t}),\n\tcomputed: {\n\t\tflip: setable('flip', 'objects/setFlip'),\n\t\tcloseUp: setable('close', 'objects/setClose'),\n\t\tselection(): string {\n\t\t\treturn this.$store.state.ui.selection!;\n\t\t},\n\t\tobject(): DeepReadonly<ICharacter> {\n\t\t\tconst obj = this.$store.state.objects.objects[this.selection];\n\t\t\tif (obj.type !== 'character') return undefined!;\n\t\t\treturn obj as ICharacter;\n\t\t},\n\t\tcharData(): DeepReadonly<Character<IAsset>> {\n\t\t\treturn getData(this.$store, this.object);\n\t\t},\n\t\tlabel(): string {\n\t\t\treturn this.charData.label || '';\n\t\t},\n\t\tparts(): DeepReadonly<string[]> {\n\t\t\treturn getParts(this.charData, this.object);\n\t\t},\n\t\thasMultipleStyles(): boolean {\n\t\t\treturn (\n\t\t\t\tthis.charData.styleGroups[this.object.styleGroupId].styles.length > 1 ||\n\t\t\t\tthis.charData.styleGroups.length > 1\n\t\t\t);\n\t\t},\n\t\thasMultiplePoses(): boolean {\n\t\t\tconst styleGroup = this.charData.styleGroups[this.object.styleGroupId];\n\t\t\tconst style = styleGroup.styles[this.object.styleId];\n\t\t\treturn style.poses.length > 1;\n\t\t},\n\t},\n\tmethods: {\n\t\tseekPose(delta: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/seekPose', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tdelta,\n\t\t\t\t} as ISeekPoseAction);\n\t\t\t});\n\t\t},\n\t\tseekStyle(delta: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/seekStyle', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tdelta,\n\t\t\t\t} as ISeekStyleAction);\n\t\t\t});\n\t\t},\n\t\tseekPart(part: string, delta: number): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/seekPart', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tdelta,\n\t\t\t\t\tpart,\n\t\t\t\t} as ISeekPosePartAction);\n\t\t\t});\n\t\t},\n\t\tcaptialize(str: string) {\n\t\t\treturn str.charAt(0).toUpperCase() + str.substring(1);\n\t\t},\n\t},\n\twatch: {\n\t\tselection() {\n\t\t\tthis.panelForParts = null;\n\t\t},\n\t},\n});\n","import { render } from \"./character.vue?vue&type=template&id=47403597&scoped=true\"\nimport script from \"./character.vue?vue&type=script&lang=ts\"\nexport * from \"./character.vue?vue&type=script&lang=ts\"\n\nimport \"./character.vue?vue&type=style&index=0&id=47403597&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-47403597\"\n\nexport default script","<template>\n\t<object-tool :object=\"object\" title=\"Custom Sprite\" />\n</template>\n\n<script lang=\"ts\">\nimport ObjectTool from '@/components/toolbox/tools/object-tool.vue';\nimport { ISprite } from '@/store/objectTypes/sprite';\nimport { PanelMixin } from './panelMixin';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { ObjectTool },\n\tcomputed: {\n\t\tobject(): ISprite {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'sprite') return undefined!;\n\t\t\treturn obj as ISprite;\n\t\t},\n\t},\n});\n</script>\n","\nimport ObjectTool from '@/components/toolbox/tools/object-tool.vue';\nimport { ISprite } from '@/store/objectTypes/sprite';\nimport { PanelMixin } from './panelMixin';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { ObjectTool },\n\tcomputed: {\n\t\tobject(): ISprite {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'sprite') return undefined!;\n\t\t\treturn obj as ISprite;\n\t\t},\n\t},\n});\n","import { render } from \"./sprite.vue?vue&type=template&id=444b96a8\"\nimport script from \"./sprite.vue?vue&type=script&lang=ts\"\nexport * from \"./sprite.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","<template>\n\t<object-tool\n\t\t:object=\"object\"\n\t\ttitle=\"Textbox\"\n\t\t:textHandler=\"textHandler\"\n\t\t:colorHandler=\"colorHandler\"\n\t>\n\t\t<template v-slot:default>\n\t\t\t<table class=\"upper-combos\">\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"text_style\">Style:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t<select id=\"text_style\" v-model=\"textBoxStyle\" @keydown.stop>\n\t\t\t\t\t\t\t<option value=\"normal\">Normal</option>\n\t\t\t\t\t\t\t<option value=\"corrupt\">Corrupt</option>\n\t\t\t\t\t\t\t<option value=\"custom\">Custom</option>\n\t\t\t\t\t\t\t<option value=\"custom_plus\">Custom (Plus)</option>\n\t\t\t\t\t\t\t<option value=\"none\">None</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"current_talking\">Person talking:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<select id=\"current_talking\" v-model=\"talkingObjId\" @keydown.stop>\n\t\t\t\t\t\t\t<option value=\"$null$\">No-one</option>\n\t\t\t\t\t\t\t<option v-for=\"[id, label] in nameList\" :key=\"id\" :value=\"id\">{{\n\t\t\t\t\t\t\t\tlabel\n\t\t\t\t\t\t\t}}</option>\n\t\t\t\t\t\t\t<option value=\"$other$\">Other</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttitle=\"Jump to talking character\"\n\t\t\t\t\t\t\t@click=\"jumpToCharacter\"\n\t\t\t\t\t\t\t:disabled=\"\n\t\t\t\t\t\t\t\ttalkingObjId === '$null$' || talkingObjId === '$other$'\n\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<label for=\"custom_name\">Other name:</label>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input id=\"custom_name\" v-model=\"talkingOther\" @keydown.stop />\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button @click=\"textEditor = 'name'\">...</button>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\n\t\t\t<toggle label=\"Auto quoting?\" v-model=\"autoQuoting\" />\n\t\t\t<toggle label=\"Auto line wrap?\" v-model=\"autoWrap\" />\n\t\t\t<div id=\"dialog_text_wrapper\">\n\t\t\t\t<label for=\"dialog_text\">Dialog:</label>\n\t\t\t\t<textarea v-model=\"dialog\" id=\"dialog_text\" @keydown.stop />\n\t\t\t\t<button @click=\"textEditor = 'body'\">Formatting</button>\n\t\t\t</div>\n\t\t</template>\n\t\t<template v-slot:options>\n\t\t\t<d-fieldset\n\t\t\t\ttitle=\"Customization:\"\n\t\t\t\t:class=\"customizable ? 'customization-set' : ''\"\n\t\t\t>\n\t\t\t\t<d-flow direction=\"vertical\" maxSize=\"100%\" no-wraping>\n\t\t\t\t\t<toggle label=\"Controls visible?\" v-model=\"showControls\" />\n\t\t\t\t\t<toggle label=\"Able to skip?\" v-model=\"allowSkipping\" />\n\t\t\t\t\t<toggle label=\"Continue arrow?\" v-model=\"showContinueArrow\" />\n\t\t\t\t\t<table v-if=\"customizable\">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"custom_namebox_width\">Namebox width:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tid=\"custom_namebox_width\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tstyle=\"width: 48px;\"\n\t\t\t\t\t\t\t\t\t:placeholder=\"nameboxWidthDefault\"\n\t\t\t\t\t\t\t\t\tv-model.number=\"customNameboxWidth\"\n\t\t\t\t\t\t\t\t\t:disabled=\"overrideColor\"\n\t\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t\t\t<toggle v-model=\"overrideColor\" label=\"Override color\" />\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr v-if=\"overrideColor\">\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<label for=\"textbox_color\">Color:</label>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tid=\"textbox_color\"\n\t\t\t\t\t\t\t\t\tclass=\"color-button\"\n\t\t\t\t\t\t\t\t\t:style=\"{ background: object.customColor }\"\n\t\t\t\t\t\t\t\t\t@click=\"colorSelect = 'base'\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr v-if=\"overrideColor\">\n\t\t\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t\t\t<toggle\n\t\t\t\t\t\t\t\t\tid=\"derive_custom_colors\"\n\t\t\t\t\t\t\t\t\tv-model=\"deriveCustomColors\"\n\t\t\t\t\t\t\t\t\tlabel=\"Derive other colors\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<template v-if=\"overrideColor && !deriveCustomColors\">\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<label for=\"custom_controls_color\">Controls Color:</label>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tid=\"custom_controls_color\"\n\t\t\t\t\t\t\t\t\t\tclass=\"color-button\"\n\t\t\t\t\t\t\t\t\t\t:style=\"{ background: object.customControlsColor }\"\n\t\t\t\t\t\t\t\t\t\t@click=\"colorSelect = 'controls'\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<label for=\"custom_namebox_color\">Namebox Color:</label>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tid=\"custom_namebox_color\"\n\t\t\t\t\t\t\t\t\t\tclass=\"color-button\"\n\t\t\t\t\t\t\t\t\t\t:style=\"{ background: object.customNameboxColor }\"\n\t\t\t\t\t\t\t\t\t\t@click=\"colorSelect = 'namebox'\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<label for=\"custom_namebox_stroke\"\n\t\t\t\t\t\t\t\t\t\t>Namebox text stroke:</label\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tid=\"custom_namebox_stroke\"\n\t\t\t\t\t\t\t\t\t\tclass=\"color-button\"\n\t\t\t\t\t\t\t\t\t\t:style=\"{ background: object.customNameboxStroke }\"\n\t\t\t\t\t\t\t\t\t\t@click=\"colorSelect = 'nameboxStroke'\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</table>\n\t\t\t\t</d-flow>\n\t\t\t</d-fieldset>\n\t\t\t<button @click=\"resetPosition\">Reset position</button>\n\t\t\t<button @click=\"splitTextbox\">Split textbox</button>\n\t\t</template>\n\t</object-tool>\n</template>\n\n<script lang=\"ts\">\nimport {\n\tITextBox,\n\tISetTextBoxCustomColorMutation,\n\tISetTextBoxCustomControlsColorMutation,\n\tISetTextBoxNameboxColorMutation,\n\tISetTextBoxNameboxStrokeMutation,\n\tISplitTextbox,\n\tIResetTextboxBounds,\n\tISetTextBoxTalkingObjMutation,\n} from '@/store/objectTypes/textbox';\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport { defineComponent } from 'vue';\nimport { exhaust } from '@/util/exhaust';\nimport { PanelMixin } from './panelMixin';\nimport { genericSetable } from '@/util/simpleSettable';\nimport ObjectTool, { Handler } from './object-tool.vue';\nimport getConstants from '@/constants';\n\nconst setable = genericSetable<ITextBox>();\n\nexport default defineComponent({\n\tcomponents: {\n\t\tToggle,\n\t\tDFieldset,\n\t\tObjectTool,\n\t\tDFlow,\n\t},\n\tmixins: [PanelMixin],\n\tdata: () => ({\n\t\ttextEditor: '' as '' | 'name' | 'body',\n\t\tcolorSelect: '' as '' | 'base' | 'controls' | 'namebox' | 'nameboxStroke',\n\t}),\n\tcomputed: {\n\t\tcustomizable(): boolean {\n\t\t\treturn this.textBoxStyle.startsWith('custom');\n\t\t},\n\t\tnameboxWidthDefault(): number {\n\t\t\treturn getConstants().TextBox.NameboxWidth;\n\t\t},\n\t\tobject(): ITextBox {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'textBox') return undefined!;\n\t\t\treturn obj as ITextBox;\n\t\t},\n\t\ttextHandler(): Handler | undefined {\n\t\t\tif (!this.textEditor) return undefined;\n\t\t\treturn {\n\t\t\t\ttitle: this.textEditorName,\n\t\t\t\tget: () => {\n\t\t\t\t\tif (this.textEditor === 'name') return this.object.talkingOther;\n\t\t\t\t\tif (this.textEditor === 'body') return this.dialog;\n\t\t\t\t\treturn '';\n\t\t\t\t},\n\t\t\t\tset: (text: string) => {\n\t\t\t\t\tif (this.textEditor === 'name') this.talkingOther = text;\n\t\t\t\t\telse if (this.textEditor === 'body') this.dialog = text;\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.textEditor = '';\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tcolorHandler(): Handler | undefined {\n\t\t\tif (!this.colorSelect) return undefined;\n\t\t\treturn {\n\t\t\t\ttitle: this.colorName,\n\t\t\t\tget: () => {\n\t\t\t\t\tswitch (this.colorSelect) {\n\t\t\t\t\t\tcase '':\n\t\t\t\t\t\t\treturn '#000000';\n\t\t\t\t\t\tcase 'base':\n\t\t\t\t\t\t\treturn this.object.customColor;\n\t\t\t\t\t\tcase 'controls':\n\t\t\t\t\t\t\treturn this.object.customControlsColor;\n\t\t\t\t\t\tcase 'namebox':\n\t\t\t\t\t\t\treturn this.object.customNameboxColor;\n\t\t\t\t\t\tcase 'nameboxStroke':\n\t\t\t\t\t\t\treturn this.object.customNameboxStroke;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\texhaust(this.colorSelect);\n\t\t\t\t\t\t\treturn '';\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tset: (color: string) => {\n\t\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\t\tswitch (this.colorSelect) {\n\t\t\t\t\t\t\tcase '':\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tcase 'base':\n\t\t\t\t\t\t\t\tthis.$store.commit('objects/setCustomColor', {\n\t\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\t\tcolor,\n\t\t\t\t\t\t\t\t} as ISetTextBoxCustomColorMutation);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tcase 'controls':\n\t\t\t\t\t\t\t\tthis.$store.commit('objects/setControlsColor', {\n\t\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\t\tcustomControlsColor: color,\n\t\t\t\t\t\t\t\t} as ISetTextBoxCustomControlsColorMutation);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tcase 'namebox':\n\t\t\t\t\t\t\t\tthis.$store.commit('objects/setNameboxColor', {\n\t\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\t\tcustomNameboxColor: color,\n\t\t\t\t\t\t\t\t} as ISetTextBoxNameboxColorMutation);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tcase 'nameboxStroke':\n\t\t\t\t\t\t\t\tthis.$store.commit('objects/setNameboxStroke', {\n\t\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\t\tcustomNameboxStroke: color,\n\t\t\t\t\t\t\t\t} as ISetTextBoxNameboxStrokeMutation);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.colorSelect = '';\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\ttalkingObjId: {\n\t\t\tget(): string {\n\t\t\t\treturn this.object.talkingObjId || '$null$';\n\t\t\t},\n\t\t\tset(val: string): void {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setTalkingObject', {\n\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\ttalkingObjId: val === '$null$' ? null : val,\n\t\t\t\t\t} as ISetTextBoxTalkingObjMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\ttalkingOther: setable('talkingOther', 'objects/setTalkingOther'),\n\t\tshowControls: setable('controls', 'objects/setControlsVisible'),\n\t\tallowSkipping: setable('skip', 'objects/setSkipable'),\n\t\tautoQuoting: setable('autoQuoting', 'objects/setAutoQuoting'),\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\tshowContinueArrow: setable('continue', 'objects/setContinueArrow'),\n\t\tdialog: setable('text', 'objects/setText'),\n\t\ttextBoxStyle: setable('style', 'objects/setStyle', true),\n\t\toverrideColor: setable('overrideColor', 'objects/setColorOverride'),\n\t\tderiveCustomColors: setable(\n\t\t\t'deriveCustomColors',\n\t\t\t'objects/setDeriveCustomColors'\n\t\t),\n\t\tcustomNameboxWidth: setable(\n\t\t\t'customNameboxWidth',\n\t\t\t'objects/setNameboxWidth'\n\t\t),\n\t\tnameList(): [string, string][] {\n\t\t\tconst panel = this.$store.state.objects.panels[\n\t\t\t\tthis.$store.state.panels.currentPanel\n\t\t\t];\n\n\t\t\tconst ret: [string, string][] = [];\n\n\t\t\tfor (const id of [...panel.order, ...panel.onTopOrder]) {\n\t\t\t\tconst obj = this.$store.state.objects.objects[id];\n\t\t\t\tif (obj.label === null) continue;\n\t\t\t\tret.push([id, obj.label!]);\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\t\ttextEditorName(): string {\n\t\t\tif (this.textEditor === 'name') return 'Name';\n\t\t\tif (this.textEditor === 'body') return 'Dialog';\n\t\t\treturn '';\n\t\t},\n\t\tcustomControlsColor(): string {\n\t\t\treturn this.object.customControlsColor;\n\t\t},\n\t\tcolorName(): string {\n\t\t\tswitch (this.colorSelect) {\n\t\t\t\tcase '':\n\t\t\t\t\treturn '';\n\t\t\t\tcase 'base':\n\t\t\t\t\treturn 'Base color';\n\t\t\t\tcase 'controls':\n\t\t\t\t\treturn 'Controls color';\n\t\t\t\tcase 'namebox':\n\t\t\t\t\treturn 'Namebox color';\n\t\t\t\tcase 'nameboxStroke':\n\t\t\t\t\treturn 'Namebox text stroke';\n\t\t\t\tdefault:\n\t\t\t\t\texhaust(this.colorSelect);\n\t\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\t},\n\tmethods: {\n\t\tsplitTextbox(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/splitTextbox', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t} as ISplitTextbox);\n\t\t\t});\n\t\t},\n\t\tresetPosition(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/resetTextboxBounds', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t} as IResetTextboxBounds);\n\t\t\t});\n\t\t},\n\t\tjumpToCharacter(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.commit('ui/setSelection', this.talkingObjId);\n\t\t\t});\n\t\t},\n\t},\n});\n</script>\n<style lang=\"scss\" scoped>\n.panel {\n\t&.vertical {\n\t\t#dialog_text_wrapper {\n\t\t\twidth: 173px;\n\n\t\t\ttextarea {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\n\t\ttable {\n\t\t\twidth: 100%;\n\n\t\t\tinput,\n\t\t\tselect {\n\t\t\t\twidth: 100px;\n\t\t\t}\n\t\t}\n\t}\n\n\ttextarea {\n\t\tdisplay: block;\n\t\theight: 114px;\n\t}\n\n\t&:not(.vertical) {\n\t\ttable.upper-combos {\n\t\t\twidth: 256px;\n\n\t\t\tselect {\n\t\t\t\twidth: 100px;\n\t\t\t}\n\t\t\tinput {\n\t\t\t\twidth: 75px;\n\t\t\t}\n\t\t\tbutton {\n\t\t\t\twidth: 25px;\n\t\t\t}\n\t\t}\n\n\t\t.customization-set {\n\t\t\t@include height-100();\n\t\t}\n\t}\n}\n\n.color-button {\n\theight: 24px;\n\twidth: 48px;\n\tvertical-align: middle;\n}\n</style>\n","\nimport {\n\tITextBox,\n\tISetTextBoxCustomColorMutation,\n\tISetTextBoxCustomControlsColorMutation,\n\tISetTextBoxNameboxColorMutation,\n\tISetTextBoxNameboxStrokeMutation,\n\tISplitTextbox,\n\tIResetTextboxBounds,\n\tISetTextBoxTalkingObjMutation,\n} from '@/store/objectTypes/textbox';\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport { defineComponent } from 'vue';\nimport { exhaust } from '@/util/exhaust';\nimport { PanelMixin } from './panelMixin';\nimport { genericSetable } from '@/util/simpleSettable';\nimport ObjectTool, { Handler } from './object-tool.vue';\nimport getConstants from '@/constants';\n\nconst setable = genericSetable<ITextBox>();\n\nexport default defineComponent({\n\tcomponents: {\n\t\tToggle,\n\t\tDFieldset,\n\t\tObjectTool,\n\t\tDFlow,\n\t},\n\tmixins: [PanelMixin],\n\tdata: () => ({\n\t\ttextEditor: '' as '' | 'name' | 'body',\n\t\tcolorSelect: '' as '' | 'base' | 'controls' | 'namebox' | 'nameboxStroke',\n\t}),\n\tcomputed: {\n\t\tcustomizable(): boolean {\n\t\t\treturn this.textBoxStyle.startsWith('custom');\n\t\t},\n\t\tnameboxWidthDefault(): number {\n\t\t\treturn getConstants().TextBox.NameboxWidth;\n\t\t},\n\t\tobject(): ITextBox {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'textBox') return undefined!;\n\t\t\treturn obj as ITextBox;\n\t\t},\n\t\ttextHandler(): Handler | undefined {\n\t\t\tif (!this.textEditor) return undefined;\n\t\t\treturn {\n\t\t\t\ttitle: this.textEditorName,\n\t\t\t\tget: () => {\n\t\t\t\t\tif (this.textEditor === 'name') return this.object.talkingOther;\n\t\t\t\t\tif (this.textEditor === 'body') return this.dialog;\n\t\t\t\t\treturn '';\n\t\t\t\t},\n\t\t\t\tset: (text: string) => {\n\t\t\t\t\tif (this.textEditor === 'name') this.talkingOther = text;\n\t\t\t\t\telse if (this.textEditor === 'body') this.dialog = text;\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.textEditor = '';\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tcolorHandler(): Handler | undefined {\n\t\t\tif (!this.colorSelect) return undefined;\n\t\t\treturn {\n\t\t\t\ttitle: this.colorName,\n\t\t\t\tget: () => {\n\t\t\t\t\tswitch (this.colorSelect) {\n\t\t\t\t\t\tcase '':\n\t\t\t\t\t\t\treturn '#000000';\n\t\t\t\t\t\tcase 'base':\n\t\t\t\t\t\t\treturn this.object.customColor;\n\t\t\t\t\t\tcase 'controls':\n\t\t\t\t\t\t\treturn this.object.customControlsColor;\n\t\t\t\t\t\tcase 'namebox':\n\t\t\t\t\t\t\treturn this.object.customNameboxColor;\n\t\t\t\t\t\tcase 'nameboxStroke':\n\t\t\t\t\t\t\treturn this.object.customNameboxStroke;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\texhaust(this.colorSelect);\n\t\t\t\t\t\t\treturn '';\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tset: (color: string) => {\n\t\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\t\tswitch (this.colorSelect) {\n\t\t\t\t\t\t\tcase '':\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tcase 'base':\n\t\t\t\t\t\t\t\tthis.$store.commit('objects/setCustomColor', {\n\t\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\t\tcolor,\n\t\t\t\t\t\t\t\t} as ISetTextBoxCustomColorMutation);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tcase 'controls':\n\t\t\t\t\t\t\t\tthis.$store.commit('objects/setControlsColor', {\n\t\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\t\tcustomControlsColor: color,\n\t\t\t\t\t\t\t\t} as ISetTextBoxCustomControlsColorMutation);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tcase 'namebox':\n\t\t\t\t\t\t\t\tthis.$store.commit('objects/setNameboxColor', {\n\t\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\t\tcustomNameboxColor: color,\n\t\t\t\t\t\t\t\t} as ISetTextBoxNameboxColorMutation);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tcase 'nameboxStroke':\n\t\t\t\t\t\t\t\tthis.$store.commit('objects/setNameboxStroke', {\n\t\t\t\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\t\t\t\tcustomNameboxStroke: color,\n\t\t\t\t\t\t\t\t} as ISetTextBoxNameboxStrokeMutation);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.colorSelect = '';\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\ttalkingObjId: {\n\t\t\tget(): string {\n\t\t\t\treturn this.object.talkingObjId || '$null$';\n\t\t\t},\n\t\t\tset(val: string): void {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('objects/setTalkingObject', {\n\t\t\t\t\t\tid: this.object.id,\n\t\t\t\t\t\ttalkingObjId: val === '$null$' ? null : val,\n\t\t\t\t\t} as ISetTextBoxTalkingObjMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\ttalkingOther: setable('talkingOther', 'objects/setTalkingOther'),\n\t\tshowControls: setable('controls', 'objects/setControlsVisible'),\n\t\tallowSkipping: setable('skip', 'objects/setSkipable'),\n\t\tautoQuoting: setable('autoQuoting', 'objects/setAutoQuoting'),\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\tshowContinueArrow: setable('continue', 'objects/setContinueArrow'),\n\t\tdialog: setable('text', 'objects/setText'),\n\t\ttextBoxStyle: setable('style', 'objects/setStyle', true),\n\t\toverrideColor: setable('overrideColor', 'objects/setColorOverride'),\n\t\tderiveCustomColors: setable(\n\t\t\t'deriveCustomColors',\n\t\t\t'objects/setDeriveCustomColors'\n\t\t),\n\t\tcustomNameboxWidth: setable(\n\t\t\t'customNameboxWidth',\n\t\t\t'objects/setNameboxWidth'\n\t\t),\n\t\tnameList(): [string, string][] {\n\t\t\tconst panel = this.$store.state.objects.panels[\n\t\t\t\tthis.$store.state.panels.currentPanel\n\t\t\t];\n\n\t\t\tconst ret: [string, string][] = [];\n\n\t\t\tfor (const id of [...panel.order, ...panel.onTopOrder]) {\n\t\t\t\tconst obj = this.$store.state.objects.objects[id];\n\t\t\t\tif (obj.label === null) continue;\n\t\t\t\tret.push([id, obj.label!]);\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\t\ttextEditorName(): string {\n\t\t\tif (this.textEditor === 'name') return 'Name';\n\t\t\tif (this.textEditor === 'body') return 'Dialog';\n\t\t\treturn '';\n\t\t},\n\t\tcustomControlsColor(): string {\n\t\t\treturn this.object.customControlsColor;\n\t\t},\n\t\tcolorName(): string {\n\t\t\tswitch (this.colorSelect) {\n\t\t\t\tcase '':\n\t\t\t\t\treturn '';\n\t\t\t\tcase 'base':\n\t\t\t\t\treturn 'Base color';\n\t\t\t\tcase 'controls':\n\t\t\t\t\treturn 'Controls color';\n\t\t\t\tcase 'namebox':\n\t\t\t\t\treturn 'Namebox color';\n\t\t\t\tcase 'nameboxStroke':\n\t\t\t\t\treturn 'Namebox text stroke';\n\t\t\t\tdefault:\n\t\t\t\t\texhaust(this.colorSelect);\n\t\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\t},\n\tmethods: {\n\t\tsplitTextbox(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/splitTextbox', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t} as ISplitTextbox);\n\t\t\t});\n\t\t},\n\t\tresetPosition(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/resetTextboxBounds', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t} as IResetTextboxBounds);\n\t\t\t});\n\t\t},\n\t\tjumpToCharacter(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.commit('ui/setSelection', this.talkingObjId);\n\t\t\t});\n\t\t},\n\t},\n});\n","import { render } from \"./textbox.vue?vue&type=template&id=fb44b570&scoped=true\"\nimport script from \"./textbox.vue?vue&type=script&lang=ts\"\nexport * from \"./textbox.vue?vue&type=script&lang=ts\"\n\nimport \"./textbox.vue?vue&type=style&index=0&id=fb44b570&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-fb44b570\"\n\nexport default script","<template>\n\t<object-tool :object=\"object\" title=\"Choice\" :textHandler=\"textHandler\">\n\t\t<d-fieldset class=\"buttons\" title=\"Buttons:\">\n\t\t\t<d-flow maxSize=\"100%\" direction=\"vertical\" noWraping>\n\t\t\t\t<div\n\t\t\t\t\tv-for=\"(button, btnIdx) in buttons\"\n\t\t\t\t\t:class=\"{ choiceBtn: true, active: btnIdx === currentIdx }\"\n\t\t\t\t\t:key=\"btnIdx\"\n\t\t\t\t\t@click=\"select(btnIdx)\"\n\t\t\t\t>\n\t\t\t\t\t{{ button.text.trim() === '' ? '[Empty]' : button.text }}\n\t\t\t\t</div>\n\t\t\t</d-flow>\n\t\t</d-fieldset>\n\t\t<d-fieldset class=\"current_button\" title=\"Current button:\">\n\t\t\t<table>\n\t\t\t\t<tr>\n\t\t\t\t\t<td colspan=\"2\">\n\t\t\t\t\t\t<label for=\"choice-button-input\">Text</label>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tid=\"choice-button-input\"\n\t\t\t\t\t\t\tv-model=\"buttonText\"\n\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<button @click=\"textEditor = true\">...</button>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</d-fieldset>\n\t\t<button @click=\"addChoice\">Add</button>\n\t\t<button @click=\"removeChoice\">Remove</button>\n\t\t<toggle label=\"Auto line wrap?\" v-model=\"autoWrap\" />\n\t</object-tool>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport { PanelMixin } from './panelMixin';\nimport { IChoices, IRemoveChoiceAction } from '@/store/objectTypes/choices';\nimport { IChoice, IAddChoiceAction } from '@/store/objectTypes/choices';\nimport { DeepReadonly } from '@/util/readonly';\nimport { ComponentCustomProperties, defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\nimport ObjectTool, { Handler } from './object-tool.vue';\n\nconst setable = genericSetable<IChoices>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tDFieldset,\n\t\tDFlow,\n\t\tObjectTool,\n\t},\n\tdata: () => ({\n\t\tcurrentIdx: 0,\n\t\ttextEditor: false,\n\t}),\n\tcomputed: {\n\t\tobject(): IChoices {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'choice') return undefined!;\n\t\t\treturn obj as IChoices;\n\t\t},\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\t// eslint-disable-next-line @typescript-eslint/camelcase\n\t\tbuttonText: simpleButtonSettable('text', 'objects/setChoiceText', true),\n\t\tbuttons(): DeepReadonly<IChoice[]> {\n\t\t\treturn this.object.choices;\n\t\t},\n\t\ttextHandler(): Handler | undefined {\n\t\t\tif (!this.textEditor) return undefined;\n\t\t\treturn {\n\t\t\t\ttitle: 'Text',\n\t\t\t\tget: () => {\n\t\t\t\t\treturn this.buttonText;\n\t\t\t\t},\n\t\t\t\tset: (text: string) => {\n\t\t\t\t\tthis.buttonText = text;\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.textEditor = false;\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\tmethods: {\n\t\tselect(idx: number): void {\n\t\t\tthis.currentIdx = idx;\n\t\t},\n\t\taddChoice(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/addChoice', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\ttext: '',\n\t\t\t\t} as IAddChoiceAction);\n\t\t\t});\n\t\t},\n\t\tremoveChoice(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tif (\n\t\t\t\t\tthis.currentIdx === this.object.choices.length - 1 &&\n\t\t\t\t\tthis.currentIdx > 0\n\t\t\t\t) {\n\t\t\t\t\tthis.select(this.currentIdx - 1);\n\t\t\t\t}\n\t\t\t\tthis.$store.dispatch('objects/removeChoice', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tchoiceIdx: this.currentIdx,\n\t\t\t\t} as IRemoveChoiceAction);\n\t\t\t});\n\t\t},\n\t},\n});\n\nfunction simpleButtonSettable<K extends keyof IChoice>(\n\tkey: K,\n\tmessage: string,\n\taction = false\n) {\n\treturn {\n\t\tget(this: IThis): IChoice[K] {\n\t\t\treturn this.object.choices[this.currentIdx][key];\n\t\t},\n\t\tset(this: IThis, val: IChoice[K]): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store[action ? 'dispatch' : 'commit'](message, {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tchoiceIdx: this.currentIdx,\n\t\t\t\t\t[key]: val,\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t};\n}\n\ninterface IThis extends ComponentCustomProperties {\n\tobject: IChoices;\n\tcurrentIdx: number;\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.choiceBtn {\n\toverflow: hidden;\n\twidth: 100%;\n\theight: 24px;\n\tmax-width: 100%;\n\ttext-overflow: ellipsis;\n\tpadding: 2px;\n\n\t&.active {\n\t\tbackground-color: $default-border;\n\t\tbackground-color: var(--border);\n\t}\n}\n\n.current_button {\n\tinput {\n\t\twidth: 130px;\n\t}\n}\n\n.panel.vertical {\n\t.buttons {\n\t\tmax-height: 200px;\n\t\twidth: 100%;\n\n\t\t> .list {\n\t\t\twidth: 172px;\n\n\t\t\t* {\n\t\t\t\twidth: 100%;\n\t\t\t\ttext-overflow: ellipsis;\n\t\t\t\tpadding: 2px;\n\t\t\t}\n\t\t}\n\t}\n}\n\n.panel:not(.vertical) {\n\t.buttons {\n\t\t@include height-100();\n\t\twidth: 161px;\n\t}\n}\n</style>\n","\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport { PanelMixin } from './panelMixin';\nimport { IChoices, IRemoveChoiceAction } from '@/store/objectTypes/choices';\nimport { IChoice, IAddChoiceAction } from '@/store/objectTypes/choices';\nimport { DeepReadonly } from '@/util/readonly';\nimport { ComponentCustomProperties, defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\nimport ObjectTool, { Handler } from './object-tool.vue';\n\nconst setable = genericSetable<IChoices>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tDFieldset,\n\t\tDFlow,\n\t\tObjectTool,\n\t},\n\tdata: () => ({\n\t\tcurrentIdx: 0,\n\t\ttextEditor: false,\n\t}),\n\tcomputed: {\n\t\tobject(): IChoices {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'choice') return undefined!;\n\t\t\treturn obj as IChoices;\n\t\t},\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\t// eslint-disable-next-line @typescript-eslint/camelcase\n\t\tbuttonText: simpleButtonSettable('text', 'objects/setChoiceText', true),\n\t\tbuttons(): DeepReadonly<IChoice[]> {\n\t\t\treturn this.object.choices;\n\t\t},\n\t\ttextHandler(): Handler | undefined {\n\t\t\tif (!this.textEditor) return undefined;\n\t\t\treturn {\n\t\t\t\ttitle: 'Text',\n\t\t\t\tget: () => {\n\t\t\t\t\treturn this.buttonText;\n\t\t\t\t},\n\t\t\t\tset: (text: string) => {\n\t\t\t\t\tthis.buttonText = text;\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.textEditor = false;\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\tmethods: {\n\t\tselect(idx: number): void {\n\t\t\tthis.currentIdx = idx;\n\t\t},\n\t\taddChoice(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('objects/addChoice', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\ttext: '',\n\t\t\t\t} as IAddChoiceAction);\n\t\t\t});\n\t\t},\n\t\tremoveChoice(): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tif (\n\t\t\t\t\tthis.currentIdx === this.object.choices.length - 1 &&\n\t\t\t\t\tthis.currentIdx > 0\n\t\t\t\t) {\n\t\t\t\t\tthis.select(this.currentIdx - 1);\n\t\t\t\t}\n\t\t\t\tthis.$store.dispatch('objects/removeChoice', {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tchoiceIdx: this.currentIdx,\n\t\t\t\t} as IRemoveChoiceAction);\n\t\t\t});\n\t\t},\n\t},\n});\n\nfunction simpleButtonSettable<K extends keyof IChoice>(\n\tkey: K,\n\tmessage: string,\n\taction = false\n) {\n\treturn {\n\t\tget(this: IThis): IChoice[K] {\n\t\t\treturn this.object.choices[this.currentIdx][key];\n\t\t},\n\t\tset(this: IThis, val: IChoice[K]): void {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store[action ? 'dispatch' : 'commit'](message, {\n\t\t\t\t\tid: this.object.id,\n\t\t\t\t\tchoiceIdx: this.currentIdx,\n\t\t\t\t\t[key]: val,\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t};\n}\n\ninterface IThis extends ComponentCustomProperties {\n\tobject: IChoices;\n\tcurrentIdx: number;\n}\n","import { render } from \"./choice.vue?vue&type=template&id=6218d3d4&scoped=true\"\nimport script from \"./choice.vue?vue&type=script&lang=ts\"\nexport * from \"./choice.vue?vue&type=script&lang=ts\"\n\nimport \"./choice.vue?vue&type=style&index=0&id=6218d3d4&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-6218d3d4\"\n\nexport default script","<template>\n\t<div class=\"panel\">\n\t\t<h1>Help and Credits</h1>\n\t\t<l class=\"btn\" to=\"wiki://Dokumentation\">Help</l>\n\t\t<l class=\"btn\" to=\"github://\">Fork me on GitHub</l>\n\t\t<l class=\"btn\" to=\"wiki://Privacy Statement\">Privacy Statement</l>\n\t\t<p>\n\t\t\tAll assets used are IP of Team Salvato and created by them, unless noted\n\t\t\totherwise.\n\t\t</p>\n\t\t<p>\n\t\t\tDoki Doki Dialog Generator developed by EDave64\n\t\t\t<br />Based on gemdude46's DDLC Shitpost generator\n\t\t</p>\n\t\t<p>\n\t\t\tUnused House Background by\n\t\t\t<l\n\t\t\t\tto=\"https://www.deviantart.com/fatelogic/art/VN-Background-Practice-295671161\"\n\t\t\t>\n\t\t\t\tFatelogic\n\t\t\t</l>\n\t\t</p>\n\t\t<p>\n\t\t\tAller Font by\n\t\t\t<l to=\"https://www.daltonmaag.com/library/aller\">Dalton Maag Ltd</l>\n\t\t</p>\n\t\t<p>\n\t\t\tRiffic Bold Font by\n\t\t\t<l to=\"https://www.fontspring.com/fonts/inky-type/riffic\">InkyType</l>\n\t\t</p>\n\t\t<p>\n\t\t\tVerily Serif Mono Font by\n\t\t\t<l to=\"https://www.dafont.com/verily-serif-mono.font\"\n\t\t\t\t>Stephen G. Hartke</l\n\t\t\t>\n\t\t</p>\n\t\t<p>\n\t\t\tF25 Bank Printer Font by\n\t\t\t<l to=\"https://www.dafont.com/f25-bank-printer.font\"\n\t\t\t\t>F25 Digital Typeface Design</l\n\t\t\t>\n\t\t</p>\n\t\t<p>\n\t\t\tJournal Font by\n\t\t\t<l to=\"https://www.dafont.com/journal.font\">Fontourist</l>\n\t\t</p>\n\t\t<p>\n\t\t\tHashtag Font by\n\t\t\t<l to=\"https://www.dafont.com/hashtag.font\"> TitanVex</l>\n\t\t</p>\n\t\t<p>\n\t\t\tJP Hand Slanted Font by\n\t\t\t<l to=\"https://www.dafont.com/jp-hand-slanted.font\">Jonathan Paterson</l>\n\t\t</p>\n\t\t<p>\n\t\t\tAs I Lay Dying Font by\n\t\t\t<l to=\"https://www.dafont.com/as-i-lay-dying.font\">Moises Esqueda</l>\n\t\t</p>\n\t\t<p>\n\t\t\tDamagrafik Script Font by\n\t\t\t<l to=\"https://www.dafont.com/damagrafik-script.font\">Davide Terenzi</l>\n\t\t</p>\n\t\t<p>\n\t\t\tAmmy's Handwriting Font by\n\t\t\t<l to=\"https://www.dafont.com/ammys-handwriting.font\">Ammy K.</l>\n\t\t</p>\n\t\t<p>\n\t\t\tHalogen Font by\n\t\t\t<l to=\"https://www.dafont.com/halogen.font\">JLH Fonts</l>\n\t\t</p>\n\t\t<p>\n\t\t\tMC Classic Sprite by Childish-N\n\t\t\t<br />MC Classic Chibi by GyleToTheRescue\n\t\t</p>\n\t\t<p>\n\t\t\tMC Sprite by Childish-N\n\t\t\t<br />MC Casual Sprite by SlightlySimple <br />MC Chibi by SlightlySimple\n\t\t</p>\n\t\t<p>\n\t\t\tMC Chad Sprite by Cylent-Nite\n\t\t\t<br />MC Chad Poses and expressions by SlightlySimple <br />MC Chad Poses\n\t\t\tand chibi by Meddy-sin\n\t\t</p>\n\t\t<p>\n\t\t\tFeMC Sprite by Meddy-sin\n\t\t\t<br />FeMC Casual Sprite by SlightlySimple\n\t\t</p>\n\t\t<p>Classic Amy Sprite by Meddy-sin</p>\n\t\t<p>Amy Sprite by Meddy-sin and SlightlySimple</p>\n\t\t<p>Special thanks to SlightlySimple for testing and technical help</p>\n\t\t<p>\n\t\t\tAtlas421, T-Rex Harris, smearglexd and Tactical Cupcakes for suggestions\n\t\t\tand testing\n\t\t</p>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { PanelMixin } from './panelMixin';\nimport L from '@/components/ui/link.vue';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { L },\n});\n</script>\n\n<style lang=\"scss\" scoped>\np {\n\tmargin: 4px;\n\tmax-width: 256px;\n}\n</style>\n","\nimport { PanelMixin } from './panelMixin';\nimport L from '@/components/ui/link.vue';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { L },\n});\n","import { render } from \"./credits.vue?vue&type=template&id=753d2b9a&scoped=true\"\nimport script from \"./credits.vue?vue&type=script&lang=ts\"\nexport * from \"./credits.vue?vue&type=script&lang=ts\"\n\nimport \"./credits.vue?vue&type=style&index=0&id=753d2b9a&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-753d2b9a\"\n\nexport default script","<template>\n\t<div class=\"panel\" @dragenter=\"dragEnter\" @mouseleave=\"$refs.dt.hide()\">\n\t\t<drop-target ref=\"dt\" class=\"drop-target\" @drop=\"addImageFile\"\n\t\t\t>Drop here to add as a new background</drop-target\n\t\t>\n\t\t<h1>Background</h1>\n\t\t<color v-if=\"colorSelect\" v-model=\"bgColor\" @leave=\"colorSelect = false\" />\n\t\t<image-options\n\t\t\tv-else-if=\"imageOptions\"\n\t\t\ttype=\"background\"\n\t\t\ttitle=\"\"\n\t\t\t:id=\"$store.state.panels.currentPanel\"\n\t\t\tno-composition\n\t\t\t@leave=\"imageOptions = false\"\n\t\t/>\n\t\t<template v-else>\n\t\t\t<background-settings\n\t\t\t\t@change-color=\"colorSelect = true\"\n\t\t\t\t@open-image-options=\"imageOptions = true\"\n\t\t\t/>\n\n\t\t\t<div class=\"btn upload-background\" @click=\"$refs.upload.click()\">\n\t\t\t\tUpload\n\t\t\t\t<input type=\"file\" ref=\"upload\" @change=\"onFileUpload\" />\n\t\t\t</div>\n\t\t\t<button class=\"upload-background\" @click=\"addByUrl\">Add by URL</button>\n\t\t\t<button\n\t\t\t\tclass=\"upload-background\"\n\t\t\t\t@click=\"$emit('show-dialog', 'type: Backgrounds')\"\n\t\t\t>\n\t\t\t\t<i class=\"material-icons\">extension</i> Search in content packs\n\t\t\t</button>\n\t\t\t<d-button\n\t\t\t\tv-if=\"showBackgroundsFolder\"\n\t\t\t\ticon=\"folder\"\n\t\t\t\tclass=\"upload-background\"\n\t\t\t\t@click=\"openBackgroundFolder\"\n\t\t\t>\n\t\t\t\tOpen sprites folder\n\t\t\t</d-button>\n\t\t\t<background-button\n\t\t\t\tv-for=\"background of backgrounds\"\n\t\t\t\t:key=\"background\"\n\t\t\t\t:backgroundId=\"background\"\n\t\t\t\t@input=\"setBackground(background)\"\n\t\t\t/>\n\t\t</template>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport BackgroundButton from './background/button.vue';\nimport BackgroundSettings from './background/settings.vue';\nimport ImageOptions from '../subtools/image-options/image-options.vue';\nimport DropTarget from '../drop-target.vue';\nimport { IAsset, ReplaceContentPackAction } from '@/store/content';\nimport {\n\tBackground,\n\tContentPack,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { ISetCurrentMutation, ISetColorMutation } from '@/store/panels';\nimport { PanelMixin } from './panelMixin';\nimport Color from '../subtools/color/color.vue';\nimport { defineComponent } from 'vue';\nimport environment, { Folder } from '@/environments/environment';\nimport DButton from '@/components/ui/d-button.vue';\n\nconst uploadedBackgroundsPack: ContentPack<string> = {\n\tpackId: 'dddg.buildin.uploadedBackgrounds',\n\tdependencies: [],\n\tpackCredits: [],\n\tcharacters: [],\n\tfonts: [],\n\tsprites: [],\n\tpoemStyles: [],\n\tpoemBackgrounds: [],\n\tbackgrounds: [],\n\tcolors: [],\n};\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tBackgroundButton,\n\t\tBackgroundSettings,\n\t\tDropTarget,\n\t\tColor,\n\t\tImageOptions,\n\t\tDButton,\n\t},\n\tdata: () => ({\n\t\tcolorSelect: false,\n\t\timageOptions: false,\n\t}),\n\tcomputed: {\n\t\tbgColor: {\n\t\t\tget(): string {\n\t\t\t\treturn this.$store.state.panels.panels[\n\t\t\t\t\tthis.$store.state.panels.currentPanel\n\t\t\t\t].background.color;\n\t\t\t},\n\t\t\tset(color: string) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundColor', {\n\t\t\t\t\t\tcolor,\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetColorMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tbackgrounds(): Array<Background<IAsset>['id']> {\n\t\t\treturn [\n\t\t\t\t...this.$store.state.content.current.backgrounds.map(\n\t\t\t\t\tbackground => background.id\n\t\t\t\t),\n\t\t\t\t'buildin.static-color',\n\t\t\t\t'buildin.transparent',\n\t\t\t];\n\t\t},\n\t\tshowBackgroundsFolder(): boolean {\n\t\t\treturn (environment.supports.openableFolders as ReadonlySet<Folder>).has(\n\t\t\t\t'backgrounds'\n\t\t\t);\n\t\t},\n\t},\n\tmethods: {\n\t\tsetBackground(id: Background<IAsset>['id']) {\n\t\t\tthis.$store.commit('panels/setCurrentBackground', {\n\t\t\t\tcurrent: id,\n\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t} as ISetCurrentMutation);\n\t\t},\n\t\tonFileUpload(e: Event) {\n\t\t\tconst uploadInput = this.$refs.upload as HTMLInputElement;\n\t\t\tif (!uploadInput.files) return;\n\t\t\tfor (const file of uploadInput.files) {\n\t\t\t\tthis.addImageFile(file);\n\t\t\t}\n\t\t},\n\t\taddImageFile(file: File) {\n\t\t\tconst url = URL.createObjectURL(file);\n\t\t\tthis.addNewCustomBackground(file.name, file.name, url);\n\t\t},\n\t\taddByUrl() {\n\t\t\tconst url = prompt('Enter the URL of the image');\n\t\t\tif (!url) return;\n\t\t\tconst lastSegment = url.split('/').slice(-1)[0];\n\t\t\tthis.addNewCustomBackground(lastSegment, lastSegment, url);\n\t\t},\n\t\taddNewCustomBackground(\n\t\t\tid: Background<IAsset>['id'],\n\t\t\tlabel: string,\n\t\t\turl: string\n\t\t) {\n\t\t\tuploadedBackgroundsPack.backgrounds.push({\n\t\t\t\tid,\n\t\t\t\tlabel,\n\t\t\t\tvariants: [[url]],\n\t\t\t\tscaling: 'none',\n\t\t\t});\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('content/replaceContentPack', {\n\t\t\t\t\tcontentPack: uploadedBackgroundsPack,\n\t\t\t\t} as ReplaceContentPackAction);\n\t\t\t\tthis.setBackground(id);\n\t\t\t});\n\t\t},\n\t\tdragEnter(e: DragEvent) {\n\t\t\tif (!e.dataTransfer) return;\n\t\t\te.dataTransfer.effectAllowed = 'none';\n\t\t\tif (\n\t\t\t\t!Array.from(e.dataTransfer.items).find(item =>\n\t\t\t\t\titem.type.match(/^image.*$/)\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.dataTransfer.effectAllowed = 'link';\n\t\t\t(this.$refs.dt as any).show();\n\t\t},\n\t\topenBackgroundFolder() {\n\t\t\tenvironment.openFolder('backgrounds');\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\ntextarea {\n\tflex-grow: 1;\n}\n\n.upload-background {\n\tmargin-top: 4px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\theight: 48px;\n\tmin-height: 48px;\n\ttext-align: center;\n\tuser-select: none;\n\n\tinput {\n\t\tdisplay: none;\n\t}\n}\n\n#panels:not(.vertical) > .panel {\n\t> div,\n\tbutton {\n\t\t&:not(.drop-target) {\n\t\t\twidth: 12rem;\n\t\t}\n\t}\n}\n\n.vertical {\n\tfieldset {\n\t\tinput {\n\t\t\twidth: 60px;\n\t\t}\n\t}\n}\n</style>\n","<template>\n\t<div\n\t\t:class=\"{ background: true, active: isActive }\"\n\t\t:title=\"title\"\n\t\t:style=\"style\"\n\t\t@click=\"$emit('input', backgroundId)\"\n\t>\n\t\t{{ title }}\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { getAAsset } from '@/asset-manager';\nimport { Background } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset, BackgroundLookup } from '@/store/content';\nimport { ErrorAsset } from '@/models/error-asset';\nimport { IPanel } from '@/store/panels';\nimport { defineComponent } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\n\nexport default defineComponent({\n\tprops: {\n\t\tbackgroundId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tisWebPSupported: null as boolean | null,\n\t\tassets: [] as Array<HTMLImageElement | ErrorAsset>,\n\t}),\n\tcomputed: {\n\t\tbackground(): DeepReadonly<IPanel['background']> {\n\t\t\tconst currentPanel = this.$store.state.panels.currentPanel;\n\t\t\treturn this.$store.state.panels.panels[currentPanel].background;\n\t\t},\n\n\t\tbgData(): Background<IAsset> | null {\n\t\t\tconst backgrounds: BackgroundLookup = this.$store.getters[\n\t\t\t\t'content/getBackgrounds'\n\t\t\t];\n\t\t\treturn backgrounds.get(this.backgroundId) || null;\n\t\t},\n\n\t\tisActive(): boolean {\n\t\t\treturn this.backgroundId === this.background.current;\n\t\t},\n\n\t\ttitle(): string {\n\t\t\tswitch (this.backgroundId) {\n\t\t\t\tcase 'buildin.static-color':\n\t\t\t\t\treturn 'Static color';\n\t\t\t\tcase 'buildin.transparent':\n\t\t\t\t\treturn 'Transparent';\n\t\t\t}\n\t\t\treturn this.bgData!.label || '';\n\t\t},\n\n\t\tstyle(): { [id: string]: string } {\n\t\t\tswitch (this.backgroundId) {\n\t\t\t\tcase 'buildin.static-color':\n\t\t\t\t\treturn {\n\t\t\t\t\t\t'background-color': this.background.color,\n\t\t\t\t\t};\n\t\t\t\tcase 'buildin.transparent':\n\t\t\t\t\treturn {};\n\t\t\t}\n\t\t\tconst urls = (this.assets.filter(\n\t\t\t\timg => img instanceof HTMLImageElement\n\t\t\t) as HTMLImageElement[])\n\t\t\t\t.map(img => `url('${img.src}')`)\n\t\t\t\t.join(',');\n\t\t\treturn {\n\t\t\t\tbackgroundImage: urls,\n\t\t\t};\n\t\t},\n\t},\n\tasync created() {\n\t\tif (this.bgData) {\n\t\t\tthis.assets = await Promise.all(\n\t\t\t\tthis.bgData.variants[0].map(asset => getAAsset(asset, false))\n\t\t\t);\n\t\t}\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.background {\n\tmargin-top: 4px;\n\tbackground-size: cover;\n\ttext-shadow: 0 0 4px #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000,\n\t\t1px 1px 0 #000;\n\tcolor: white;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tbox-shadow: inset 0 0 1px 3px $default-modal-backdrop;\n\tbox-shadow: inset 0 0 1px 3px var(--modal-backdrop);\n\theight: 48px;\n\tmin-height: 48px;\n\ttext-align: center;\n\tuser-select: none;\n\n\t&.active {\n\t\tbox-shadow: inset 0 0 1px 3px $default-modal-backdrop-light;\n\t\tbox-shadow: inset 0 0 1px 3px var(--modal-backdrop-light);\n\t}\n}\n</style>\n","\nimport { getAAsset } from '@/asset-manager';\nimport { Background } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset, BackgroundLookup } from '@/store/content';\nimport { ErrorAsset } from '@/models/error-asset';\nimport { IPanel } from '@/store/panels';\nimport { defineComponent } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\n\nexport default defineComponent({\n\tprops: {\n\t\tbackgroundId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tisWebPSupported: null as boolean | null,\n\t\tassets: [] as Array<HTMLImageElement | ErrorAsset>,\n\t}),\n\tcomputed: {\n\t\tbackground(): DeepReadonly<IPanel['background']> {\n\t\t\tconst currentPanel = this.$store.state.panels.currentPanel;\n\t\t\treturn this.$store.state.panels.panels[currentPanel].background;\n\t\t},\n\n\t\tbgData(): Background<IAsset> | null {\n\t\t\tconst backgrounds: BackgroundLookup = this.$store.getters[\n\t\t\t\t'content/getBackgrounds'\n\t\t\t];\n\t\t\treturn backgrounds.get(this.backgroundId) || null;\n\t\t},\n\n\t\tisActive(): boolean {\n\t\t\treturn this.backgroundId === this.background.current;\n\t\t},\n\n\t\ttitle(): string {\n\t\t\tswitch (this.backgroundId) {\n\t\t\t\tcase 'buildin.static-color':\n\t\t\t\t\treturn 'Static color';\n\t\t\t\tcase 'buildin.transparent':\n\t\t\t\t\treturn 'Transparent';\n\t\t\t}\n\t\t\treturn this.bgData!.label || '';\n\t\t},\n\n\t\tstyle(): { [id: string]: string } {\n\t\t\tswitch (this.backgroundId) {\n\t\t\t\tcase 'buildin.static-color':\n\t\t\t\t\treturn {\n\t\t\t\t\t\t'background-color': this.background.color,\n\t\t\t\t\t};\n\t\t\t\tcase 'buildin.transparent':\n\t\t\t\t\treturn {};\n\t\t\t}\n\t\t\tconst urls = (this.assets.filter(\n\t\t\t\timg => img instanceof HTMLImageElement\n\t\t\t) as HTMLImageElement[])\n\t\t\t\t.map(img => `url('${img.src}')`)\n\t\t\t\t.join(',');\n\t\t\treturn {\n\t\t\t\tbackgroundImage: urls,\n\t\t\t};\n\t\t},\n\t},\n\tasync created() {\n\t\tif (this.bgData) {\n\t\t\tthis.assets = await Promise.all(\n\t\t\t\tthis.bgData.variants[0].map(asset => getAAsset(asset, false))\n\t\t\t);\n\t\t}\n\t},\n});\n","import { render } from \"./button.vue?vue&type=template&id=09138076&scoped=true\"\nimport script from \"./button.vue?vue&type=script&lang=ts\"\nexport * from \"./button.vue?vue&type=script&lang=ts\"\n\nimport \"./button.vue?vue&type=style&index=0&id=09138076&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-09138076\"\n\nexport default script","<template>\n\t<d-fieldset\n\t\t:class=\"{ 'bg-settings': true, vertical: vertical }\"\n\t\ttitle=\"Settings:\"\n\t>\n\t\t<template v-if=\"isColor\">\n\t\t\t<label for=\"bg_color\">Color:</label>\n\t\t\t<button\n\t\t\t\tid=\"bg_color\"\n\t\t\t\tclass=\"color-button\"\n\t\t\t\t:style=\"{ background: color }\"\n\t\t\t\t@click=\"$emit('change-color')\"\n\t\t\t/>\n\t\t</template>\n\t\t<table v-if=\"isVariant\">\n\t\t\t<tr>\n\t\t\t\t<td colspan=\"3\">\n\t\t\t\t\t<toggle v-model=\"flipped\" label=\"Flipped?\" />\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr v-if=\"hasVariants\">\n\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t<button class=\"small-button\" @click=\"seekVariant(-1)\">&lt;</button>\n\t\t\t\t</td>\n\t\t\t\t<td style=\"text-align:center\">Variant</td>\n\t\t\t\t<td class=\"arrow-col\">\n\t\t\t\t\t<button class=\"small-button\" @click=\"seekVariant(1)\">&gt;</button>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td colspan=\"3\">\n\t\t\t\t\t<select v-model=\"scaling\" @keydown.stop>\n\t\t\t\t\t\t<option value=\"0\">None</option>\n\t\t\t\t\t\t<option value=\"1\">Stretch</option>\n\t\t\t\t\t\t<option value=\"2\">Cover</option>\n\t\t\t\t\t</select>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td colspan=\"3\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tid=\"image_options_button\"\n\t\t\t\t\t\t@click=\"$emit('open-image-options')\"\n\t\t\t\t\t>\n\t\t\t\t\t\tImage options\n\t\t\t\t\t</button>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\t</d-fieldset>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport { Background } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport {\n\tISetColorMutation,\n\tISetFlipMutation,\n\tISeekVariantAction,\n\tISetScalingMutation,\n\tIPanel,\n} from '@/store/panels';\nimport { defineComponent } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\n\nexport default defineComponent({\n\tcomponents: { Toggle, DFieldset },\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tcolor: {\n\t\t\tget(): string {\n\t\t\t\treturn this.background.color;\n\t\t\t},\n\t\t\tset(color: string): void {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundColor', {\n\t\t\t\t\t\tcolor,\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetColorMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tflipped: {\n\t\t\tget(): boolean {\n\t\t\t\treturn this.background.flipped;\n\t\t\t},\n\t\t\tset(flipped: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundFlipped', {\n\t\t\t\t\t\tflipped,\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetFlipMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tscaling: {\n\t\t\tget(): string {\n\t\t\t\treturn this.background.scaling.toString();\n\t\t\t},\n\n\t\t\tset(scaling: string) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundScaling', {\n\t\t\t\t\t\tscaling: parseInt(scaling, 10),\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetScalingMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tcurrentBackgroundId(): string {\n\t\t\treturn this.background.current;\n\t\t},\n\t\tbackground(): DeepReadonly<IPanel['background']> {\n\t\t\tconst currentPanel = this.$store.state.panels.currentPanel;\n\t\t\treturn this.$store.state.panels.panels[currentPanel].background;\n\t\t},\n\t\tbgData(): DeepReadonly<Background<IAsset>> | null {\n\t\t\treturn (\n\t\t\t\tthis.$store.state.content.current.backgrounds.find(\n\t\t\t\t\tbackground => background.id === this.currentBackgroundId\n\t\t\t\t) || null\n\t\t\t);\n\t\t},\n\t\tisColor(): boolean {\n\t\t\treturn this.currentBackgroundId === 'buildin.static-color';\n\t\t},\n\t\tisVariant(): boolean {\n\t\t\treturn !!this.bgData;\n\t\t},\n\t\thasVariants(): boolean {\n\t\t\treturn this.bgData ? this.bgData.variants.length > 1 : false;\n\t\t},\n\t},\n\tmethods: {\n\t\tseekVariant(delta: 1 | -1) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('panels/seekBackgroundVariant', {\n\t\t\t\t\tdelta,\n\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t} as ISeekVariantAction);\n\t\t\t});\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.bg-settings:not(.vertical) {\n\t@include height-100();\n}\n\n.small-button {\n\twidth: 24px;\n}\n\nselect {\n\twidth: 100%;\n}\n\ntable {\n\twidth: 100%;\n}\n\n.arrow-col {\n\twidth: 24px;\n\n\tbutton {\n\t\twidth: 24px;\n\t}\n}\n\n.color-button {\n\theight: 24px;\n\twidth: 48px;\n\tvertical-align: middle;\n}\n</style>\n","\nimport Toggle from '@/components/toggle.vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport { Background } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '@/store/content';\nimport {\n\tISetColorMutation,\n\tISetFlipMutation,\n\tISeekVariantAction,\n\tISetScalingMutation,\n\tIPanel,\n} from '@/store/panels';\nimport { defineComponent } from 'vue';\nimport { DeepReadonly } from '@/util/readonly';\n\nexport default defineComponent({\n\tcomponents: { Toggle, DFieldset },\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tcolor: {\n\t\t\tget(): string {\n\t\t\t\treturn this.background.color;\n\t\t\t},\n\t\t\tset(color: string): void {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundColor', {\n\t\t\t\t\t\tcolor,\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetColorMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tflipped: {\n\t\t\tget(): boolean {\n\t\t\t\treturn this.background.flipped;\n\t\t\t},\n\t\t\tset(flipped: boolean) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundFlipped', {\n\t\t\t\t\t\tflipped,\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetFlipMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tscaling: {\n\t\t\tget(): string {\n\t\t\t\treturn this.background.scaling.toString();\n\t\t\t},\n\n\t\t\tset(scaling: string) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundScaling', {\n\t\t\t\t\t\tscaling: parseInt(scaling, 10),\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetScalingMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tcurrentBackgroundId(): string {\n\t\t\treturn this.background.current;\n\t\t},\n\t\tbackground(): DeepReadonly<IPanel['background']> {\n\t\t\tconst currentPanel = this.$store.state.panels.currentPanel;\n\t\t\treturn this.$store.state.panels.panels[currentPanel].background;\n\t\t},\n\t\tbgData(): DeepReadonly<Background<IAsset>> | null {\n\t\t\treturn (\n\t\t\t\tthis.$store.state.content.current.backgrounds.find(\n\t\t\t\t\tbackground => background.id === this.currentBackgroundId\n\t\t\t\t) || null\n\t\t\t);\n\t\t},\n\t\tisColor(): boolean {\n\t\t\treturn this.currentBackgroundId === 'buildin.static-color';\n\t\t},\n\t\tisVariant(): boolean {\n\t\t\treturn !!this.bgData;\n\t\t},\n\t\thasVariants(): boolean {\n\t\t\treturn this.bgData ? this.bgData.variants.length > 1 : false;\n\t\t},\n\t},\n\tmethods: {\n\t\tseekVariant(delta: 1 | -1) {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('panels/seekBackgroundVariant', {\n\t\t\t\t\tdelta,\n\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t} as ISeekVariantAction);\n\t\t\t});\n\t\t},\n\t},\n});\n","import { render } from \"./settings.vue?vue&type=template&id=99a6545a&scoped=true\"\nimport script from \"./settings.vue?vue&type=script&lang=ts\"\nexport * from \"./settings.vue?vue&type=script&lang=ts\"\n\nimport \"./settings.vue?vue&type=style&index=0&id=99a6545a&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-99a6545a\"\n\nexport default script","\nimport BackgroundButton from './background/button.vue';\nimport BackgroundSettings from './background/settings.vue';\nimport ImageOptions from '../subtools/image-options/image-options.vue';\nimport DropTarget from '../drop-target.vue';\nimport { IAsset, ReplaceContentPackAction } from '@/store/content';\nimport {\n\tBackground,\n\tContentPack,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { ISetCurrentMutation, ISetColorMutation } from '@/store/panels';\nimport { PanelMixin } from './panelMixin';\nimport Color from '../subtools/color/color.vue';\nimport { defineComponent } from 'vue';\nimport environment, { Folder } from '@/environments/environment';\nimport DButton from '@/components/ui/d-button.vue';\n\nconst uploadedBackgroundsPack: ContentPack<string> = {\n\tpackId: 'dddg.buildin.uploadedBackgrounds',\n\tdependencies: [],\n\tpackCredits: [],\n\tcharacters: [],\n\tfonts: [],\n\tsprites: [],\n\tpoemStyles: [],\n\tpoemBackgrounds: [],\n\tbackgrounds: [],\n\tcolors: [],\n};\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tBackgroundButton,\n\t\tBackgroundSettings,\n\t\tDropTarget,\n\t\tColor,\n\t\tImageOptions,\n\t\tDButton,\n\t},\n\tdata: () => ({\n\t\tcolorSelect: false,\n\t\timageOptions: false,\n\t}),\n\tcomputed: {\n\t\tbgColor: {\n\t\t\tget(): string {\n\t\t\t\treturn this.$store.state.panels.panels[\n\t\t\t\t\tthis.$store.state.panels.currentPanel\n\t\t\t\t].background.color;\n\t\t\t},\n\t\t\tset(color: string) {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('panels/setBackgroundColor', {\n\t\t\t\t\t\tcolor,\n\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t} as ISetColorMutation);\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\tbackgrounds(): Array<Background<IAsset>['id']> {\n\t\t\treturn [\n\t\t\t\t...this.$store.state.content.current.backgrounds.map(\n\t\t\t\t\tbackground => background.id\n\t\t\t\t),\n\t\t\t\t'buildin.static-color',\n\t\t\t\t'buildin.transparent',\n\t\t\t];\n\t\t},\n\t\tshowBackgroundsFolder(): boolean {\n\t\t\treturn (environment.supports.openableFolders as ReadonlySet<Folder>).has(\n\t\t\t\t'backgrounds'\n\t\t\t);\n\t\t},\n\t},\n\tmethods: {\n\t\tsetBackground(id: Background<IAsset>['id']) {\n\t\t\tthis.$store.commit('panels/setCurrentBackground', {\n\t\t\t\tcurrent: id,\n\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t} as ISetCurrentMutation);\n\t\t},\n\t\tonFileUpload(e: Event) {\n\t\t\tconst uploadInput = this.$refs.upload as HTMLInputElement;\n\t\t\tif (!uploadInput.files) return;\n\t\t\tfor (const file of uploadInput.files) {\n\t\t\t\tthis.addImageFile(file);\n\t\t\t}\n\t\t},\n\t\taddImageFile(file: File) {\n\t\t\tconst url = URL.createObjectURL(file);\n\t\t\tthis.addNewCustomBackground(file.name, file.name, url);\n\t\t},\n\t\taddByUrl() {\n\t\t\tconst url = prompt('Enter the URL of the image');\n\t\t\tif (!url) return;\n\t\t\tconst lastSegment = url.split('/').slice(-1)[0];\n\t\t\tthis.addNewCustomBackground(lastSegment, lastSegment, url);\n\t\t},\n\t\taddNewCustomBackground(\n\t\t\tid: Background<IAsset>['id'],\n\t\t\tlabel: string,\n\t\t\turl: string\n\t\t) {\n\t\t\tuploadedBackgroundsPack.backgrounds.push({\n\t\t\t\tid,\n\t\t\t\tlabel,\n\t\t\t\tvariants: [[url]],\n\t\t\t\tscaling: 'none',\n\t\t\t});\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('content/replaceContentPack', {\n\t\t\t\t\tcontentPack: uploadedBackgroundsPack,\n\t\t\t\t} as ReplaceContentPackAction);\n\t\t\t\tthis.setBackground(id);\n\t\t\t});\n\t\t},\n\t\tdragEnter(e: DragEvent) {\n\t\t\tif (!e.dataTransfer) return;\n\t\t\te.dataTransfer.effectAllowed = 'none';\n\t\t\tif (\n\t\t\t\t!Array.from(e.dataTransfer.items).find(item =>\n\t\t\t\t\titem.type.match(/^image.*$/)\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\te.dataTransfer.effectAllowed = 'link';\n\t\t\t(this.$refs.dt as any).show();\n\t\t},\n\t\topenBackgroundFolder() {\n\t\t\tenvironment.openFolder('backgrounds');\n\t\t},\n\t},\n});\n","import { render } from \"./backgrounds.vue?vue&type=template&id=42a773bc&scoped=true\"\nimport script from \"./backgrounds.vue?vue&type=script&lang=ts\"\nexport * from \"./backgrounds.vue?vue&type=script&lang=ts\"\n\nimport \"./backgrounds.vue?vue&type=style&index=0&id=42a773bc&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-42a773bc\"\n\nexport default script","<template>\n\t<div class=\"panel\">\n\t\t<h1>Content Packs</h1>\n\t\t<button @click=\"addNew\">Add new Pack</button>\n\t\t<d-fieldset title=\"Installed Packs:\">\n\t\t\t<div class=\"list\">\n\t\t\t\t<div\n\t\t\t\t\tv-for=\"pack in packs\"\n\t\t\t\t\t:class=\"{ active: pack.name === name }\"\n\t\t\t\t\t:key=\"pack.name\"\n\t\t\t\t\t@click=\"select(pack.name)\"\n\t\t\t\t>\n\t\t\t\t\t{{ pack.name }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</d-fieldset>\n\t\t<label for=\"pack_name\">Name:</label>\n\t\t<input id=\"pack_name\" :value=\"name\" readonly />\n\t\t<label for=\"pack_credits\">Credits:</label>\n\t\t<div id=\"pack_credits\" v-html=\"credits\"></div>\n\t\t<button v-if=\"activatable\" @click=\"activate\">Activate</button>\n\t\t<button v-if=\"deactivatable\" @click=\"deactivate\">Deactivate</button>\n\t\t<button v-if=\"installable\" @click=\"install\">Install</button>\n\t\t<button v-if=\"uninstallable\" @click=\"uninstall\">Uninstall</button>\n\t\t<div v-if=\"needRestart\">\n\t\t\tThe tool need restart for changes to take effect.\n\t\t\t<button @click=\"restart\">Restart Now</button>\n\t\t</div>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { PanelMixin } from './panelMixin';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport environment from '@/environments/environment';\nimport { defineComponent } from 'vue';\n\ninterface IPack {\n\tname: string;\n\tcredits: [string | [string, string]];\n\tinstalled: boolean;\n\tqueuedUninstall: boolean;\n\tactive: boolean;\n\tfreshInstall: boolean;\n\turl: string;\n}\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { DFieldset },\n\tdata: () => ({\n\t\tselectedPack: null as IPack | null,\n\t\tneedRestart: false,\n\t}),\n\tcomputed: {\n\t\tpacks(): IPack[] {\n\t\t\tconst packs = this.$store.state.content.contentPacks;\n\t\t\treturn packs\n\t\t\t\t.filter(pack => pack.packId && !pack.packId.startsWith('dddg.buildin.'))\n\t\t\t\t.map(\n\t\t\t\t\tpack =>\n\t\t\t\t\t\t({\n\t\t\t\t\t\t\tname: pack.packId,\n\t\t\t\t\t\t\tcredits: pack.packCredits,\n\t\t\t\t\t\t\tinstalled: true,\n\t\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\t\tqueuedUninstall: false,\n\t\t\t\t\t\t\tfreshInstall: false,\n\t\t\t\t\t\t\turl: '',\n\t\t\t\t\t\t} as IPack)\n\t\t\t\t);\n\t\t},\n\n\t\tname(): string {\n\t\t\tif (!this.selectedPack) return '';\n\t\t\treturn this.selectedPack.name;\n\t\t},\n\t\tcredits(): [string | [string, string]] {\n\t\t\tif (!this.selectedPack) return [''];\n\t\t\treturn this.selectedPack.credits;\n\t\t},\n\t\tactivatable(): boolean {\n\t\t\tif (!environment.supports.autoLoading) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\tif (!this.selectedPack.installed) return false;\n\t\t\tif (this.selectedPack.queuedUninstall) return false;\n\t\t\tif (this.selectedPack.freshInstall) return false;\n\t\t\treturn !this.selectedPack.active;\n\t\t},\n\t\tdeactivatable(): boolean {\n\t\t\tif (!environment.supports.autoLoading) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\tif (!this.selectedPack.installed) return false;\n\t\t\tif (this.selectedPack.queuedUninstall) return false;\n\t\t\tif (this.selectedPack.freshInstall) return false;\n\t\t\treturn this.selectedPack.active;\n\t\t},\n\t\tinstallable(): boolean {\n\t\t\tif (!environment.supports.autoLoading) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\treturn this.selectedPack.queuedUninstall || !this.selectedPack.installed;\n\t\t},\n\t\tuninstallable(): boolean {\n\t\t\tif (!environment.supports.autoLoading) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\tif (this.selectedPack.freshInstall) return false;\n\t\t\treturn !(\n\t\t\t\tthis.selectedPack.queuedUninstall || !this.selectedPack.installed\n\t\t\t);\n\t\t},\n\t},\n\tmethods: {\n\t\tselect(name: string) {\n\t\t\tthis.selectedPack = this.packs.find(pack => pack.name === name) || null;\n\t\t},\n\t\tasync addNew() {\n\t\t\tconst url = await environment.prompt(\n\t\t\t\t'Enter the URL of the character pack:'\n\t\t\t);\n\t\t\tif (!url) return;\n\t\t\tawait this.$store.dispatch('content/loadContentPacks', url);\n\t\t},\n\t\trestart() {\n\t\t\tlocation.reload(true);\n\t\t},\n\t\tinstall(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tif (this.selectedPack.queuedUninstall) {\n\t\t\t\tthis.selectedPack.queuedUninstall = false;\n\t\t\t} else {\n\t\t\t\tthis.selectedPack.installed = true;\n\t\t\t}\n\t\t},\n\t\tuninstall(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tenvironment.localRepoUninstall(this.selectedPack.url);\n\t\t\tthis.selectedPack.queuedUninstall = true;\n\t\t\tthis.needRestart = true;\n\t\t},\n\t\tactivate(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tenvironment.autoLoadAdd(this.selectedPack.url);\n\t\t\tthis.selectedPack.active = true;\n\t\t\tthis.needRestart = true;\n\t\t},\n\t\tdeactivate(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tenvironment.autoLoadRemove(this.selectedPack.url);\n\t\t\tthis.selectedPack.active = false;\n\t\t\tthis.needRestart = true;\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\np {\n\tmargin: 4px;\n}\n.list {\n\toverflow-y: auto;\n\toverflow-x: hidden;\n\t.active {\n\t\tbackground-color: $default-border;\n\t\tbackground-color: var(--border);\n\t}\n}\n\n.panel.vertical {\n\tfieldset {\n\t\twidth: 100%;\n\n\t\t> .list {\n\t\t\tmax-height: 200px;\n\t\t\twidth: 172px;\n\n\t\t\t* {\n\t\t\t\twidth: 100%;\n\t\t\t\ttext-overflow: ellipsis;\n\t\t\t\tpadding: 2px;\n\t\t\t}\n\t\t}\n\t}\n}\n\n.panel:not(.vertical) {\n\t.list {\n\t\tmax-height: 140px;\n\t}\n}\n</style>\n","\nimport { PanelMixin } from './panelMixin';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport environment from '@/environments/environment';\nimport { defineComponent } from 'vue';\n\ninterface IPack {\n\tname: string;\n\tcredits: [string | [string, string]];\n\tinstalled: boolean;\n\tqueuedUninstall: boolean;\n\tactive: boolean;\n\tfreshInstall: boolean;\n\turl: string;\n}\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { DFieldset },\n\tdata: () => ({\n\t\tselectedPack: null as IPack | null,\n\t\tneedRestart: false,\n\t}),\n\tcomputed: {\n\t\tpacks(): IPack[] {\n\t\t\tconst packs = this.$store.state.content.contentPacks;\n\t\t\treturn packs\n\t\t\t\t.filter(pack => pack.packId && !pack.packId.startsWith('dddg.buildin.'))\n\t\t\t\t.map(\n\t\t\t\t\tpack =>\n\t\t\t\t\t\t({\n\t\t\t\t\t\t\tname: pack.packId,\n\t\t\t\t\t\t\tcredits: pack.packCredits,\n\t\t\t\t\t\t\tinstalled: true,\n\t\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\t\tqueuedUninstall: false,\n\t\t\t\t\t\t\tfreshInstall: false,\n\t\t\t\t\t\t\turl: '',\n\t\t\t\t\t\t} as IPack)\n\t\t\t\t);\n\t\t},\n\n\t\tname(): string {\n\t\t\tif (!this.selectedPack) return '';\n\t\t\treturn this.selectedPack.name;\n\t\t},\n\t\tcredits(): [string | [string, string]] {\n\t\t\tif (!this.selectedPack) return [''];\n\t\t\treturn this.selectedPack.credits;\n\t\t},\n\t\tactivatable(): boolean {\n\t\t\tif (!environment.supports.autoLoading) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\tif (!this.selectedPack.installed) return false;\n\t\t\tif (this.selectedPack.queuedUninstall) return false;\n\t\t\tif (this.selectedPack.freshInstall) return false;\n\t\t\treturn !this.selectedPack.active;\n\t\t},\n\t\tdeactivatable(): boolean {\n\t\t\tif (!environment.supports.autoLoading) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\tif (!this.selectedPack.installed) return false;\n\t\t\tif (this.selectedPack.queuedUninstall) return false;\n\t\t\tif (this.selectedPack.freshInstall) return false;\n\t\t\treturn this.selectedPack.active;\n\t\t},\n\t\tinstallable(): boolean {\n\t\t\tif (!environment.supports.autoLoading) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\treturn this.selectedPack.queuedUninstall || !this.selectedPack.installed;\n\t\t},\n\t\tuninstallable(): boolean {\n\t\t\tif (!environment.supports.autoLoading) return false;\n\t\t\tif (!this.selectedPack) return false;\n\t\t\tif (this.selectedPack.freshInstall) return false;\n\t\t\treturn !(\n\t\t\t\tthis.selectedPack.queuedUninstall || !this.selectedPack.installed\n\t\t\t);\n\t\t},\n\t},\n\tmethods: {\n\t\tselect(name: string) {\n\t\t\tthis.selectedPack = this.packs.find(pack => pack.name === name) || null;\n\t\t},\n\t\tasync addNew() {\n\t\t\tconst url = await environment.prompt(\n\t\t\t\t'Enter the URL of the character pack:'\n\t\t\t);\n\t\t\tif (!url) return;\n\t\t\tawait this.$store.dispatch('content/loadContentPacks', url);\n\t\t},\n\t\trestart() {\n\t\t\tlocation.reload(true);\n\t\t},\n\t\tinstall(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tif (this.selectedPack.queuedUninstall) {\n\t\t\t\tthis.selectedPack.queuedUninstall = false;\n\t\t\t} else {\n\t\t\t\tthis.selectedPack.installed = true;\n\t\t\t}\n\t\t},\n\t\tuninstall(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tenvironment.localRepoUninstall(this.selectedPack.url);\n\t\t\tthis.selectedPack.queuedUninstall = true;\n\t\t\tthis.needRestart = true;\n\t\t},\n\t\tactivate(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tenvironment.autoLoadAdd(this.selectedPack.url);\n\t\t\tthis.selectedPack.active = true;\n\t\t\tthis.needRestart = true;\n\t\t},\n\t\tdeactivate(): void {\n\t\t\tif (!this.selectedPack) return;\n\t\t\tenvironment.autoLoadRemove(this.selectedPack.url);\n\t\t\tthis.selectedPack.active = false;\n\t\t\tthis.needRestart = true;\n\t\t},\n\t},\n});\n","import { render } from \"./content-pack.vue?vue&type=template&id=714ad0fa&scoped=true\"\nimport script from \"./content-pack.vue?vue&type=script&lang=ts\"\nexport * from \"./content-pack.vue?vue&type=script&lang=ts\"\n\nimport \"./content-pack.vue?vue&type=style&index=0&id=714ad0fa&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-714ad0fa\"\n\nexport default script","<template>\n\t<div class=\"panel\">\n\t\t<h1>Panels</h1>\n\t\t<image-options\n\t\t\tv-if=\"imageOptions\"\n\t\t\ttype=\"panel\"\n\t\t\ttitle=\"\"\n\t\t\t:id=\"currentPanel\"\n\t\t\tno-composition\n\t\t\t@leave=\"\n\t\t\t\timageOptions = false;\n\t\t\t\trenderThumbnail();\n\t\t\t\"\n\t\t/>\n\t\t<template v-else>\n\t\t\t<d-fieldset class=\"existing_panels_fieldset\" title=\"Existing Panels\">\n\t\t\t\t<d-flow no-wraping maxSize=\"350px\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-for=\"(panel, idx) of panelButtons\"\n\t\t\t\t\t\t:key=\"panel.id\"\n\t\t\t\t\t\t:class=\"{ panel_button: true, active: panel.id === currentPanel }\"\n\t\t\t\t\t\t:style=\"`background-image: url('${panel.image}')`\"\n\t\t\t\t\t\t@click=\"updateCurrentPanel(panel.id)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"panel_text\">\n\t\t\t\t\t\t\t<p>{{ panel.text }}</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"panel_nr\">{{ idx + 1 }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</d-flow>\n\t\t\t</d-fieldset>\n\t\t\t<div class=\"column\">\n\t\t\t\t<d-button icon=\"add_to_queue\" @click=\"addNewPanel\">\n\t\t\t\t\tAdd new\n\t\t\t\t</d-button>\n\t\t\t\t<d-button\n\t\t\t\t\ticon=\"remove_from_queue\"\n\t\t\t\t\t@click=\"deletePanel\"\n\t\t\t\t\t:disabled=\"!canDeletePanel\"\n\t\t\t\t>\n\t\t\t\t\tDelete panel\n\t\t\t\t</d-button>\n\n\t\t\t\t<d-button\n\t\t\t\t\ticon=\"arrow_upward\"\n\t\t\t\t\t@click=\"moveAhead\"\n\t\t\t\t\t:disabled=\"!canMoveAhead\"\n\t\t\t\t>\n\t\t\t\t\tMove ahead\n\t\t\t\t</d-button>\n\t\t\t\t<d-button\n\t\t\t\t\ticon=\"arrow_downward\"\n\t\t\t\t\t@click=\"moveBehind\"\n\t\t\t\t\t:disabled=\"!canMoveBehind\"\n\t\t\t\t>\n\t\t\t\t\tMove behind\n\t\t\t\t</d-button>\n\t\t\t\t<d-button icon=\"color_lens\" @click=\"imageOptions = true\">\n\t\t\t\t\tImage options\n\t\t\t\t</d-button>\n\t\t\t</div>\n\t\t\t<d-fieldset title=\"Export\">\n\t\t\t\t<table>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<label for=\"export_format\">Format</label>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<select id=\"export_format\" v-model=\"format\">\n\t\t\t\t\t\t\t\t<option value=\"image/png\">PNG (lossless)</option>\n\t\t\t\t\t\t\t\t<option value=\"image/webp\" v-if=\"webpSupport\"\n\t\t\t\t\t\t\t\t\t>WebP (lossy)</option\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<option value=\"image/heif\" v-if=\"heifSupport\"\n\t\t\t\t\t\t\t\t\t>HEIF (lossy)</option\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<option value=\"image/jpeg\">JPEG (lossy)</option>\n\t\t\t\t\t\t\t\t<!-- <option value=\"image/jpeg\">WebM (lossy, video)</option>-->\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr v-if=\"isLossy\">\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<label for=\"export_quality\">Quality:</label>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tid=\"export_quality\"\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\t\tmax=\"100\"\n\t\t\t\t\t\t\t\tv-model.number=\"quality\"\n\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<label for=\"export_ppi\">\n\t\t\t\t\t\t\t\tPanels per image:\n\t\t\t\t\t\t\t\t<br /><small>(0 for one single image)</small>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tid=\"export_ppi\"\n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\tmin=\"0\"\n\t\t\t\t\t\t\t\tv-model.number=\"ppi\"\n\t\t\t\t\t\t\t\t@keydown.stop\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<label for=\"export_pages\">\n\t\t\t\t\t\t\t\tPanels to export:\n\t\t\t\t\t\t\t\t<br /><small>(Leave empty for all)</small>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tid=\"export_pages\"\n\t\t\t\t\t\t\t\tv-model=\"pages\"\n\t\t\t\t\t\t\t\tplaceholder=\"E.g. 1-5, 8, 11-13\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<d-button icon=\"photo_camera\" @click=\"download\">\n\t\t\t\t\t\t\t\tDownload\n\t\t\t\t\t\t\t</d-button>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<button @click=\"estimateExportSize\">Estimate filesizes</button>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t</d-fieldset>\n\t\t</template>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport { PanelMixin } from './panelMixin';\nimport {\n\tIDuplicatePanelAction,\n\tISetCurrentPanelMutation,\n\tIDeletePanelAction,\n\tISetPanelPreviewMutation,\n\tIMovePanelAction,\n} from '@/store/panels';\nimport { isWebPSupported, isHeifSupported } from '@/asset-manager';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport { SceneRenderer } from '@/renderables/scene-renderer';\nimport { DeepReadonly } from '@/util/readonly';\nimport environment from '@/environments/environment';\nimport eventBus, { ShowMessageEvent } from '@/eventbus/event-bus';\nimport { IObject } from '@/store/objects';\nimport { INotification } from '@/store/objectTypes/notification';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport { IChoices } from '@/store/objectTypes/choices';\nimport { defineComponent } from 'vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport DButton from '@/components/ui/d-button.vue';\nimport ImageOptions from '../subtools/image-options/image-options.vue';\nimport getConstants from '@/constants';\n\ninterface IPanelButton {\n\tid: string;\n\timage: string;\n\ttext: string;\n}\n\n// tslint:disable: no-magic-numbers\nconst estimateFactor = 1.5;\nconst thumbnailFactor = 1 / 4;\nconst thumbnailQuality = 0.5;\nconst qualityFactor = 100;\n\nconst defaultQuality = 90;\n\nconst qualityWarningThreshold = 70;\n// tslint:enable: no-magic-numbers\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { DFieldset, DFlow, DButton, ImageOptions },\n\tdata: () => ({\n\t\twebpSupport: false,\n\t\theifSupport: false,\n\t\tppi: 0,\n\t\tpages: '',\n\t\tformat: 'image/png',\n\t\tquality: defaultQuality,\n\t\timageOptions: false,\n\t}),\n\tcomputed: {\n\t\tcurrentPanel(): string {\n\t\t\treturn this.$store.state.panels.currentPanel;\n\t\t},\n\n\t\tisLossy(): boolean {\n\t\t\treturn this.format !== 'image/png';\n\t\t},\n\n\t\tcanDeletePanel(): boolean {\n\t\t\treturn this.panelButtons.length > 1;\n\t\t},\n\n\t\tpanelButtons(): IPanelButton[] {\n\t\t\tconst panelOrder = this.$store.state.panels.panelOrder;\n\t\t\treturn panelOrder.map(id => {\n\t\t\t\tconst panel = this.$store.state.panels.panels[id];\n\t\t\t\tconst objectOrders = this.$store.state.objects.panels[id];\n\t\t\t\tconst txtBox = objectOrders\n\t\t\t\t\t? ([] as string[])\n\t\t\t\t\t\t\t.concat(objectOrders.order, objectOrders.onTopOrder)\n\t\t\t\t\t\t\t.map(objId => this.$store.state.objects.objects[objId])\n\t\t\t\t\t\t\t.map(this.extractObjectText)\n\t\t\t\t\t: [];\n\t\t\t\treturn {\n\t\t\t\t\tid,\n\t\t\t\t\timage: panel.lastRender,\n\t\t\t\t\ttext: txtBox.reduce(\n\t\t\t\t\t\t(acc, current) => (acc.length > current.length ? acc : current),\n\t\t\t\t\t\t''\n\t\t\t\t\t),\n\t\t\t\t} as IPanelButton;\n\t\t\t});\n\t\t},\n\n\t\tcanMoveAhead(): boolean {\n\t\t\tconst panelOrder = this.$store.state.panels.panelOrder;\n\t\t\tconst idx = panelOrder.indexOf(this.currentPanel);\n\t\t\treturn idx > 0;\n\t\t},\n\n\t\tcanMoveBehind(): boolean {\n\t\t\tconst panelOrder = this.$store.state.panels.panelOrder;\n\t\t\tconst idx = panelOrder.indexOf(this.currentPanel);\n\t\t\treturn idx < panelOrder.length - 1;\n\t\t},\n\t},\n\tasync created() {\n\t\t[this.webpSupport, this.heifSupport] = await Promise.all([\n\t\t\tisWebPSupported(),\n\t\t\tisHeifSupported(),\n\t\t]);\n\t},\n\tasync mounted() {\n\t\tthis.moveFocusToActivePanel();\n\t\tthis.renderThumbnail();\n\t},\n\tmethods: {\n\t\tasync download() {\n\t\t\tconst distribution = this.getPanelDistibution();\n\t\t\tconst date = new Date();\n\t\t\tconst prefix = `cd-${[\n\t\t\t\tdate.getFullYear(),\n\t\t\t\t`${date.getMonth() + 1}`.padStart(2, '0'),\n\t\t\t\t`${date.getDate()}`.padStart(2, '0'),\n\t\t\t\t`${date.getHours()}`.padStart(2, '0'),\n\t\t\t\t`${date.getMinutes()}`.padStart(2, '0'),\n\t\t\t\t`${date.getSeconds()}`.padStart(2, '0'),\n\t\t\t].join('-')}`;\n\t\t\tconst extension = this.format.split('/')[1];\n\t\t\tconst format = this.format;\n\t\t\tconst quality = this.quality;\n\t\t\tawait this.renderObjects(\n\t\t\t\tdistribution,\n\t\t\t\ttrue,\n\t\t\t\tasync (imageIdx: number, canvas: HTMLCanvasElement) => {\n\t\t\t\t\tenvironment.saveToFile(\n\t\t\t\t\t\tcanvas,\n\t\t\t\t\t\t`${prefix}_${imageIdx}.${extension}`,\n\t\t\t\t\t\tformat,\n\t\t\t\t\t\tquality / qualityFactor\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\t\t},\n\t\tasync estimateExportSize() {\n\t\t\tconst distribution = this.getPanelDistibution();\n\t\t\tconst format = this.format || 'image/png';\n\t\t\tconst quality = this.quality || defaultQuality;\n\t\t\tconst sizes = await this.renderObjects(\n\t\t\t\tdistribution,\n\t\t\t\tfalse,\n\t\t\t\tasync (imageIdx: number, canvas: HTMLCanvasElement) => {\n\t\t\t\t\treturn new Promise<number>((resolve, reject) => {\n\t\t\t\t\t\tcanvas.toBlob(\n\t\t\t\t\t\t\tblob => {\n\t\t\t\t\t\t\t\tif (!blob) {\n\t\t\t\t\t\t\t\t\treject(`Image ${imageIdx + 1} could not be rendered.`);\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tresolve(blob.size);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tformat,\n\t\t\t\t\t\t\tquality / qualityFactor\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t\tconst readableSizes = sizes.map(\n\t\t\t\tsize => ((size * estimateFactor) / 1024 / 1024).toFixed(2) + 'MiB'\n\t\t\t);\n\t\t\tconst filePluralize = readableSizes.length > 1 ? 'files' : 'file';\n\t\t\tconst itPluralize = readableSizes.length > 1 ? 'These' : 'It';\n\t\t\tconst sizePluralize = readableSizes.length > 1 ? 'sizes' : 'size';\n\t\t\teventBus.fire(\n\t\t\t\tnew ShowMessageEvent(\n\t\t\t\t\t`This would export ${\n\t\t\t\t\t\treadableSizes.length\n\t\t\t\t\t} ${filePluralize}. ${itPluralize} would have the following (aproximate) ${sizePluralize}: ${readableSizes.join(\n\t\t\t\t\t\t','\n\t\t\t\t\t)}`\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\t\tasync renderObjects<T>(\n\t\t\tdistribution: DeepReadonly<string[][]>,\n\t\t\thq: boolean,\n\t\t\tmapper: (imageIdx: number, canvas: HTMLCanvasElement) => Promise<T>\n\t\t): Promise<T[]> {\n\t\t\tconst baseConst = getConstants().Base;\n\t\t\treturn await Promise.all(\n\t\t\t\tdistribution.map(async (image, imageIdx) => {\n\t\t\t\t\tconst targetCanvas = document.createElement('canvas');\n\t\t\t\t\ttargetCanvas.width = baseConst.screenWidth;\n\t\t\t\t\ttargetCanvas.height = baseConst.screenHeight * image.length;\n\t\t\t\t\tconst context = targetCanvas.getContext('2d')!;\n\n\t\t\t\t\tawait Promise.all(\n\t\t\t\t\t\timage.map(async (panelId, panelIdx) => {\n\t\t\t\t\t\t\tconst sceneRenderer = new SceneRenderer(\n\t\t\t\t\t\t\t\tthis.$store,\n\t\t\t\t\t\t\t\timage[panelIdx],\n\t\t\t\t\t\t\t\tbaseConst.screenWidth,\n\t\t\t\t\t\t\t\tbaseConst.screenHeight\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tawait sceneRenderer.render(hq, false);\n\n\t\t\t\t\t\t\tsceneRenderer.paintOnto(context, {\n\t\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\t\ty: baseConst.screenHeight * panelIdx,\n\t\t\t\t\t\t\t\tw: baseConst.screenWidth,\n\t\t\t\t\t\t\t\th: baseConst.screenHeight,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\n\t\t\t\t\treturn await mapper(imageIdx, targetCanvas);\n\t\t\t\t})\n\t\t\t);\n\t\t},\n\t\tgetLimitedPanelList(): DeepReadonly<string[]> {\n\t\t\tconst max = this.$store.state.panels.panelOrder.length - 1;\n\t\t\tconst min = 0;\n\t\t\tconst parts = this.pages.split(',');\n\t\t\tconst listedPages: number[] = [];\n\t\t\tlet foundMatch = false;\n\n\t\t\tfor (const part of parts) {\n\t\t\t\tconst trimmedPart = part.trim();\n\t\t\t\tconst match = trimmedPart.match(/^\\s*((\\d+)|(\\d+)\\s*-\\s*(\\d+))\\s*$/);\n\t\t\t\tif (!match) {\n\t\t\t\t\tif (trimmedPart !== '') {\n\t\t\t\t\t\teventBus.fire(\n\t\t\t\t\t\t\tnew ShowMessageEvent(`Could not read '${part}' in the page list.`)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tfoundMatch = true;\n\t\t\t\tif (match[2]) listedPages.push(parseInt(match[2], 10) - 1);\n\t\t\t\telse {\n\t\t\t\t\tconst from = Math.max(parseInt(match[3], 10) - 1, min);\n\t\t\t\t\tconst to = Math.min(parseInt(match[4], 10) - 1, max);\n\t\t\t\t\tif (from === undefined || to === undefined || from > to) continue;\n\t\t\t\t\tfor (let i = from; i <= to; ++i) {\n\t\t\t\t\t\tlistedPages.push(i);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!foundMatch) {\n\t\t\t\treturn this.$store.state.panels.panelOrder;\n\t\t\t}\n\n\t\t\treturn listedPages\n\t\t\t\t.sort((a, b) => a - b)\n\t\t\t\t.filter((value, idx, ary) => ary[idx - 1] !== value)\n\t\t\t\t.map(pageIdx => this.$store.state.panels.panelOrder[pageIdx]);\n\t\t},\n\t\tgetPanelDistibution(): DeepReadonly<string[][]> {\n\t\t\tconst panelOrder = this.getLimitedPanelList();\n\t\t\tif (this.ppi === 0) return [panelOrder];\n\t\t\tconst images: string[][] = [];\n\t\t\tfor (let imageI = 0; imageI < panelOrder.length / this.ppi; ++imageI) {\n\t\t\t\tconst sliceStart = imageI * this.ppi;\n\t\t\t\tconst sliceEnd = sliceStart + this.ppi;\n\t\t\t\timages.push([...panelOrder.slice(sliceStart, sliceEnd)]);\n\t\t\t}\n\t\t\treturn images;\n\t\t},\n\t\tmoveFocusToActivePanel() {\n\t\t\tconst active = this.$el.querySelector('.panel_button.active');\n\t\t\tif (active) {\n\t\t\t\tthis.scrollIntoView(active);\n\t\t\t}\n\t\t},\n\t\tscrollIntoView(ele: Element) {\n\t\t\tconst parent = ele.parentElement!.parentElement!;\n\t\t\tconst idx = Array.from(ele.parentElement!.children).indexOf(ele);\n\t\t\tif (this.$store.state.ui.vertical) {\n\t\t\t\tconst scroll =\n\t\t\t\t\tidx * ele.clientHeight -\n\t\t\t\t\tparent.clientHeight / 2 +\n\t\t\t\t\tele.clientHeight / 2;\n\t\t\t\tparent.scrollTop = scroll;\n\t\t\t\tparent.scrollLeft = 0;\n\t\t\t} else {\n\t\t\t\tconst scroll =\n\t\t\t\t\tidx * ele.clientWidth - parent.clientWidth / 2 + ele.clientWidth / 2;\n\t\t\t\tparent.scrollLeft = scroll;\n\t\t\t\tparent.scrollTop = 0;\n\t\t\t}\n\t\t},\n\t\textractObjectText(obj: DeepReadonly<IObject>) {\n\t\t\tswitch (obj.type) {\n\t\t\t\tcase 'textBox':\n\t\t\t\t\treturn (obj as ITextBox).text;\n\t\t\t\tcase 'notification':\n\t\t\t\t\treturn (obj as INotification).text;\n\t\t\t\tcase 'poem':\n\t\t\t\t\treturn (obj as IPoem).text;\n\t\t\t\tcase 'choice':\n\t\t\t\t\treturn (obj as IChoices).choices\n\t\t\t\t\t\t.map(choice => `[${choice.text}]`)\n\t\t\t\t\t\t.join('\\n');\n\t\t\t}\n\t\t\treturn '';\n\t\t},\n\t\tasync addNewPanel() {\n\t\t\tawait this.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('panels/duplicatePanel', {\n\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t} as IDuplicatePanelAction);\n\t\t\t});\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.moveFocusToActivePanel();\n\t\t\t});\n\t\t},\n\t\tupdateCurrentPanel(panelId: string) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.commit('panels/setCurrentPanel', {\n\t\t\t\t\tpanelId,\n\t\t\t\t} as ISetCurrentPanelMutation);\n\t\t\t});\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.moveFocusToActivePanel();\n\t\t\t});\n\t\t},\n\t\tdeletePanel() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('panels/delete', {\n\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t} as IDeletePanelAction);\n\t\t\t});\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.moveFocusToActivePanel();\n\t\t\t});\n\t\t},\n\t\tmoveAhead() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('panels/move', {\n\t\t\t\t\tpanelId: this.currentPanel,\n\t\t\t\t\tdelta: -1,\n\t\t\t\t} as IMovePanelAction);\n\t\t\t});\n\t\t},\n\t\tmoveBehind() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('panels/move', {\n\t\t\t\t\tpanelId: this.currentPanel,\n\t\t\t\t\tdelta: 1,\n\t\t\t\t} as IMovePanelAction);\n\t\t\t});\n\t\t},\n\t\tasync renderThumbnail() {\n\t\t\tconst baseConst = getConstants().Base;\n\t\t\tconst sceneRenderer = new SceneRenderer(\n\t\t\t\tthis.$store,\n\t\t\t\tthis.currentPanel,\n\t\t\t\tbaseConst.screenWidth,\n\t\t\t\tbaseConst.screenHeight\n\t\t\t);\n\n\t\t\tawait sceneRenderer.render(false, true);\n\n\t\t\tconst targetCanvas = document.createElement('canvas');\n\t\t\ttargetCanvas.width = baseConst.screenWidth * thumbnailFactor;\n\t\t\ttargetCanvas.height = baseConst.screenHeight * thumbnailFactor;\n\n\t\t\tsceneRenderer.paintOnto(targetCanvas.getContext('2d')!, {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\tw: targetCanvas.width,\n\t\t\t\th: targetCanvas.height,\n\t\t\t});\n\t\t\ttargetCanvas.toBlob(\n\t\t\t\tblob => {\n\t\t\t\t\tif (!blob) return;\n\t\t\t\t\tconst url = URL.createObjectURL(blob);\n\t\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\t\tthis.$store.commit('panels/setPanelPreview', {\n\t\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t} as ISetPanelPreviewMutation);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t(await isWebPSupported()) ? 'image/webp' : 'image/jpeg',\n\t\t\t\tthumbnailQuality\n\t\t\t);\n\t\t},\n\t},\n\twatch: {\n\t\tquality(quality: number, oldQuality: number) {\n\t\t\tif (quality === qualityFactor) {\n\t\t\t\teventBus.fire(\n\t\t\t\t\tnew ShowMessageEvent(\n\t\t\t\t\t\t'Note: 100% quality on a lossy format is still not lossless! Select PNG if you want lossless compression.'\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (\n\t\t\t\toldQuality > qualityWarningThreshold &&\n\t\t\t\tquality <= qualityWarningThreshold\n\t\t\t) {\n\t\t\t\teventBus.fire(\n\t\t\t\t\tnew ShowMessageEvent(\n\t\t\t\t\t\t'Note: A quality level below 70% might be very noticable and impair legibility of text.'\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.panel_button {\n\theight: 150px;\n\twidth: 150px;\n\tflex-shrink: 0;\n\tpadding: 4px;\n\tbackground-size: contain;\n\tbackground-position: center center;\n\tbackground-repeat: no-repeat;\n\tbackground-color: $default-native-background;\n\tbackground-color: var(--native-background);\n\tborder: 2px solid $default-border;\n\tborder: 2px solid var(--border);\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground-color: $default-native-background;\n\tbackground-color: var(--native-background);\n\n\ttext-shadow: 0 0 4px #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000,\n\t\t1px 1px 0 #000;\n\n\t&.active {\n\t\tbackground-color: $default-border;\n\t\tbackground-color: var(--border);\n\t}\n}\n\n.panel_text {\n\tflex-grow: 1;\n\tposition: relative;\n\n\tp {\n\t\theight: 60px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\twhite-space: pre;\n\t}\n}\n\n.panel_nr {\n\ttext-align: right;\n}\n\n#export_ppi,\n#export_pages {\n\twidth: 128px;\n}\n\nsmall {\n\tfont-size: 0.75em;\n}\n\n.panel {\n\t&.vertical {\n\t\t.column {\n\t\t\twidth: 100%;\n\n\t\t\tbutton,\n\t\t\tselect {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\n\t\tfieldset {\n\t\t\twidth: 100%;\n\t\t\t.existing_panels {\n\t\t\t\tmax-height: 350px;\n\t\t\t\twidth: 100%;\n\t\t\t\tflex-direction: column;\n\n\t\t\t\t.panel_button {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 150px;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttable {\n\t\t\t\twidth: 100%;\n\t\t\t\ttd {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tdisplay: table-row;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t&:not(.vertical) {\n\t\t.column {\n\t\t\tdisplay: flex;\n\t\t\t@include height-100();\n\t\t\tflex-direction: column;\n\t\t\tflex-wrap: wrap;\n\n\t\t\ttextarea {\n\t\t\t\theight: 100%;\n\t\t\t}\n\t\t}\n\n\t\t.existing_panels_fieldset {\n\t\t\t@include height-100();\n\t\t}\n\n\t\tfieldset {\n\t\t\t.existing_panels {\n\t\t\t\tflex-direction: row;\n\n\t\t\t\t.panel_button {\n\t\t\t\t\theight: 100%;\n\t\t\t\t\twidth: 150px;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttable {\n\t\t\t\ttd {\n\t\t\t\t\twhite-space: nowrap;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n</style>\n","import { Module } from 'vuex';\nimport { ContentPack } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset, BackgroundLookup } from './content';\nimport { IRootState } from '.';\nimport { arraySeeker } from '@/models/seekers';\nimport { ICopyObjectsAction, IDeleteAllOfPanel } from './objects';\nimport {\n\taddFilter,\n\tIAddFilterAction,\n\tIHasSpriteFilters,\n\tIMoveFilterAction,\n\tIRemoveFilterAction,\n\tISetCompositionMutation,\n\tISetFilterAction,\n\tISetFiltersMutation,\n\tmoveFilter,\n\tremoveFilter,\n\tsetFilter,\n} from './sprite_options';\n\nexport enum ScalingModes {\n\tNone = 0,\n\tStretch = 1,\n\tCover = 2,\n}\n\nexport interface IPanel extends IHasSpriteFilters {\n\tid: string;\n\tbackground: IPanelBackground;\n\tlastRender: string;\n}\n\ninterface IPanelBackground extends IHasSpriteFilters {\n\tcurrent: string;\n\tcolor: string;\n\tflipped: boolean;\n\tvariant: number;\n\tscaling: ScalingModes;\n}\n\nexport interface IPanels {\n\tpanels: { [id: string]: IPanel };\n\tpanelOrder: string[];\n\tcurrentPanel: string;\n}\n\nexport const transparentId = 'buildin.transparent';\nexport const staticColorId = 'buildin.static-color';\n\nlet lastPanelNum = 0;\n\nconst previewManager = {\n\tpanelToUrl: new Map<string, string>(),\n\turlToPanel: new Map<string, string[]>(),\n\tregister(panelId: string, url: string) {\n\t\tif (this.panelToUrl.has(panelId)) {\n\t\t\tif (this.panelToUrl.get(panelId) === url) return;\n\t\t\tthis.unregister(panelId, this.panelToUrl.get(panelId)!);\n\t\t}\n\t\tthis.panelToUrl.set(panelId, url);\n\t\tif (this.urlToPanel.has(url)) {\n\t\t\tthis.urlToPanel.get(url)!.push(panelId);\n\t\t} else {\n\t\t\tthis.urlToPanel.set(url, [panelId]);\n\t\t}\n\t},\n\tunregister(panelId: string, url: string) {\n\t\tif (this.urlToPanel.has(url)) {\n\t\t\tconst panels = this.urlToPanel.get(url)!;\n\t\t\tpanels.splice(panels.indexOf(panelId), 1);\n\t\t\tif (panels.length === 0) {\n\t\t\t\tthis.urlToPanel.delete(url);\n\t\t\t\tURL.revokeObjectURL(url);\n\t\t\t}\n\t\t}\n\t\tthis.panelToUrl.delete(panelId);\n\t},\n};\n\nexport default {\n\tnamespaced: true,\n\tstate: {\n\t\tpanels: {},\n\t\tpanelOrder: [],\n\t\tcurrentPanel: null!,\n\t},\n\tmutations: {\n\t\tsetCurrentPanel(state, { panelId }: ISetCurrentPanelMutation) {\n\t\t\tstate.currentPanel = panelId;\n\t\t},\n\t\tsetPanelPreview(state, { panelId, url }: ISetPanelPreviewMutation) {\n\t\t\tstate.panels[panelId].lastRender = url;\n\t\t\tpreviewManager.register(panelId, url);\n\t\t},\n\t\tcreatePanel(state, { panel }: ICreatePanel) {\n\t\t\tstate.panels[panel.id] = panel;\n\t\t},\n\t\tsetPanelOrder(state, { panelOrder }: ISetPanelOrder) {\n\t\t\tstate.panelOrder = [...panelOrder];\n\t\t},\n\t\tsetCurrentBackground(state, { current, panelId }: ISetCurrentMutation) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tpanel.background.current = current;\n\t\t\tpanel.background.variant = 0;\n\t\t},\n\t\tsetBackgroundColor(state, { color, panelId }: ISetColorMutation) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tpanel.background.color = color;\n\t\t},\n\t\tsetBackgroundFlipped(state, { flipped, panelId }: ISetFlipMutation) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tpanel.background.flipped = flipped;\n\t\t},\n\t\tsetBackgroundVariant(state, { variant, panelId }: ISetVariantMutation) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tpanel.background.variant = variant;\n\t\t},\n\t\tsetBackgroundScaling(state, { scaling, panelId }: ISetScalingMutation) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tpanel.background.scaling = scaling;\n\t\t},\n\t\tdeletePanel(state, { panelId }: IDeletePanelMutation) {\n\t\t\tpreviewManager.unregister(\n\t\t\t\tpanelId,\n\t\t\t\tpreviewManager.panelToUrl.get(panelId)!\n\t\t\t);\n\t\t\tdelete state.panels[panelId];\n\t\t},\n\t\tsetComposition(state, command: ISetCompositionMutation) {\n\t\t\tconst obj = state.panels[command.id];\n\t\t\tobj.composite = command.composite;\n\t\t},\n\t\tsetFilters(state, command: ISetFiltersMutation) {\n\t\t\tconst obj = state.panels[command.id];\n\t\t\tobj.filters = command.filters;\n\t\t},\n\t\tbackgroundSetComposition(state, command: ISetCompositionMutation) {\n\t\t\tconst obj = state.panels[command.id];\n\t\t\tobj.background.composite = command.composite;\n\t\t},\n\t\tbackgroundSetFilters(state, command: ISetFiltersMutation) {\n\t\t\tconst obj = state.panels[command.id];\n\t\t\tobj.background.filters = command.filters;\n\t\t},\n\t},\n\tactions: {\n\t\tcreatePanel({ state, commit }) {\n\t\t\tconst id = 'panel' + ++lastPanelNum;\n\t\t\tcommit('createPanel', {\n\t\t\t\tpanel: {\n\t\t\t\t\tid,\n\t\t\t\t\tbackground: {\n\t\t\t\t\t\tcolor: '#000000',\n\t\t\t\t\t\tcurrent: transparentId,\n\t\t\t\t\t\tflipped: false,\n\t\t\t\t\t\tscaling: ScalingModes.Cover,\n\t\t\t\t\t\tvariant: 0,\n\t\t\t\t\t\tcomposite: 'source-over',\n\t\t\t\t\t\tfilters: [],\n\t\t\t\t\t},\n\t\t\t\t\tlastRender: '',\n\t\t\t\t\tcomposite: 'source-over',\n\t\t\t\t\tfilters: [],\n\t\t\t\t},\n\t\t\t} as ICreatePanel);\n\t\t\tif (!state.panelOrder) {\n\t\t\t\tcommit('setPanelOrder', {\n\t\t\t\t\tpanelOrder: [id],\n\t\t\t\t} as ISetPanelOrder);\n\t\t\t} else {\n\t\t\t\tcommit('setPanelOrder', {\n\t\t\t\t\tpanelOrder: [...state.panelOrder, id],\n\t\t\t\t} as ISetPanelOrder);\n\t\t\t}\n\t\t\tcommit('setCurrentPanel', {\n\t\t\t\tpanelId: id,\n\t\t\t} as ISetCurrentPanelMutation);\n\t\t},\n\t\tduplicatePanel(\n\t\t\t{ state, commit, dispatch },\n\t\t\t{ panelId }: IDuplicatePanelAction\n\t\t) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tconst id = 'panel' + ++lastPanelNum;\n\t\t\tpreviewManager.register(id, panel.lastRender);\n\t\t\tcommit('createPanel', {\n\t\t\t\tpanel: {\n\t\t\t\t\tid,\n\t\t\t\t\tbackground: JSON.parse(JSON.stringify(panel.background)),\n\t\t\t\t\tlastRender: panel.lastRender,\n\t\t\t\t\tcomposite: panel.composite,\n\t\t\t\t\tfilters: JSON.parse(JSON.stringify(panel.filters)),\n\t\t\t\t},\n\t\t\t} as ICreatePanel);\n\t\t\tdispatch(\n\t\t\t\t'objects/copyObjects',\n\t\t\t\t{\n\t\t\t\t\tsourcePanelId: panelId,\n\t\t\t\t\ttargetPanelId: id,\n\t\t\t\t} as ICopyObjectsAction,\n\t\t\t\t{ root: true }\n\t\t\t);\n\t\t\tconst oldIdx = state.panelOrder.indexOf(panelId);\n\t\t\tcommit('setPanelOrder', {\n\t\t\t\tpanelOrder: [\n\t\t\t\t\t...state.panelOrder.slice(0, oldIdx + 1),\n\t\t\t\t\tid,\n\t\t\t\t\t...state.panelOrder.slice(oldIdx + 1),\n\t\t\t\t],\n\t\t\t} as ISetPanelOrder);\n\t\t\tcommit('setCurrentPanel', {\n\t\t\t\tpanelId: id,\n\t\t\t} as ISetCurrentPanelMutation);\n\t\t},\n\t\tseekBackgroundVariant(\n\t\t\t{ state, rootGetters, commit },\n\t\t\t{ delta }: ISeekVariantAction\n\t\t) {\n\t\t\tconst panel = state.panels[state.currentPanel];\n\t\t\tconst backgrounds = rootGetters[\n\t\t\t\t'content/getBackgrounds'\n\t\t\t] as BackgroundLookup;\n\t\t\tconst background = backgrounds.get(panel.background.current);\n\t\t\tif (!background) return;\n\t\t\tcommit('setBackgroundVariant', {\n\t\t\t\tpanelId: state.currentPanel,\n\t\t\t\tvariant: arraySeeker(\n\t\t\t\t\tbackground.variants,\n\t\t\t\t\tpanel.background.variant,\n\t\t\t\t\tdelta\n\t\t\t\t),\n\t\t\t} as ISetVariantMutation);\n\t\t},\n\t\tdelete({ state, dispatch, commit }, { panelId }: IDeletePanelAction) {\n\t\t\tif (state.panelOrder.length <= 1) return;\n\t\t\tconst orderIdx = state.panelOrder.indexOf(panelId);\n\t\t\tlet newOrderIdx;\n\t\t\tif (orderIdx === state.panelOrder.length - 1) {\n\t\t\t\tnewOrderIdx = orderIdx - 1;\n\t\t\t} else {\n\t\t\t\tnewOrderIdx = orderIdx + 1;\n\t\t\t}\n\t\t\tcommit('setCurrentPanel', {\n\t\t\t\tpanelId: state.panelOrder[newOrderIdx],\n\t\t\t} as ISetCurrentPanelMutation);\n\t\t\tcommit('setPanelOrder', {\n\t\t\t\tpanelOrder: [\n\t\t\t\t\t...state.panelOrder.slice(0, orderIdx),\n\t\t\t\t\t...state.panelOrder.slice(orderIdx + 1),\n\t\t\t\t],\n\t\t\t} as ISetPanelOrder);\n\t\t\tdispatch(\n\t\t\t\t'objects/deleteAllOfPanel',\n\t\t\t\t{\n\t\t\t\t\tpanelId,\n\t\t\t\t} as IDeleteAllOfPanel,\n\t\t\t\t{ root: true }\n\t\t\t);\n\t\t\tcommit('deletePanel', {\n\t\t\t\tpanelId,\n\t\t\t} as IDeletePanelMutation);\n\t\t},\n\t\tasync fixContentPackRemoval(\n\t\t\t{ state, rootGetters, commit, rootState },\n\t\t\toldContent: ContentPack<IAsset>\n\t\t) {\n\t\t\tfor (const panel of Object.values(state.panels)) {\n\t\t\t\tconst oldBackground = oldContent.backgrounds.find(\n\t\t\t\t\tx => x.id === panel.background.current\n\t\t\t\t);\n\t\t\t\t// Probably build in?\n\t\t\t\tif (!oldBackground) return;\n\n\t\t\t\tconst newBackground = (rootGetters[\n\t\t\t\t\t'content/getBackgrounds'\n\t\t\t\t] as BackgroundLookup).get(panel.background.current);\n\n\t\t\t\tif (!newBackground) {\n\t\t\t\t\tif (rootState.content.current.backgrounds[0]) {\n\t\t\t\t\t\tcommit('setCurrentBackground', {\n\t\t\t\t\t\t\tcurrent: rootState.content.current.backgrounds[0].id,\n\t\t\t\t\t\t\tpanelId: panel.id,\n\t\t\t\t\t\t} as ISetCurrentMutation);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcommit('setCurrentBackground', {\n\t\t\t\t\t\t\tcurrent: 'buildin.transparent',\n\t\t\t\t\t\t\tpanelId: panel.id,\n\t\t\t\t\t\t} as ISetCurrentMutation);\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst oldVariantJSON = JSON.stringify(\n\t\t\t\t\toldBackground.variants[panel.background.variant]\n\t\t\t\t);\n\t\t\t\tconst newVariantIdx = newBackground.variants.findIndex(\n\t\t\t\t\tvariant => JSON.stringify(variant) === oldVariantJSON\n\t\t\t\t);\n\t\t\t\tif (newVariantIdx !== panel.background.variant) {\n\t\t\t\t\tcommit('setBackgroundVariant', {\n\t\t\t\t\t\tvariant: newVariantIdx === -1 ? 0 : newVariantIdx,\n\t\t\t\t\t\tpanelId: panel.id,\n\t\t\t\t\t} as ISetVariantMutation);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tmove({ state, commit }, { panelId, delta }: IMovePanelAction) {\n\t\t\tconst collection = [...state.panelOrder];\n\t\t\tconst oldIdx = collection.indexOf(panelId);\n\t\t\tcollection.splice(oldIdx, 1);\n\t\t\tconst newIdx = Math.max(oldIdx + delta, 0);\n\t\t\tcollection.splice(newIdx, 0, panelId);\n\t\t\tcommit('setPanelOrder', { panelOrder: collection } as ISetPanelOrder);\n\t\t},\n\t\taddFilter({ state, commit }, action: IAddFilterAction) {\n\t\t\taddFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.panels[id],\n\t\t\t\tmutation => commit('setFilters', mutation)\n\t\t\t);\n\t\t},\n\t\tremoveFilter({ state, commit }, action: IRemoveFilterAction) {\n\t\t\tremoveFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.panels[id],\n\t\t\t\tmutation => commit('setFilters', mutation)\n\t\t\t);\n\t\t},\n\t\tmoveFilter({ state, commit }, action: IMoveFilterAction) {\n\t\t\tmoveFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.panels[id],\n\t\t\t\tmutation => commit('setFilters', mutation)\n\t\t\t);\n\t\t},\n\t\tsetFilter({ state, commit }, action: ISetFilterAction) {\n\t\t\tsetFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.panels[id],\n\t\t\t\tmutation => commit('setFilters', mutation)\n\t\t\t);\n\t\t},\n\t\tbackgroundAddFilter({ state, commit }, action: IAddFilterAction) {\n\t\t\taddFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.panels[id].background,\n\t\t\t\tmutation => commit('backgroundSetFilters', mutation)\n\t\t\t);\n\t\t},\n\t\tbackgroundRemoveFilter({ state, commit }, action: IRemoveFilterAction) {\n\t\t\tremoveFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.panels[id].background,\n\t\t\t\tmutation => commit('backgroundSetFilters', mutation)\n\t\t\t);\n\t\t},\n\t\tbackgroundMoveFilter({ state, commit }, action: IMoveFilterAction) {\n\t\t\tmoveFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.panels[id].background,\n\t\t\t\tmutation => commit('backgroundSetFilters', mutation)\n\t\t\t);\n\t\t},\n\t\tbackgroundSetFilter({ state, commit }, action: ISetFilterAction) {\n\t\t\tsetFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.panels[id].background,\n\t\t\t\tmutation => commit('backgroundSetFilters', mutation)\n\t\t\t);\n\t\t},\n\t},\n} as Module<IPanels, IRootState>;\n\nexport interface ISetCurrentPanelMutation {\n\treadonly panelId: string;\n}\n\nexport interface IDeletePanelMutation {\n\treadonly panelId: string;\n}\n\nexport interface ISetPanelPreviewMutation {\n\treadonly panelId: string;\n\treadonly url: string;\n}\n\nexport interface IDuplicatePanelAction {\n\treadonly panelId: string;\n}\n\nexport interface IDeletePanelAction {\n\treadonly panelId: string;\n}\n\nexport interface ICreatePanel {\n\treadonly panel: IPanel;\n}\n\nexport interface ISetPanelOrder {\n\treadonly panelOrder: string[];\n}\n\nexport interface ISetCurrentMutation {\n\treadonly panelId: string;\n\treadonly current: string;\n}\n\nexport interface ISetColorMutation {\n\treadonly panelId: string;\n\treadonly color: string;\n}\n\nexport interface ISetFlipMutation {\n\treadonly panelId: string;\n\treadonly flipped: boolean;\n}\n\nexport interface ISetVariantMutation {\n\treadonly panelId: string;\n\treadonly variant: number;\n}\n\nexport interface ISetScalingMutation {\n\treadonly panelId: string;\n\treadonly scaling: ScalingModes;\n}\n\nexport interface ISeekVariantAction {\n\treadonly delta: 1 | -1;\n}\n\nexport interface IMovePanelAction {\n\treadonly panelId: string;\n\treadonly delta: number;\n}\n","import { CompositeModes, RenderContext } from '@/renderer/rendererContext';\nimport { getAAsset } from '@/asset-manager';\nimport { IAsset } from '@/store/content';\nimport { ScalingModes } from '@/store/panels';\nimport { DeepReadonly } from '@/util/readonly';\nimport { SpriteFilter } from '@/store/sprite_options';\nimport getConstants from '@/constants';\n\nexport interface IBackgroundRenderer {\n\trender(rx: RenderContext): Promise<void>;\n}\n\nexport class Background implements IBackgroundRenderer {\n\tpublic constructor(\n\t\tpublic readonly id: string,\n\t\tpublic readonly assets: DeepReadonly<IAsset[]>,\n\t\tpublic readonly flip: boolean,\n\t\tpublic readonly scale: ScalingModes,\n\t\tpublic readonly compositeMode: CompositeModes,\n\t\tpublic readonly filters: DeepReadonly<SpriteFilter[]>\n\t) {}\n\n\tpublic async render(rx: RenderContext): Promise<void> {\n\t\tconst { screenWidth, screenHeight } = getConstants().Base;\n\t\tconst images = await Promise.all(\n\t\t\tthis.assets.map(asset => getAAsset(asset, rx.hq))\n\t\t);\n\t\tfor (const image of images) {\n\t\t\tif (!(image instanceof HTMLImageElement)) return;\n\t\t\tlet x = 0;\n\t\t\tlet y = 0;\n\t\t\tlet w = image.width;\n\t\t\tlet h = image.height;\n\n\t\t\tswitch (this.scale) {\n\t\t\t\tcase ScalingModes.None:\n\t\t\t\t\tx = screenWidth / 2 - w / 2;\n\t\t\t\t\ty = screenHeight / 2 - h / 2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase ScalingModes.Stretch:\n\t\t\t\t\tw = screenWidth;\n\t\t\t\t\th = screenHeight;\n\t\t\t\t\tbreak;\n\t\t\t\tcase ScalingModes.Cover:\n\t\t\t\t\tconst ratio = w / h;\n\t\t\t\t\tconst screenRatio = screenWidth / screenHeight;\n\n\t\t\t\t\tif (ratio > screenRatio) {\n\t\t\t\t\t\th = screenHeight;\n\t\t\t\t\t\tw = h * ratio;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tw = screenWidth;\n\t\t\t\t\t\th = w / ratio;\n\t\t\t\t\t}\n\n\t\t\t\t\tx = screenWidth / 2 - w / 2;\n\t\t\t\t\ty = screenHeight / 2 - h / 2;\n\t\t\t}\n\n\t\t\trx.drawImage({\n\t\t\t\timage,\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t\tw,\n\t\t\t\th,\n\t\t\t\tflip: this.flip,\n\t\t\t\tcomposite: this.compositeMode,\n\t\t\t\tfilters: this.filters,\n\t\t\t});\n\t\t}\n\t}\n}\n\nexport const color = {\n\tid: 'buildin.static-color',\n\tname: 'Static color',\n\tcolor: '#000000',\n\n\tasync render(rx: RenderContext): Promise<void> {\n\t\tconst { screenWidth, screenHeight } = getConstants().Base;\n\t\trx.drawRect({\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\tw: screenWidth,\n\t\t\th: screenHeight,\n\t\t\tfill: { style: this.color },\n\t\t});\n\t},\n};\n\nexport const transparent = {\n\tid: 'buildin.transparent',\n\tname: 'Transparent',\n\t// tslint:disable-next-line: no-empty\n\tasync render(rx: RenderContext) {},\n};\n","import { getAAsset } from '@/asset-manager';\nimport { ISprite } from '@/store/objectTypes/sprite';\nimport { DeepReadonly } from '@/util/readonly';\nimport {\n\tAssetListRenderable,\n\tIDrawAssets,\n\tIDrawAssetsUnloaded,\n} from './assetListRenderable';\n\nexport class Sprite extends AssetListRenderable<ISprite> {\n\tprivate assets!: IDrawAssets[];\n\tprotected ready!: Promise<void>;\n\tprotected canvasHeight: number = 0;\n\tprotected canvasWidth: number = 0;\n\n\tconstructor(obj: DeepReadonly<ISprite>) {\n\t\tsuper(obj);\n\t\tthis.init();\n\t}\n\n\tprotected get version(): number {\n\t\treturn this.assets === null ? -1 : this.obj.version;\n\t}\n\n\tpublic async init() {\n\t\tlet readyResolve!: () => void;\n\t\tthis.ready = new Promise((resolve, reject) => {\n\t\t\treadyResolve = resolve;\n\t\t});\n\t\tconst assets = await Promise.all(\n\t\t\tthis.obj.assets.map(asset => getAAsset(asset))\n\t\t);\n\t\tlet width = 0;\n\t\tlet height = 0;\n\t\tfor (const asset of assets) {\n\t\t\tif (asset instanceof HTMLImageElement) {\n\t\t\t\tif (asset.height > height) height = asset.height;\n\t\t\t\tif (asset.width > width) width = asset.width;\n\t\t\t}\n\t\t}\n\t\tthis.canvasWidth = width;\n\t\tthis.canvasHeight = height;\n\t\tthis.assets = [\n\t\t\t{\n\t\t\t\tloaded: true,\n\t\t\t\tassets,\n\t\t\t\toffset: [0, 0],\n\t\t\t},\n\t\t];\n\t\treadyResolve();\n\t}\n\tprotected getAssetList(): (IDrawAssets | IDrawAssetsUnloaded)[] {\n\t\treturn this.assets || [];\n\t}\n}\n","import { RenderContext } from '@/renderer/rendererContext';\nimport { TextRenderer } from '@/renderer/textRenderer/textRenderer';\nimport { IChoices } from '@/store/objectTypes/choices';\nimport { ScalingRenderable } from './scalingRenderable';\nimport getConstants from '@/constants';\n\nexport class Choice extends ScalingRenderable<IChoices> {\n\tprivate _height: number = 0;\n\tpublic get height(): number {\n\t\treturn this._height;\n\t}\n\tprotected get centeredVertically(): boolean {\n\t\treturn true;\n\t}\n\n\tprivate choiceRenderers: TextRenderer[] = [];\n\n\tprotected async draw(rx: RenderContext): Promise<void> {\n\t\tawait this.updateChoiceBounds();\n\n\t\tconst constants = getConstants();\n\t\tconst w = this.obj.width;\n\t\tconst h = this.height;\n\t\tconst w2 = w / 2;\n\t\tconst baseX = this.flip\n\t\t\t? constants.Base.screenWidth - this.obj.x\n\t\t\t: this.obj.x;\n\t\tconst x = baseX - w2;\n\t\tlet y = this.obj.y - h / 2;\n\n\t\tfor (const choiceRenderer of this.choiceRenderers) {\n\t\t\tawait choiceRenderer.loadFonts();\n\t\t\tconst height = choiceRenderer.getHeight(\n\t\t\t\tthis.obj.autoWrap ? this.obj.width : 0\n\t\t\t);\n\t\t\trx.drawRect({\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t\tw,\n\t\t\t\th: height + constants.Choices.ChoicePadding * 2,\n\t\t\t\toutline: {\n\t\t\t\t\tstyle: constants.Choices.ChoiceButtonBorderColor,\n\t\t\t\t\twidth: constants.Choices.Outline,\n\t\t\t\t},\n\t\t\t\tfill: {\n\t\t\t\t\tstyle: constants.Choices.ChoiceButtonColor,\n\t\t\t\t},\n\t\t\t});\n\t\t\tchoiceRenderer.fixAlignment(\n\t\t\t\t'center',\n\t\t\t\tx,\n\t\t\t\tx + w,\n\t\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\t\ty + constants.Choices.ChoiceSpacing * 1.25,\n\t\t\t\tthis.obj.autoWrap ? w : 0\n\t\t\t);\n\t\t\tchoiceRenderer.render(rx.fsCtx);\n\t\t\ty +=\n\t\t\t\theight +\n\t\t\t\tconstants.Choices.ChoicePadding * 2 +\n\t\t\t\tconstants.Choices.ChoiceSpacing;\n\t\t}\n\t}\n\n\tprivate async updateChoiceBounds() {\n\t\tconst constants = getConstants();\n\t\tthis.choiceRenderers = this.obj.choices.map(\n\t\t\tchoice =>\n\t\t\t\tnew TextRenderer(choice.text || ' ', constants.Choices.ChoiceTextStyle)\n\t\t);\n\n\t\tthis._height =\n\t\t\tthis.choiceRenderers.reduce(\n\t\t\t\t(acc, renderer) =>\n\t\t\t\t\tacc +\n\t\t\t\t\trenderer.getHeight(this.obj.autoWrap ? this.obj.width : 0) +\n\t\t\t\t\tconstants.Choices.ChoicePadding * 2,\n\t\t\t\t0\n\t\t\t) +\n\t\t\tthis.obj.choiceDistance * (this.obj.choices.length - 1);\n\t}\n}\n","import { RenderContext } from '@/renderer/rendererContext';\nimport { TextRenderer } from '@/renderer/textRenderer/textRenderer';\nimport { INotification } from '@/store/objectTypes/notification';\nimport { ScalingRenderable } from './scalingRenderable';\nimport getConstants from '@/constants';\n\nexport class Notification extends ScalingRenderable<INotification> {\n\tprivate _height: number = 0;\n\tpublic get height(): number {\n\t\treturn this._height;\n\t}\n\tprivate _width: number = 0;\n\tpublic get width(): number {\n\t\treturn this._width;\n\t}\n\tprotected get centeredVertically(): boolean {\n\t\treturn true;\n\t}\n\n\tpublic get id() {\n\t\treturn this.obj.id;\n\t}\n\n\tpublic async render(selected: boolean, rx: RenderContext) {\n\t\tconst constants = getConstants();\n\t\tif (this.obj.backdrop) {\n\t\t\trx.drawRect({\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\tw: constants.Base.screenWidth,\n\t\t\t\th: constants.Base.screenHeight,\n\t\t\t\tfill: {\n\t\t\t\t\tstyle: getConstants().Notification.NotificationBackdropColor,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\tawait super.render(selected, rx);\n\t}\n\n\tprotected async draw(rx: RenderContext): Promise<void> {\n\t\tconst constants = getConstants();\n\t\tconst textRenderer = new TextRenderer(\n\t\t\tthis.obj.text,\n\t\t\tconstants.Notification.NotificationTextStyle\n\t\t);\n\t\tconst buttonRenderer = new TextRenderer(\n\t\t\t'OK',\n\t\t\tconstants.Notification.NotificationOkTextStyle\n\t\t);\n\t\tawait textRenderer.loadFonts();\n\t\tawait buttonRenderer.loadFonts();\n\n\t\tconst lineWrap = this.obj.autoWrap\n\t\t\t? this.obj.width - constants.Notification.NotificationPadding * 2\n\t\t\t: 0;\n\n\t\tconst textWidth = this.obj.autoWrap ? lineWrap : textRenderer.getWidth();\n\t\tconst textHeight = textRenderer.getHeight(lineWrap);\n\t\tconst buttonWidth = this.obj.autoWrap\n\t\t\t? lineWrap\n\t\t\t: buttonRenderer.getWidth();\n\t\tconst buttonHeight = buttonRenderer.getHeight(lineWrap);\n\n\t\tconst w = (this._width =\n\t\t\tMath.max(textWidth, buttonWidth) +\n\t\t\tconstants.Notification.NotificationPadding * 2);\n\t\tconst h = (this._height =\n\t\t\ttextHeight +\n\t\t\tconstants.Notification.NotificationPadding * 2 +\n\t\t\tconstants.Notification.NotificationSpacing +\n\t\t\tbuttonHeight);\n\n\t\tconst w2 = w / 2;\n\t\tconst baseX = this.flip\n\t\t\t? constants.Base.screenWidth - this.obj.x\n\t\t\t: this.obj.x;\n\t\tconst x = baseX - w2;\n\t\tconst y = this.obj.y - h / 2;\n\n\t\trx.drawRect({\n\t\t\tx,\n\t\t\ty,\n\t\t\tw,\n\t\t\th,\n\t\t\toutline: {\n\t\t\t\tstyle: constants.Choices.ChoiceButtonBorderColor,\n\t\t\t\twidth: 3,\n\t\t\t},\n\t\t\tfill: {\n\t\t\t\tstyle: constants.Choices.ChoiceButtonColor,\n\t\t\t},\n\t\t});\n\t\ttextRenderer.fixAlignment(\n\t\t\t'center',\n\t\t\tx,\n\t\t\tx + w,\n\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\ty + constants.Notification.NotificationPadding * 1.5,\n\t\t\tlineWrap\n\t\t);\n\t\ttextRenderer.render(rx.fsCtx);\n\t\tbuttonRenderer.fixAlignment(\n\t\t\t'center',\n\t\t\tx,\n\t\t\tx + w,\n\t\t\t// tslint:disable-next-line: no-magic-numbers\n\t\t\ty + h - constants.Notification.NotificationPadding,\n\t\t\tlineWrap\n\t\t);\n\t\tbuttonRenderer.render(rx.fsCtx);\n\t}\n}\n","import { RenderContext } from '@/renderer/rendererContext';\nimport { TextRenderer } from '@/renderer/textRenderer/textRenderer';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport { getAssetByUrl } from '@/asset-manager';\nimport { ScalingRenderable } from './scalingRenderable';\nimport getConstants from '@/constants';\n\nconst consolePadding = -2;\nconst consoleTopPadding = 26;\nconst consoleLineWrapPadding = 10;\nconst poemTopMargin = 10;\n\nexport class Poem extends ScalingRenderable<IPoem> {\n\tprivate _height: number = 0;\n\tpublic get height(): number {\n\t\treturn this._height;\n\t}\n\n\tprivate _width: number = 0;\n\tpublic get width(): number {\n\t\treturn this._width;\n\t}\n\tprotected get centeredVertically(): boolean {\n\t\treturn true;\n\t}\n\n\tprotected async draw(rx: RenderContext): Promise<void> {\n\t\tconst constants = getConstants();\n\t\tconst paper = constants.Poem.poemBackgrounds[this.obj.background];\n\t\tconst flippedX = this.flip\n\t\t\t? constants.Base.screenWidth - this.obj.x\n\t\t\t: this.obj.x;\n\t\tlet y = this.obj.y;\n\t\tlet x = flippedX + poemTopMargin;\n\t\tlet padding = constants.Poem.poemPadding;\n\t\tlet topPadding = constants.Poem.poemTopPadding;\n\t\tlet lineWrapPadding = padding * 2;\n\n\t\tif (paper.file === 'internal:console') {\n\t\t\tconst h = (this._height = this.obj.height);\n\t\t\tconst w = (this._width = this.obj.width);\n\n\t\t\trx.drawRect({\n\t\t\t\tx: flippedX - w / 2,\n\t\t\t\ty: this.obj.y - h / 2,\n\t\t\t\th,\n\t\t\t\tw,\n\t\t\t\tfill: { style: constants.Poem.consoleBackgroundColor },\n\t\t\t});\n\t\t\tpadding = consolePadding;\n\t\t\ttopPadding = consoleTopPadding;\n\t\t\tlineWrapPadding = consoleLineWrapPadding;\n\t\t} else if (paper.file === 'internal:transparent') {\n\t\t\tthis._height = this.obj.height;\n\t\t\tthis._width = this.obj.width;\n\t\t} else {\n\t\t\tconst asset = await getAssetByUrl(`assets/poemBackgrounds/${paper.file}`);\n\t\t\tif (asset instanceof HTMLImageElement) {\n\t\t\t\trx.drawImage({\n\t\t\t\t\timage: asset,\n\t\t\t\t\tx: flippedX - asset.width / 2,\n\t\t\t\t\ty: this.obj.y - asset.height / 2,\n\t\t\t\t});\n\t\t\t\tthis._height = asset.height;\n\t\t\t\tthis._width = asset.width;\n\t\t\t}\n\t\t}\n\t\ty -= this.height / 2;\n\t\tx -= this.width / 2;\n\n\t\tconst style = constants.Poem.poemTextStyles[this.obj.font];\n\t\tconst render = new TextRenderer(this.obj.text, style);\n\t\tawait render.loadFonts();\n\n\t\trender.fixAlignment(\n\t\t\t'left',\n\t\t\tx + padding,\n\t\t\tx + padding,\n\t\t\ty + topPadding + padding,\n\t\t\tthis.obj.autoWrap ? this.width - lineWrapPadding : 0\n\t\t);\n\n\t\trender.render(rx.fsCtx);\n\t}\n}\n","import { Store } from 'vuex';\nimport { IRootState } from '@/store';\nimport { color, Background, IBackgroundRenderer } from './background';\nimport panels, { IPanel } from '@/store/panels';\nimport { DeepReadonly } from '@/util/readonly';\nimport { ISprite } from '@/store/objectTypes/sprite';\nimport { Sprite } from './sprite';\nimport { Character } from './character';\nimport { ICharacter, getData } from '@/store/objectTypes/characters';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport { TextBox } from './textbox';\nimport { Choice } from './choices';\nimport { RenderContext } from '@/renderer/rendererContext';\nimport { getAsset } from '@/asset-manager';\nimport { Renderer } from '@/renderer/renderer';\nimport { BackgroundLookup } from '@/store/content';\nimport { IChoices } from '@/store/objectTypes/choices';\nimport { INotification } from '@/store/objectTypes/notification';\nimport { Notification } from '@/renderables/notification';\nimport { Poem } from './poem';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport { IObject } from '@/store/objects';\nimport { OffscreenRenderable } from './offscreenRenderable';\n\nexport class SceneRenderer {\n\tprivate renderObjectCache = new Map<string, OffscreenRenderable<IObject>>();\n\tprivate lCurrentlyRendering = false;\n\tprivate renderer: Renderer;\n\n\tpublic constructor(\n\t\tprivate store: Store<DeepReadonly<IRootState>>,\n\t\tprivate panelId: string,\n\t\treadonly canvasWidth: number,\n\t\treadonly canvasHeight: number\n\t) {\n\t\tthis.renderer = new Renderer(canvasWidth, canvasHeight);\n\t}\n\n\tpublic render(hq: boolean, preview: boolean): Promise<boolean> {\n\t\tif (!this.panel) return Promise.resolve(false);\n\t\treturn this.renderer.render(this.renderCallback.bind(this), hq, preview);\n\t}\n\n\tpublic download(): Promise<string> {\n\t\tconst date = new Date();\n\t\tconst filename = `panel-${[\n\t\t\tdate.getFullYear(),\n\t\t\t`${date.getMonth() + 1}`.padStart(2, '0'),\n\t\t\t`${date.getDate()}`.padStart(2, '0'),\n\t\t\t`${date.getHours()}`.padStart(2, '0'),\n\t\t\t`${date.getMinutes()}`.padStart(2, '0'),\n\t\t\t`${date.getSeconds()}`.padStart(2, '0'),\n\t\t].join('-')}.png`;\n\t\treturn this.renderer.download(this.renderCallback.bind(this), filename);\n\t}\n\n\tpublic get currentlyRendering() {\n\t\treturn this.lCurrentlyRendering;\n\t}\n\n\tpublic paintOnto(\n\t\tc: CanvasRenderingContext2D,\n\t\topts: { x: number; y: number; w?: number; h?: number }\n\t) {\n\t\tthis.renderer.paintOnto(c, opts);\n\t}\n\n\tpublic objectsAt(x: number, y: number): string[] {\n\t\treturn this.getRenderObjects()\n\t\t\t.filter(renderObject => renderObject.hitTest(x, y))\n\t\t\t.map(renderObject => ((renderObject as unknown) as { id: string }).id);\n\t}\n\n\tprivate async renderCallback(rx: RenderContext): Promise<void> {\n\t\tthis.lCurrentlyRendering = true;\n\t\ttry {\n\t\t\trx.fsCtx.imageSmoothingEnabled = true;\n\t\t\trx.fsCtx.imageSmoothingQuality = rx.hq ? 'high' : 'low';\n\n\t\t\tawait this.getBackgroundRenderer()?.render(rx);\n\n\t\t\tconst selection = this.store.state.ui.selection;\n\t\t\tfor (const object of this.getRenderObjects()) {\n\t\t\t\tlet selected = false;\n\t\t\t\tif (object instanceof OffscreenRenderable) {\n\t\t\t\t\tobject.updatedContent(this.store, this.panelId);\n\t\t\t\t\tselected = selection === object.id;\n\t\t\t\t}\n\t\t\t\tawait object.render(selected, rx);\n\t\t\t}\n\t\t\trx.applyFilters([...this.panel.filters]);\n\t\t\tif (rx.preview) {\n\t\t\t\trx.drawImage({\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\tcomposite: 'destination-over',\n\t\t\t\t\timage: await getAsset('backgrounds/transparent'),\n\t\t\t\t});\n\t\t\t}\n\t\t} finally {\n\t\t\tthis.lCurrentlyRendering = false;\n\t\t}\n\t}\n\n\tprivate getRenderObjects() {\n\t\tconst objectsState = this.store.state.objects.panels[this.panelId];\n\t\tconst order = objectsState\n\t\t\t? [...objectsState.order, ...objectsState.onTopOrder]\n\t\t\t: [];\n\t\tconst objects = this.store.state.objects.objects;\n\t\tconst toUncache = Object.keys(this.renderObjectCache).filter(\n\t\t\tid => !order.includes(id)\n\t\t);\n\n\t\tfor (const id of toUncache) {\n\t\t\tthis.renderObjectCache.delete(id);\n\t\t}\n\n\t\treturn order.map(id => {\n\t\t\tlet renderObject = this.renderObjectCache.get(id);\n\t\t\tif (!renderObject) {\n\t\t\t\tconst obj = objects[id];\n\t\t\t\tswitch (obj.type) {\n\t\t\t\t\tcase 'sprite':\n\t\t\t\t\t\trenderObject = new Sprite(obj as DeepReadonly<ISprite>);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'character':\n\t\t\t\t\t\tconst char = obj as DeepReadonly<ICharacter>;\n\t\t\t\t\t\trenderObject = new Character(char, getData(this.store, char));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'textBox':\n\t\t\t\t\t\trenderObject = new TextBox(obj as DeepReadonly<ITextBox>);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'choice':\n\t\t\t\t\t\trenderObject = new Choice(obj as DeepReadonly<IChoices>);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'notification':\n\t\t\t\t\t\trenderObject = new Notification(obj as DeepReadonly<INotification>);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'poem':\n\t\t\t\t\t\trenderObject = new Poem(obj as DeepReadonly<IPoem>);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tthis.renderObjectCache.set(id, renderObject);\n\t\t\t}\n\t\t\treturn renderObject;\n\t\t});\n\t}\n\n\tprivate get panel(): DeepReadonly<IPanel> {\n\t\treturn this.store.state.panels.panels[this.panelId];\n\t}\n\n\tprivate getBackgroundRenderer(): IBackgroundRenderer | null {\n\t\tconst panel = this.panel;\n\t\tswitch (panel.background.current) {\n\t\t\tcase 'buildin.static-color':\n\t\t\t\tcolor.color = panel.background.color;\n\t\t\t\treturn color;\n\t\t\tdefault:\n\t\t\t\tconst lookup = this.store.getters[\n\t\t\t\t\t'content/getBackgrounds'\n\t\t\t\t] as BackgroundLookup;\n\t\t\t\tconst current = lookup.get(panel.background.current);\n\t\t\t\tif (!current) return null;\n\t\t\t\tconst variant = current.variants[panel.background.variant];\n\t\t\t\tif (!variant) return null;\n\t\t\t\treturn new Background(\n\t\t\t\t\tpanel.background.current,\n\t\t\t\t\tvariant,\n\t\t\t\t\tpanel.background.flipped,\n\t\t\t\t\tpanel.background.scaling,\n\t\t\t\t\tpanel.background.composite,\n\t\t\t\t\tpanel.background.filters\n\t\t\t\t);\n\t\t}\n\t}\n}\n","\nimport { PanelMixin } from './panelMixin';\nimport {\n\tIDuplicatePanelAction,\n\tISetCurrentPanelMutation,\n\tIDeletePanelAction,\n\tISetPanelPreviewMutation,\n\tIMovePanelAction,\n} from '@/store/panels';\nimport { isWebPSupported, isHeifSupported } from '@/asset-manager';\nimport { ITextBox } from '@/store/objectTypes/textbox';\nimport { SceneRenderer } from '@/renderables/scene-renderer';\nimport { DeepReadonly } from '@/util/readonly';\nimport environment from '@/environments/environment';\nimport eventBus, { ShowMessageEvent } from '@/eventbus/event-bus';\nimport { IObject } from '@/store/objects';\nimport { INotification } from '@/store/objectTypes/notification';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport { IChoices } from '@/store/objectTypes/choices';\nimport { defineComponent } from 'vue';\nimport DFieldset from '@/components/ui/d-fieldset.vue';\nimport DFlow from '@/components/ui/d-flow.vue';\nimport DButton from '@/components/ui/d-button.vue';\nimport ImageOptions from '../subtools/image-options/image-options.vue';\nimport getConstants from '@/constants';\n\ninterface IPanelButton {\n\tid: string;\n\timage: string;\n\ttext: string;\n}\n\n// tslint:disable: no-magic-numbers\nconst estimateFactor = 1.5;\nconst thumbnailFactor = 1 / 4;\nconst thumbnailQuality = 0.5;\nconst qualityFactor = 100;\n\nconst defaultQuality = 90;\n\nconst qualityWarningThreshold = 70;\n// tslint:enable: no-magic-numbers\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: { DFieldset, DFlow, DButton, ImageOptions },\n\tdata: () => ({\n\t\twebpSupport: false,\n\t\theifSupport: false,\n\t\tppi: 0,\n\t\tpages: '',\n\t\tformat: 'image/png',\n\t\tquality: defaultQuality,\n\t\timageOptions: false,\n\t}),\n\tcomputed: {\n\t\tcurrentPanel(): string {\n\t\t\treturn this.$store.state.panels.currentPanel;\n\t\t},\n\n\t\tisLossy(): boolean {\n\t\t\treturn this.format !== 'image/png';\n\t\t},\n\n\t\tcanDeletePanel(): boolean {\n\t\t\treturn this.panelButtons.length > 1;\n\t\t},\n\n\t\tpanelButtons(): IPanelButton[] {\n\t\t\tconst panelOrder = this.$store.state.panels.panelOrder;\n\t\t\treturn panelOrder.map(id => {\n\t\t\t\tconst panel = this.$store.state.panels.panels[id];\n\t\t\t\tconst objectOrders = this.$store.state.objects.panels[id];\n\t\t\t\tconst txtBox = objectOrders\n\t\t\t\t\t? ([] as string[])\n\t\t\t\t\t\t\t.concat(objectOrders.order, objectOrders.onTopOrder)\n\t\t\t\t\t\t\t.map(objId => this.$store.state.objects.objects[objId])\n\t\t\t\t\t\t\t.map(this.extractObjectText)\n\t\t\t\t\t: [];\n\t\t\t\treturn {\n\t\t\t\t\tid,\n\t\t\t\t\timage: panel.lastRender,\n\t\t\t\t\ttext: txtBox.reduce(\n\t\t\t\t\t\t(acc, current) => (acc.length > current.length ? acc : current),\n\t\t\t\t\t\t''\n\t\t\t\t\t),\n\t\t\t\t} as IPanelButton;\n\t\t\t});\n\t\t},\n\n\t\tcanMoveAhead(): boolean {\n\t\t\tconst panelOrder = this.$store.state.panels.panelOrder;\n\t\t\tconst idx = panelOrder.indexOf(this.currentPanel);\n\t\t\treturn idx > 0;\n\t\t},\n\n\t\tcanMoveBehind(): boolean {\n\t\t\tconst panelOrder = this.$store.state.panels.panelOrder;\n\t\t\tconst idx = panelOrder.indexOf(this.currentPanel);\n\t\t\treturn idx < panelOrder.length - 1;\n\t\t},\n\t},\n\tasync created() {\n\t\t[this.webpSupport, this.heifSupport] = await Promise.all([\n\t\t\tisWebPSupported(),\n\t\t\tisHeifSupported(),\n\t\t]);\n\t},\n\tasync mounted() {\n\t\tthis.moveFocusToActivePanel();\n\t\tthis.renderThumbnail();\n\t},\n\tmethods: {\n\t\tasync download() {\n\t\t\tconst distribution = this.getPanelDistibution();\n\t\t\tconst date = new Date();\n\t\t\tconst prefix = `cd-${[\n\t\t\t\tdate.getFullYear(),\n\t\t\t\t`${date.getMonth() + 1}`.padStart(2, '0'),\n\t\t\t\t`${date.getDate()}`.padStart(2, '0'),\n\t\t\t\t`${date.getHours()}`.padStart(2, '0'),\n\t\t\t\t`${date.getMinutes()}`.padStart(2, '0'),\n\t\t\t\t`${date.getSeconds()}`.padStart(2, '0'),\n\t\t\t].join('-')}`;\n\t\t\tconst extension = this.format.split('/')[1];\n\t\t\tconst format = this.format;\n\t\t\tconst quality = this.quality;\n\t\t\tawait this.renderObjects(\n\t\t\t\tdistribution,\n\t\t\t\ttrue,\n\t\t\t\tasync (imageIdx: number, canvas: HTMLCanvasElement) => {\n\t\t\t\t\tenvironment.saveToFile(\n\t\t\t\t\t\tcanvas,\n\t\t\t\t\t\t`${prefix}_${imageIdx}.${extension}`,\n\t\t\t\t\t\tformat,\n\t\t\t\t\t\tquality / qualityFactor\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\t\t},\n\t\tasync estimateExportSize() {\n\t\t\tconst distribution = this.getPanelDistibution();\n\t\t\tconst format = this.format || 'image/png';\n\t\t\tconst quality = this.quality || defaultQuality;\n\t\t\tconst sizes = await this.renderObjects(\n\t\t\t\tdistribution,\n\t\t\t\tfalse,\n\t\t\t\tasync (imageIdx: number, canvas: HTMLCanvasElement) => {\n\t\t\t\t\treturn new Promise<number>((resolve, reject) => {\n\t\t\t\t\t\tcanvas.toBlob(\n\t\t\t\t\t\t\tblob => {\n\t\t\t\t\t\t\t\tif (!blob) {\n\t\t\t\t\t\t\t\t\treject(`Image ${imageIdx + 1} could not be rendered.`);\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tresolve(blob.size);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tformat,\n\t\t\t\t\t\t\tquality / qualityFactor\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\t\t\tconst readableSizes = sizes.map(\n\t\t\t\tsize => ((size * estimateFactor) / 1024 / 1024).toFixed(2) + 'MiB'\n\t\t\t);\n\t\t\tconst filePluralize = readableSizes.length > 1 ? 'files' : 'file';\n\t\t\tconst itPluralize = readableSizes.length > 1 ? 'These' : 'It';\n\t\t\tconst sizePluralize = readableSizes.length > 1 ? 'sizes' : 'size';\n\t\t\teventBus.fire(\n\t\t\t\tnew ShowMessageEvent(\n\t\t\t\t\t`This would export ${\n\t\t\t\t\t\treadableSizes.length\n\t\t\t\t\t} ${filePluralize}. ${itPluralize} would have the following (aproximate) ${sizePluralize}: ${readableSizes.join(\n\t\t\t\t\t\t','\n\t\t\t\t\t)}`\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\t\tasync renderObjects<T>(\n\t\t\tdistribution: DeepReadonly<string[][]>,\n\t\t\thq: boolean,\n\t\t\tmapper: (imageIdx: number, canvas: HTMLCanvasElement) => Promise<T>\n\t\t): Promise<T[]> {\n\t\t\tconst baseConst = getConstants().Base;\n\t\t\treturn await Promise.all(\n\t\t\t\tdistribution.map(async (image, imageIdx) => {\n\t\t\t\t\tconst targetCanvas = document.createElement('canvas');\n\t\t\t\t\ttargetCanvas.width = baseConst.screenWidth;\n\t\t\t\t\ttargetCanvas.height = baseConst.screenHeight * image.length;\n\t\t\t\t\tconst context = targetCanvas.getContext('2d')!;\n\n\t\t\t\t\tawait Promise.all(\n\t\t\t\t\t\timage.map(async (panelId, panelIdx) => {\n\t\t\t\t\t\t\tconst sceneRenderer = new SceneRenderer(\n\t\t\t\t\t\t\t\tthis.$store,\n\t\t\t\t\t\t\t\timage[panelIdx],\n\t\t\t\t\t\t\t\tbaseConst.screenWidth,\n\t\t\t\t\t\t\t\tbaseConst.screenHeight\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tawait sceneRenderer.render(hq, false);\n\n\t\t\t\t\t\t\tsceneRenderer.paintOnto(context, {\n\t\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\t\ty: baseConst.screenHeight * panelIdx,\n\t\t\t\t\t\t\t\tw: baseConst.screenWidth,\n\t\t\t\t\t\t\t\th: baseConst.screenHeight,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\n\t\t\t\t\treturn await mapper(imageIdx, targetCanvas);\n\t\t\t\t})\n\t\t\t);\n\t\t},\n\t\tgetLimitedPanelList(): DeepReadonly<string[]> {\n\t\t\tconst max = this.$store.state.panels.panelOrder.length - 1;\n\t\t\tconst min = 0;\n\t\t\tconst parts = this.pages.split(',');\n\t\t\tconst listedPages: number[] = [];\n\t\t\tlet foundMatch = false;\n\n\t\t\tfor (const part of parts) {\n\t\t\t\tconst trimmedPart = part.trim();\n\t\t\t\tconst match = trimmedPart.match(/^\\s*((\\d+)|(\\d+)\\s*-\\s*(\\d+))\\s*$/);\n\t\t\t\tif (!match) {\n\t\t\t\t\tif (trimmedPart !== '') {\n\t\t\t\t\t\teventBus.fire(\n\t\t\t\t\t\t\tnew ShowMessageEvent(`Could not read '${part}' in the page list.`)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tfoundMatch = true;\n\t\t\t\tif (match[2]) listedPages.push(parseInt(match[2], 10) - 1);\n\t\t\t\telse {\n\t\t\t\t\tconst from = Math.max(parseInt(match[3], 10) - 1, min);\n\t\t\t\t\tconst to = Math.min(parseInt(match[4], 10) - 1, max);\n\t\t\t\t\tif (from === undefined || to === undefined || from > to) continue;\n\t\t\t\t\tfor (let i = from; i <= to; ++i) {\n\t\t\t\t\t\tlistedPages.push(i);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!foundMatch) {\n\t\t\t\treturn this.$store.state.panels.panelOrder;\n\t\t\t}\n\n\t\t\treturn listedPages\n\t\t\t\t.sort((a, b) => a - b)\n\t\t\t\t.filter((value, idx, ary) => ary[idx - 1] !== value)\n\t\t\t\t.map(pageIdx => this.$store.state.panels.panelOrder[pageIdx]);\n\t\t},\n\t\tgetPanelDistibution(): DeepReadonly<string[][]> {\n\t\t\tconst panelOrder = this.getLimitedPanelList();\n\t\t\tif (this.ppi === 0) return [panelOrder];\n\t\t\tconst images: string[][] = [];\n\t\t\tfor (let imageI = 0; imageI < panelOrder.length / this.ppi; ++imageI) {\n\t\t\t\tconst sliceStart = imageI * this.ppi;\n\t\t\t\tconst sliceEnd = sliceStart + this.ppi;\n\t\t\t\timages.push([...panelOrder.slice(sliceStart, sliceEnd)]);\n\t\t\t}\n\t\t\treturn images;\n\t\t},\n\t\tmoveFocusToActivePanel() {\n\t\t\tconst active = this.$el.querySelector('.panel_button.active');\n\t\t\tif (active) {\n\t\t\t\tthis.scrollIntoView(active);\n\t\t\t}\n\t\t},\n\t\tscrollIntoView(ele: Element) {\n\t\t\tconst parent = ele.parentElement!.parentElement!;\n\t\t\tconst idx = Array.from(ele.parentElement!.children).indexOf(ele);\n\t\t\tif (this.$store.state.ui.vertical) {\n\t\t\t\tconst scroll =\n\t\t\t\t\tidx * ele.clientHeight -\n\t\t\t\t\tparent.clientHeight / 2 +\n\t\t\t\t\tele.clientHeight / 2;\n\t\t\t\tparent.scrollTop = scroll;\n\t\t\t\tparent.scrollLeft = 0;\n\t\t\t} else {\n\t\t\t\tconst scroll =\n\t\t\t\t\tidx * ele.clientWidth - parent.clientWidth / 2 + ele.clientWidth / 2;\n\t\t\t\tparent.scrollLeft = scroll;\n\t\t\t\tparent.scrollTop = 0;\n\t\t\t}\n\t\t},\n\t\textractObjectText(obj: DeepReadonly<IObject>) {\n\t\t\tswitch (obj.type) {\n\t\t\t\tcase 'textBox':\n\t\t\t\t\treturn (obj as ITextBox).text;\n\t\t\t\tcase 'notification':\n\t\t\t\t\treturn (obj as INotification).text;\n\t\t\t\tcase 'poem':\n\t\t\t\t\treturn (obj as IPoem).text;\n\t\t\t\tcase 'choice':\n\t\t\t\t\treturn (obj as IChoices).choices\n\t\t\t\t\t\t.map(choice => `[${choice.text}]`)\n\t\t\t\t\t\t.join('\\n');\n\t\t\t}\n\t\t\treturn '';\n\t\t},\n\t\tasync addNewPanel() {\n\t\t\tawait this.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('panels/duplicatePanel', {\n\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t} as IDuplicatePanelAction);\n\t\t\t});\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.moveFocusToActivePanel();\n\t\t\t});\n\t\t},\n\t\tupdateCurrentPanel(panelId: string) {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.commit('panels/setCurrentPanel', {\n\t\t\t\t\tpanelId,\n\t\t\t\t} as ISetCurrentPanelMutation);\n\t\t\t});\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.moveFocusToActivePanel();\n\t\t\t});\n\t\t},\n\t\tdeletePanel() {\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tthis.$store.dispatch('panels/delete', {\n\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t} as IDeletePanelAction);\n\t\t\t});\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.moveFocusToActivePanel();\n\t\t\t});\n\t\t},\n\t\tmoveAhead() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('panels/move', {\n\t\t\t\t\tpanelId: this.currentPanel,\n\t\t\t\t\tdelta: -1,\n\t\t\t\t} as IMovePanelAction);\n\t\t\t});\n\t\t},\n\t\tmoveBehind() {\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.dispatch('panels/move', {\n\t\t\t\t\tpanelId: this.currentPanel,\n\t\t\t\t\tdelta: 1,\n\t\t\t\t} as IMovePanelAction);\n\t\t\t});\n\t\t},\n\t\tasync renderThumbnail() {\n\t\t\tconst baseConst = getConstants().Base;\n\t\t\tconst sceneRenderer = new SceneRenderer(\n\t\t\t\tthis.$store,\n\t\t\t\tthis.currentPanel,\n\t\t\t\tbaseConst.screenWidth,\n\t\t\t\tbaseConst.screenHeight\n\t\t\t);\n\n\t\t\tawait sceneRenderer.render(false, true);\n\n\t\t\tconst targetCanvas = document.createElement('canvas');\n\t\t\ttargetCanvas.width = baseConst.screenWidth * thumbnailFactor;\n\t\t\ttargetCanvas.height = baseConst.screenHeight * thumbnailFactor;\n\n\t\t\tsceneRenderer.paintOnto(targetCanvas.getContext('2d')!, {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\tw: targetCanvas.width,\n\t\t\t\th: targetCanvas.height,\n\t\t\t});\n\t\t\ttargetCanvas.toBlob(\n\t\t\t\tblob => {\n\t\t\t\t\tif (!blob) return;\n\t\t\t\t\tconst url = URL.createObjectURL(blob);\n\t\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\t\tthis.$store.commit('panels/setPanelPreview', {\n\t\t\t\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t} as ISetPanelPreviewMutation);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t(await isWebPSupported()) ? 'image/webp' : 'image/jpeg',\n\t\t\t\tthumbnailQuality\n\t\t\t);\n\t\t},\n\t},\n\twatch: {\n\t\tquality(quality: number, oldQuality: number) {\n\t\t\tif (quality === qualityFactor) {\n\t\t\t\teventBus.fire(\n\t\t\t\t\tnew ShowMessageEvent(\n\t\t\t\t\t\t'Note: 100% quality on a lossy format is still not lossless! Select PNG if you want lossless compression.'\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (\n\t\t\t\toldQuality > qualityWarningThreshold &&\n\t\t\t\tquality <= qualityWarningThreshold\n\t\t\t) {\n\t\t\t\teventBus.fire(\n\t\t\t\t\tnew ShowMessageEvent(\n\t\t\t\t\t\t'Note: A quality level below 70% might be very noticable and impair legibility of text.'\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\t\t},\n\t},\n});\n","import { render } from \"./panels.vue?vue&type=template&id=0c58913e&scoped=true\"\nimport script from \"./panels.vue?vue&type=script&lang=ts\"\nexport * from \"./panels.vue?vue&type=script&lang=ts\"\n\nimport \"./panels.vue?vue&type=style&index=0&id=0c58913e&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-0c58913e\"\n\nexport default script","<template>\n\t<object-tool :object=\"object\" title=\"Notification\" :textHandler=\"textHandler\">\n\t\t<template v-slot:default>\n\t\t\t<div id=\"notification_text\">\n\t\t\t\t<label for=\"notification_text\">Text:</label>\n\t\t\t\t<textarea v-model=\"text\" id=\"notification_text\" @keydown.stop />\n\t\t\t\t<button @click=\"textEditor = true\">Formatting</button>\n\t\t\t</div>\n\t\t</template>\n\t\t<template v-slot:options>\n\t\t\t<toggle v-model=\"renderBackdrop\" label=\"Show backdrop?\" />\n\t\t</template>\n\t</object-tool>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport ObjectTool, { Handler } from './object-tool.vue';\nimport { PanelMixin } from './panelMixin';\nimport { INotification } from '../../../store/objectTypes/notification';\nimport { defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\n\nconst setable = genericSetable<INotification>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tObjectTool,\n\t},\n\tdata: () => ({\n\t\ttextEditor: false,\n\t}),\n\tcomputed: {\n\t\tobject(): INotification {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'notification') return undefined!;\n\t\t\treturn obj as INotification;\n\t\t},\n\t\ttextHandler(): Handler | undefined {\n\t\t\tif (!this.textEditor) return undefined;\n\t\t\treturn {\n\t\t\t\ttitle: 'Text',\n\t\t\t\tget: () => {\n\t\t\t\t\treturn this.text;\n\t\t\t\t},\n\t\t\t\tset: (text: string) => {\n\t\t\t\t\tthis.text = text;\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.textEditor = false;\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\ttext: setable('text', 'objects/setNotificationText'),\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\trenderBackdrop: setable('backdrop', 'objects/setNotificationBackdrop'),\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.current_button {\n\tinput {\n\t\twidth: 145px;\n\t}\n}\n\n.panel {\n\t&.vertical {\n\t\t#notification_text {\n\t\t\twidth: 173px;\n\n\t\t\ttextarea {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\n\t\tfieldset.buttons {\n\t\t\twidth: 100%;\n\t\t}\n\t}\n\n\ttextarea {\n\t\tdisplay: block;\n\t\theight: 114px;\n\t}\n}\n</style>\n","\nimport Toggle from '@/components/toggle.vue';\nimport ObjectTool, { Handler } from './object-tool.vue';\nimport { PanelMixin } from './panelMixin';\nimport { INotification } from '../../../store/objectTypes/notification';\nimport { defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\n\nconst setable = genericSetable<INotification>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tObjectTool,\n\t},\n\tdata: () => ({\n\t\ttextEditor: false,\n\t}),\n\tcomputed: {\n\t\tobject(): INotification {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'notification') return undefined!;\n\t\t\treturn obj as INotification;\n\t\t},\n\t\ttextHandler(): Handler | undefined {\n\t\t\tif (!this.textEditor) return undefined;\n\t\t\treturn {\n\t\t\t\ttitle: 'Text',\n\t\t\t\tget: () => {\n\t\t\t\t\treturn this.text;\n\t\t\t\t},\n\t\t\t\tset: (text: string) => {\n\t\t\t\t\tthis.text = text;\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.textEditor = false;\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\ttext: setable('text', 'objects/setNotificationText'),\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\trenderBackdrop: setable('backdrop', 'objects/setNotificationBackdrop'),\n\t},\n});\n","import { render } from \"./notification.vue?vue&type=template&id=618f75f2&scoped=true\"\nimport script from \"./notification.vue?vue&type=script&lang=ts\"\nexport * from \"./notification.vue?vue&type=script&lang=ts\"\n\nimport \"./notification.vue?vue&type=style&index=0&id=618f75f2&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-618f75f2\"\n\nexport default script","<template>\n\t<object-tool\n\t\t:object=\"object\"\n\t\t:title=\"object.subType === 'poem' ? 'Poem' : 'Console'\"\n\t\t:textHandler=\"textHandler\"\n\t>\n\t\t<div id=\"poem_text\">\n\t\t\t<label for=\"poem_text\">Text:</label>\n\t\t\t<textarea v-model=\"text\" @keydown.stop />\n\t\t\t<button @click=\"textEditor = true\">Formatting</button>\n\t\t</div>\n\t\t<toggle label=\"Auto line wrap?\" v-model=\"autoWrap\" />\n\t\t<template v-if=\"object.subType === 'poem'\">\n\t\t\t<select v-model=\"poemBackground\" @keydown.stop>\n\t\t\t\t<option\n\t\t\t\t\tv-for=\"(background, idx) of backgrounds\"\n\t\t\t\t\t:value=\"idx\"\n\t\t\t\t\t:key=\"idx\"\n\t\t\t\t\t>{{ background.name }}</option\n\t\t\t\t>\n\t\t\t</select>\n\t\t\t<select v-model=\"poemStyle\" @keydown.stop>\n\t\t\t\t<option\n\t\t\t\t\tv-for=\"(style, idx) of poemTextStyles\"\n\t\t\t\t\t:value=\"idx\"\n\t\t\t\t\t:key=\"idx\"\n\t\t\t\t\t>{{ style.name }}</option\n\t\t\t\t>\n\t\t\t</select>\n\t\t</template>\n\t</object-tool>\n</template>\n\n<script lang=\"ts\">\nimport Toggle from '@/components/toggle.vue';\nimport { PanelMixin } from './panelMixin';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport {\n\tpoemBackgrounds,\n\tpoemTextStyles,\n\tIPoemTextStyle,\n} from '@/constants/game_modes/ddlc/poem';\nimport { defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\nimport ObjectTool, { Handler } from './object-tool.vue';\n\nconst setable = genericSetable<IPoem>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tObjectTool,\n\t},\n\tdata: () => ({\n\t\ttextEditor: false,\n\t}),\n\tcomputed: {\n\t\tbackgrounds(): Array<{ name: string; file: string }> {\n\t\t\treturn poemBackgrounds;\n\t\t},\n\t\tpoemTextStyles(): IPoemTextStyle[] {\n\t\t\treturn poemTextStyles;\n\t\t},\n\t\tobject(): IPoem {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'poem') return undefined!;\n\t\t\treturn obj as IPoem;\n\t\t},\n\t\ttextHandler(): Handler | undefined {\n\t\t\tif (!this.textEditor) return undefined;\n\t\t\treturn {\n\t\t\t\ttitle: 'Text',\n\t\t\t\tget: () => {\n\t\t\t\t\treturn this.text;\n\t\t\t\t},\n\t\t\t\tset: (text: string) => {\n\t\t\t\t\tthis.text = text;\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.textEditor = false;\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\ttext: setable('text', 'objects/setPoemText'),\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\tpoemStyle: setable('font', 'objects/setPoemFont'),\n\t\tpoemBackground: setable('background', 'objects/setPoemBackground'),\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.panel {\n\t&.vertical {\n\t\t#poem_text {\n\t\t\twidth: 173px;\n\n\t\t\ttextarea {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t}\n\n\t\tfieldset.buttons {\n\t\t\twidth: 100%;\n\t\t}\n\t}\n\t&:not(.vertical) {\n\t\ttextarea {\n\t\t\tdisplay: block;\n\t\t\theight: 114px;\n\t\t}\n\t}\n}\n</style>\n","\nimport Toggle from '@/components/toggle.vue';\nimport { PanelMixin } from './panelMixin';\nimport { IPoem } from '@/store/objectTypes/poem';\nimport {\n\tpoemBackgrounds,\n\tpoemTextStyles,\n\tIPoemTextStyle,\n} from '@/constants/game_modes/ddlc/poem';\nimport { defineComponent } from 'vue';\nimport { genericSetable } from '@/util/simpleSettable';\nimport ObjectTool, { Handler } from './object-tool.vue';\n\nconst setable = genericSetable<IPoem>();\n\nexport default defineComponent({\n\tmixins: [PanelMixin],\n\tcomponents: {\n\t\tToggle,\n\t\tObjectTool,\n\t},\n\tdata: () => ({\n\t\ttextEditor: false,\n\t}),\n\tcomputed: {\n\t\tbackgrounds(): Array<{ name: string; file: string }> {\n\t\t\treturn poemBackgrounds;\n\t\t},\n\t\tpoemTextStyles(): IPoemTextStyle[] {\n\t\t\treturn poemTextStyles;\n\t\t},\n\t\tobject(): IPoem {\n\t\t\tconst obj = this.$store.state.objects.objects[\n\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t];\n\t\t\tif (obj.type !== 'poem') return undefined!;\n\t\t\treturn obj as IPoem;\n\t\t},\n\t\ttextHandler(): Handler | undefined {\n\t\t\tif (!this.textEditor) return undefined;\n\t\t\treturn {\n\t\t\t\ttitle: 'Text',\n\t\t\t\tget: () => {\n\t\t\t\t\treturn this.text;\n\t\t\t\t},\n\t\t\t\tset: (text: string) => {\n\t\t\t\t\tthis.text = text;\n\t\t\t\t},\n\t\t\t\tleave: () => {\n\t\t\t\t\tthis.textEditor = false;\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\ttext: setable('text', 'objects/setPoemText'),\n\t\tautoWrap: setable('autoWrap', 'objects/setAutoWrapping'),\n\t\tpoemStyle: setable('font', 'objects/setPoemFont'),\n\t\tpoemBackground: setable('background', 'objects/setPoemBackground'),\n\t},\n});\n","import { render } from \"./poem.vue?vue&type=template&id=67d04474&scoped=true\"\nimport script from \"./poem.vue?vue&type=script&lang=ts\"\nexport * from \"./poem.vue?vue&type=script&lang=ts\"\n\nimport \"./poem.vue?vue&type=style&index=0&id=67d04474&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-67d04474\"\n\nexport default script","\nimport SettingsPanel from './tools/settings.vue';\nimport AddPanel from './tools/add.vue';\nimport CharacterPanel from './tools/character.vue';\nimport SpritePanel from './tools/sprite.vue';\nimport TextBoxPanel from './tools/textbox.vue';\nimport ChoicePanel from './tools/choice.vue';\nimport CreditsPanel from './tools/credits.vue';\nimport BackgroundsPanel from './tools/backgrounds.vue';\nimport ContentPacksPanel from './tools/content-pack.vue';\nimport PanelsPanel from './tools/panels.vue';\nimport NotificationPanel from './tools/notification.vue';\nimport PoemPanel from './tools/poem.vue';\nimport { IObject, ObjectTypes } from '@/store/objects';\nimport environment from '@/environments/environment';\nimport { defineComponent } from 'vue';\n\ntype PanelNames =\n\t| 'add'\n\t| 'backgrounds'\n\t| 'help_credits'\n\t| 'selection'\n\t| 'packs'\n\t| 'settings'\n\t| 'panels'\n\t| 'notification'\n\t| 'poem';\n\nexport default defineComponent({\n\tcomponents: {\n\t\tSettingsPanel,\n\t\tAddPanel,\n\t\tBackgroundsPanel,\n\t\tCreditsPanel,\n\t\tCharacterPanel,\n\t\tTextBoxPanel,\n\t\tChoicePanel,\n\t\tSpritePanel,\n\t\tContentPacksPanel,\n\t\tPanelsPanel,\n\t\tNotificationPanel,\n\t\tPoemPanel,\n\t},\n\tdata: () => ({\n\t\tpanelSelection: 'add' as PanelNames,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t\tselection(): string | null {\n\t\t\treturn this.$store.state.ui.selection;\n\t\t},\n\t\tpanel(): PanelNames | ObjectTypes {\n\t\t\tif (this.panelSelection === 'selection') {\n\t\t\t\tif (this.selection === null) {\n\t\t\t\t\t// eslint-disable-next-line vue/no-side-effects-in-computed-properties\n\t\t\t\t\tthis.panelSelection = 'add';\n\t\t\t\t} else {\n\t\t\t\t\tconst obj = this.$store.state.objects.objects[this.selection];\n\t\t\t\t\treturn obj.type;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this.panelSelection;\n\t\t},\n\t\thasPrevRender(): boolean {\n\t\t\treturn this.$store.state.ui.lastDownload !== null;\n\t\t},\n\t},\n\tmethods: {\n\t\tcreate() {\n\t\t\tenvironment.onPanelChange((panel: string) => {\n\t\t\t\tthis.panelSelection = panel as PanelNames;\n\t\t\t});\n\t\t},\n\t\tsetPanel(name: PanelNames) {\n\t\t\tif (name === this.panelSelection) name = 'add';\n\t\t\tthis.panelSelection = name;\n\t\t\tif (this.selection) {\n\t\t\t\tif (this.$store.state.ui.selection === null) return;\n\t\t\t\tthis.$store.commit('ui/setSelection', null);\n\t\t\t}\n\t\t},\n\t},\n\twatch: {\n\t\tselection(newSelection: IObject | null) {\n\t\t\tif (newSelection) {\n\t\t\t\tthis.panelSelection = 'selection';\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.panelSelection === 'selection') {\n\t\t\t\tthis.panelSelection = 'add';\n\t\t\t}\n\t\t},\n\t},\n});\n","import { render } from \"./toolbox.vue?vue&type=template&id=111e9686\"\nimport script from \"./toolbox.vue?vue&type=script&lang=ts\"\nexport * from \"./toolbox.vue?vue&type=script&lang=ts\"\n\nimport \"./toolbox.vue?vue&type=style&index=0&id=111e9686&lang=scss\"\nscript.render = render\n\nexport default script","<template>\n\t<div id=\"messageConsole\" :class=\"{ vertical }\">\n\t\t<p v-if=\"showLoading\">Loading...</p>\n\t\t<p v-for=\"(message, i) in messages\" :key=\"message + '_' + i\">\n\t\t\t{{ message }}\n\t\t</p>\n\t\t<p v-for=\"(error, i) in errors\" class=\"error\" :key=\"error + '_' + i\">\n\t\t\t{{ error }} <a href=\"#\" @click=\"dismissError(i)\">[Dismiss]</a>\n\t\t</p>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nimport EventBus, {\n\tAssetFailureEvent,\n\tCustomAssetFailureEvent,\n\tFailureEvent,\n\tShowMessageEvent,\n\tVueErrorEvent,\n} from '@/eventbus/event-bus';\nimport { defineComponent } from 'vue';\n\nconst shortHidingTime = 5000;\nconst longHidingTime = 20000;\nconst hideShowTimeouts = 100;\n\nexport default defineComponent({\n\tprops: {\n\t\tloading: {\n\t\t\tdefault: false,\n\t\t\ttype: Boolean,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tmessages: [] as string[],\n\t\terrors: [] as string[],\n\t\tshowLoading: false,\n\t\tshowLoadingTimeout: 0,\n\t\thideLoadingTimeout: 0,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\tcreated() {\n\t\tthis.onLoadingChange(this.loading);\n\t\tEventBus.subscribe(AssetFailureEvent, ev => {\n\t\t\tthis.messages.push(`Failed to load asset '${ev.path}'`);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t}, shortHidingTime);\n\t\t});\n\n\t\tEventBus.subscribe(CustomAssetFailureEvent, ev => {\n\t\t\tthis.messages.push(\n\t\t\t\t'Failed to load custom asset. Try to download it manually and then upload it.'\n\t\t\t);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t}, longHidingTime);\n\t\t});\n\n\t\tEventBus.subscribe(FailureEvent, ev => {\n\t\t\tthis.errors.push(ev.message);\n\t\t});\n\n\t\tEventBus.subscribe(ShowMessageEvent, ev => {\n\t\t\tthis.messages.push(ev.message);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t}, longHidingTime);\n\t\t});\n\n\t\tEventBus.subscribe(VueErrorEvent, ev => {\n\t\t\tthis.messages.push(ev.error.name);\n\t\t\tthis.messages.push(JSON.stringify(ev.error.stack));\n\t\t\tthis.messages.push(ev.info);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t\tthis.messages.shift();\n\t\t\t\tthis.messages.shift();\n\t\t\t}, longHidingTime);\n\t\t});\n\t},\n\n\tmethods: {\n\t\tonLoadingChange(newValue: boolean) {\n\t\t\tif (newValue) {\n\t\t\t\tif (this.hideLoadingTimeout) {\n\t\t\t\t\tclearTimeout(this.hideLoadingTimeout);\n\t\t\t\t\tthis.hideLoadingTimeout = 0;\n\t\t\t\t}\n\t\t\t\tif (!this.showLoading && !this.showLoadingTimeout) {\n\t\t\t\t\tthis.showLoadingTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.showLoading = true;\n\t\t\t\t\t\tthis.showLoadingTimeout = 0;\n\t\t\t\t\t}, hideShowTimeouts);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this.showLoadingTimeout) {\n\t\t\t\t\tclearTimeout(this.showLoadingTimeout);\n\t\t\t\t\tthis.showLoadingTimeout = 0;\n\t\t\t\t}\n\t\t\t\tif (this.showLoading && !this.hideLoadingTimeout) {\n\t\t\t\t\tthis.hideLoadingTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.showLoading = false;\n\t\t\t\t\t\tthis.hideLoadingTimeout = 0;\n\t\t\t\t\t}, hideShowTimeouts);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tdismissError(i: number) {\n\t\t\tthis.errors.splice(i, 1);\n\t\t},\n\t},\n\n\twatch: {\n\t\tloading(newValue: boolean) {\n\t\t\tthis.onLoadingChange(newValue);\n\t\t},\n\t},\n});\n</script>\n\n<style lang=\"scss\" scoped>\n#messageConsole {\n\tfont-family: monospace;\n\ttext-shadow: 0px 0px 4px #ffffff;\n\tposition: absolute;\n\n\t&.vertical {\n\t\tright: 200px;\n\t\ttop: 0;\n\t}\n\n\t&:not(.vertical) {\n\t\tbottom: 200px;\n\t\tleft: 0;\n\t}\n\n\t.error {\n\t\tcolor: #660000;\n\t\tfont-weight: bolder;\n\n\t\ta {\n\t\t\tuser-select: none;\n\t\t}\n\t}\n}\n</style>\n","\nimport EventBus, {\n\tAssetFailureEvent,\n\tCustomAssetFailureEvent,\n\tFailureEvent,\n\tShowMessageEvent,\n\tVueErrorEvent,\n} from '@/eventbus/event-bus';\nimport { defineComponent } from 'vue';\n\nconst shortHidingTime = 5000;\nconst longHidingTime = 20000;\nconst hideShowTimeouts = 100;\n\nexport default defineComponent({\n\tprops: {\n\t\tloading: {\n\t\t\tdefault: false,\n\t\t\ttype: Boolean,\n\t\t},\n\t},\n\tdata: () => ({\n\t\tmessages: [] as string[],\n\t\terrors: [] as string[],\n\t\tshowLoading: false,\n\t\tshowLoadingTimeout: 0,\n\t\thideLoadingTimeout: 0,\n\t}),\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\tcreated() {\n\t\tthis.onLoadingChange(this.loading);\n\t\tEventBus.subscribe(AssetFailureEvent, ev => {\n\t\t\tthis.messages.push(`Failed to load asset '${ev.path}'`);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t}, shortHidingTime);\n\t\t});\n\n\t\tEventBus.subscribe(CustomAssetFailureEvent, ev => {\n\t\t\tthis.messages.push(\n\t\t\t\t'Failed to load custom asset. Try to download it manually and then upload it.'\n\t\t\t);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t}, longHidingTime);\n\t\t});\n\n\t\tEventBus.subscribe(FailureEvent, ev => {\n\t\t\tthis.errors.push(ev.message);\n\t\t});\n\n\t\tEventBus.subscribe(ShowMessageEvent, ev => {\n\t\t\tthis.messages.push(ev.message);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t}, longHidingTime);\n\t\t});\n\n\t\tEventBus.subscribe(VueErrorEvent, ev => {\n\t\t\tthis.messages.push(ev.error.name);\n\t\t\tthis.messages.push(JSON.stringify(ev.error.stack));\n\t\t\tthis.messages.push(ev.info);\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.messages.shift();\n\t\t\t\tthis.messages.shift();\n\t\t\t\tthis.messages.shift();\n\t\t\t}, longHidingTime);\n\t\t});\n\t},\n\n\tmethods: {\n\t\tonLoadingChange(newValue: boolean) {\n\t\t\tif (newValue) {\n\t\t\t\tif (this.hideLoadingTimeout) {\n\t\t\t\t\tclearTimeout(this.hideLoadingTimeout);\n\t\t\t\t\tthis.hideLoadingTimeout = 0;\n\t\t\t\t}\n\t\t\t\tif (!this.showLoading && !this.showLoadingTimeout) {\n\t\t\t\t\tthis.showLoadingTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.showLoading = true;\n\t\t\t\t\t\tthis.showLoadingTimeout = 0;\n\t\t\t\t\t}, hideShowTimeouts);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this.showLoadingTimeout) {\n\t\t\t\t\tclearTimeout(this.showLoadingTimeout);\n\t\t\t\t\tthis.showLoadingTimeout = 0;\n\t\t\t\t}\n\t\t\t\tif (this.showLoading && !this.hideLoadingTimeout) {\n\t\t\t\t\tthis.hideLoadingTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.showLoading = false;\n\t\t\t\t\t\tthis.hideLoadingTimeout = 0;\n\t\t\t\t\t}, hideShowTimeouts);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tdismissError(i: number) {\n\t\t\tthis.errors.splice(i, 1);\n\t\t},\n\t},\n\n\twatch: {\n\t\tloading(newValue: boolean) {\n\t\t\tthis.onLoadingChange(newValue);\n\t\t},\n\t},\n});\n","import { render } from \"./message-console.vue?vue&type=template&id=7f9dc964&scoped=true\"\nimport script from \"./message-console.vue?vue&type=script&lang=ts\"\nexport * from \"./message-console.vue?vue&type=script&lang=ts\"\n\nimport \"./message-console.vue?vue&type=style&index=0&id=7f9dc964&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-7f9dc964\"\n\nexport default script","<template>\n\t<canvas\n\t\tid=\"scaled_display\"\n\t\tref=\"sd\"\n\t\t:height=\"bitmapHeight\"\n\t\t:width=\"bitmapWidth\"\n\t\t:style=\"{ width: canvasWidth + 'px', height: canvasHeight + 'px', cursor }\"\n\t\tdraggable=\"true\"\n\t\t@click=\"onUiClick\"\n\t\t@touchstart=\"onTouchStart\"\n\t\t@dragstart=\"onDragStart\"\n\t\t@touchmove=\"onSpriteDragMove\"\n\t\t@mousemove=\"onSpriteDragMove\"\n\t\t@touchend=\"onSpriteDrop\"\n\t\t@mouseup=\"onSpriteDrop\"\n\t\t@dragover=\"onDragOver\"\n\t\t@drop=\"onDrop\"\n\t\t@mouseenter=\"onMouseEnter\"\n\t\t>HTML5 is required to use the Doki Doki Dialog Generator.</canvas\n\t>\n</template>\n\n<script lang=\"ts\">\nimport { MutationPayload } from 'vuex';\nimport { RenderContext } from '@/renderer/rendererContext';\nimport { registerAsset } from '@/asset-manager';\nimport eventBus, {\n\tColorPickedEvent,\n\tInvalidateRenderEvent,\n} from '@/eventbus/event-bus';\nimport { IObject, ISetObjectPositionMutation } from '@/store/objects';\nimport { ICreateSpriteAction } from '@/store/objectTypes/sprite';\nimport { SceneRenderer } from '../renderables/scene-renderer';\nimport { DeepReadonly } from '../util/readonly';\nimport { defineComponent } from 'vue';\nimport getConstants from '@/constants';\n\nexport default defineComponent({\n\tprops: {\n\t\tcanvasWidth: { default: 0 },\n\t\tcanvasHeight: { default: 0 },\n\t\tpreLoading: { type: Boolean },\n\t},\n\tdata: () => ({\n\t\tsdCtx: null! as CanvasRenderingContext2D,\n\t\tcurrentlyRendering: false,\n\t\tqueuedRender: null as null | number,\n\t\tshowingLast: false,\n\t\tdropSpriteCount: 0,\n\t\tdropPreventClick: false,\n\n\t\tdraggedObject: null as DeepReadonly<IObject> | null,\n\t\tdragXOffset: 0,\n\t\tdragYOffset: 0,\n\t\tdragXOriginal: 0,\n\t\tdragYOriginal: 0,\n\t}),\n\tcomputed: {\n\t\tselection(): string | null {\n\t\t\treturn this.$store.state.ui.selection;\n\t\t},\n\t\tlqRendering(): boolean {\n\t\t\treturn this.$store.state.ui.lqRendering;\n\t\t},\n\t\tsceneRender(): SceneRenderer {\n\t\t\treturn new SceneRenderer(\n\t\t\t\tthis.$store,\n\t\t\t\tthis.$store.state.panels.currentPanel,\n\t\t\t\tthis.bitmapWidth,\n\t\t\t\tthis.bitmapHeight\n\t\t\t);\n\t\t},\n\t\tbitmapHeight(): number {\n\t\t\tthis.preLoading;\n\t\t\treturn getConstants().Base.screenHeight;\n\t\t},\n\t\tbitmapWidth(): number {\n\t\t\tthis.preLoading;\n\t\t\treturn getConstants().Base.screenWidth;\n\t\t},\n\t\tpickerMode(): boolean {\n\t\t\treturn this.$store.state.ui.pickColor;\n\t\t},\n\t\tcursor(): 'default' | 'crosshair' {\n\t\t\treturn this.pickerMode ? 'crosshair' : 'default';\n\t\t},\n\t},\n\tmethods: {\n\t\tasync download(): Promise<void> {\n\t\t\tconst url = await this.sceneRender.download();\n\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tconst oldUrl = this.$store.state.ui.lastDownload;\n\n\t\t\t\tthis.$store.commit('ui/setLastDownload', url);\n\t\t\t\tif (oldUrl) {\n\t\t\t\t\tURL.revokeObjectURL(oldUrl);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tinvalidateRender() {\n\t\t\tif (this.queuedRender) return;\n\t\t\tthis.queuedRender = requestAnimationFrame(() => this.render_());\n\t\t},\n\t\tasync render_(): Promise<void> {\n\t\t\tif (this.queuedRender) {\n\t\t\t\tcancelAnimationFrame(this.queuedRender);\n\t\t\t\tthis.queuedRender = null;\n\t\t\t}\n\n\t\t\tif (this.$store.state.unsafe) return;\n\n\t\t\tawait this.sceneRender.render(!this.lqRendering, true);\n\t\t\tthis.display();\n\t\t},\n\t\trenderLoadingScreen() {\n\t\t\tif (!this.sdCtx) return;\n\t\t\tconst loadingScreen = document.createElement('canvas');\n\t\t\tloadingScreen.height = this.bitmapHeight;\n\t\t\tloadingScreen.width = this.bitmapWidth;\n\t\t\tconst rctx = RenderContext.make(loadingScreen, true, false);\n\t\t\trctx.drawText({\n\t\t\t\ttext: 'Starting...',\n\t\t\t\tx: loadingScreen.width / 2,\n\t\t\t\ty: loadingScreen.height / 2,\n\t\t\t\talign: 'center',\n\t\t\t\toutline: {\n\t\t\t\t\twidth: 5,\n\t\t\t\t\tstyle: '#b59',\n\t\t\t\t},\n\t\t\t\tfont: '32px riffic',\n\t\t\t\tfill: {\n\t\t\t\t\tstyle: 'white',\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.sdCtx!.drawImage(loadingScreen, this.canvasWidth, this.canvasHeight);\n\t\t},\n\t\tdisplay(): void {\n\t\t\tif (!this.sdCtx) return;\n\t\t\tthis.showingLast = false;\n\t\t\tthis.sceneRender.paintOnto(this.sdCtx, {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\tw: this.bitmapWidth,\n\t\t\t\th: this.bitmapHeight,\n\t\t\t});\n\t\t},\n\t\ttoRendererCoordinate(x: number, y: number): [number, number] {\n\t\t\tconst sd = this.$refs.sd as HTMLCanvasElement;\n\t\t\tconst rx = x - sd.offsetLeft;\n\t\t\tconst ry = y - sd.offsetTop;\n\t\t\tconst sx = (rx / sd.offsetWidth) * sd.width;\n\t\t\tconst sy = (ry / sd.offsetWidth) * sd.width;\n\t\t\treturn [sx, sy];\n\t\t},\n\t\tonUiClick(e: MouseEvent): void {\n\t\t\tconst [sx, sy] = this.toRendererCoordinate(e.clientX, e.clientY);\n\n\t\t\tif (this.pickerMode) {\n\t\t\t\tconst data = this.sdCtx.getImageData(sx, sy, 1, 1).data;\n\t\t\t\tconst hex = `rgba(${data[0].toString()},${data[1].toString()},${data[2].toString()},${(\n\t\t\t\t\tdata[3] / 255\n\t\t\t\t).toString()})`;\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('ui/setColorPicker', false);\n\t\t\t\t\teventBus.fire(new ColorPickedEvent(hex));\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.dropPreventClick) {\n\t\t\t\tthis.dropPreventClick = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst objects = this.sceneRender.objectsAt(sx, sy);\n\n\t\t\tconst currentObjectIdx = objects.findIndex(id => id === this.selection);\n\t\t\tlet selectedObject: string | null;\n\n\t\t\tif (currentObjectIdx === 0) {\n\t\t\t\tselectedObject = null;\n\t\t\t} else if (currentObjectIdx !== -1) {\n\t\t\t\t// Select the next lower character\n\t\t\t\tselectedObject = objects[currentObjectIdx - 1];\n\t\t\t} else {\n\t\t\t\tselectedObject = objects[objects.length - 1] || null;\n\t\t\t}\n\n\t\t\tif (this.$store.state.ui.selection === selectedObject) return;\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.commit('ui/setSelection', selectedObject);\n\t\t\t});\n\t\t},\n\t\tonDragStart(e: DragEvent) {\n\t\t\te.preventDefault();\n\t\t\tif (!this.selection) return;\n\t\t\tthis.draggedObject = this.$store.state.objects.objects[this.selection];\n\t\t\tconst [x, y] = this.toRendererCoordinate(e.clientX, e.clientY);\n\t\t\tthis.dragXOffset = x - this.draggedObject.x;\n\t\t\tthis.dragYOffset = y - this.draggedObject.y;\n\t\t\tthis.dragXOriginal = this.draggedObject.x;\n\t\t\tthis.dragYOriginal = this.draggedObject.y;\n\t\t},\n\t\tonTouchStart(e: TouchEvent) {\n\t\t\tif (!this.selection) return;\n\t\t\tthis.draggedObject = this.$store.state.objects.objects[this.selection];\n\t\t\tconst [x, y] = this.toRendererCoordinate(\n\t\t\t\te.touches[0].clientX,\n\t\t\t\te.touches[0].clientY\n\t\t\t);\n\t\t\tthis.dragXOffset = x - this.draggedObject.x;\n\t\t\tthis.dragYOffset = y - this.draggedObject.y;\n\t\t\tthis.dragXOriginal = this.draggedObject.x;\n\t\t\tthis.dragYOriginal = this.draggedObject.y;\n\t\t},\n\t\tonDragOver(e: DragEvent) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\te.dataTransfer!.dropEffect = 'copy';\n\t\t},\n\t\tonSpriteDragMove(e: MouseEvent | TouchEvent) {\n\t\t\tif (this.draggedObject) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\t// Formatter quirk\n\t\t\t\t// tslint:disable:indent\n\t\t\t\tlet [x, y] =\n\t\t\t\t\te instanceof MouseEvent\n\t\t\t\t\t\t? this.toRendererCoordinate(e.clientX, e.clientY)\n\t\t\t\t\t\t: this.toRendererCoordinate(\n\t\t\t\t\t\t\t\te.touches[0].clientX,\n\t\t\t\t\t\t\t\te.touches[0].clientY\n\t\t\t\t\t\t  );\n\t\t\t\t// tslint:enable:indent\n\t\t\t\tx -= this.dragXOffset;\n\t\t\t\ty -= this.dragYOffset;\n\n\t\t\t\tconst deltaX = Math.abs(x - this.dragXOriginal);\n\t\t\t\tconst deltaY = Math.abs(y - this.dragYOriginal);\n\n\t\t\t\tif (deltaX + deltaY > 1) this.dropPreventClick = true;\n\n\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\tif (deltaX > deltaY) {\n\t\t\t\t\t\ty = this.dragYOriginal;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tx = this.dragXOriginal;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setPosition', {\n\t\t\t\t\t\tid: this.draggedObject!.id,\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty,\n\t\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tasync onDrop(e: DragEvent) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif (!e.dataTransfer) return;\n\n\t\t\tfor (const item of e.dataTransfer.items) {\n\t\t\t\tif (item.kind === 'file' && item.type.match(/image.*/)) {\n\t\t\t\t\tconst name = 'dropCustomAsset' + ++this.dropSpriteCount;\n\t\t\t\t\tconst url = registerAsset(name, item.getAsFile()!);\n\n\t\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\t\tawait this.$store.dispatch('objects/createSprite', {\n\t\t\t\t\t\t\tassets: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\thq: url,\n\t\t\t\t\t\t\t\t\tlq: url,\n\t\t\t\t\t\t\t\t\tsourcePack: 'dddg.generated.uploaded-sprites',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t} as ICreateSpriteAction);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonSpriteDrop(e: MouseEvent | TouchEvent) {\n\t\t\tif (this.draggedObject) {\n\t\t\t\tif ('TouchEvent' in window && e instanceof TouchEvent) {\n\t\t\t\t\tthis.dropPreventClick = false;\n\t\t\t\t}\n\t\t\t\tthis.draggedObject = null;\n\t\t\t}\n\t\t},\n\t\tonMouseEnter(e: MouseEvent) {\n\t\t\tif (e.buttons !== 1) {\n\t\t\t\tthis.draggedObject = null;\n\t\t\t}\n\t\t},\n\t},\n\twatch: {\n\t\tcanvasWidth() {\n\t\t\tthis.display();\n\t\t},\n\t\tcanvasHeight() {\n\t\t\tthis.display();\n\t\t},\n\t},\n\tasync created(): Promise<void> {\n\t\teventBus.subscribe(InvalidateRenderEvent, () => this.invalidateRender());\n\t\tthis.$store.subscribe((mut: MutationPayload) => {\n\t\t\tif (mut.type === 'panels/setPanelPreview') return;\n\t\t\tif (mut.type === 'panels/currentPanel') return;\n\t\t\tthis.invalidateRender();\n\t\t});\n\t},\n\tmounted(): void {\n\t\tconst sd = this.$refs.sd as HTMLCanvasElement;\n\t\tthis.sdCtx = sd.getContext('2d')!;\n\n\t\tthis.renderLoadingScreen();\n\t\tthis.invalidateRender();\n\t},\n});\n</script>\n\n<style lang=\"scss\"></style>\n","\nimport { MutationPayload } from 'vuex';\nimport { RenderContext } from '@/renderer/rendererContext';\nimport { registerAsset } from '@/asset-manager';\nimport eventBus, {\n\tColorPickedEvent,\n\tInvalidateRenderEvent,\n} from '@/eventbus/event-bus';\nimport { IObject, ISetObjectPositionMutation } from '@/store/objects';\nimport { ICreateSpriteAction } from '@/store/objectTypes/sprite';\nimport { SceneRenderer } from '../renderables/scene-renderer';\nimport { DeepReadonly } from '../util/readonly';\nimport { defineComponent } from 'vue';\nimport getConstants from '@/constants';\n\nexport default defineComponent({\n\tprops: {\n\t\tcanvasWidth: { default: 0 },\n\t\tcanvasHeight: { default: 0 },\n\t\tpreLoading: { type: Boolean },\n\t},\n\tdata: () => ({\n\t\tsdCtx: null! as CanvasRenderingContext2D,\n\t\tcurrentlyRendering: false,\n\t\tqueuedRender: null as null | number,\n\t\tshowingLast: false,\n\t\tdropSpriteCount: 0,\n\t\tdropPreventClick: false,\n\n\t\tdraggedObject: null as DeepReadonly<IObject> | null,\n\t\tdragXOffset: 0,\n\t\tdragYOffset: 0,\n\t\tdragXOriginal: 0,\n\t\tdragYOriginal: 0,\n\t}),\n\tcomputed: {\n\t\tselection(): string | null {\n\t\t\treturn this.$store.state.ui.selection;\n\t\t},\n\t\tlqRendering(): boolean {\n\t\t\treturn this.$store.state.ui.lqRendering;\n\t\t},\n\t\tsceneRender(): SceneRenderer {\n\t\t\treturn new SceneRenderer(\n\t\t\t\tthis.$store,\n\t\t\t\tthis.$store.state.panels.currentPanel,\n\t\t\t\tthis.bitmapWidth,\n\t\t\t\tthis.bitmapHeight\n\t\t\t);\n\t\t},\n\t\tbitmapHeight(): number {\n\t\t\tthis.preLoading;\n\t\t\treturn getConstants().Base.screenHeight;\n\t\t},\n\t\tbitmapWidth(): number {\n\t\t\tthis.preLoading;\n\t\t\treturn getConstants().Base.screenWidth;\n\t\t},\n\t\tpickerMode(): boolean {\n\t\t\treturn this.$store.state.ui.pickColor;\n\t\t},\n\t\tcursor(): 'default' | 'crosshair' {\n\t\t\treturn this.pickerMode ? 'crosshair' : 'default';\n\t\t},\n\t},\n\tmethods: {\n\t\tasync download(): Promise<void> {\n\t\t\tconst url = await this.sceneRender.download();\n\n\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\tconst oldUrl = this.$store.state.ui.lastDownload;\n\n\t\t\t\tthis.$store.commit('ui/setLastDownload', url);\n\t\t\t\tif (oldUrl) {\n\t\t\t\t\tURL.revokeObjectURL(oldUrl);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tinvalidateRender() {\n\t\t\tif (this.queuedRender) return;\n\t\t\tthis.queuedRender = requestAnimationFrame(() => this.render_());\n\t\t},\n\t\tasync render_(): Promise<void> {\n\t\t\tif (this.queuedRender) {\n\t\t\t\tcancelAnimationFrame(this.queuedRender);\n\t\t\t\tthis.queuedRender = null;\n\t\t\t}\n\n\t\t\tif (this.$store.state.unsafe) return;\n\n\t\t\tawait this.sceneRender.render(!this.lqRendering, true);\n\t\t\tthis.display();\n\t\t},\n\t\trenderLoadingScreen() {\n\t\t\tif (!this.sdCtx) return;\n\t\t\tconst loadingScreen = document.createElement('canvas');\n\t\t\tloadingScreen.height = this.bitmapHeight;\n\t\t\tloadingScreen.width = this.bitmapWidth;\n\t\t\tconst rctx = RenderContext.make(loadingScreen, true, false);\n\t\t\trctx.drawText({\n\t\t\t\ttext: 'Starting...',\n\t\t\t\tx: loadingScreen.width / 2,\n\t\t\t\ty: loadingScreen.height / 2,\n\t\t\t\talign: 'center',\n\t\t\t\toutline: {\n\t\t\t\t\twidth: 5,\n\t\t\t\t\tstyle: '#b59',\n\t\t\t\t},\n\t\t\t\tfont: '32px riffic',\n\t\t\t\tfill: {\n\t\t\t\t\tstyle: 'white',\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.sdCtx!.drawImage(loadingScreen, this.canvasWidth, this.canvasHeight);\n\t\t},\n\t\tdisplay(): void {\n\t\t\tif (!this.sdCtx) return;\n\t\t\tthis.showingLast = false;\n\t\t\tthis.sceneRender.paintOnto(this.sdCtx, {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\tw: this.bitmapWidth,\n\t\t\t\th: this.bitmapHeight,\n\t\t\t});\n\t\t},\n\t\ttoRendererCoordinate(x: number, y: number): [number, number] {\n\t\t\tconst sd = this.$refs.sd as HTMLCanvasElement;\n\t\t\tconst rx = x - sd.offsetLeft;\n\t\t\tconst ry = y - sd.offsetTop;\n\t\t\tconst sx = (rx / sd.offsetWidth) * sd.width;\n\t\t\tconst sy = (ry / sd.offsetWidth) * sd.width;\n\t\t\treturn [sx, sy];\n\t\t},\n\t\tonUiClick(e: MouseEvent): void {\n\t\t\tconst [sx, sy] = this.toRendererCoordinate(e.clientX, e.clientY);\n\n\t\t\tif (this.pickerMode) {\n\t\t\t\tconst data = this.sdCtx.getImageData(sx, sy, 1, 1).data;\n\t\t\t\tconst hex = `rgba(${data[0].toString()},${data[1].toString()},${data[2].toString()},${(\n\t\t\t\t\tdata[3] / 255\n\t\t\t\t).toString()})`;\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.commit('ui/setColorPicker', false);\n\t\t\t\t\teventBus.fire(new ColorPickedEvent(hex));\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.dropPreventClick) {\n\t\t\t\tthis.dropPreventClick = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst objects = this.sceneRender.objectsAt(sx, sy);\n\n\t\t\tconst currentObjectIdx = objects.findIndex(id => id === this.selection);\n\t\t\tlet selectedObject: string | null;\n\n\t\t\tif (currentObjectIdx === 0) {\n\t\t\t\tselectedObject = null;\n\t\t\t} else if (currentObjectIdx !== -1) {\n\t\t\t\t// Select the next lower character\n\t\t\t\tselectedObject = objects[currentObjectIdx - 1];\n\t\t\t} else {\n\t\t\t\tselectedObject = objects[objects.length - 1] || null;\n\t\t\t}\n\n\t\t\tif (this.$store.state.ui.selection === selectedObject) return;\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tthis.$store.commit('ui/setSelection', selectedObject);\n\t\t\t});\n\t\t},\n\t\tonDragStart(e: DragEvent) {\n\t\t\te.preventDefault();\n\t\t\tif (!this.selection) return;\n\t\t\tthis.draggedObject = this.$store.state.objects.objects[this.selection];\n\t\t\tconst [x, y] = this.toRendererCoordinate(e.clientX, e.clientY);\n\t\t\tthis.dragXOffset = x - this.draggedObject.x;\n\t\t\tthis.dragYOffset = y - this.draggedObject.y;\n\t\t\tthis.dragXOriginal = this.draggedObject.x;\n\t\t\tthis.dragYOriginal = this.draggedObject.y;\n\t\t},\n\t\tonTouchStart(e: TouchEvent) {\n\t\t\tif (!this.selection) return;\n\t\t\tthis.draggedObject = this.$store.state.objects.objects[this.selection];\n\t\t\tconst [x, y] = this.toRendererCoordinate(\n\t\t\t\te.touches[0].clientX,\n\t\t\t\te.touches[0].clientY\n\t\t\t);\n\t\t\tthis.dragXOffset = x - this.draggedObject.x;\n\t\t\tthis.dragYOffset = y - this.draggedObject.y;\n\t\t\tthis.dragXOriginal = this.draggedObject.x;\n\t\t\tthis.dragYOriginal = this.draggedObject.y;\n\t\t},\n\t\tonDragOver(e: DragEvent) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\te.dataTransfer!.dropEffect = 'copy';\n\t\t},\n\t\tonSpriteDragMove(e: MouseEvent | TouchEvent) {\n\t\t\tif (this.draggedObject) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\t// Formatter quirk\n\t\t\t\t// tslint:disable:indent\n\t\t\t\tlet [x, y] =\n\t\t\t\t\te instanceof MouseEvent\n\t\t\t\t\t\t? this.toRendererCoordinate(e.clientX, e.clientY)\n\t\t\t\t\t\t: this.toRendererCoordinate(\n\t\t\t\t\t\t\t\te.touches[0].clientX,\n\t\t\t\t\t\t\t\te.touches[0].clientY\n\t\t\t\t\t\t  );\n\t\t\t\t// tslint:enable:indent\n\t\t\t\tx -= this.dragXOffset;\n\t\t\t\ty -= this.dragYOffset;\n\n\t\t\t\tconst deltaX = Math.abs(x - this.dragXOriginal);\n\t\t\t\tconst deltaY = Math.abs(y - this.dragYOriginal);\n\n\t\t\t\tif (deltaX + deltaY > 1) this.dropPreventClick = true;\n\n\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\tif (deltaX > deltaY) {\n\t\t\t\t\t\ty = this.dragYOriginal;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tx = this.dragXOriginal;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tthis.$store.dispatch('objects/setPosition', {\n\t\t\t\t\t\tid: this.draggedObject!.id,\n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty,\n\t\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tasync onDrop(e: DragEvent) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif (!e.dataTransfer) return;\n\n\t\t\tfor (const item of e.dataTransfer.items) {\n\t\t\t\tif (item.kind === 'file' && item.type.match(/image.*/)) {\n\t\t\t\t\tconst name = 'dropCustomAsset' + ++this.dropSpriteCount;\n\t\t\t\t\tconst url = registerAsset(name, item.getAsFile()!);\n\n\t\t\t\t\tthis.vuexHistory.transaction(async () => {\n\t\t\t\t\t\tawait this.$store.dispatch('objects/createSprite', {\n\t\t\t\t\t\t\tassets: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\thq: url,\n\t\t\t\t\t\t\t\t\tlq: url,\n\t\t\t\t\t\t\t\t\tsourcePack: 'dddg.generated.uploaded-sprites',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t} as ICreateSpriteAction);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonSpriteDrop(e: MouseEvent | TouchEvent) {\n\t\t\tif (this.draggedObject) {\n\t\t\t\tif ('TouchEvent' in window && e instanceof TouchEvent) {\n\t\t\t\t\tthis.dropPreventClick = false;\n\t\t\t\t}\n\t\t\t\tthis.draggedObject = null;\n\t\t\t}\n\t\t},\n\t\tonMouseEnter(e: MouseEvent) {\n\t\t\tif (e.buttons !== 1) {\n\t\t\t\tthis.draggedObject = null;\n\t\t\t}\n\t\t},\n\t},\n\twatch: {\n\t\tcanvasWidth() {\n\t\t\tthis.display();\n\t\t},\n\t\tcanvasHeight() {\n\t\t\tthis.display();\n\t\t},\n\t},\n\tasync created(): Promise<void> {\n\t\teventBus.subscribe(InvalidateRenderEvent, () => this.invalidateRender());\n\t\tthis.$store.subscribe((mut: MutationPayload) => {\n\t\t\tif (mut.type === 'panels/setPanelPreview') return;\n\t\t\tif (mut.type === 'panels/currentPanel') return;\n\t\t\tthis.invalidateRender();\n\t\t});\n\t},\n\tmounted(): void {\n\t\tconst sd = this.$refs.sd as HTMLCanvasElement;\n\t\tthis.sdCtx = sd.getContext('2d')!;\n\n\t\tthis.renderLoadingScreen();\n\t\tthis.invalidateRender();\n\t},\n});\n","import { render } from \"./render.vue?vue&type=template&id=2f9b4852\"\nimport script from \"./render.vue?vue&type=script&lang=ts\"\nexport * from \"./render.vue?vue&type=script&lang=ts\"\nscript.render = render\n\nexport default script","\n// App.vue has currently so many responsiblities that it's best to break it into chunks\nimport { ICreateTextBoxAction } from '@/store/objectTypes/textbox';\nimport {\n\tISetObjectPositionMutation,\n\tIRemoveObjectAction,\n\tICopyObjectToClipboardAction,\n\tIPasteFromClipboardAction,\n} from '@/store/objects';\nimport {\n\tIShiftCharacterSlotAction,\n\tICharacter,\n} from '@/store/objectTypes/characters';\nimport ToolBox from '@/components/toolbox/toolbox.vue';\nimport MessageConsole from '@/components/message-console.vue';\nimport Render from '@/components/render.vue';\nimport ModalDialog from '@/components/ModalDialog.vue';\nimport { ISetCurrentMutation } from '@/store/panels';\nimport { defineAsyncComponent, defineComponent } from 'vue';\nimport { Repo } from './models/repo';\nimport enviroment from '@/environments/environment';\nimport { IRemovePacksAction } from './store';\n\n// tslint:disable-next-line: no-magic-numbers\nconst aspectRatio = 16 / 9;\nconst arrowMoveStepSize = 20;\nconst packDialogWaitMs = 50;\nconst canvasTooSmallThreshold = 200;\n\nconst nsfwPacks = {\n\t'dddg.buildin.backgrounds.nsfw': `${process.env.BASE_URL}packs/buildin.base.backgrounds.nsfw.json`,\n\t'dddg.buildin.sayori.nsfw': `${process.env.BASE_URL}packs/buildin.base.sayori.nsfw.json`,\n\t'dddg.buildin.base.natsuki.nsfw': `${process.env.BASE_URL}packs/buildin.base.natsuki.nsfw.json`,\n\t'dddg.buildin.yuri.nsfw': `${process.env.BASE_URL}packs/buildin.base.yuri.nsfw.json`,\n};\n\nconst names = new Set(Object.keys(nsfwPacks));\nconst paths = Object.values(nsfwPacks);\n\nexport default defineComponent({\n\tcomponents: {\n\t\tToolBox,\n\t\tMessageConsole,\n\t\tRender,\n\t\tModalDialog,\n\t\tSingleBox: defineAsyncComponent(() =>\n\t\t\timport('@/components/repo/layouts/SingleBox.vue')\n\t\t),\n\t\tExpressionBuilder: defineAsyncComponent(() =>\n\t\t\timport('@/components/content-pack-builder/expression-builder/index.vue')\n\t\t),\n\t},\n\tdata: () => ({\n\t\tcanvasWidth: 0,\n\t\tcanvasHeight: 0,\n\t\tblendOver: null as string | null,\n\t\tuiSize: 192,\n\t\tcurrentlyRendering: false,\n\t\tpanel: '',\n\t\tdialogVisable: false,\n\t\tcanvasTooSmall: false,\n\t\texpressionBuilderVisible: false,\n\t\texpressionBuilderCharacter: '',\n\t\texpressionBuilderHeadGroup: undefined as string | undefined,\n\t\tsystemPrefersDarkMode: false,\n\t\tpreLoading: true,\n\t}),\n\tcomputed: {\n\t\tisSafari(): boolean {\n\t\t\treturn false;\n\t\t\t/*\t\treturn !!(\n\t\t\tnavigator.vendor &&\n\t\t\tnavigator.vendor.indexOf('Apple') > -1 &&\n\t\t\tnavigator.userAgent &&\n\t\t\tnavigator.userAgent.indexOf('CriOS') === -1 &&\n\t\t\tnavigator.userAgent.indexOf('FxiOS') === -1\n\t\t);*/\n\t\t},\n\t\tuseDarkTheme(): boolean {\n\t\t\treturn this.userPrefersDarkMode ?? this.systemPrefersDarkMode;\n\t\t},\n\t\tuserPrefersDarkMode(): boolean | null {\n\t\t\treturn this.$store.state.ui.useDarkTheme;\n\t\t},\n\t\tnsfw(): boolean {\n\t\t\treturn this.$store.state.ui.nsfw;\n\t\t},\n\t},\n\tmethods: {\n\t\tdrawLastDownload(): void {\n\t\t\tconst last = this.$store.state.ui.lastDownload;\n\t\t\tif (!last) return;\n\t\t\t(this.$refs.render as typeof Render).blendOver(last);\n\t\t},\n\t\tsetBlendOver(): void {\n\t\t\tthis.blendOver = this.$store.state.ui.lastDownload;\n\t\t},\n\t\toptimum(sw: number, sh: number): [number, number] {\n\t\t\tlet rh = sw / aspectRatio;\n\t\t\tlet rw = sh * aspectRatio;\n\n\t\t\tif (rh > sh) {\n\t\t\t\trh = sh;\n\t\t\t} else {\n\t\t\t\trw = sw;\n\t\t\t}\n\n\t\t\treturn [rw, rh];\n\t\t},\n\t\toptimizeWithMenu(sw: number, sh: number): [number, number, boolean] {\n\t\t\tconst opth = this.optimum(sw, sh - this.uiSize);\n\t\t\tconst optv = this.optimum(sw - this.uiSize, sh);\n\n\t\t\tif (!this.isSafari && opth[0] * opth[1] > optv[0] * optv[1]) {\n\t\t\t\treturn [opth[0], opth[1], false];\n\t\t\t} else {\n\t\t\t\treturn [optv[0], optv[1], true];\n\t\t\t}\n\t\t},\n\t\tupdateArea(): void {\n\t\t\tconst [cw, ch, v] = this.optimizeWithMenu(\n\t\t\t\tdocument.documentElement.clientWidth,\n\t\t\t\tdocument.documentElement.clientHeight\n\t\t\t);\n\n\t\t\tthis.canvasWidth = cw;\n\t\t\tthis.canvasHeight = ch;\n\n\t\t\tthis.canvasTooSmall = Math.max(cw, ch) < canvasTooSmallThreshold;\n\n\t\t\tif (this.$store.state.ui.vertical === v) return;\n\t\t\tthis.$store.commit('ui/setVertical', v);\n\t\t},\n\t\tshowDialog(search: string | undefined) {\n\t\t\tthis.dialogVisable = true;\n\t\t\tif (search) {\n\t\t\t\tconst wait = () => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.$refs.packDialog &&\n\t\t\t\t\t\t(this.$refs.packDialog as any).$refs.packDialog\n\t\t\t\t\t) {\n\t\t\t\t\t\t// This strange doubling is to get around the async component wrapper\n\t\t\t\t\t\t(this.$refs.packDialog as any).$refs.packDialog.setSearch(search);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetTimeout(wait, packDialogWaitMs);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tthis.$nextTick(wait);\n\t\t\t}\n\t\t},\n\t\tshowExpressionDialog(e: IShowExpressionDialogEvent) {\n\t\t\tthis.expressionBuilderVisible = true;\n\t\t\tthis.expressionBuilderCharacter = e.character;\n\t\t\tthis.expressionBuilderHeadGroup = e.headGroup;\n\t\t},\n\t\tonKeydown(e: KeyboardEvent) {\n\t\t\tif (\n\t\t\t\te.target instanceof HTMLInputElement ||\n\t\t\t\te.target instanceof HTMLTextAreaElement\n\t\t\t) {\n\t\t\t\tconsole.log('skip keydown on potential target');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\tconst selection = this.$store.state.objects.objects[\n\t\t\t\t\tthis.$store.state.ui.selection!\n\t\t\t\t];\n\t\t\t\tif (e.ctrlKey) {\n\t\t\t\t\tif (e.key === 'z') {\n\t\t\t\t\t\t// this.$store.commit('history/undo');\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (e.key === 'y') {\n\t\t\t\t\t\t// this.$store.commit('history/redo');\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (e.key === 'v') {\n\t\t\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t\t\t'objects/pasteObjectFromClipboard',\n\t\t\t\t\t\t\t{} as IPasteFromClipboardAction\n\t\t\t\t\t\t);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!selection) return;\n\t\t\t\tif (e.key === 'Delete') {\n\t\t\t\t\tthis.$store.dispatch('objects/removeObject', {\n\t\t\t\t\t\tid: selection.id,\n\t\t\t\t\t} as IRemoveObjectAction);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e.key === 'c' || e.key === 'x') {\n\t\t\t\t\tthis.$store.dispatch('objects/copyObjectToClipboard', {\n\t\t\t\t\t\tid: selection.id,\n\t\t\t\t\t} as ICopyObjectToClipboardAction);\n\t\t\t\t\tif (e.key === 'x') {\n\t\t\t\t\t\tthis.$store.dispatch('objects/removeObject', {\n\t\t\t\t\t\t\tid: selection.id,\n\t\t\t\t\t\t} as IRemoveObjectAction);\n\t\t\t\t\t}\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (selection.type === 'character') {\n\t\t\t\t\tconst character = selection as ICharacter;\n\t\t\t\t\tif (!character.freeMove) {\n\t\t\t\t\t\tif (e.key === 'ArrowLeft') {\n\t\t\t\t\t\t\tthis.$store.dispatch('objects/shiftCharacterSlot', {\n\t\t\t\t\t\t\t\tid: character.id,\n\t\t\t\t\t\t\t\tdelta: -1,\n\t\t\t\t\t\t\t} as IShiftCharacterSlotAction);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (e.key === 'ArrowRight') {\n\t\t\t\t\t\t\tthis.$store.dispatch('objects/shiftCharacterSlot', {\n\t\t\t\t\t\t\t\tid: character.id,\n\t\t\t\t\t\t\t\tdelta: 1,\n\t\t\t\t\t\t\t} as IShiftCharacterSlotAction);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet { x, y } = selection;\n\t\t\t\tif (e.key === 'ArrowLeft') {\n\t\t\t\t\tx -= e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else if (selection && e.key === 'ArrowRight') {\n\t\t\t\t\tx += e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else if (selection && e.key === 'ArrowUp') {\n\t\t\t\t\ty -= e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else if (selection && e.key === 'ArrowDown') {\n\t\t\t\t\ty += e.shiftKey ? 1 : arrowMoveStepSize;\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.$store.dispatch('objects/setPosition', {\n\t\t\t\t\tid: selection.id,\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t} as ISetObjectPositionMutation);\n\t\t\t\treturn;\n\t\t\t});\n\t\t},\n\t\tdestroyed(): void {\n\t\t\twindow.removeEventListener('keydown', this.onKeydown);\n\t\t},\n\t\tapplyTheme(): void {\n\t\t\tdocument.body.classList.toggle('dark-theme', this.useDarkTheme);\n\t\t},\n\t},\n\twatch: {\n\t\tsystemPrefersDarkMode() {\n\t\t\tthis.applyTheme();\n\t\t},\n\t\tuserPrefersDarkMode() {\n\t\t\tthis.applyTheme();\n\t\t},\n\t\tasync nsfw(value: boolean) {\n\t\t\tif (value) {\n\t\t\t\tawait this.$store.dispatch('content/loadContentPacks', paths);\n\t\t\t} else {\n\t\t\t\tawait this.$store.dispatch('removePacks', {\n\t\t\t\t\tpacks: names,\n\t\t\t\t} as IRemovePacksAction);\n\t\t\t}\n\t\t},\n\t},\n\tmounted(): void {\n\t\twindow.addEventListener('keypress', e => {\n\t\t\tif (e.key === 'Escape') {\n\t\t\t\tthis.vuexHistory.transaction(() => {\n\t\t\t\t\tif (this.$store.state.ui.selection === null) return;\n\t\t\t\t\tthis.$store.commit('ui/setSelection', null);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tif (window.matchMedia) {\n\t\t\t/* The viewport is less than, or equal to, 700 pixels wide */\n\t\t\tconst matcher = window.matchMedia('(prefers-color-scheme: dark)');\n\t\t\tthis.systemPrefersDarkMode = matcher.matches;\n\t\t\tmatcher.addListener(match => {\n\t\t\t\tthis.systemPrefersDarkMode = match.matches;\n\t\t\t});\n\t\t}\n\t},\n\tasync created(): Promise<void> {\n\t\t// Moving this to the \"mounted\"-handler crashes safari over version 12.\n\t\t// My best guess is because it runs in a microtask, which have been added in that Version.\n\t\tthis.updateArea();\n\t\tRepo.setStore(this.$store);\n\t\twindow.addEventListener('resize', this.updateArea);\n\t\twindow.removeEventListener('keydown', this.onKeydown);\n\t\twindow.addEventListener('keydown', this.onKeydown);\n\n\t\t(window as any).app = this;\n\t\t(window as any).store = this.$store;\n\t\t(window as any).env = enviroment;\n\n\t\tdocument.body.addEventListener(\n\t\t\t'drop',\n\t\t\t(event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\t\tdocument.body.addEventListener(\n\t\t\t'dragover',\n\t\t\t(event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\tawait enviroment.loadGameMode();\n\t\tthis.preLoading = false;\n\t\tenviroment.connectToStore(this.vuexHistory, this.$store);\n\t\tconst settings = await enviroment.loadSettings();\n\n\t\tthis.vuexHistory.transaction(async () => {\n\t\t\tthis.$store.commit('ui/setLqRendering', settings.lq ?? false);\n\t\t\tthis.$store.commit('ui/setDarkTheme', settings.darkMode ?? null);\n\t\t\tthis.$store.commit(\n\t\t\t\t'ui/setDefaultCharacterTalkingZoom',\n\t\t\t\tsettings.defaultCharacterTalkingZoom ?? true\n\t\t\t);\n\n\t\t\tawait this.$store.dispatch('content/loadContentPacks', [\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.backgrounds.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.monika.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.sayori.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.natsuki.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.base.yuri.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.mc.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.mc_chad.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.mc_classic.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.femc.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.classic_amy.json`,\n\t\t\t\t`${process.env.BASE_URL}packs/buildin.extra.amy.json`,\n\t\t\t]);\n\n\t\t\tawait this.$store.dispatch('panels/createPanel');\n\t\t\tif (Object.keys(this.$store.state.objects.objects).length === 0) {\n\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t'objects/createTextBox',\n\t\t\t\t\t{} as ICreateTextBoxAction\n\t\t\t\t);\n\t\t\t}\n\t\t\tawait this.$store.commit('panels/setCurrentBackground', {\n\t\t\t\tcurrent: 'dddg.buildin.backgrounds:ddlc.clubroom',\n\t\t\t\tpanelId: this.$store.state.panels.currentPanel,\n\t\t\t} as ISetCurrentMutation);\n\n\t\t\tawait this.$store.commit('ui/setNsfw', settings.nsfw ?? false);\n\t\t});\n\t},\n});\n\nexport interface IShowExpressionDialogEvent {\n\tcharacter: string;\n\theadGroup?: string;\n}\n","import { render } from \"./App.vue?vue&type=template&id=7ed1cde7\"\nimport script from \"./App.vue?vue&type=script&lang=ts\"\nexport * from \"./App.vue?vue&type=script&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=7ed1cde7&lang=scss\"\nscript.render = render\n\nexport default script","import { ICommand } from '@/eventbus/command';\nimport { getAAsset } from '@/asset-manager';\nimport { IObjectsState, ICreateObjectMutation, IObject } from '@/store/objects';\nimport { MutationTree, ActionTree } from 'vuex';\nimport { IRootState } from '..';\nimport { IAsset } from '../content';\nimport { baseProps } from './baseObjectProps';\n\nexport interface ISprite extends IObject {\n\ttype: 'sprite';\n\tassets: IAsset[];\n}\n\nexport const spriteMutations: MutationTree<IObjectsState> = {};\n\nlet lastSpriteId = 0;\n\nexport const spriteActions: ActionTree<IObjectsState, IRootState> = {\n\tasync createSprite({ commit, rootState }, command: ICreateSpriteAction) {\n\t\tconst asset = await getAAsset(command.assets[0], false);\n\t\tif (!(asset instanceof HTMLImageElement)) return;\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\t...baseProps(),\n\t\t\t\tassets: command.assets,\n\t\t\t\theight: asset.height,\n\t\t\t\twidth: asset.width,\n\t\t\t\tid: 'sprite_' + ++lastSpriteId,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tonTop: false,\n\t\t\t\tpreserveRatio: true,\n\t\t\t\tratio: asset.width / asset.height,\n\t\t\t\ttype: 'sprite',\n\t\t\t\ty: 0,\n\t\t\t\tenlargeWhenTalking: rootState.ui.defaultCharacterTalkingZoom,\n\t\t\t} as ISprite,\n\t\t} as ICreateObjectMutation);\n\t},\n};\n\nexport interface ICreateSpriteAction extends ICommand {\n\treadonly assets: IAsset[];\n}\n","import { ICommand } from '@/eventbus/command';\nimport { IObjectsState, ICreateObjectMutation, IObject } from '@/store/objects';\nimport { MutationTree, ActionTree } from 'vuex';\nimport { IRootState } from '..';\nimport { ISetAutoWrappingMutation } from './textbox';\nimport { baseProps } from './baseObjectProps';\nimport getConstants from '@/constants';\n\nexport interface IChoice {\n\ttext: string;\n\tselected: boolean;\n}\n\nexport interface IChoices extends IObject {\n\ttype: 'choice';\n\tcustomColor: string;\n\tchoices: IChoice[];\n\tchoiceDistance: number;\n\tautoWrap: boolean;\n}\n\nexport const choiceMutations: MutationTree<IObjectsState> = {\n\tsetChoices(state, command: ISetChoicesMutation) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tobj.choices = command.choices;\n\t\t++obj.version;\n\t},\n\tsetChoiceColor(state, command: ISetChoiceColorMutation) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tobj.customColor = command.customColor;\n\t\t++obj.version;\n\t},\n\tsetChoiceDistance(state, command: ISetChoiceDistanceMutation) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tobj.choiceDistance = command.choiceDistance;\n\t\t++obj.version;\n\t},\n\tsetAutoWrapping(state, command: ISetAutoWrappingMutation) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tobj.autoWrap = command.autoWrap;\n\t\t++obj.version;\n\t},\n};\n\nlet lastChoiceId = 0;\n\nexport const choiceActions: ActionTree<IObjectsState, IRootState> = {\n\tcreateChoice({ commit, rootState }, command: ICreateChoicesAction): string {\n\t\tconst constants = getConstants();\n\t\tconst id = 'choice_' + ++lastChoiceId;\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\t...baseProps(),\n\t\t\t\ty: constants.Choices.ChoiceY,\n\t\t\t\twidth: constants.Choices.ChoiceButtonWidth,\n\t\t\t\theight: 0,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tid,\n\t\t\t\tonTop: true,\n\t\t\t\tautoWrap: true,\n\t\t\t\ttype: 'choice',\n\t\t\t\tpreserveRatio: false,\n\t\t\t\tratio: constants.TextBox.TextBoxWidth / constants.TextBox.TextBoxHeight,\n\t\t\t\tchoiceDistance: constants.Choices.ChoiceSpacing,\n\t\t\t\tchoices: [\n\t\t\t\t\t{\n\t\t\t\t\t\tselected: false,\n\t\t\t\t\t\ttext: 'Click here to edit choice',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tcustomColor: constants.Choices.ChoiceButtonColor,\n\t\t\t} as IChoices,\n\t\t} as ICreateObjectMutation);\n\t\treturn id;\n\t},\n\n\taddChoice({ state, commit }, command: IAddChoiceAction) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tcommit('setChoices', {\n\t\t\tid: command.id,\n\t\t\tchoices: [\n\t\t\t\t...obj.choices,\n\t\t\t\t{\n\t\t\t\t\tselected: false,\n\t\t\t\t\ttext: command.text,\n\t\t\t\t},\n\t\t\t],\n\t\t} as ISetChoicesMutation);\n\t},\n\n\tremoveChoice({ state, commit }, command: IRemoveChoiceAction) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tconst choices = [...obj.choices];\n\t\tif (!choices[command.choiceIdx]) return;\n\t\tchoices.splice(command.choiceIdx, 1);\n\t\t// Do not allow empty choices\n\t\tif (choices.length === 0) {\n\t\t\tchoices.push({\n\t\t\t\tselected: false,\n\t\t\t\ttext: '',\n\t\t\t});\n\t\t}\n\t\tcommit('setChoices', {\n\t\t\tid: command.id,\n\t\t\tchoices,\n\t\t} as ISetChoicesMutation);\n\t},\n\n\tsetChoiceText({ state, commit }, command: ISetChoiceTextAction) {\n\t\tconst obj = state.objects[command.id] as IChoices;\n\t\tconst choices = [...obj.choices];\n\t\tif (!choices[command.choiceIdx]) return;\n\t\tchoices[command.choiceIdx].text = command.text;\n\t\tcommit('setChoices', {\n\t\t\tid: command.id,\n\t\t\tchoices,\n\t\t} as ISetChoicesMutation);\n\t},\n};\n\nexport interface ISetChoicesMutation extends ICommand {\n\treadonly choices: IChoices['choices'];\n}\n\nexport interface ISetChoiceColorMutation extends ICommand {\n\treadonly customColor: IChoices['customColor'];\n}\n\nexport interface ISetChoiceDistanceMutation extends ICommand {\n\treadonly choiceDistance: IChoices['choiceDistance'];\n}\n\nexport interface ICreateChoicesAction extends ICommand {}\n\nexport interface IAddChoiceAction extends ICommand {\n\treadonly text: string;\n}\n\nexport interface ISetChoiceTextAction extends ICommand {\n\treadonly choiceIdx: number;\n\treadonly text: string;\n}\n\nexport interface IRemoveChoiceAction extends ICommand {\n\treadonly choiceIdx: number;\n}\n","export function between(min: number, val: number, max: number) {\n\tif (min > val) return min;\n\tif (val > max) return max;\n\treturn val;\n}\n","import { ICommand } from '@/eventbus/command';\nimport {\n\tIObjectsState,\n\tICreateObjectMutation,\n\tIObject,\n\tISetObjectPositionMutation,\n\tISetObjectFlipMutation,\n\tISetSpriteRotationMutation,\n} from '@/store/objects';\nimport { MutationTree, ActionTree } from 'vuex';\nimport { ISetSpriteSizeMutation } from './characters';\nimport { IRootState } from '..';\nimport { baseProps } from './baseObjectProps';\nimport { rotateAround } from '@/util/rotation';\nimport getConstants from '@/constants';\nimport { rendererLookup } from '@/renderables/textbox';\nimport { between } from '@/util/math';\n\nexport interface ITextBox extends IObject {\n\ttype: 'textBox';\n\ttext: string;\n\ttalkingObjId: null | '$other$' | string;\n\ttalkingOther: string;\n\tstyle:\n\t\t| 'normal'\n\t\t| 'normal_plus'\n\t\t| 'corrupt'\n\t\t| 'corrupt_plus'\n\t\t| 'custom'\n\t\t| 'custom_plus'\n\t\t| 'none';\n\toverrideColor: boolean;\n\tcustomColor: string;\n\tderiveCustomColors: boolean;\n\tcustomControlsColor: string;\n\tcustomNameboxColor: string;\n\tcustomNameboxStroke: string;\n\tcustomNameboxWidth: number | null;\n\tcontrols: boolean;\n\tskip: boolean;\n\tautoQuoting: boolean;\n\tautoWrap: boolean;\n\tcontinue: boolean;\n\tresetBounds: {\n\t\tx: number;\n\t\ty: number;\n\t\twidth: number;\n\t\theight: number;\n\t\trotation: number;\n\t};\n}\n\nconst splitTextboxSpacing = 4;\n\nexport const textBoxMutations: MutationTree<IObjectsState> = {\n\tsetText(state, command: ISetTextBoxTextMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.text = command.text;\n\t\t++obj.version;\n\t},\n\tsetTalkingObject(state, command: ISetTextBoxTalkingObjMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.talkingObjId = command.talkingObjId;\n\t\t++obj.version;\n\t},\n\tsetTalkingOther(state, command: ISetTextBoxTalkingOtherMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.talkingOther = command.talkingOther;\n\t\tobj.talkingObjId = '$other$';\n\t\t++obj.version;\n\t},\n\tsetStyle(state, command: ISetTextBoxStyleMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.style = command.style;\n\t\t++obj.version;\n\t},\n\tsetControlsVisible(state, command: ISetTextBoxControlsVisibleMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.controls = command.controls;\n\t\t++obj.version;\n\t},\n\tsetControlsColor(state, command: ISetTextBoxCustomControlsColorMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.customControlsColor = command.customControlsColor;\n\t\t++obj.version;\n\t},\n\tsetDeriveCustomColors(state, command: ISetTextBoxDeriveCustomColorMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.deriveCustomColors = command.deriveCustomColors;\n\t\t++obj.version;\n\t},\n\tsetNameboxColor(state, command: ISetTextBoxNameboxColorMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.customNameboxColor = command.customNameboxColor;\n\t\t++obj.version;\n\t},\n\tsetNameboxStroke(state, command: ISetTextBoxNameboxStrokeMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.customNameboxStroke = command.customNameboxStroke;\n\t\t++obj.version;\n\t},\n\tsetNameboxWidth(state, command: ISetTextBoxNameboxWidthMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.customNameboxWidth = command.customNameboxWidth;\n\t\t++obj.version;\n\t},\n\tsetSkipable(state, command: ISetTextBoxControlsSkipMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.skip = command.skip;\n\t\t++obj.version;\n\t},\n\tsetContinueArrow(state, command: ISetTextBoxControlsContinueMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.continue = command.continue;\n\t\t++obj.version;\n\t},\n\tsetCustomColor(state, command: ISetTextBoxCustomColorMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.customColor = command.color;\n\t\t++obj.version;\n\t},\n\tsetAutoQuoting(state, command: ISetTextBoxAutoQuotingMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.autoQuoting = command.autoQuoting;\n\t\t++obj.version;\n\t},\n\tsetAutoWrapping(state, command: ISetAutoWrappingMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.autoWrap = command.autoWrap;\n\t\t++obj.version;\n\t},\n\tsetResetBounds(state, command: ISetResetBoundsMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.resetBounds = command.resetBounds;\n\t\tobj.x = command.resetBounds.x;\n\t\tobj.y = command.resetBounds.y;\n\t\tobj.height = command.resetBounds.height;\n\t\tobj.width = command.resetBounds.width;\n\t\tobj.rotation = command.resetBounds.rotation;\n\t\t++obj.version;\n\t},\n\tsetColorOverride(state, command: ISetColorOverrideMutation) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tobj.overrideColor = command.overrideColor;\n\t\t++obj.version;\n\t},\n};\n\nlet lastTextBoxId = 0;\n\nexport const textBoxActions: ActionTree<IObjectsState, IRootState> = {\n\tcreateTextBox({ commit, rootState }, command: ICreateTextBoxAction): string {\n\t\tconst constants = getConstants();\n\t\tconst id = 'textBox_' + ++lastTextBoxId;\n\t\tconst style = constants.TextBox.DefaultTextboxStyle;\n\t\tconst renderer = rendererLookup[style];\n\n\t\tconst resetBounds = command.resetBounds || {\n\t\t\tx: renderer.defaultX,\n\t\t\ty: renderer.defaultY,\n\t\t\twidth: renderer.defaultWidth,\n\t\t\theight: renderer.defaultHeight,\n\t\t\trotation: 0,\n\t\t};\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\t...baseProps(),\n\t\t\t\t...resetBounds,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tid,\n\t\t\t\tonTop: true,\n\t\t\t\ttype: 'textBox',\n\t\t\t\tpreserveRatio: false,\n\t\t\t\tratio: constants.TextBox.TextBoxWidth / constants.TextBox.TextBoxHeight,\n\t\t\t\tcontinue: true,\n\t\t\t\tcontrols: true,\n\t\t\t\tskip: true,\n\t\t\t\tautoQuoting: true,\n\t\t\t\tautoWrap: true,\n\t\t\t\tstyle,\n\t\t\t\toverrideColor: false,\n\t\t\t\tcustomColor: constants.TextBoxCustom.textboxDefaultColor,\n\t\t\t\tderiveCustomColors: true,\n\t\t\t\tcustomControlsColor: constants.TextBoxCustom.controlsDefaultColor,\n\t\t\t\tcustomNameboxColor: constants.TextBoxCustom.nameboxDefaultColor,\n\t\t\t\tcustomNameboxWidth: null,\n\t\t\t\tcustomNameboxStroke: constants.TextBoxCustom.nameboxStrokeDefaultColor,\n\t\t\t\ttalkingObjId: null,\n\t\t\t\ttalkingOther: '',\n\t\t\t\ttext: '',\n\t\t\t\tresetBounds,\n\t\t\t} as ITextBox,\n\t\t} as ICreateObjectMutation);\n\t\treturn id;\n\t},\n\n\tsetStyle({ state, commit }, command: ISetTextBoxStyleAction) {\n\t\tconst constants = getConstants();\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tconst oldRenderer = rendererLookup[obj.style];\n\t\tconst newRenderer = rendererLookup[command.style];\n\n\t\tconst safetyMargin = 10;\n\n\t\tlet updatePos = false;\n\t\tconst posUpdate = {\n\t\t\tid: command.id,\n\t\t\tx: obj.x,\n\t\t\ty: obj.y,\n\t\t};\n\t\tlet updateSize = false;\n\t\tconst sizeUpdate = {\n\t\t\tid: command.id,\n\t\t\twidth: obj.width,\n\t\t\theight: obj.height,\n\t\t};\n\n\t\tif (!newRenderer.resizable) {\n\t\t\tupdateSize = true;\n\t\t\tsizeUpdate.width = newRenderer.defaultWidth;\n\t\t\tsizeUpdate.height = newRenderer.defaultHeight;\n\t\t} else {\n\t\t\tif (oldRenderer.defaultWidth !== newRenderer.defaultWidth) {\n\t\t\t\tupdateSize = true;\n\t\t\t\tsizeUpdate.width = Math.max(\n\t\t\t\t\tsizeUpdate.width +\n\t\t\t\t\t\tnewRenderer.defaultWidth -\n\t\t\t\t\t\toldRenderer.defaultWidth,\n\t\t\t\t\tsafetyMargin\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (oldRenderer.defaultHeight !== newRenderer.defaultHeight) {\n\t\t\t\tupdateSize = true;\n\t\t\t\tsizeUpdate.height = Math.max(\n\t\t\t\t\tsizeUpdate.height +\n\t\t\t\t\t\tnewRenderer.defaultHeight -\n\t\t\t\t\t\toldRenderer.defaultHeight,\n\t\t\t\t\tsafetyMargin\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\tif (oldRenderer.defaultX !== newRenderer.defaultX) {\n\t\t\tupdatePos = true;\n\t\t\tposUpdate.x = between(\n\t\t\t\t-sizeUpdate.width + safetyMargin,\n\t\t\t\tposUpdate.x + newRenderer.defaultX - oldRenderer.defaultX,\n\t\t\t\tconstants.Base.screenWidth - safetyMargin\n\t\t\t);\n\t\t}\n\t\tif (oldRenderer.defaultY !== newRenderer.defaultY) {\n\t\t\tupdatePos = true;\n\t\t\tposUpdate.y = between(\n\t\t\t\t-sizeUpdate.height + safetyMargin,\n\t\t\t\tposUpdate.y + newRenderer.defaultY - oldRenderer.defaultY,\n\t\t\t\tconstants.Base.screenHeight - safetyMargin\n\t\t\t);\n\t\t}\n\n\t\tif (updatePos) {\n\t\t\tcommit('setPosition', posUpdate as ISetObjectPositionMutation);\n\t\t}\n\t\tif (updateSize) {\n\t\t\tcommit('setSize', sizeUpdate as ISetSpriteSizeMutation);\n\t\t}\n\n\t\tcommit('setStyle', {\n\t\t\tid: command.id,\n\t\t\tstyle: command.style,\n\t\t} as ISetTextBoxStyleMutation);\n\t},\n\n\tresetTextboxBounds({ commit, state }, command: IResetTextboxBounds) {\n\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\tcommit('setPosition', {\n\t\t\tid: command.id,\n\t\t\tx: obj.resetBounds.x,\n\t\t\ty: obj.resetBounds.y,\n\t\t} as ISetObjectPositionMutation);\n\t\tcommit('setSize', {\n\t\t\tid: command.id,\n\t\t\theight: obj.resetBounds.height,\n\t\t\twidth: obj.resetBounds.width,\n\t\t} as ISetSpriteSizeMutation);\n\t\tcommit('setRotation', {\n\t\t\tid: command.id,\n\t\t\trotation: obj.resetBounds.rotation,\n\t\t} as ISetSpriteRotationMutation);\n\t},\n\n\tasync splitTextbox({ commit, state, dispatch }, command: ISplitTextbox) {\n\t\tconst obj = state.objects[command.id];\n\t\tconst newWidth = (obj.width - splitTextboxSpacing) / 2;\n\t\tconst centerDistance = newWidth / 2 + splitTextboxSpacing / 2;\n\n\t\tconst baseCenter = [obj.x, obj.y];\n\t\tlet boxOneCoords = [obj.x - centerDistance, obj.y];\n\t\tlet boxTwoCoords = [obj.x + centerDistance, obj.y];\n\n\t\tif (obj.rotation !== 0) {\n\t\t\tboxOneCoords = rotateAround(\n\t\t\t\tboxOneCoords[0],\n\t\t\t\tboxOneCoords[1],\n\t\t\t\tbaseCenter[0],\n\t\t\t\tbaseCenter[1],\n\t\t\t\t(obj.rotation / 180) * Math.PI\n\t\t\t);\n\t\t\tboxTwoCoords = rotateAround(\n\t\t\t\tboxTwoCoords[0],\n\t\t\t\tboxTwoCoords[1],\n\t\t\t\tbaseCenter[0],\n\t\t\t\tbaseCenter[1],\n\t\t\t\t(obj.rotation / 180) * Math.PI\n\t\t\t);\n\t\t}\n\n\t\tcommit('setResetBounds', {\n\t\t\tid: command.id,\n\t\t\tresetBounds: {\n\t\t\t\tx: boxOneCoords[0],\n\t\t\t\ty: boxOneCoords[1],\n\t\t\t\twidth: newWidth,\n\t\t\t\theight: obj.height,\n\t\t\t\trotation: obj.rotation,\n\t\t\t},\n\t\t} as ISetResetBoundsMutation);\n\t\tcommit('setStyle', {\n\t\t\tid: command.id,\n\t\t\tstyle: 'custom',\n\t\t} as ISetTextBoxStyleMutation);\n\t\tconst id = (await dispatch('createTextBox', {\n\t\t\tresetBounds: {\n\t\t\t\tx: boxTwoCoords[0],\n\t\t\t\ty: boxTwoCoords[1],\n\t\t\t\twidth: newWidth,\n\t\t\t\theight: obj.height,\n\t\t\t\trotation: obj.rotation,\n\t\t\t},\n\t\t} as ICreateTextBoxAction)) as string;\n\t\tcommit('setStyle', {\n\t\t\tid,\n\t\t\tstyle: 'custom',\n\t\t} as ISetTextBoxStyleMutation);\n\t\tif (obj.flip) {\n\t\t\tcommit('setFlip', {\n\t\t\t\tid,\n\t\t\t\tflip: obj.flip,\n\t\t\t} as ISetObjectFlipMutation);\n\t\t}\n\t},\n};\n\nexport interface ISetTextBoxTextMutation extends ICommand {\n\treadonly text: string;\n}\n\nexport interface ISetTextBoxTalkingObjMutation extends ICommand {\n\treadonly talkingObjId: ITextBox['talkingObjId'];\n}\n\nexport interface ISetTextBoxTalkingOtherMutation extends ICommand {\n\treadonly talkingOther: string;\n}\n\nexport interface ISetTextBoxStyleMutation extends ICommand {\n\treadonly style: ITextBox['style'];\n}\n\nexport interface ISetTextBoxControlsVisibleMutation extends ICommand {\n\treadonly controls: boolean;\n}\n\nexport interface ISetTextBoxDeriveCustomColorMutation extends ICommand {\n\treadonly deriveCustomColors: boolean;\n}\n\nexport interface ISetTextBoxCustomControlsColorMutation extends ICommand {\n\treadonly customControlsColor: string;\n}\n\nexport interface ISetTextBoxNameboxColorMutation extends ICommand {\n\treadonly customNameboxColor: string;\n}\n\nexport interface ISetTextBoxNameboxStrokeMutation extends ICommand {\n\treadonly customNameboxStroke: string;\n}\n\nexport interface ISetTextBoxNameboxWidthMutation extends ICommand {\n\treadonly customNameboxWidth: number;\n}\n\nexport interface ISetTextBoxAutoQuotingMutation extends ICommand {\n\treadonly autoQuoting: boolean;\n}\n\nexport interface ISetAutoWrappingMutation extends ICommand {\n\treadonly autoWrap: boolean;\n}\n\nexport interface ISetResetBoundsMutation extends ICommand {\n\treadonly resetBounds: ITextBox['resetBounds'];\n}\n\nexport interface ISetColorOverrideMutation extends ICommand {\n\treadonly overrideColor: boolean;\n}\n\nexport interface ISetColorOverrideMutation extends ICommand {\n\treadonly overrideColor: boolean;\n}\n\nexport interface ISetTextBoxControlsSkipMutation extends ICommand {\n\treadonly skip: boolean;\n}\n\nexport interface ISetTextBoxControlsContinueMutation extends ICommand {\n\treadonly continue: boolean;\n}\n\nexport interface ISetTextBoxCustomColorMutation extends ICommand {\n\treadonly color: string;\n}\n\nexport interface ICreateTextBoxAction extends ICommand {\n\treadonly resetBounds?: ITextBox['resetBounds'];\n}\n\nexport interface ISetTextBoxStyleAction extends ICommand {\n\treadonly style: ITextBox['style'];\n}\n\nexport interface ISplitTextbox extends ICommand {}\n\nexport interface IResetTextboxBounds extends ICommand {}\n","import { ICommand } from '@/eventbus/command';\nimport { IObjectsState, ICreateObjectMutation, IObject } from '@/store/objects';\nimport { MutationTree, ActionTree } from 'vuex';\nimport { IRootState } from '..';\nimport { ISetAutoWrappingMutation } from './textbox';\nimport { baseProps } from './baseObjectProps';\nimport getConstants from '@/constants';\n\nexport interface INotification extends IObject {\n\ttype: 'notification';\n\tcustomColor: string;\n\ttext: string;\n\tbackdrop: boolean;\n\tautoWrap: boolean;\n}\n\nexport const notificationMutations: MutationTree<IObjectsState> = {\n\tsetNotificationColor(state, command: ISetChoiceColorMutation) {\n\t\tconst obj = state.objects[command.id] as INotification;\n\t\tobj.customColor = command.customColor;\n\t\t++obj.version;\n\t},\n\tsetNotificationText(state, { id, text }: ISetNotificationTextMutation) {\n\t\tconst obj = state.objects[id] as INotification;\n\t\tobj.text = text;\n\t\t++obj.version;\n\t},\n\tsetNotificationBackdrop(\n\t\tstate,\n\t\t{ id, backdrop }: ISetNotificationBackdropMutation\n\t) {\n\t\tconst obj = state.objects[id] as INotification;\n\t\tobj.backdrop = backdrop;\n\t\t++obj.version;\n\t},\n\tsetAutoWrapping(state, command: ISetAutoWrappingMutation) {\n\t\tconst obj = state.objects[command.id] as INotification;\n\t\tobj.autoWrap = command.autoWrap;\n\t\t++obj.version;\n\t},\n};\n\nlet lastNotificationId = 0;\n\nexport const notificationActions: ActionTree<IObjectsState, IRootState> = {\n\tcreateNotification(\n\t\t{ commit, rootState },\n\t\tcommand: ICreateNotificationAction\n\t): string {\n\t\tconst constants = getConstants();\n\t\tconst id = 'notification_' + ++lastNotificationId;\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\t...baseProps(),\n\t\t\t\ty: constants.Base.screenHeight / 2,\n\t\t\t\twidth: constants.Choices.ChoiceButtonWidth,\n\t\t\t\theight: 0,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tautoWrap: false,\n\t\t\t\tid,\n\t\t\t\tonTop: true,\n\t\t\t\ttype: 'notification',\n\t\t\t\tpreserveRatio: false,\n\t\t\t\tratio: constants.TextBox.TextBoxWidth / constants.TextBox.TextBoxHeight,\n\t\t\t\tcustomColor: constants.Choices.ChoiceButtonColor,\n\t\t\t\ttext: 'Click here to edit notification',\n\t\t\t\tbackdrop: true,\n\t\t\t} as INotification,\n\t\t} as ICreateObjectMutation);\n\t\treturn id;\n\t},\n};\n\nexport interface ISetNotificationTextMutation extends ICommand {\n\treadonly text: INotification['text'];\n}\n\nexport interface ISetNotificationBackdropMutation extends ICommand {\n\treadonly backdrop: INotification['backdrop'];\n}\n\nexport interface ISetChoiceColorMutation extends ICommand {\n\treadonly customColor: INotification['customColor'];\n}\n\nexport interface ICreateNotificationAction extends ICommand {}\n","import { ICommand } from '@/eventbus/command';\nimport { IObjectsState, ICreateObjectMutation, IObject } from '@/store/objects';\nimport { MutationTree, ActionTree } from 'vuex';\nimport { IRootState } from '..';\nimport { ISetAutoWrappingMutation } from './textbox';\nimport { baseProps } from './baseObjectProps';\nimport getConstants from '@/constants';\n\nexport interface IPoem extends IObject {\n\ttype: 'poem';\n\tsubType: 'poem' | 'console';\n\tbackground: number;\n\tfont: number;\n\ttext: string;\n\tautoWrap: boolean;\n}\n\nexport const poemMutations: MutationTree<IObjectsState> = {\n\tsetPoemBackground(state, { id, background }: ISetBackgroundMutation) {\n\t\tconst obj = state.objects[id] as IPoem;\n\t\tobj.background = background;\n\t\t++obj.version;\n\t},\n\tsetPoemFont(state, { id, font }: ISetFontMutation) {\n\t\tconst obj = state.objects[id] as IPoem;\n\t\tobj.font = font;\n\t\t++obj.version;\n\t},\n\tsetPoemText(state, { id, text }: ISetTextMutation) {\n\t\tconst obj = state.objects[id] as IPoem;\n\t\tobj.text = text;\n\t\t++obj.version;\n\t},\n\tsetAutoWrapping(state, command: ISetAutoWrappingMutation) {\n\t\tconst obj = state.objects[command.id] as IPoem;\n\t\tobj.autoWrap = command.autoWrap;\n\t\t++obj.version;\n\t},\n};\n\nlet lastPoemId = 0;\n\nexport const poemActions: ActionTree<IObjectsState, IRootState> = {\n\tcreatePoem({ commit, rootState }, _command: ICreatePoemAction): string {\n\t\tconst constants = getConstants();\n\t\tconst id = 'poem_' + ++lastPoemId;\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\tsubType: 'poem',\n\t\t\t\tx: constants.Poem.defaultX,\n\t\t\t\ty: constants.Poem.defaultY,\n\t\t\t\twidth: constants.Poem.defaultPoemWidth,\n\t\t\t\theight: constants.Poem.defaultPoemHeight,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tflip: false,\n\t\t\t\trotation: 0,\n\t\t\t\tid,\n\t\t\t\tonTop: true,\n\t\t\t\topacity: 100,\n\t\t\t\ttype: 'poem',\n\t\t\t\tversion: 0,\n\t\t\t\tpreserveRatio: false,\n\t\t\t\tautoWrap: true,\n\t\t\t\tratio:\n\t\t\t\t\tconstants.Poem.defaultPoemWidth / constants.Poem.defaultPoemHeight,\n\t\t\t\tbackground: constants.Poem.defaultPoemBackground,\n\t\t\t\tfont: constants.Poem.defaultPoemStyle,\n\t\t\t\ttext: 'New poem\\n\\nClick here to edit poem',\n\t\t\t\tcomposite: 'source-over',\n\t\t\t\tfilters: [],\n\t\t\t\tlabel: null,\n\t\t\t\ttextboxColor: null,\n\t\t\t\tenlargeWhenTalking: true,\n\t\t\t\tnameboxWidth: null,\n\t\t\t\tzoom: 1,\n\t\t\t} as IPoem,\n\t\t} as ICreateObjectMutation);\n\t\treturn id;\n\t},\n\tcreateConsole({ commit, rootState }, _command: ICreatePoemAction): string {\n\t\tconst constants = getConstants();\n\t\tconst id = 'poem_' + ++lastPoemId;\n\t\tcommit('create', {\n\t\t\tobject: {\n\t\t\t\t...baseProps(),\n\t\t\t\tsubType: 'console',\n\t\t\t\tx: constants.Poem.consoleWidth / 2,\n\t\t\t\ty: constants.Poem.consoleHeight / 2,\n\t\t\t\twidth: constants.Poem.consoleWidth,\n\t\t\t\theight: constants.Poem.consoleHeight,\n\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\tid,\n\t\t\t\tonTop: true,\n\t\t\t\ttype: 'poem',\n\t\t\t\tpreserveRatio: false,\n\t\t\t\tratio: constants.Poem.consoleWidth / constants.Poem.consoleHeight,\n\t\t\t\tbackground: constants.Poem.defaultConsoleBackground,\n\t\t\t\tfont: constants.Poem.defaultConsoleStyle,\n\t\t\t\ttext: '> _\\n  \\n  Console command\\n  Click here to edit',\n\t\t\t\tautoWrap: true,\n\t\t\t} as IPoem,\n\t\t} as ICreateObjectMutation);\n\t\treturn id;\n\t},\n};\n\nexport interface ISetBackgroundMutation extends ICommand {\n\treadonly background: IPoem['background'];\n}\n\nexport interface ISetFontMutation extends ICommand {\n\treadonly font: IPoem['font'];\n}\n\nexport interface ISetTextMutation extends ICommand {\n\treadonly text: IPoem['text'];\n}\n\nexport interface ICreatePoemAction extends ICommand {}\n","import { Module } from 'vuex';\nimport { ICommand } from '@/eventbus/command';\nimport { spriteMutations, spriteActions } from './objectTypes/sprite';\nimport {\n\tcharacterActions,\n\tcharacterMutations,\n\tfixContentPackRemovalFromCharacter,\n} from './objectTypes/characters';\nimport { choiceMutations, choiceActions } from './objectTypes/choices';\nimport {\n\tITextBox,\n\ttextBoxActions,\n\ttextBoxMutations,\n\tISetTextBoxTalkingOtherMutation,\n} from './objectTypes/textbox';\nimport {\n\tnotificationMutations,\n\tnotificationActions,\n} from './objectTypes/notification';\nimport { poemMutations, poemActions } from './objectTypes/poem';\nimport { IRootState } from '.';\nimport { ContentPack } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from './content';\nimport {\n\taddFilter,\n\tIAddFilterAction,\n\tIHasSpriteFilters,\n\tIMoveFilterAction,\n\tIRemoveFilterAction,\n\tISetFilterAction,\n\tISetFiltersMutation,\n\tISetCompositionMutation,\n\tmoveFilter,\n\tremoveFilter,\n\tsetFilter,\n} from './sprite_options';\n\nexport interface IPanel {\n\tid: string;\n\torder: string[];\n\tonTopOrder: string[];\n}\n\nexport interface IObjectsState {\n\tobjects: { [id: string]: IObject };\n\tpanels: { [id: string]: IPanel };\n}\n\nexport interface IObject extends IHasSpriteFilters {\n\ttype: ObjectTypes;\n\tpanelId: string;\n\tid: string;\n\tx: number;\n\ty: number;\n\twidth: number;\n\theight: number;\n\trotation: number;\n\tpreserveRatio: boolean;\n\tratio: number;\n\tversion: number;\n\tflip: boolean;\n\tonTop: boolean;\n\tlabel: null | string;\n\ttextboxColor: string | null;\n\tenlargeWhenTalking: boolean;\n\tnameboxWidth: null | number;\n\tzoom: number;\n}\n\nexport type ObjectTypes =\n\t| 'sprite'\n\t| 'character'\n\t| 'textBox'\n\t| 'choice'\n\t| 'notification'\n\t| 'poem';\n\nlet lastCopyId = 0;\n\nexport default {\n\tnamespaced: true,\n\tstate: {\n\t\tobjects: {},\n\t\tpanels: {},\n\t},\n\tmutations: {\n\t\tcreate(state, { object }: ICreateObjectMutation) {\n\t\t\tif (!state.panels[object.panelId]) {\n\t\t\t\tstate.panels[object.panelId] = {\n\t\t\t\t\tid: object.panelId,\n\t\t\t\t\tonTopOrder: [],\n\t\t\t\t\torder: [],\n\t\t\t\t};\n\t\t\t}\n\t\t\tconst panel = state.panels[object.panelId];\n\t\t\tconst collection = object.onTop ? panel.onTopOrder : panel.order;\n\t\t\tstate.objects[object.id] = object;\n\t\t\tcollection.push(object.id);\n\t\t},\n\t\tremoveFromList(state, command: IRemoveFromListMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst panel = state.panels[obj.panelId];\n\t\t\tconst collection = command.onTop ? panel.onTopOrder : panel.order;\n\t\t\tconst idx = collection.indexOf(command.id);\n\t\t\tcollection.splice(idx, 1);\n\t\t},\n\t\taddToList(state, command: IAddToListMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst panel = state.panels[obj.panelId];\n\t\t\tconst collection = command.onTop ? panel.onTopOrder : panel.order;\n\t\t\tcollection.splice(command.position, 0, command.id);\n\t\t},\n\t\tsetOnTop(state, command: ISetOnTopMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.onTop = command.onTop;\n\t\t},\n\t\tsetPosition(state, command: ISetObjectPositionMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.x = command.x;\n\t\t\tobj.y = command.y;\n\t\t},\n\t\tsetFlip(state, command: ISetObjectFlipMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.flip = command.flip;\n\t\t},\n\t\tsetSize(state, command: ISetSpriteSizeMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.width = command.width;\n\t\t\tobj.height = command.height;\n\t\t},\n\t\tsetRatio(state, command: ISetSpriteRatioMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.preserveRatio = command.preserveRatio;\n\t\t\tobj.ratio = command.ratio;\n\t\t},\n\t\tsetRotation(state, command: ISetSpriteRotationMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.rotation =\n\t\t\t\tcommand.rotation < 0\n\t\t\t\t\t? 360 - (Math.abs(command.rotation) % 360)\n\t\t\t\t\t: command.rotation % 360;\n\t\t},\n\t\tremoveObject(state, command: IRemoveObjectMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tdelete state.objects[command.id];\n\t\t\tconst panel = state.panels[obj.panelId];\n\t\t\tif (panel.onTopOrder.length === 0 && panel.order.length === 0) {\n\t\t\t\tdelete state.panels[obj.panelId];\n\t\t\t}\n\t\t},\n\t\tsetComposition(state, command: ISetCompositionMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.composite = command.composite;\n\t\t},\n\t\tsetFilters(state, command: ISetFiltersMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.filters = command.filters;\n\t\t},\n\t\tsetLabel(state, command: ISetLabelMutation) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.label = command.label;\n\t\t},\n\t\tsetTextboxColor(state, command: ISetTextBoxColor) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tobj.textboxColor = command.textboxColor;\n\t\t},\n\t\tsetEnlargeWhenTalking(state, command: ISetEnlargeWhenTalkingMutation) {\n\t\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\t\tobj.enlargeWhenTalking = command.enlargeWhenTalking;\n\t\t\t++obj.version;\n\t\t},\n\t\tsetObjectNameboxWidth(state, command: ISetNameboxWidthMutation) {\n\t\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\t\tobj.nameboxWidth = command.nameboxWidth;\n\t\t\t++obj.version;\n\t\t},\n\t\tsetObjectZoom(state, command: ISetObjectZoomMutation) {\n\t\t\tconst obj = state.objects[command.id] as ITextBox;\n\t\t\tobj.zoom = command.zoom;\n\t\t\t++obj.version;\n\t\t},\n\t\t...spriteMutations,\n\t\t...characterMutations,\n\t\t...textBoxMutations,\n\t\t...choiceMutations,\n\t\t...notificationMutations,\n\t\t...poemMutations,\n\t},\n\tactions: {\n\t\tremoveObject({ state, commit, rootState }, command: IRemoveObjectAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst panel = state.panels[obj.panelId];\n\t\t\tif (rootState.ui.selection === command.id) {\n\t\t\t\tcommit('ui/setSelection', null, { root: true });\n\t\t\t}\n\t\t\tfor (const key of [...panel.onTopOrder, ...panel.order]) {\n\t\t\t\tconst otherObject = state.objects[key] as ITextBox;\n\t\t\t\tif (obj.id === key || otherObject.type !== 'textBox') continue;\n\n\t\t\t\tif (otherObject.talkingObjId !== obj.id) continue;\n\n\t\t\t\tcommit('setTalkingOther', {\n\t\t\t\t\tid: otherObject.id,\n\t\t\t\t\ttalkingOther: obj.label || '',\n\t\t\t\t} as ISetTextBoxTalkingOtherMutation);\n\t\t\t}\n\t\t\tcommit('removeFromList', {\n\t\t\t\tid: command.id,\n\t\t\t\tonTop: obj.onTop,\n\t\t\t} as IRemoveFromListMutation);\n\t\t\tcommit('removeObject', {\n\t\t\t\tid: command.id,\n\t\t\t} as IRemoveObjectMutation);\n\t\t},\n\t\tsetPosition({ state, commit, dispatch }, command: ISetPositionAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tif (obj.type === 'character') {\n\t\t\t\tdispatch('setCharacterPosition', command as ISetPositionAction);\n\t\t\t} else {\n\t\t\t\tcommit('setPosition', command as ISetObjectPositionMutation);\n\t\t\t}\n\t\t},\n\t\tsetOnTop({ state, commit }, command: IObjectSetOnTopAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst panel = state.panels[obj.panelId];\n\t\t\tif (obj.onTop === command.onTop) return;\n\t\t\tcommit('removeFromList', {\n\t\t\t\tid: command.id,\n\t\t\t\tonTop: obj.onTop,\n\t\t\t} as IRemoveFromListMutation);\n\t\t\tcommit('addToList', {\n\t\t\t\tid: command.id,\n\t\t\t\tposition: (command.onTop ? panel.onTopOrder : panel.order).length,\n\t\t\t\tonTop: command.onTop,\n\t\t\t} as IRemoveFromListMutation);\n\t\t\tcommit('setOnTop', {\n\t\t\t\tid: command.id,\n\t\t\t\tonTop: command.onTop,\n\t\t\t} as ISetOnTopMutation);\n\t\t},\n\t\tshiftLayer({ state, commit }, command: IObjectShiftLayerAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst panel = state.panels[obj.panelId];\n\t\t\tconst collection = obj.onTop ? panel.onTopOrder : panel.order;\n\t\t\tconst position = collection.indexOf(obj.id);\n\n\t\t\tlet newPosition = position + command.delta;\n\t\t\tif (newPosition < 0) {\n\t\t\t\tnewPosition = 0;\n\t\t\t}\n\t\t\tif (newPosition > collection.length) {\n\t\t\t\tnewPosition = collection.length;\n\t\t\t}\n\t\t\tcommit('removeFromList', {\n\t\t\t\tid: command.id,\n\t\t\t\tonTop: obj.onTop,\n\t\t\t} as IRemoveFromListMutation);\n\t\t\tcommit('addToList', {\n\t\t\t\tid: command.id,\n\t\t\t\tposition: newPosition,\n\t\t\t\tonTop: obj.onTop,\n\t\t\t} as IAddToListMutation);\n\t\t},\n\t\tsetPreserveRatio({ commit, state }, command: ISetRatioAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst ratio = command.preserveRatio ? obj.width / obj.height : 0;\n\t\t\tcommit('setRatio', {\n\t\t\t\tid: command.id,\n\t\t\t\tpreserveRatio: command.preserveRatio,\n\t\t\t\tratio,\n\t\t\t} as ISetSpriteRatioMutation);\n\t\t},\n\t\tsetWidth({ commit, state }, command: ISetWidthAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst height = !obj.preserveRatio\n\t\t\t\t? obj.height\n\t\t\t\t: command.width / obj.ratio;\n\t\t\tcommit('setSize', {\n\t\t\t\tid: command.id,\n\t\t\t\theight,\n\t\t\t\twidth: command.width,\n\t\t\t} as ISetSpriteSizeMutation);\n\t\t},\n\t\tsetHeight({ commit, state }, command: ISetHeightAction) {\n\t\t\tconst obj = state.objects[command.id];\n\t\t\tconst width = !obj.preserveRatio ? obj.width : command.height * obj.ratio;\n\t\t\tcommit('setSize', {\n\t\t\t\tid: command.id,\n\t\t\t\theight: command.height,\n\t\t\t\twidth,\n\t\t\t} as ISetSpriteSizeMutation);\n\t\t},\n\t\tfixContentPackRemoval(context, oldContent: ContentPack<IAsset>) {\n\t\t\tObject.values(context.state.objects).map(obj => {\n\t\t\t\tswitch (obj.type) {\n\t\t\t\t\tcase 'character':\n\t\t\t\t\t\tfixContentPackRemovalFromCharacter(context, obj.id, oldContent);\n\t\t\t\t\t\treturn;\n\t\t\t\t\tcase 'sprite':\n\t\t\t\t\t\treturn;\n\t\t\t\t\tcase 'textBox':\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tcopyObjects(\n\t\t\t{ commit, state },\n\t\t\t{ sourcePanelId, targetPanelId }: ICopyObjectsAction\n\t\t) {\n\t\t\tconst sourceOrders = state.panels[sourcePanelId];\n\t\t\tif (!sourceOrders) return;\n\t\t\tconst allSourceIds = [...sourceOrders.onTopOrder, ...sourceOrders.order];\n\t\t\tconst transationTable = new Map<string, string>();\n\t\t\tfor (const sourceId of allSourceIds) {\n\t\t\t\tconst targetId = `copy_${++lastCopyId}`;\n\t\t\t\ttransationTable.set(sourceId, targetId);\n\t\t\t}\n\t\t\tfor (const sourceId of allSourceIds) {\n\t\t\t\tconst oldObject = state.objects[sourceId];\n\t\t\t\tconst newObject: IObject = JSON.parse(JSON.stringify(oldObject));\n\t\t\t\tif ('talkingObjId' in newObject) {\n\t\t\t\t\tconst newTextbox = newObject as ITextBox;\n\t\t\t\t\tif (\n\t\t\t\t\t\tnewTextbox.talkingObjId !== null &&\n\t\t\t\t\t\ttransationTable.has(newTextbox.talkingObjId)\n\t\t\t\t\t) {\n\t\t\t\t\t\tnewTextbox.talkingObjId = transationTable.get(\n\t\t\t\t\t\t\tnewTextbox.talkingObjId\n\t\t\t\t\t\t)!;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcommit('create', {\n\t\t\t\t\tobject: {\n\t\t\t\t\t\t...newObject,\n\t\t\t\t\t\tid: transationTable.get(sourceId)!,\n\t\t\t\t\t\tpanelId: targetPanelId,\n\t\t\t\t\t},\n\t\t\t\t} as ICreateObjectMutation);\n\t\t\t}\n\t\t},\n\t\tcopyObjectToClipboard(\n\t\t\t{ commit, state },\n\t\t\t{ id }: ICopyObjectToClipboardAction\n\t\t) {\n\t\t\tconst oldObject = state.objects[id];\n\t\t\tcommit('ui/setClipboard', JSON.stringify(oldObject), { root: true });\n\t\t},\n\t\tpasteObjectFromClipboard({ commit, rootState }) {\n\t\t\tif (!rootState.ui.clipboard) return;\n\t\t\tconst oldObject = JSON.parse(rootState.ui.clipboard);\n\t\t\tcommit('create', {\n\t\t\t\tobject: {\n\t\t\t\t\t...oldObject,\n\t\t\t\t\tid: `copy_${++lastCopyId}`,\n\t\t\t\t\tpanelId: rootState.panels.currentPanel,\n\t\t\t\t},\n\t\t\t} as ICreateObjectMutation);\n\t\t},\n\t\tdeleteAllOfPanel({ state, dispatch }, { panelId }: IDeleteAllOfPanel) {\n\t\t\tconst panel = state.panels[panelId];\n\t\t\tfor (const id of [...panel.onTopOrder, ...panel.order]) {\n\t\t\t\tdispatch('removeObject', { id } as IRemoveObjectAction);\n\t\t\t}\n\t\t},\n\t\taddFilter({ state, commit }, action: IAddFilterAction) {\n\t\t\taddFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.objects[id],\n\t\t\t\tmutation => commit('setFilters', mutation)\n\t\t\t);\n\t\t},\n\t\tremoveFilter({ state, commit }, action: IRemoveFilterAction) {\n\t\t\tremoveFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.objects[id],\n\t\t\t\tmutation => commit('setFilters', mutation)\n\t\t\t);\n\t\t},\n\t\tmoveFilter({ state, commit }, action: IMoveFilterAction) {\n\t\t\tmoveFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.objects[id],\n\t\t\t\tmutation => commit('setFilters', mutation)\n\t\t\t);\n\t\t},\n\t\tsetFilter({ state, commit }, action: ISetFilterAction) {\n\t\t\tsetFilter(\n\t\t\t\taction,\n\t\t\t\t(id: string) => state.objects[id],\n\t\t\t\tmutation => commit('setFilters', mutation)\n\t\t\t);\n\t\t},\n\t\t...spriteActions,\n\t\t...characterActions,\n\t\t...textBoxActions,\n\t\t...choiceActions,\n\t\t...notificationActions,\n\t\t...poemActions,\n\t},\n} as Module<IObjectsState, IRootState>;\n\nexport interface ICreateObjectMutation {\n\treadonly object: IObject;\n}\n\nexport interface IDeleteAllOfPanel {\n\treadonly panelId: string;\n}\n\nexport interface IObjectMutation {\n\treadonly id: string;\n}\n\nexport interface ISetSpriteSizeMutation extends ICommand {\n\treadonly width: number;\n\treadonly height: number;\n}\n\nexport interface ISetSpriteRatioMutation extends ICommand {\n\treadonly preserveRatio: boolean;\n\treadonly ratio: number;\n}\n\nexport interface ISetSpriteRotationMutation extends ICommand {\n\treadonly rotation: number;\n}\n\nexport interface ISetObjectPositionMutation extends IObjectMutation {\n\treadonly x: number;\n\treadonly y: number;\n}\n\nexport interface ISetOnTopMutation extends IObjectMutation {\n\treadonly onTop: boolean;\n}\n\nexport interface ISetObjectFlipMutation extends IObjectMutation {\n\treadonly flip: boolean;\n}\n\nexport interface IRemoveFromListMutation extends IObjectMutation {\n\treadonly onTop: boolean;\n}\n\nexport interface IAddToListMutation extends IObjectMutation {\n\treadonly onTop: boolean;\n\treadonly position: number;\n}\n\nexport interface ISetLabelMutation extends ICommand {\n\treadonly label: string;\n}\n\nexport interface ISetTextBoxColor extends ICommand {\n\treadonly textboxColor: string | null;\n}\n\nexport interface ISetEnlargeWhenTalkingMutation extends ICommand {\n\treadonly enlargeWhenTalking: boolean;\n}\n\nexport interface ISetNameboxWidthMutation extends ICommand {\n\treadonly nameboxWidth: null | number;\n}\n\nexport interface ISetObjectZoomMutation extends ICommand {\n\treadonly zoom: number;\n}\n\nexport interface IObjectShiftLayerAction extends ICommand {\n\treadonly delta: number;\n}\n\nexport interface IObjectSetOnTopAction extends ICommand {\n\treadonly onTop: boolean;\n}\n\nexport interface ISetWidthAction extends ICommand {\n\treadonly width: number;\n}\n\nexport interface ISetHeightAction extends ICommand {\n\treadonly height: number;\n}\n\nexport interface ISetRatioAction extends ICommand {\n\treadonly preserveRatio: boolean;\n}\n\nexport interface IRemoveObjectMutation extends ICommand {}\nexport interface IRemoveObjectAction extends ICommand {}\n\nexport interface ISetPositionAction extends ICommand {\n\treadonly x: number;\n\treadonly y: number;\n}\n\nexport interface IObjectContentPackRemovalAction extends ICommand {\n\treadonly oldPack: ContentPack<IAsset>;\n}\n\nexport interface ICopyObjectsAction {\n\treadonly sourcePanelId: string;\n\treadonly targetPanelId: string;\n}\n\nexport interface ICopyObjectToClipboardAction {\n\treadonly id: string;\n}\n\nexport interface IPasteFromClipboardAction {\n\treadonly panelId: string;\n}\n","import { Module } from 'vuex';\nimport { IRootState } from '.';\n\nexport interface IUiState {\n\tvertical: boolean;\n\tnsfw: boolean;\n\tselection: string | null;\n\tlqRendering: boolean;\n\tlastDownload: string | null;\n\tclipboard: string | null;\n\tuseDarkTheme: boolean | null;\n\tdefaultCharacterTalkingZoom: boolean;\n\tpickColor: boolean;\n}\n\nexport default {\n\tnamespaced: true,\n\tstate: {\n\t\tvertical: false,\n\t\tlqRendering: true,\n\t\tnsfw: false,\n\t\tselection: null,\n\t\tlastDownload: null,\n\t\tclipboard: null,\n\t\tuseDarkTheme: null,\n\t\tdefaultCharacterTalkingZoom: true,\n\t\tpickColor: false,\n\t},\n\tmutations: {\n\t\tsetVertical(state, vertical: boolean) {\n\t\t\tstate.vertical = vertical;\n\t\t},\n\t\tsetNsfw(state, nsfw: boolean) {\n\t\t\tstate.nsfw = nsfw;\n\t\t},\n\t\tsetLqRendering(state, lqRendering: boolean) {\n\t\t\tstate.lqRendering = lqRendering;\n\t\t},\n\t\tsetSelection(state, selection: string | null) {\n\t\t\tstate.selection = selection;\n\t\t},\n\t\tsetLastDownload(state, download: string) {\n\t\t\tstate.lastDownload = download;\n\t\t},\n\t\tsetClipboard(state, contents: string) {\n\t\t\tstate.clipboard = contents;\n\t\t},\n\t\tsetDarkTheme(state, theme: boolean | null) {\n\t\t\tstate.useDarkTheme = theme;\n\t\t},\n\t\tsetDefaultCharacterTalkingZoom(state, zoom: boolean) {\n\t\t\tstate.defaultCharacterTalkingZoom = zoom;\n\t\t},\n\t\tsetColorPicker(state, pickColor: boolean) {\n\t\t\tstate.pickColor = pickColor;\n\t\t},\n\t},\n} as Module<IUiState, IRootState>;\n","import {\n\tContentPack,\n\tBackground,\n\tCharacter,\n\tHeadCollections,\n\tPose,\n\tStyleClasses,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport { IAsset } from '.';\n\nexport function mergeContentPacks(\n\tx: ContentPack<IAsset>,\n\ty: ContentPack<IAsset>\n): ContentPack<IAsset> {\n\treturn {\n\t\tbackgrounds: mergeBackgrounds(x.backgrounds, y.backgrounds),\n\t\tcharacters: mergeCharacters<IAsset>(x.characters, y.characters),\n\t\tdependencies: mergeArrayUnique(x.dependencies, y.dependencies),\n\t\tfonts: mergeIdArrays(\n\t\t\tx.fonts,\n\t\t\ty.fonts,\n\t\t\tobj => obj.id,\n\t\t\t(xObj, yObj) => ({\n\t\t\t\t...xObj,\n\t\t\t\tfiles: mergeArrayUnique(xObj.files, yObj.files),\n\t\t\t})\n\t\t),\n\t\tpoemStyles: mergeIdArrays(\n\t\t\tx.poemStyles,\n\t\t\ty.poemStyles,\n\t\t\tobj => obj.label,\n\t\t\t() => {\n\t\t\t\tthrow new Error();\n\t\t\t}\n\t\t),\n\t\tpoemBackgrounds: [...x.poemBackgrounds, ...y.poemBackgrounds],\n\t\tsprites: mergeIdArrays(\n\t\t\tx.sprites,\n\t\t\ty.sprites,\n\t\t\tobj => obj.id,\n\t\t\t(xObj, yObj) => ({\n\t\t\t\tid: xObj.id,\n\t\t\t\tlabel: xObj.label,\n\t\t\t\tvariants: [...xObj.variants, ...yObj.variants],\n\t\t\t\tdefaultScale: xObj.defaultScale,\n\t\t\t\thd: xObj.hd,\n\t\t\t\tsdVersion: xObj.sdVersion || yObj.sdVersion,\n\t\t\t})\n\t\t),\n\t\tcolors: mergeIdArrays(\n\t\t\tx.colors,\n\t\t\ty.colors,\n\t\t\tobj => obj.color,\n\t\t\txObj => xObj\n\t\t),\n\t};\n}\n\nfunction mergeBackgrounds<A>(\n\tx: Array<Background<A>>,\n\ty: Array<Background<A>>\n): Array<Background<A>> {\n\treturn mergeIdArrays(x, y, obj => obj.id, mergeBackground);\n}\n\nfunction mergeBackground<A>(x: Background<A>, y: Background<A>): Background<A> {\n\treturn {\n\t\tid: x.id,\n\t\tlabel: x.label,\n\t\tvariants: [...x.variants, ...y.variants],\n\t\tscaling: x.scaling,\n\t\tsdVersion: x.sdVersion || y.sdVersion,\n\t};\n}\n\nfunction mergeCharacters<A>(\n\tx: Array<Character<A>>,\n\ty: Array<Character<A>>\n): Array<Character<A>> {\n\treturn mergeIdArrays(x, y, obj => obj.id, mergeCharacter);\n}\n\nfunction mergeCharacter<A>(x: Character<A>, y: Character<A>): Character<A> {\n\treturn {\n\t\tchibi: x.chibi,\n\t\tid: x.id,\n\t\tlabel: x.label,\n\t\theads: mergeHeadCollections(x.heads, y.heads),\n\t\tdefaultScale: x.defaultScale,\n\t\thd: x.hd,\n\t\tsize: x.size,\n\t\tsdVersion: x.sdVersion,\n\t\tstyleGroups: mergeIdArrays(\n\t\t\tx.styleGroups,\n\t\t\ty.styleGroups,\n\t\t\tobj => obj.id,\n\t\t\t(xStyleGroup, yStyleGroup) => {\n\t\t\t\treturn {\n\t\t\t\t\tid: xStyleGroup.id,\n\t\t\t\t\tstyleComponents: mergeIdArrays(\n\t\t\t\t\t\txStyleGroup.styleComponents,\n\t\t\t\t\t\tyStyleGroup.styleComponents,\n\t\t\t\t\t\tobj => obj.id,\n\t\t\t\t\t\t(xClasses, yClasses) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tid: xClasses.id,\n\t\t\t\t\t\t\t\tlabel: xClasses.label,\n\t\t\t\t\t\t\t\tvariants: mergeStyleClasses(\n\t\t\t\t\t\t\t\t\txClasses.variants,\n\t\t\t\t\t\t\t\t\tyClasses.variants\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t),\n\t\t\t\t\tstyles: mergeIdArrays(\n\t\t\t\t\t\txStyleGroup.styles,\n\t\t\t\t\t\tyStyleGroup.styles,\n\t\t\t\t\t\tobj => JSON.stringify(obj.components),\n\t\t\t\t\t\t(xStyle, yStyle) => ({\n\t\t\t\t\t\t\tcomponents: xStyle.components,\n\t\t\t\t\t\t\tposes: mergeIdArrays(\n\t\t\t\t\t\t\t\txStyle.poses,\n\t\t\t\t\t\t\t\tyStyle.poses,\n\t\t\t\t\t\t\t\tobj => obj.id,\n\t\t\t\t\t\t\t\tmergePose\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t})\n\t\t\t\t\t),\n\t\t\t\t};\n\t\t\t}\n\t\t),\n\t};\n}\n\nfunction mergeStyleClasses<A>(\n\tx: StyleClasses<A>,\n\ty: StyleClasses<A>\n): StyleClasses<A> {\n\tconst ret: StyleClasses<A> = { ...x };\n\n\tfor (const classKey in y) {\n\t\tif (!y.hasOwnProperty(classKey)) continue;\n\t\tif (ret.hasOwnProperty(classKey)) continue;\n\t\tret[classKey] = y[classKey];\n\t}\n\n\treturn ret;\n}\n\nfunction mergePose<A>(x: Pose<A>, y: Pose<A>): Pose<A> {\n\tconst positions: Pose<A>['positions'] = { ...x.positions };\n\n\tfor (const key in y.positions) {\n\t\tif (positions[key]) {\n\t\t\tpositions[key] = [...positions[key], ...y.positions[key]] as A[][];\n\t\t} else {\n\t\t\tpositions[key] = y.positions[key];\n\t\t}\n\t}\n\n\treturn {\n\t\tid: x.id,\n\t\tcompatibleHeads: mergeArrayUnique(x.compatibleHeads, y.compatibleHeads),\n\t\tpreviewOffset: x.previewOffset,\n\t\tpreviewSize: x.previewSize,\n\t\tscale: x.scale,\n\t\tsize: x.size,\n\t\trenderCommands: x.renderCommands,\n\t\tpositions,\n\t};\n}\n\nfunction mergeHeadCollections<A>(\n\tx: HeadCollections<A>,\n\ty: HeadCollections<A>\n): HeadCollections<A> {\n\tconst ret = { ...x };\n\n\tfor (const headGroupKey in y) {\n\t\tif (!y.hasOwnProperty(headGroupKey)) continue;\n\t\tconst headGroup = y[headGroupKey];\n\t\tif (ret[headGroupKey]) {\n\t\t\tconst oldHeadGroup = ret[headGroupKey];\n\t\t\tret[headGroupKey] = {\n\t\t\t\tpreviewOffset: oldHeadGroup.previewOffset,\n\t\t\t\tpreviewSize: oldHeadGroup.previewSize,\n\t\t\t\tvariants: [...oldHeadGroup.variants, ...headGroup.variants],\n\t\t\t};\n\t\t} else {\n\t\t\tret[headGroupKey] = headGroup;\n\t\t}\n\t}\n\n\treturn ret;\n}\n\nfunction mergeArrayUnique<A>(x: A[], y: A[]): A[] {\n\tconst ret = [...x];\n\tfor (const yObj of y) {\n\t\tif (!ret.includes(yObj)) {\n\t\t\tret.push(yObj);\n\t\t}\n\t}\n\treturn ret;\n}\n\nfunction mergeIdArrays<A, B>(\n\tx: A[],\n\ty: A[],\n\tgetId: (obj: A) => B,\n\tmerge: (x: A, y: A) => A\n): A[] {\n\tconst ret = [...x];\n\tconst definedIds = new Map<B, number>(\n\t\tx.map((xObj, idx) => [getId(xObj), idx])\n\t);\n\n\tfor (const yObj of y) {\n\t\tconst yId = getId(yObj);\n\t\tif (definedIds.has(yId)) {\n\t\t\tconst existingIdx = definedIds.get(yId)!;\n\t\t\tconst existing = ret[existingIdx];\n\t\t\tret.splice(existingIdx, 1, merge(existing, yObj));\n\t\t} else {\n\t\t\tdefinedIds.set(yId, ret.length);\n\t\t\tret.push(yObj);\n\t\t}\n\t}\n\n\treturn ret;\n}\n","import { Module } from 'vuex';\nimport {\n\tContentPack,\n\tCharacter,\n\tBackground,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\nimport {\n\tassetWalker,\n\tnormalizePath,\n} from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/util';\nimport { normalizeContentPack } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/parser';\nimport { convert as convertV1 } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/convertV1';\n// tslint:disable-next-line: max-line-length\nimport { normalizeCharacter as normalizeCharacterV1 } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v1/parser';\nimport { isWebPSupported } from '@/asset-manager';\nimport { mergeContentPacks } from './merge';\nimport { IRootState } from '..';\n\nexport interface IContentState {\n\tcontentPacks: Array<ContentPack<IAsset>>;\n\tcurrent: ContentPack<IAsset>;\n}\n\nexport interface IAsset {\n\thq: string;\n\tlq: string;\n\tsourcePack: string;\n}\n\nfunction baseDir(url: string): string {\n\treturn (\n\t\turl\n\t\t\t.split('/')\n\t\t\t.slice(0, -1)\n\t\t\t.join('/') + '/'\n\t);\n}\n\n// These types are assumed to always be supported\nconst baseTypes = new Set(['png', 'gif', 'bmp', 'svg']);\n\nexport type BackgroundLookup = Map<\n\tBackground<IAsset>['id'],\n\tBackground<IAsset>\n>;\n\nexport default {\n\tnamespaced: true,\n\tstate: {\n\t\tcontentPacks: [],\n\t\tcurrent: {\n\t\t\tdependencies: [],\n\t\t\tbackgrounds: [],\n\t\t\tcharacters: [],\n\t\t\tfonts: [],\n\t\t\tpoemStyles: [],\n\t\t\tpoemBackgrounds: [],\n\t\t\tsprites: [],\n\t\t\tcolors: [],\n\t\t},\n\t},\n\tmutations: {\n\t\tsetContentPacks(state: IContentState, packs: Array<ContentPack<IAsset>>) {\n\t\t\tstate.contentPacks = packs;\n\t\t},\n\t\tsetCurrentContent(state: IContentState, content: ContentPack<IAsset>) {\n\t\t\tstate.current = content;\n\t\t},\n\t},\n\tactions: {\n\t\tasync contentPack({ commit, state }, contentPack: ContentPack<string>) {\n\t\t\tconst convertedPack = (await convertContentPack(\n\t\t\t\tcontentPack\n\t\t\t)) as ContentPack<IAsset>;\n\t\t\tconst existingPacks = new Set(state.contentPacks.map(x => x.packId!));\n\t\t\tfor (const dependency of contentPack.dependencies) {\n\t\t\t\tif (!existingPacks.has(dependency)) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t`Missing dependency '${dependency}'. Refusing to install ${contentPack.packId}`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcommit('setContentPacks', [...state.contentPacks, convertedPack]);\n\t\t\tcommit(\n\t\t\t\t'setCurrentContent',\n\t\t\t\tmergeContentPacks(state.current, convertedPack)\n\t\t\t);\n\t\t},\n\n\t\tasync removeContentPacks({ commit, state }, packIds: Set<string>) {\n\t\t\tconst newContentPacks = sortByDependencies(\n\t\t\t\tstate.contentPacks.filter(pack => !packIds.has(pack.packId!))\n\t\t\t);\n\t\t\tcommit('setContentPacks', newContentPacks);\n\t\t\tcommit(\n\t\t\t\t'setCurrentContent',\n\t\t\t\t(newContentPacks as Array<ContentPack<IAsset>>).reduce((acc, value) =>\n\t\t\t\t\tmergeContentPacks(acc, value)\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\n\t\tasync replaceContentPack(\n\t\t\t{ commit, state },\n\t\t\taction: ReplaceContentPackAction\n\t\t) {\n\t\t\tconst convertedPack = action.processed\n\t\t\t\t? action.contentPack\n\t\t\t\t: await convertContentPack(action.contentPack);\n\t\t\tlet packs = state.contentPacks;\n\t\t\tconst packIdx = packs.findIndex(\n\t\t\t\tpack => pack.packId === action.contentPack.packId\n\t\t\t);\n\t\t\tif (packIdx === -1) {\n\t\t\t\tpacks.push(convertedPack);\n\t\t\t} else {\n\t\t\t\tpacks.splice(packIdx, 1, convertedPack);\n\t\t\t}\n\t\t\tpacks = sortByDependencies(packs);\n\t\t\tcommit('setContentPacks', packs);\n\t\t\tcommit(\n\t\t\t\t'setCurrentContent',\n\t\t\t\t(packs as Array<ContentPack<IAsset>>).reduce((acc, value) =>\n\t\t\t\t\tmergeContentPacks(acc, value)\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\n\t\tasync loadContentPacks({ dispatch }, urls: string | string[]) {\n\t\t\tif (typeof urls === 'string') {\n\t\t\t\turls = [urls];\n\t\t\t}\n\t\t\tconst contentPacks = await Promise.all(\n\t\t\t\turls.map(async url => {\n\t\t\t\t\tconst response = await fetch(url);\n\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\terror(\n\t\t\t\t\t\t\t`Could not load content pack. Server responded with: ${response.statusText}`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet json;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tjson = await response.json();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\terror('Content pack is not valid json!');\n\t\t\t\t\t}\n\n\t\t\t\t\tlet contentPack: ContentPack<string>;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst paths = {\n\t\t\t\t\t\t\t'./': baseDir(url),\n\t\t\t\t\t\t\t'/': baseDir(location.href) + 'assets/',\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (json.version === '2.0') {\n\t\t\t\t\t\t\tcontentPack = normalizeContentPack(json, paths) as ContentPack<\n\t\t\t\t\t\t\t\tstring\n\t\t\t\t\t\t\t>;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcontentPack = convertV1(\n\t\t\t\t\t\t\t\tnormalizeCharacterV1(json, paths),\n\t\t\t\t\t\t\t\tpaths,\n\t\t\t\t\t\t\t\tfalse\n\t\t\t\t\t\t\t) as ContentPack<string>;\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\terror('Content pack is not in a valid format!', e);\n\t\t\t\t\t}\n\t\t\t\t\treturn contentPack;\n\t\t\t\t})\n\t\t\t);\n\n\t\t\tfor (const contentPack of contentPacks) {\n\t\t\t\tawait dispatch('contentPack', contentPack);\n\t\t\t}\n\n\t\t\treturn contentPacks.map(x => x.packId);\n\t\t},\n\t},\n\tgetters: {\n\t\tgetCharacters({\n\t\t\tcurrent,\n\t\t}): Map<Character<IAsset>['id'], Character<IAsset>> {\n\t\t\tconst ret = new Map<Character<IAsset>['id'], Character<IAsset>>();\n\t\t\tfor (const character of current.characters) {\n\t\t\t\tret.set(character.id, character);\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\t\tgetBackgrounds({ current }): BackgroundLookup {\n\t\t\tconst ret = new Map<Background<IAsset>['id'], Background<IAsset>>();\n\t\t\tfor (const background of current.backgrounds) {\n\t\t\t\tret.set(background.id, background);\n\t\t\t}\n\t\t\treturn ret;\n\t\t},\n\t},\n} as Module<IContentState, IRootState>;\n\nfunction sortByDependencies(\n\tpacks: Array<ContentPack<IAsset>>\n): Array<ContentPack<IAsset>> {\n\treturn packs;\n}\n\nasync function convertContentPack(\n\tpack: ContentPack<string>\n): Promise<ContentPack<IAsset>> {\n\tconst types: ReadonlySet<string> = new Set(\n\t\t(await isWebPSupported()) ? ['webp', ...baseTypes] : baseTypes\n\t);\n\n\tconst replacementMap = new Map([\n\t\t['ext', '{lq:.lq:}.{format:webp:webp:png:png}'],\n\t]);\n\n\tconst ret = assetWalker(\n\t\tpack,\n\t\t(path: string, type: 'image' | 'font'): IAsset => {\n\t\t\tconst hq = normalizePath(path, replacementMap, types, false);\n\t\t\tconst lq = normalizePath(path, replacementMap, types, true);\n\n\t\t\treturn {\n\t\t\t\thq,\n\t\t\t\tlq,\n\t\t\t\tsourcePack: pack.packId || 'buildIn',\n\t\t\t};\n\t\t}\n\t) as ContentPack<IAsset>;\n\treturn ret;\n}\n\nfunction error(msg: string, payload?: any): never {\n\tconsole.error(msg, payload);\n\tthrow new Error(msg);\n}\n\n// tslint:disable: indent\nexport type ReplaceContentPackAction =\n\t| {\n\t\t\tcontentPack: ContentPack<string>;\n\t\t\tprocessed: false;\n\t  }\n\t| {\n\t\t\tcontentPack: ContentPack<IAsset>;\n\t\t\tprocessed: true;\n\t  };\n// tslint:enable: indent\n","import { createStore } from 'vuex';\nimport objects, { IObjectsState } from './objects';\nimport ui, { IUiState } from './ui';\nimport panels, { IPanels } from './panels';\nimport content, { IContentState, IAsset } from './content';\nimport { ContentPack } from '@edave64/doki-doki-dialog-generator-pack-format/dist/v2/model';\n\nexport interface IRootState {\n\tobjects: IObjectsState;\n\tui: IUiState;\n\tpanels: IPanels;\n\tcontent: IContentState;\n\tunsafe: boolean;\n}\n\nexport default createStore({\n\tstate: {\n\t\tunsafe: false,\n\t} as any,\n\tmutations: {\n\t\tsetUnsafe(state, unsafe: boolean) {\n\t\t\tstate.unsafe = unsafe;\n\t\t},\n\t},\n\tactions: {\n\t\tasync removePacks(\n\t\t\t{ dispatch, commit, state },\n\t\t\t{ packs }: IRemovePacksAction\n\t\t) {\n\t\t\tconst oldState: ContentPack<IAsset> = JSON.parse(\n\t\t\t\tJSON.stringify(state.content.current)\n\t\t\t);\n\n\t\t\tcommit('setUnsafe', true);\n\t\t\tawait dispatch('content/removeContentPacks', packs);\n\t\t\tawait dispatch('panels/fixContentPackRemoval', oldState);\n\t\t\tawait dispatch('objects/fixContentPackRemoval', oldState);\n\t\t\tcommit('setUnsafe', false);\n\t\t},\n\t},\n\tmodules: { objects, ui, panels, content },\n});\n\nexport interface IRemovePacksAction {\n\tpacks: Set<string>;\n}\n","import { reactive } from 'vue';\n\nexport default {\n\t/**\n\t *\n\t * @param {Vue} Vue\n\t * @param {{}} options\n\t */\n\tinstall(vueApp, options = {}) {\n\t\tif (!vueApp.config.globalProperties.$store) {\n\t\t\tthrow new Error(\n\t\t\t\t'VuexUndoRedo plugin must be installed after the Vuex plugin.'\n\t\t\t);\n\t\t}\n\t\tif (!options.resetStateMutation) options.resetStateMutation = 'emptyState';\n\t\tif (!options.mutations) options.mutations = {};\n\n\t\tconst $store = vueApp.config.globalProperties.$store;\n\n\t\t/**\n\t\t * @param {Vue} vm\n\t\t * @param {*} mutation\n\t\t */\n\t\tfunction replayMutation(vm, mutation) {\n\t\t\tlet baseObj = {};\n\t\t\tswitch (typeof mutation.payload) {\n\t\t\t\tcase 'object':\n\t\t\t\t\tif (mutation.payload instanceof Array) {\n\t\t\t\t\t\tbaseObj = [];\n\t\t\t\t\t}\n\t\t\t\t\t$store.commit(\n\t\t\t\t\t\t`${mutation.type}`,\n\t\t\t\t\t\tObject.assign(baseObj, mutation.payload)\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t$store.commit(`${mutation.type}`, mutation.payload);\n\t\t\t}\n\t\t}\n\n\t\tasync function replayTransaction(vm, transaction) {\n\t\t\treturn await vm.transaction(() => {\n\t\t\t\ttransaction.forEach(mutation => {\n\t\t\t\t\treplayMutation(vm, mutation);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * @param {Vue} vm\n\t\t * @param {*} mutation\n\t\t */\n\t\tasync function replayAll(vm) {\n\t\t\tconst oldTransactions = vm.data.done.slice(0);\n\t\t\tvm.data.done = [];\n\t\t\t$store.commit(options.resetStateMutation);\n\t\t\tfor (let i = 0; i < oldTransactions.length; ++i) {\n\t\t\t\tawait replayTransaction(vm, oldTransactions[i]);\n\t\t\t}\n\t\t}\n\n\t\tconst mutationProperiesCache = {};\n\n\t\t/**\n\t\t *\n\t\t * @param {IHistoryOptions} options\n\t\t * @param {*} name\n\t\t */\n\t\tfunction getMutationProperties(name) {\n\t\t\tif (!mutationProperiesCache[name]) {\n\t\t\t\tconst parts = name.split('/');\n\t\t\t\tconst mutationProperties = {\n\t\t\t\t\tignore: mutation => false,\n\t\t\t\t\tcombinable: (oldMutation, newMutation) => false,\n\t\t\t\t\tcombinator: (oldMutation, newMutation) => newMutation,\n\t\t\t\t};\n\t\t\t\tlet currentWildcard = '';\n\t\t\t\tfor (const part of parts) {\n\t\t\t\t\tif (options.mutations[currentWildcard + '*']) {\n\t\t\t\t\t\tObject.assign(\n\t\t\t\t\t\t\tmutationProperties,\n\t\t\t\t\t\t\toptions.mutations[currentWildcard + '*']\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tcurrentWildcard += part + '/';\n\t\t\t\t}\n\t\t\t\tif (options.mutations[name]) {\n\t\t\t\t\tObject.assign(mutationProperties, options.mutations[name]);\n\t\t\t\t}\n\t\t\t\tmutationProperiesCache[name] = mutationProperties;\n\t\t\t}\n\t\t\treturn mutationProperiesCache[name];\n\t\t}\n\n\t\tconst history = {\n\t\t\tdata: reactive({\n\t\t\t\tdone: [],\n\t\t\t\tundone: [],\n\t\t\t\tnewMutation: true,\n\t\t\t\tignoreMutations: options.ignoreMutations || [],\n\t\t\t\tcurrentTransaction: null,\n\t\t\t\ttransactionQueue: [],\n\t\t\t\tinitialized: false,\n\t\t\t}),\n\t\t\tinitialize() {\n\t\t\t\tif (history.initialized) return;\n\t\t\t\thistory.initialized = true;\n\t\t\t\t$store.subscribe(mutation => {\n\t\t\t\t\tconst exec = () => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tmutation.type === options.resetStateMutation ||\n\t\t\t\t\t\t\tgetMutationProperties(mutation.type).ignore(mutation)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\thistory.currentTransaction.push(mutation);\n\t\t\t\t\t\tif (history.newMutation) {\n\t\t\t\t\t\t\thistory.data.undone = [];\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tif (history.currentTransaction) {\n\t\t\t\t\t\texec();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// If a mutation triggers outside of any transaction, it gets it's own transaction\n\t\t\t\t\t\thistory.transaction(() => {\n\t\t\t\t\t\t\texec();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tredo() {\n\t\t\t\tif (history.data.undone.length <= 0) return;\n\t\t\t\tconst commit = history.data.undone.pop();\n\t\t\t\thistory.newMutation = false;\n\t\t\t\treplayTransaction(history, commit);\n\t\t\t\thistory.newMutation = true;\n\t\t\t},\n\t\t\tasync undo() {\n\t\t\t\tif (history.data.done.length <= 0) return;\n\t\t\t\thistory.data.undone.push(history.data.done.pop());\n\t\t\t\thistory.newMutation = false;\n\t\t\t\tawait replayAll(history);\n\t\t\t\thistory.newMutation = true;\n\t\t\t},\n\t\t\t/**\n\t\t\t * @param {transactionCallback} callback\n\t\t\t */\n\t\t\ttransaction(callback) {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tconst exec = async () => {\n\t\t\t\t\t\thistory.currentTransaction = [];\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait callback();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tconsole.log('Error during transaction!: ', e);\n\t\t\t\t\t\t\t// reject(e);\n\t\t\t\t\t\t\t//this.currentTransaction = [];\n\t\t\t\t\t\t\t// The transaction that just failed is not in the undo history yet.\n\t\t\t\t\t\t\t// So replaying that is equivalent to undoing the transaction.\n\t\t\t\t\t\t\t//replayAll(this);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst lastUndo = history.data.done[history.data.done.length - 1];\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\thistory.currentTransaction.length === 1 &&\n\t\t\t\t\t\t\tlastUndo &&\n\t\t\t\t\t\t\tlastUndo.length === 1\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tconst options = getMutationProperties(\n\t\t\t\t\t\t\t\thistory.currentTransaction[0].type\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\toptions.combinable(lastUndo[0], history.currentTransaction[0])\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tconst combination = options.combinator(\n\t\t\t\t\t\t\t\t\tlastUndo[0],\n\t\t\t\t\t\t\t\t\thistory.currentTransaction[0]\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\thistory.data.done.pop();\n\t\t\t\t\t\t\t\tif (combination) {\n\t\t\t\t\t\t\t\t\thistory.currentTransaction = [combination];\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t// Returning a non-truthy value in the combinator simply eliminates both transactions.\n\t\t\t\t\t\t\t\t\t// So if the user manually undoes an action, you can just pretend it never happened.\n\t\t\t\t\t\t\t\t\thistory.currentTransaction = [];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (history.currentTransaction.length > 0) {\n\t\t\t\t\t\t\thistory.data.done.push(history.currentTransaction);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\thistory.currentTransaction = null;\n\t\t\t\t\t\tif (history.data.transactionQueue.length > 0) {\n\t\t\t\t\t\t\thistory.data.transactionQueue.pop()();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t};\n\t\t\t\t\tif (history.currentTransaction) {\n\t\t\t\t\t\thistory.data.transactionQueue.push(exec);\n\t\t\t\t\t} else {\n\t\t\t\t\t\texec();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t};\n\n\t\tvueApp.config.globalProperties.vuexHistory = history;\n\t\thistory.initialize();\n\t},\n};\n\n/**\n * @callback transactionCallback\n * @async\n */\n","import { createApp } from 'vue';\r\nimport App from './App.vue';\r\nimport store from './store';\r\nimport History from './plugins/vuex-history';\r\n\r\ncreateApp(App)\r\n\t.use(store)\r\n\t.use(History)\r\n\t.mount('#app');\r\n","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./object-tool.vue?vue&type=style&index=0&id=16d40063&lang=scss&scoped=true\"","import { ITextStyle } from '@/renderer/textRenderer/textRenderer';\nimport { screenWidth } from './base';\nimport { nameboxStrokeDefaultColor } from './textBoxCustom';\n\n// tslint:disable: no-magic-numbers\nexport const TextBoxWidth = 816;\nexport const TextBoxCorruptedWidth = 900;\nexport const TextBoxHeight = 146;\nexport const TextBoxKerning = 0;\nexport const TextBoxLineHeight = 29;\nexport const TextBoxCorruptedKerning = 8;\nexport const TextBoxTextXOffset = 38;\nexport const TextBoxTextYOffset = 44;\nexport const TextBoxBottomSpacing = 6;\n\nexport const HdSpacing = 93;\nexport const HdSideMargin = 404;\n\nexport const TextBoxTextCorruptedXOffset = 9;\nexport const TextBoxTextCorruptedYOffset = 9;\n\nexport const NameboxHeight = 39;\nexport const NameboxWidth = 168;\nexport const NameboxXOffset = 34;\nexport const NameboxTextYOffset = 29;\n\nexport const ControlsYBottomOffset = 12;\nexport const ControlsXHistoryOffset = -126;\nexport const ControlsXSkipOffset = -72;\nexport const ControlsXStuffOffset = -38;\n\nexport const ArrowXRightOffset = 30.75;\nexport const ArrowYBottomOffset = 26;\n\nexport const GlowRX = 426;\nexport const GlowRY = 58;\n\nexport const BaseTextStyle: ITextStyle = {\n\talpha: 1,\n\tcolor: 'black',\n\tfontName: 'aller',\n\tfontSize: 24,\n\tisBold: false,\n\tisItalic: false,\n\tisStrikethrough: false,\n\tisUnderlined: false,\n\tletterSpacing: 0,\n\tlineSpacing: 1,\n\tstrokeColor: '',\n\tstrokeWidth: 0,\n};\n\nexport const NameboxTextStyle: ITextStyle = {\n\t...BaseTextStyle,\n\tfontName: 'riffic',\n\tfontSize: 24,\n\tstrokeColor: nameboxStrokeDefaultColor,\n\tstrokeWidth: 6,\n\tcolor: 'white',\n\tletterSpacing: 1,\n};\n\nexport const ControlsTextStyle = {\n\talign: 'left' as CanvasTextAlign,\n\tfont: '13px aller',\n\tfill: {\n\t\tstyle: '#522',\n\t},\n};\n\nexport const ControlsTextDisabledStyle = {\n\t...ControlsTextStyle,\n\tfill: {\n\t\tstyle: '#a66',\n\t},\n};\n/*\nexport const TextBoxStyle = {\n\t...BaseTextStyle,\n\talign: 'left' as CanvasTextAlign,\n\tfont: '24px aller',\n\toutline: {\n\t\tstyle: '#523140',\n\t\twidth: 4,\n\t},\n\tfill: {\n\t\tstyle: '#fff',\n\t},\n};\n*/\nexport const TextBoxCorruptedStyle = {\n\talign: 'left' as CanvasTextAlign,\n\tfont: '24px verily',\n\toutline: {\n\t\tstyle: '#000',\n\t\twidth: 20,\n\t},\n\tfill: {\n\t\tstyle: '#fff',\n\t},\n};\n\nexport const TextBoxStyle = {\n\talpha: 1,\n\tcolor: '#ffffff',\n\tfontName: 'aller',\n\tfontSize: 24,\n\tisBold: false,\n\tisItalic: false,\n\tisStrikethrough: false,\n\tisUnderlined: false,\n\tletterSpacing: 0,\n\tstrokeColor: '#523140',\n\tstrokeWidth: 4,\n\tlineSpacing: 1.2,\n};\n\nexport const TextBoxX = screenWidth / 2 - TextBoxWidth / 2; // 232\nexport const TextBoxCorruptedX = screenWidth / 2 - TextBoxCorruptedWidth / 2;\nexport const TextBoxTextX = TextBoxX + TextBoxTextXOffset;\n\nexport const NameboxX = TextBoxX + NameboxXOffset;\nexport const NameboxTextX = NameboxX + NameboxWidth / 2;\n\nexport const ControlsXHistory = TextBoxX + ControlsXHistoryOffset;\nexport const ControlsXSkip = TextBoxX + ControlsXSkipOffset;\nexport const ControlsXStuff = TextBoxX + ControlsXStuffOffset;\n\nexport const DefaultTextboxStyle = 'normal';\n","<template>\n\t<div\n\t\tv-if=\"visible\"\n\t\t@dragleave=\"visible = false\"\n\t\t@drop=\"drop\"\n\t\t:class=\"{ vertical: vertical }\"\n\t>\n\t\t<slot />\n\t</div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\tdata: () => ({\n\t\tvisible: false,\n\t}),\n\tmethods: {\n\t\tshow(): void {\n\t\t\tthis.visible = true;\n\t\t},\n\t\thide(): void {\n\t\t\tthis.visible = false;\n\t\t},\n\t\tdrop(e: DragEvent): void {\n\t\t\tthis.hide();\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif (!e.dataTransfer) return;\n\n\t\t\tfor (const item of e.dataTransfer.items) {\n\t\t\t\tif (item.kind === 'file' && item.type.match(/image.*/)) {\n\t\t\t\t\tthis.$emit('drop', item.getAsFile());\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n});\n</script>\n<style lang=\"scss\" scoped>\ndiv {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground: rgba(50, 50, 50, 0.75);\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tcolor: $default-native-background;\n\tcolor: var(--native-background);\n\ttext-shadow: 0 0 4px #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000,\n\t\t1px 1px 0 #000;\n\tfont-size: 24px;\n\tfont-family: riffic, sans-serif;\n}\n</style>\n","\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\tcomputed: {\n\t\tvertical(): boolean {\n\t\t\treturn this.$store.state.ui.vertical;\n\t\t},\n\t},\n\tdata: () => ({\n\t\tvisible: false,\n\t}),\n\tmethods: {\n\t\tshow(): void {\n\t\t\tthis.visible = true;\n\t\t},\n\t\thide(): void {\n\t\t\tthis.visible = false;\n\t\t},\n\t\tdrop(e: DragEvent): void {\n\t\t\tthis.hide();\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif (!e.dataTransfer) return;\n\n\t\t\tfor (const item of e.dataTransfer.items) {\n\t\t\t\tif (item.kind === 'file' && item.type.match(/image.*/)) {\n\t\t\t\t\tthis.$emit('drop', item.getAsFile());\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n});\n","import { render } from \"./drop-target.vue?vue&type=template&id=0c92f421&scoped=true\"\nimport script from \"./drop-target.vue?vue&type=script&lang=ts\"\nexport * from \"./drop-target.vue?vue&type=script&lang=ts\"\n\nimport \"./drop-target.vue?vue&type=style&index=0&id=0c92f421&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-0c92f421\"\n\nexport default script","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./character.vue?vue&type=style&index=0&id=47403597&lang=scss&scoped=true\"","export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./partButton.vue?vue&type=style&index=0&id=7d67a652&lang=scss&scoped=true\"","// tslint:disable: no-magic-numbers\nexport const screenWidth = 1280;\nexport const screenHeight = 720;\n\nexport const positions = [\n\t'4-1',\n\t'3-1',\n\t'2-1',\n\t'4-2',\n\t'center',\n\t'4-3',\n\t'2-2',\n\t'3-3',\n\t'4-4',\n];\n\nexport const sdCharacterScaleFactor = 1;\nexport const hdCharacterScaleFactor = 1 / 1.5;\n\nexport const CloseUpYOffset = -74;\nexport const BaseCharacterYPos = -26;\n\nexport const characterPositions = [\n\t200,\n\t240,\n\t400,\n\t493,\n\t640,\n\t786,\n\t880,\n\t1040,\n\t1080,\n];\n","import { IColor } from './color';\nimport { RGBAColor } from './rgb';\n\n// tslint:disable: no-magic-numbers\nexport class HSLAColor implements IColor {\n\tpublic constructor(\n\t\tpublic readonly h: number,\n\t\tpublic readonly s: number,\n\t\tpublic readonly l: number,\n\t\tpublic readonly a: number\n\t) {\n\t\tObject.freeze(this);\n\t}\n\n\tpublic toCss(): string {\n\t\tif (this.a >= 1) {\n\t\t\treturn `hsl(${this.h}, ${this.s}, ${this.l})`;\n\t\t}\n\t\treturn `hsla(${this.h}, ${this.s}, ${this.l}, ${this.a})`;\n\t}\n\n\tpublic shift(deltas: HSLAColor): HSLAColor {\n\t\tlet { h, s, l, a } = this;\n\t\th += deltas.h;\n\t\tif (h >= 1) {\n\t\t\th -= 1;\n\t\t} else if (h < 0) {\n\t\t\th += 1;\n\t\t}\n\t\tif (s + deltas.s > 1) {\n\t\t\ts -= deltas.s;\n\t\t} else {\n\t\t\ts += deltas.s;\n\t\t\tif (s < 0) {\n\t\t\t\ts = 0;\n\t\t\t}\n\t\t}\n\t\tif (l + deltas.l > 1 || l + deltas.l < 0) {\n\t\t\tl -= deltas.l;\n\t\t} else {\n\t\t\tl += deltas.l;\n\t\t}\n\t\tif (a + deltas.a > 1 || a + deltas.a < 0) {\n\t\t\ta -= deltas.a;\n\t\t} else {\n\t\t\ta += deltas.a;\n\t\t}\n\t\treturn new HSLAColor(h, s, l, a);\n\t}\n\n\tpublic toRgb(): RGBAColor {\n\t\tconst { h, s, l, a } = this;\n\t\tlet r: number;\n\t\tlet g: number;\n\t\tlet b: number;\n\n\t\tif (s === 0) {\n\t\t\tr = g = b = l; // achromatic\n\t\t} else {\n\t\t\tconst q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n\t\t\tconst p = 2 * l - q;\n\t\t\tr = this.hue2rgb(p, q, h + 1 / 3);\n\t\t\tg = this.hue2rgb(p, q, h);\n\t\t\tb = this.hue2rgb(p, q, h - 1 / 3);\n\t\t}\n\n\t\treturn new RGBAColor(\n\t\t\tMath.round(r * 255),\n\t\t\tMath.round(g * 255),\n\t\t\tMath.round(b * 255),\n\t\t\ta\n\t\t);\n\t}\n\n\tpublic toHSL(): HSLAColor {\n\t\treturn this;\n\t}\n\n\tprivate hue2rgb(p: number, q: number, t: number) {\n\t\tif (t < 0) t += 1;\n\t\tif (t > 1) t -= 1;\n\t\tif (t < 1 / 6) return p + (q - p) * 6 * t;\n\t\tif (t < 1 / 2) return q;\n\t\tif (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\n\t\treturn p;\n\t}\n}\n","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./content-pack.vue?vue&type=style&index=0&id=714ad0fa&lang=scss&scoped=true\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./add.vue?vue&type=style&index=0&id=32ed20c5&lang=scss&scoped=true\"","import { ITextStyle } from '@/renderer/textRenderer/textRenderer';\nimport { screenHeight, screenWidth } from './base';\n\n// tslint:disable: no-magic-numbers\nexport const poemBackgrounds = [\n\t{ name: 'Normal paper', file: 'poem.jpg' },\n\t{ name: 'Lightly soiled paper', file: 'poem_y1.jpg' },\n\t{ name: 'Heavily soiled paper', file: 'poem_y2.jpg' },\n\t{ name: 'Console', file: 'internal:console' },\n\t{ name: 'Transparent', file: 'internal:transparent' },\n];\nexport const defaultPoemBackground = 0;\nexport const defaultPoemStyle = 0;\nexport const defaultX = screenWidth / 2;\nexport const defaultY = screenHeight / 2;\nexport const poemTopPadding = 33;\nexport const poemBottomPadding = 100;\nexport const poemPadding = 30;\nexport const defaultPoemWidth = 800;\nexport const defaultPoemHeight = 720;\n\n//#region Console style\nexport const consoleBackgroundColor = 'rgba(51,51,51,0.75)';\nexport const consoleWidth = 480;\nexport const consoleHeight = 180;\nexport const defaultConsoleBackground = 3;\nexport const defaultConsoleStyle = 7;\n//#endregion Console style\n\nconst BasePoemStyle: ITextStyle = {\n\talpha: 1,\n\tcolor: 'black',\n\tisBold: false,\n\tisItalic: false,\n\tisStrikethrough: false,\n\tisUnderlined: false,\n\tletterSpacing: 0,\n\tlineSpacing: 1.2,\n\tstrokeColor: '',\n\tstrokeWidth: 0,\n\tfontName: 'aller',\n\tfontSize: 12,\n};\n\nexport interface IPoemTextStyle extends ITextStyle {\n\tname: string;\n}\n\nexport const poemTextStyles: IPoemTextStyle[] = [\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Sayori',\n\t\tfontName: 'hashtag',\n\t\tfontSize: 34,\n\t\tlineSpacing: 1.05,\n\t\tletterSpacing: 0,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Natsuki',\n\t\tfontName: 'ammy_handwriting',\n\t\tfontSize: 28,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Monika',\n\t\tfontName: 'journal',\n\t\tfontSize: 34,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Yuri',\n\t\tfontName: 'jp_hand_slanted',\n\t\tlineSpacing: 1.5,\n\t\tfontSize: 32,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Yuri Act 2',\n\t\tfontName: 'damagrafik_script',\n\t\tfontSize: 18,\n\t\tletterSpacing: -8,\n\t\t// justify: true,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Yuri Unused',\n\t\tfontName: 'as_i_lay_dying',\n\t\tfontSize: 40,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'MC',\n\t\tfontName: 'halogen',\n\t\tfontSize: 30,\n\t\tlineSpacing: 1.53,\n\t},\n\t{\n\t\t...BasePoemStyle,\n\t\tname: 'Console',\n\t\tfontName: 'f25_bank_printer',\n\t\tfontSize: 18,\n\t\tcolor: 'white',\n\t\tlineSpacing: 1.1,\n\t},\n];\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./drop-target.vue?vue&type=style&index=0&id=0c92f421&lang=scss&scoped=true\"","import { RenderContext } from './rendererContext';\nimport { RenderAbortedException } from './renderAbortedException';\nimport environment from '@/environments/environment';\nimport getConstants from '@/constants';\n\nexport class Renderer {\n\tprivate previewCanvas: HTMLCanvasElement;\n\tprivate runningContext: RenderContext | null = null;\n\n\tpublic constructor(w?: number, h?: number) {\n\t\tconst constants = getConstants();\n\t\tthis.previewCanvas = document.createElement('canvas');\n\t\tthis.previewCanvas.width = w ?? constants.Base.screenWidth;\n\t\tthis.previewCanvas.height = h ?? constants.Base.screenHeight;\n\t}\n\n\tpublic async render(\n\t\trenderCallback: (rc: RenderContext) => Promise<void>,\n\t\thq: boolean = true,\n\t\tpreview: boolean = true\n\t): Promise<boolean> {\n\t\tif (this.runningContext) {\n\t\t\tthis.runningContext.abort();\n\t\t}\n\n\t\tconst ctx = this.previewCanvas.getContext('2d')!;\n\t\tctx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n\t\tconst context = (this.runningContext = RenderContext.makeWithContext(\n\t\t\tthis.previewCanvas,\n\t\t\tctx,\n\t\t\thq,\n\t\t\tpreview\n\t\t));\n\t\ttry {\n\t\t\tawait renderCallback(this.runningContext);\n\t\t} catch (e) {\n\t\t\tif (e instanceof RenderAbortedException) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthrow e;\n\t\t} finally {\n\t\t\tif (context === this.runningContext) {\n\t\t\t\tthis.runningContext = null;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic get width(): number {\n\t\treturn this.previewCanvas.width;\n\t}\n\n\tpublic get height(): number {\n\t\treturn this.previewCanvas.height;\n\t}\n\n\tpublic paintOnto(\n\t\tc: CanvasRenderingContext2D,\n\t\topts: { x: number; y: number; w?: number; h?: number }\n\t) {\n\t\tif (opts.w && opts.h) {\n\t\t\tc.drawImage(this.previewCanvas, opts.x, opts.y, opts.w, opts.h);\n\t\t} else {\n\t\t\tc.drawImage(this.previewCanvas, opts.x, opts.y);\n\t\t}\n\t}\n\n\tpublic async download(\n\t\trenderCallback: (rc: RenderContext) => Promise<void>,\n\t\tfilename: string\n\t): Promise<string> {\n\t\tconst downloadCanvas = document.createElement('canvas');\n\t\tdownloadCanvas.width = this.previewCanvas.width;\n\t\tdownloadCanvas.height = this.previewCanvas.height;\n\n\t\tconst ctx = downloadCanvas.getContext('2d')!;\n\t\tctx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n\t\tawait renderCallback(\n\t\t\tRenderContext.makeWithContext(downloadCanvas, ctx, true, false)\n\t\t);\n\n\t\treturn environment.saveToFile(downloadCanvas, filename);\n\t}\n\n\tpublic async renderToBlob(\n\t\trenderCallback: (rc: RenderContext) => Promise<void>\n\t): Promise<Blob> {\n\t\tconst downloadCanvas = document.createElement('canvas');\n\t\tdownloadCanvas.width = this.previewCanvas.width;\n\t\tdownloadCanvas.height = this.previewCanvas.height;\n\n\t\tconst ctx = downloadCanvas.getContext('2d')!;\n\t\tctx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n\t\tawait renderCallback(\n\t\t\tRenderContext.makeWithContext(downloadCanvas, ctx, true, false)\n\t\t);\n\t\treturn await new Promise<Blob>((resolve, reject) => {\n\t\t\tdownloadCanvas.toBlob(blob => {\n\t\t\t\tif (blob) resolve(blob);\n\t\t\t\telse reject();\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic getDataAt(x: number, y: number): Uint8ClampedArray {\n\t\tconst ctx = this.previewCanvas.getContext('2d');\n\n\t\treturn ctx!.getImageData(x, y, 1, 1).data;\n\t}\n}\n"],"sourceRoot":""}